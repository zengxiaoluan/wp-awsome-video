(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function e(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerpolicy&&(a.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?a.credentials="include":s.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=e(s);fetch(s.href,a)}})();(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&e(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function e(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();function cg(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var ba={exports:{}},W={};/**
* @license React
* react.production.min.js
*
* Copyright (c) Facebook, Inc. and its affiliates.
*
* This source code is licensed under the MIT license found in the
* LICENSE file in the root directory of this source tree.
*/var es=Symbol.for("react.element"),dg=Symbol.for("react.portal"),hg=Symbol.for("react.fragment"),fg=Symbol.for("react.strict_mode"),gg=Symbol.for("react.profiler"),pg=Symbol.for("react.provider"),mg=Symbol.for("react.context"),yg=Symbol.for("react.forward_ref"),vg=Symbol.for("react.suspense"),Eg=Symbol.for("react.memo"),Tg=Symbol.for("react.lazy"),Jl=Symbol.iterator;function Sg(r){return r===null||typeof r!="object"?null:(r=Jl&&r[Jl]||r["@@iterator"],typeof r=="function"?r:null)}var ed={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},rd=Object.assign,id={};function li(r,t,e){this.props=r,this.context=t,this.refs=id,this.updater=e||ed}li.prototype.isReactComponent={};li.prototype.setState=function(r,t){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,t,"setState")};li.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function sd(){}sd.prototype=li.prototype;function Ko(r,t,e){this.props=r,this.context=t,this.refs=id,this.updater=e||ed}var Vo=Ko.prototype=new sd;Vo.constructor=Ko;rd(Vo,li.prototype);Vo.isPureReactComponent=!0;var Zl=Array.isArray,ad=Object.prototype.hasOwnProperty,Ho={current:null},nd={key:!0,ref:!0,__self:!0,__source:!0};function od(r,t,e){var i,s={},a=null,n=null;if(t!=null)for(i in t.ref!==void 0&&(n=t.ref),t.key!==void 0&&(a=""+t.key),t)ad.call(t,i)&&!nd.hasOwnProperty(i)&&(s[i]=t[i]);var o=arguments.length-2;if(o===1)s.children=e;else if(1<o){for(var l=Array(o),u=0;u<o;u++)l[u]=arguments[u+2];s.children=l}if(r&&r.defaultProps)for(i in o=r.defaultProps,o)s[i]===void 0&&(s[i]=o[i]);return{$$typeof:es,type:r,key:a,ref:n,props:s,_owner:Ho.current}}function bg(r,t){return{$$typeof:es,type:r.type,key:t,ref:r.ref,props:r.props,_owner:r._owner}}function zo(r){return typeof r=="object"&&r!==null&&r.$$typeof===es}function Lg(r){var t={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(e){return t[e]})}var tu=/\/+/g;function Ka(r,t){return typeof r=="object"&&r!==null&&r.key!=null?Lg(""+r.key):t.toString(36)}function xs(r,t,e,i,s){var a=typeof r;(a==="undefined"||a==="boolean")&&(r=null);var n=!1;if(r===null)n=!0;else switch(a){case"string":case"number":n=!0;break;case"object":switch(r.$$typeof){case es:case dg:n=!0}}if(n)return n=r,s=s(n),r=i===""?"."+Ka(n,0):i,Zl(s)?(e="",r!=null&&(e=r.replace(tu,"$&/")+"/"),xs(s,t,e,"",function(u){return u})):s!=null&&(zo(s)&&(s=bg(s,e+(!s.key||n&&n.key===s.key?"":(""+s.key).replace(tu,"$&/")+"/")+r)),t.push(s)),1;if(n=0,i=i===""?".":i+":",Zl(r))for(var o=0;o<r.length;o++){a=r[o];var l=i+Ka(a,o);n+=xs(a,t,e,l,s)}else if(l=Sg(r),typeof l=="function")for(r=l.call(r),o=0;!(a=r.next()).done;)a=a.value,l=i+Ka(a,o++),n+=xs(a,t,e,l,s);else if(a==="object")throw t=String(r),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return n}function ns(r,t,e){if(r==null)return r;var i=[],s=0;return xs(r,i,"","",function(a){return t.call(e,a,s++)}),i}function kg(r){if(r._status===-1){var t=r._result;t=t(),t.then(function(e){(r._status===0||r._status===-1)&&(r._status=1,r._result=e)},function(e){(r._status===0||r._status===-1)&&(r._status=2,r._result=e)}),r._status===-1&&(r._status=0,r._result=t)}if(r._status===1)return r._result.default;throw r._result}var Ft={current:null},Os={transition:null},Ag={ReactCurrentDispatcher:Ft,ReactCurrentBatchConfig:Os,ReactCurrentOwner:Ho};W.Children={map:ns,forEach:function(r,t,e){ns(r,function(){t.apply(this,arguments)},e)},count:function(r){var t=0;return ns(r,function(){t++}),t},toArray:function(r){return ns(r,function(t){return t})||[]},only:function(r){if(!zo(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};W.Component=li;W.Fragment=hg;W.Profiler=gg;W.PureComponent=Ko;W.StrictMode=fg;W.Suspense=vg;W.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ag;W.cloneElement=function(r,t,e){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var i=rd({},r.props),s=r.key,a=r.ref,n=r._owner;if(t!=null){if(t.ref!==void 0&&(a=t.ref,n=Ho.current),t.key!==void 0&&(s=""+t.key),r.type&&r.type.defaultProps)var o=r.type.defaultProps;for(l in t)ad.call(t,l)&&!nd.hasOwnProperty(l)&&(i[l]=t[l]===void 0&&o!==void 0?o[l]:t[l])}var l=arguments.length-2;if(l===1)i.children=e;else if(1<l){o=Array(l);for(var u=0;u<l;u++)o[u]=arguments[u+2];i.children=o}return{$$typeof:es,type:r.type,key:s,ref:a,props:i,_owner:n}};W.createContext=function(r){return r={$$typeof:mg,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:pg,_context:r},r.Consumer=r};W.createElement=od;W.createFactory=function(r){var t=od.bind(null,r);return t.type=r,t};W.createRef=function(){return{current:null}};W.forwardRef=function(r){return{$$typeof:yg,render:r}};W.isValidElement=zo;W.lazy=function(r){return{$$typeof:Tg,_payload:{_status:-1,_result:r},_init:kg}};W.memo=function(r,t){return{$$typeof:Eg,type:r,compare:t===void 0?null:t}};W.startTransition=function(r){var t=Os.transition;Os.transition={};try{r()}finally{Os.transition=t}};W.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};W.useCallback=function(r,t){return Ft.current.useCallback(r,t)};W.useContext=function(r){return Ft.current.useContext(r)};W.useDebugValue=function(){};W.useDeferredValue=function(r){return Ft.current.useDeferredValue(r)};W.useEffect=function(r,t){return Ft.current.useEffect(r,t)};W.useId=function(){return Ft.current.useId()};W.useImperativeHandle=function(r,t,e){return Ft.current.useImperativeHandle(r,t,e)};W.useInsertionEffect=function(r,t){return Ft.current.useInsertionEffect(r,t)};W.useLayoutEffect=function(r,t){return Ft.current.useLayoutEffect(r,t)};W.useMemo=function(r,t){return Ft.current.useMemo(r,t)};W.useReducer=function(r,t,e){return Ft.current.useReducer(r,t,e)};W.useRef=function(r){return Ft.current.useRef(r)};W.useState=function(r){return Ft.current.useState(r)};W.useSyncExternalStore=function(r,t,e){return Ft.current.useSyncExternalStore(r,t,e)};W.useTransition=function(){return Ft.current.useTransition()};W.version="18.2.0";(function(r){r.exports=W})(ba);const pr=cg(ba.exports);var Bn={},ld={exports:{}},Qt={},ud={exports:{}},cd={};/**
* @license React
* scheduler.production.min.js
*
* Copyright (c) Facebook, Inc. and its affiliates.
*
* This source code is licensed under the MIT license found in the
* LICENSE file in the root directory of this source tree.
*/(function(r){function t(C,x){var F=C.length;C.push(x);t:for(;0<F;){var K=F-1>>>1,z=C[K];if(0<s(z,x))C[K]=x,C[F]=z,F=K;else break t}}function e(C){return C.length===0?null:C[0]}function i(C){if(C.length===0)return null;var x=C[0],F=C.pop();if(F!==x){C[0]=F;t:for(var K=0,z=C.length,Et=z>>>1;K<Et;){var ft=2*(K+1)-1,Rt=C[ft],Zt=ft+1,Ee=C[Zt];if(0>s(Rt,F))Zt<z&&0>s(Ee,Rt)?(C[K]=Ee,C[Zt]=F,K=Zt):(C[K]=Rt,C[ft]=F,K=ft);else if(Zt<z&&0>s(Ee,F))C[K]=Ee,C[Zt]=F,K=Zt;else break t}}return x}function s(C,x){var F=C.sortIndex-x.sortIndex;return F!==0?F:C.id-x.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;r.unstable_now=function(){return a.now()}}else{var n=Date,o=n.now();r.unstable_now=function(){return n.now()-o}}var l=[],u=[],c=1,d=null,h=3,f=!1,g=!1,p=!1,T=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function E(C){for(var x=e(u);x!==null;){if(x.callback===null)i(u);else if(x.startTime<=C)i(u),x.sortIndex=x.expirationTime,t(l,x);else break;x=e(u)}}function S(C){if(p=!1,E(C),!g)if(e(l)!==null)g=!0,st(b);else{var x=e(u);x!==null&&Q(S,x.startTime-C)}}function b(C,x){g=!1,p&&(p=!1,y(D),D=-1),f=!0;var F=h;try{for(E(x),d=e(l);d!==null&&(!(d.expirationTime>x)||C&&!U());){var K=d.callback;if(typeof K=="function"){d.callback=null,h=d.priorityLevel;var z=K(d.expirationTime<=x);x=r.unstable_now(),typeof z=="function"?d.callback=z:d===e(l)&&i(l),E(x)}else i(l);d=e(l)}if(d!==null)var Et=!0;else{var ft=e(u);ft!==null&&Q(S,ft.startTime-x),Et=!1}return Et}finally{d=null,h=F,f=!1}}var w=!1,k=null,D=-1,P=5,R=-1;function U(){return!(r.unstable_now()-R<P)}function M(){if(k!==null){var C=r.unstable_now();R=C;var x=!0;try{x=k(!0,C)}finally{x?Y():(w=!1,k=null)}}else w=!1}var Y;if(typeof v=="function")Y=function(){v(M)};else if(typeof MessageChannel<"u"){var pt=new MessageChannel,H=pt.port2;pt.port1.onmessage=M,Y=function(){H.postMessage(null)}}else Y=function(){T(M,0)};function st(C){k=C,w||(w=!0,Y())}function Q(C,x){D=T(function(){C(r.unstable_now())},x)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(C){C.callback=null},r.unstable_continueExecution=function(){g||f||(g=!0,st(b))},r.unstable_forceFrameRate=function(C){0>C||125<C?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<C?Math.floor(1e3/C):5},r.unstable_getCurrentPriorityLevel=function(){return h},r.unstable_getFirstCallbackNode=function(){return e(l)},r.unstable_next=function(C){switch(h){case 1:case 2:case 3:var x=3;break;default:x=h}var F=h;h=x;try{return C()}finally{h=F}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(C,x){switch(C){case 1:case 2:case 3:case 4:case 5:break;default:C=3}var F=h;h=C;try{return x()}finally{h=F}},r.unstable_scheduleCallback=function(C,x,F){var K=r.unstable_now();switch(typeof F=="object"&&F!==null?(F=F.delay,F=typeof F=="number"&&0<F?K+F:K):F=K,C){case 1:var z=-1;break;case 2:z=250;break;case 5:z=1073741823;break;case 4:z=1e4;break;default:z=5e3}return z=F+z,C={id:c++,callback:x,priorityLevel:C,startTime:F,expirationTime:z,sortIndex:-1},F>K?(C.sortIndex=F,t(u,C),e(l)===null&&C===e(u)&&(p?(y(D),D=-1):p=!0,Q(S,F-K))):(C.sortIndex=z,t(l,C),g||f||(g=!0,st(b))),C},r.unstable_shouldYield=U,r.unstable_wrapCallback=function(C){var x=h;return function(){var F=h;h=x;try{return C.apply(this,arguments)}finally{h=F}}}})(cd);(function(r){r.exports=cd})(ud);/**
* @license React
* react-dom.production.min.js
*
* Copyright (c) Facebook, Inc. and its affiliates.
*
* This source code is licensed under the MIT license found in the
* LICENSE file in the root directory of this source tree.
*/var dd=ba.exports,Xt=ud.exports;function O(r){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+r,e=1;e<arguments.length;e++)t+="&args[]="+encodeURIComponent(arguments[e]);return"Minified React error #"+r+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var hd=new Set,Fi={};function Ir(r,t){ei(r,t),ei(r+"Capture",t)}function ei(r,t){for(Fi[r]=t,r=0;r<t.length;r++)hd.add(t[r])}var Ne=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),$n=Object.prototype.hasOwnProperty,wg=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,eu={},ru={};function Rg(r){return $n.call(ru,r)?!0:$n.call(eu,r)?!1:wg.test(r)?ru[r]=!0:(eu[r]=!0,!1)}function Ig(r,t,e,i){if(e!==null&&e.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return i?!1:e!==null?!e.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function Dg(r,t,e,i){if(t===null||typeof t>"u"||Ig(r,t,e,i))return!0;if(i)return!1;if(e!==null)switch(e.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Mt(r,t,e,i,s,a,n){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=i,this.attributeNamespace=s,this.mustUseProperty=e,this.propertyName=r,this.type=t,this.sanitizeURL=a,this.removeEmptyString=n}var wt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){wt[r]=new Mt(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var t=r[0];wt[t]=new Mt(t,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){wt[r]=new Mt(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){wt[r]=new Mt(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){wt[r]=new Mt(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){wt[r]=new Mt(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){wt[r]=new Mt(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){wt[r]=new Mt(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){wt[r]=new Mt(r,5,!1,r.toLowerCase(),null,!1,!1)});var Wo=/[\-:]([a-z])/g;function Yo(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var t=r.replace(Wo,Yo);wt[t]=new Mt(t,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var t=r.replace(Wo,Yo);wt[t]=new Mt(t,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var t=r.replace(Wo,Yo);wt[t]=new Mt(t,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){wt[r]=new Mt(r,1,!1,r.toLowerCase(),null,!1,!1)});wt.xlinkHref=new Mt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){wt[r]=new Mt(r,1,!1,r.toLowerCase(),null,!0,!0)});function jo(r,t,e,i){var s=wt.hasOwnProperty(t)?wt[t]:null;(s!==null?s.type!==0:i||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Dg(t,e,s,i)&&(e=null),i||s===null?Rg(t)&&(e===null?r.removeAttribute(t):r.setAttribute(t,""+e)):s.mustUseProperty?r[s.propertyName]=e===null?s.type===3?!1:"":e:(t=s.attributeName,i=s.attributeNamespace,e===null?r.removeAttribute(t):(s=s.type,e=s===3||s===4&&e===!0?"":""+e,i?r.setAttributeNS(i,t,e):r.setAttribute(t,e))))}var Ge=dd.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,os=Symbol.for("react.element"),Fr=Symbol.for("react.portal"),Mr=Symbol.for("react.fragment"),qo=Symbol.for("react.strict_mode"),Gn=Symbol.for("react.profiler"),fd=Symbol.for("react.provider"),gd=Symbol.for("react.context"),Xo=Symbol.for("react.forward_ref"),Kn=Symbol.for("react.suspense"),Vn=Symbol.for("react.suspense_list"),Qo=Symbol.for("react.memo"),He=Symbol.for("react.lazy"),pd=Symbol.for("react.offscreen"),iu=Symbol.iterator;function di(r){return r===null||typeof r!="object"?null:(r=iu&&r[iu]||r["@@iterator"],typeof r=="function"?r:null)}var ct=Object.assign,Va;function Ti(r){if(Va===void 0)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);Va=t&&t[1]||""}return`
`+Va+r}var Ha=!1;function za(r,t){if(!r||Ha)return"";Ha=!0;var e=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var i=u}Reflect.construct(r,[],t)}else{try{t.call()}catch(u){i=u}r.call(t.prototype)}else{try{throw Error()}catch(u){i=u}r()}}catch(u){if(u&&i&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),a=i.stack.split(`
`),n=s.length-1,o=a.length-1;1<=n&&0<=o&&s[n]!==a[o];)o--;for(;1<=n&&0<=o;n--,o--)if(s[n]!==a[o]){if(n!==1||o!==1)do if(n--,o--,0>o||s[n]!==a[o]){var l=`
`+s[n].replace(" at new "," at ");return r.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",r.displayName)),l}while(1<=n&&0<=o);break}}}finally{Ha=!1,Error.prepareStackTrace=e}return(r=r?r.displayName||r.name:"")?Ti(r):""}function Cg(r){switch(r.tag){case 5:return Ti(r.type);case 16:return Ti("Lazy");case 13:return Ti("Suspense");case 19:return Ti("SuspenseList");case 0:case 2:case 15:return r=za(r.type,!1),r;case 11:return r=za(r.type.render,!1),r;case 1:return r=za(r.type,!0),r;default:return""}}function Hn(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case Mr:return"Fragment";case Fr:return"Portal";case Gn:return"Profiler";case qo:return"StrictMode";case Kn:return"Suspense";case Vn:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case gd:return(r.displayName||"Context")+".Consumer";case fd:return(r._context.displayName||"Context")+".Provider";case Xo:var t=r.render;return r=r.displayName,r||(r=t.displayName||t.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case Qo:return t=r.displayName||null,t!==null?t:Hn(r.type)||"Memo";case He:t=r._payload,r=r._init;try{return Hn(r(t))}catch{}}return null}function _g(r){var t=r.type;switch(r.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=t.render,r=r.displayName||r.name||"",t.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Hn(t);case 8:return t===qo?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function nr(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function md(r){var t=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Pg(r){var t=md(r)?"checked":"value",e=Object.getOwnPropertyDescriptor(r.constructor.prototype,t),i=""+r[t];if(!r.hasOwnProperty(t)&&typeof e<"u"&&typeof e.get=="function"&&typeof e.set=="function"){var s=e.get,a=e.set;return Object.defineProperty(r,t,{configurable:!0,get:function(){return s.call(this)},set:function(n){i=""+n,a.call(this,n)}}),Object.defineProperty(r,t,{enumerable:e.enumerable}),{getValue:function(){return i},setValue:function(n){i=""+n},stopTracking:function(){r._valueTracker=null,delete r[t]}}}}function ls(r){r._valueTracker||(r._valueTracker=Pg(r))}function yd(r){if(!r)return!1;var t=r._valueTracker;if(!t)return!0;var e=t.getValue(),i="";return r&&(i=md(r)?r.checked?"true":"false":r.value),r=i,r!==e?(t.setValue(r),!0):!1}function Ws(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function zn(r,t){var e=t.checked;return ct({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:e!=null?e:r._wrapperState.initialChecked})}function su(r,t){var e=t.defaultValue==null?"":t.defaultValue,i=t.checked!=null?t.checked:t.defaultChecked;e=nr(t.value!=null?t.value:e),r._wrapperState={initialChecked:i,initialValue:e,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function vd(r,t){t=t.checked,t!=null&&jo(r,"checked",t,!1)}function Wn(r,t){vd(r,t);var e=nr(t.value),i=t.type;if(e!=null)i==="number"?(e===0&&r.value===""||r.value!=e)&&(r.value=""+e):r.value!==""+e&&(r.value=""+e);else if(i==="submit"||i==="reset"){r.removeAttribute("value");return}t.hasOwnProperty("value")?Yn(r,t.type,e):t.hasOwnProperty("defaultValue")&&Yn(r,t.type,nr(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(r.defaultChecked=!!t.defaultChecked)}function au(r,t,e){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!(i!=="submit"&&i!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+r._wrapperState.initialValue,e||t===r.value||(r.value=t),r.defaultValue=t}e=r.name,e!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,e!==""&&(r.name=e)}function Yn(r,t,e){(t!=="number"||Ws(r.ownerDocument)!==r)&&(e==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+e&&(r.defaultValue=""+e))}var Si=Array.isArray;function jr(r,t,e,i){if(r=r.options,t){t={};for(var s=0;s<e.length;s++)t["$"+e[s]]=!0;for(e=0;e<r.length;e++)s=t.hasOwnProperty("$"+r[e].value),r[e].selected!==s&&(r[e].selected=s),s&&i&&(r[e].defaultSelected=!0)}else{for(e=""+nr(e),t=null,s=0;s<r.length;s++){if(r[s].value===e){r[s].selected=!0,i&&(r[s].defaultSelected=!0);return}t!==null||r[s].disabled||(t=r[s])}t!==null&&(t.selected=!0)}}function jn(r,t){if(t.dangerouslySetInnerHTML!=null)throw Error(O(91));return ct({},t,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function nu(r,t){var e=t.value;if(e==null){if(e=t.children,t=t.defaultValue,e!=null){if(t!=null)throw Error(O(92));if(Si(e)){if(1<e.length)throw Error(O(93));e=e[0]}t=e}t==null&&(t=""),e=t}r._wrapperState={initialValue:nr(e)}}function Ed(r,t){var e=nr(t.value),i=nr(t.defaultValue);e!=null&&(e=""+e,e!==r.value&&(r.value=e),t.defaultValue==null&&r.defaultValue!==e&&(r.defaultValue=e)),i!=null&&(r.defaultValue=""+i)}function ou(r){var t=r.textContent;t===r._wrapperState.initialValue&&t!==""&&t!==null&&(r.value=t)}function Td(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function qn(r,t){return r==null||r==="http://www.w3.org/1999/xhtml"?Td(t):r==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var us,Sd=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,e,i,s){MSApp.execUnsafeLocalFunction(function(){return r(t,e,i,s)})}:r}(function(r,t){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=t;else{for(us=us||document.createElement("div"),us.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=us.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;t.firstChild;)r.appendChild(t.firstChild)}});function Mi(r,t){if(t){var e=r.firstChild;if(e&&e===r.lastChild&&e.nodeType===3){e.nodeValue=t;return}}r.textContent=t}var ki={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},xg=["Webkit","ms","Moz","O"];Object.keys(ki).forEach(function(r){xg.forEach(function(t){t=t+r.charAt(0).toUpperCase()+r.substring(1),ki[t]=ki[r]})});function bd(r,t,e){return t==null||typeof t=="boolean"||t===""?"":e||typeof t!="number"||t===0||ki.hasOwnProperty(r)&&ki[r]?(""+t).trim():t+"px"}function Ld(r,t){r=r.style;for(var e in t)if(t.hasOwnProperty(e)){var i=e.indexOf("--")===0,s=bd(e,t[e],i);e==="float"&&(e="cssFloat"),i?r.setProperty(e,s):r[e]=s}}var Og=ct({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Xn(r,t){if(t){if(Og[r]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(O(137,r));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(O(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(O(61))}if(t.style!=null&&typeof t.style!="object")throw Error(O(62))}}function Qn(r,t){if(r.indexOf("-")===-1)return typeof t.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Jn=null;function Jo(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Zn=null,qr=null,Xr=null;function lu(r){if(r=ss(r)){if(typeof Zn!="function")throw Error(O(280));var t=r.stateNode;t&&(t=Ra(t),Zn(r.stateNode,r.type,t))}}function kd(r){qr?Xr?Xr.push(r):Xr=[r]:qr=r}function Ad(){if(qr){var r=qr,t=Xr;if(Xr=qr=null,lu(r),t)for(r=0;r<t.length;r++)lu(t[r])}}function wd(r,t){return r(t)}function Rd(){}var Wa=!1;function Id(r,t,e){if(Wa)return r(t,e);Wa=!0;try{return wd(r,t,e)}finally{Wa=!1,(qr!==null||Xr!==null)&&(Rd(),Ad())}}function Ni(r,t){var e=r.stateNode;if(e===null)return null;var i=Ra(e);if(i===null)return null;e=i[t];t:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(r=r.type,i=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!i;break t;default:r=!1}if(r)return null;if(e&&typeof e!="function")throw Error(O(231,t,typeof e));return e}var to=!1;if(Ne)try{var hi={};Object.defineProperty(hi,"passive",{get:function(){to=!0}}),window.addEventListener("test",hi,hi),window.removeEventListener("test",hi,hi)}catch{to=!1}function Fg(r,t,e,i,s,a,n,o,l){var u=Array.prototype.slice.call(arguments,3);try{t.apply(e,u)}catch(c){this.onError(c)}}var Ai=!1,Ys=null,js=!1,eo=null,Mg={onError:function(r){Ai=!0,Ys=r}};function Ng(r,t,e,i,s,a,n,o,l){Ai=!1,Ys=null,Fg.apply(Mg,arguments)}function Ug(r,t,e,i,s,a,n,o,l){if(Ng.apply(this,arguments),Ai){if(Ai){var u=Ys;Ai=!1,Ys=null}else throw Error(O(198));js||(js=!0,eo=u)}}function Dr(r){var t=r,e=r;if(r.alternate)for(;t.return;)t=t.return;else{r=t;do t=r,(t.flags&4098)!==0&&(e=t.return),r=t.return;while(r)}return t.tag===3?e:null}function Dd(r){if(r.tag===13){var t=r.memoizedState;if(t===null&&(r=r.alternate,r!==null&&(t=r.memoizedState)),t!==null)return t.dehydrated}return null}function uu(r){if(Dr(r)!==r)throw Error(O(188))}function Bg(r){var t=r.alternate;if(!t){if(t=Dr(r),t===null)throw Error(O(188));return t!==r?null:r}for(var e=r,i=t;;){var s=e.return;if(s===null)break;var a=s.alternate;if(a===null){if(i=s.return,i!==null){e=i;continue}break}if(s.child===a.child){for(a=s.child;a;){if(a===e)return uu(s),r;if(a===i)return uu(s),t;a=a.sibling}throw Error(O(188))}if(e.return!==i.return)e=s,i=a;else{for(var n=!1,o=s.child;o;){if(o===e){n=!0,e=s,i=a;break}if(o===i){n=!0,i=s,e=a;break}o=o.sibling}if(!n){for(o=a.child;o;){if(o===e){n=!0,e=a,i=s;break}if(o===i){n=!0,i=a,e=s;break}o=o.sibling}if(!n)throw Error(O(189))}}if(e.alternate!==i)throw Error(O(190))}if(e.tag!==3)throw Error(O(188));return e.stateNode.current===e?r:t}function Cd(r){return r=Bg(r),r!==null?_d(r):null}function _d(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var t=_d(r);if(t!==null)return t;r=r.sibling}return null}var Pd=Xt.unstable_scheduleCallback,cu=Xt.unstable_cancelCallback,$g=Xt.unstable_shouldYield,Gg=Xt.unstable_requestPaint,ht=Xt.unstable_now,Kg=Xt.unstable_getCurrentPriorityLevel,Zo=Xt.unstable_ImmediatePriority,xd=Xt.unstable_UserBlockingPriority,qs=Xt.unstable_NormalPriority,Vg=Xt.unstable_LowPriority,Od=Xt.unstable_IdlePriority,La=null,Ae=null;function Hg(r){if(Ae&&typeof Ae.onCommitFiberRoot=="function")try{Ae.onCommitFiberRoot(La,r,void 0,(r.current.flags&128)===128)}catch{}}var me=Math.clz32?Math.clz32:Yg,zg=Math.log,Wg=Math.LN2;function Yg(r){return r>>>=0,r===0?32:31-(zg(r)/Wg|0)|0}var cs=64,ds=4194304;function bi(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function Xs(r,t){var e=r.pendingLanes;if(e===0)return 0;var i=0,s=r.suspendedLanes,a=r.pingedLanes,n=e&268435455;if(n!==0){var o=n&~s;o!==0?i=bi(o):(a&=n,a!==0&&(i=bi(a)))}else n=e&~s,n!==0?i=bi(n):a!==0&&(i=bi(a));if(i===0)return 0;if(t!==0&&t!==i&&(t&s)===0&&(s=i&-i,a=t&-t,s>=a||s===16&&(a&4194240)!==0))return t;if((i&4)!==0&&(i|=e&16),t=r.entangledLanes,t!==0)for(r=r.entanglements,t&=i;0<t;)e=31-me(t),s=1<<e,i|=r[e],t&=~s;return i}function jg(r,t){switch(r){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function qg(r,t){for(var e=r.suspendedLanes,i=r.pingedLanes,s=r.expirationTimes,a=r.pendingLanes;0<a;){var n=31-me(a),o=1<<n,l=s[n];l===-1?((o&e)===0||(o&i)!==0)&&(s[n]=jg(o,t)):l<=t&&(r.expiredLanes|=o),a&=~o}}function ro(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function Fd(){var r=cs;return cs<<=1,(cs&4194240)===0&&(cs=64),r}function Ya(r){for(var t=[],e=0;31>e;e++)t.push(r);return t}function rs(r,t,e){r.pendingLanes|=t,t!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,t=31-me(t),r[t]=e}function Xg(r,t){var e=r.pendingLanes&~t;r.pendingLanes=t,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=t,r.mutableReadLanes&=t,r.entangledLanes&=t,t=r.entanglements;var i=r.eventTimes;for(r=r.expirationTimes;0<e;){var s=31-me(e),a=1<<s;t[s]=0,i[s]=-1,r[s]=-1,e&=~a}}function tl(r,t){var e=r.entangledLanes|=t;for(r=r.entanglements;e;){var i=31-me(e),s=1<<i;s&t|r[i]&t&&(r[i]|=t),e&=~s}}var J=0;function Md(r){return r&=-r,1<r?4<r?(r&268435455)!==0?16:536870912:4:1}var Nd,el,Ud,Bd,$d,io=!1,hs=[],Je=null,Ze=null,tr=null,Ui=new Map,Bi=new Map,je=[],Qg="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function du(r,t){switch(r){case"focusin":case"focusout":Je=null;break;case"dragenter":case"dragleave":Ze=null;break;case"mouseover":case"mouseout":tr=null;break;case"pointerover":case"pointerout":Ui.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Bi.delete(t.pointerId)}}function fi(r,t,e,i,s,a){return r===null||r.nativeEvent!==a?(r={blockedOn:t,domEventName:e,eventSystemFlags:i,nativeEvent:a,targetContainers:[s]},t!==null&&(t=ss(t),t!==null&&el(t)),r):(r.eventSystemFlags|=i,t=r.targetContainers,s!==null&&t.indexOf(s)===-1&&t.push(s),r)}function Jg(r,t,e,i,s){switch(t){case"focusin":return Je=fi(Je,r,t,e,i,s),!0;case"dragenter":return Ze=fi(Ze,r,t,e,i,s),!0;case"mouseover":return tr=fi(tr,r,t,e,i,s),!0;case"pointerover":var a=s.pointerId;return Ui.set(a,fi(Ui.get(a)||null,r,t,e,i,s)),!0;case"gotpointercapture":return a=s.pointerId,Bi.set(a,fi(Bi.get(a)||null,r,t,e,i,s)),!0}return!1}function Gd(r){var t=mr(r.target);if(t!==null){var e=Dr(t);if(e!==null){if(t=e.tag,t===13){if(t=Dd(e),t!==null){r.blockedOn=t,$d(r.priority,function(){Ud(e)});return}}else if(t===3&&e.stateNode.current.memoizedState.isDehydrated){r.blockedOn=e.tag===3?e.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Fs(r){if(r.blockedOn!==null)return!1;for(var t=r.targetContainers;0<t.length;){var e=so(r.domEventName,r.eventSystemFlags,t[0],r.nativeEvent);if(e===null){e=r.nativeEvent;var i=new e.constructor(e.type,e);Jn=i,e.target.dispatchEvent(i),Jn=null}else return t=ss(e),t!==null&&el(t),r.blockedOn=e,!1;t.shift()}return!0}function hu(r,t,e){Fs(r)&&e.delete(t)}function Zg(){io=!1,Je!==null&&Fs(Je)&&(Je=null),Ze!==null&&Fs(Ze)&&(Ze=null),tr!==null&&Fs(tr)&&(tr=null),Ui.forEach(hu),Bi.forEach(hu)}function gi(r,t){r.blockedOn===t&&(r.blockedOn=null,io||(io=!0,Xt.unstable_scheduleCallback(Xt.unstable_NormalPriority,Zg)))}function $i(r){function t(s){return gi(s,r)}if(0<hs.length){gi(hs[0],r);for(var e=1;e<hs.length;e++){var i=hs[e];i.blockedOn===r&&(i.blockedOn=null)}}for(Je!==null&&gi(Je,r),Ze!==null&&gi(Ze,r),tr!==null&&gi(tr,r),Ui.forEach(t),Bi.forEach(t),e=0;e<je.length;e++)i=je[e],i.blockedOn===r&&(i.blockedOn=null);for(;0<je.length&&(e=je[0],e.blockedOn===null);)Gd(e),e.blockedOn===null&&je.shift()}var Qr=Ge.ReactCurrentBatchConfig,Qs=!0;function tp(r,t,e,i){var s=J,a=Qr.transition;Qr.transition=null;try{J=1,rl(r,t,e,i)}finally{J=s,Qr.transition=a}}function ep(r,t,e,i){var s=J,a=Qr.transition;Qr.transition=null;try{J=4,rl(r,t,e,i)}finally{J=s,Qr.transition=a}}function rl(r,t,e,i){if(Qs){var s=so(r,t,e,i);if(s===null)sn(r,t,i,Js,e),du(r,i);else if(Jg(s,r,t,e,i))i.stopPropagation();else if(du(r,i),t&4&&-1<Qg.indexOf(r)){for(;s!==null;){var a=ss(s);if(a!==null&&Nd(a),a=so(r,t,e,i),a===null&&sn(r,t,i,Js,e),a===s)break;s=a}s!==null&&i.stopPropagation()}else sn(r,t,i,null,e)}}var Js=null;function so(r,t,e,i){if(Js=null,r=Jo(i),r=mr(r),r!==null)if(t=Dr(r),t===null)r=null;else if(e=t.tag,e===13){if(r=Dd(t),r!==null)return r;r=null}else if(e===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;r=null}else t!==r&&(r=null);return Js=r,null}function Kd(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Kg()){case Zo:return 1;case xd:return 4;case qs:case Vg:return 16;case Od:return 536870912;default:return 16}default:return 16}}var Xe=null,il=null,Ms=null;function Vd(){if(Ms)return Ms;var r,t=il,e=t.length,i,s="value"in Xe?Xe.value:Xe.textContent,a=s.length;for(r=0;r<e&&t[r]===s[r];r++);var n=e-r;for(i=1;i<=n&&t[e-i]===s[a-i];i++);return Ms=s.slice(r,1<i?1-i:void 0)}function Ns(r){var t=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&t===13&&(r=13)):r=t,r===10&&(r=13),32<=r||r===13?r:0}function fs(){return!0}function fu(){return!1}function Jt(r){function t(e,i,s,a,n){this._reactName=e,this._targetInst=s,this.type=i,this.nativeEvent=a,this.target=n,this.currentTarget=null;for(var o in r)r.hasOwnProperty(o)&&(e=r[o],this[o]=e?e(a):a[o]);return this.isDefaultPrevented=(a.defaultPrevented!=null?a.defaultPrevented:a.returnValue===!1)?fs:fu,this.isPropagationStopped=fu,this}return ct(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():typeof e.returnValue!="unknown"&&(e.returnValue=!1),this.isDefaultPrevented=fs)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():typeof e.cancelBubble!="unknown"&&(e.cancelBubble=!0),this.isPropagationStopped=fs)},persist:function(){},isPersistent:fs}),t}var ui={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},sl=Jt(ui),is=ct({},ui,{view:0,detail:0}),rp=Jt(is),ja,qa,pi,ka=ct({},is,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:al,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==pi&&(pi&&r.type==="mousemove"?(ja=r.screenX-pi.screenX,qa=r.screenY-pi.screenY):qa=ja=0,pi=r),ja)},movementY:function(r){return"movementY"in r?r.movementY:qa}}),gu=Jt(ka),ip=ct({},ka,{dataTransfer:0}),sp=Jt(ip),ap=ct({},is,{relatedTarget:0}),Xa=Jt(ap),np=ct({},ui,{animationName:0,elapsedTime:0,pseudoElement:0}),op=Jt(np),lp=ct({},ui,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),up=Jt(lp),cp=ct({},ui,{data:0}),pu=Jt(cp),dp={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hp={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},fp={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function gp(r){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(r):(r=fp[r])?!!t[r]:!1}function al(){return gp}var pp=ct({},is,{key:function(r){if(r.key){var t=dp[r.key]||r.key;if(t!=="Unidentified")return t}return r.type==="keypress"?(r=Ns(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?hp[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:al,charCode:function(r){return r.type==="keypress"?Ns(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?Ns(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),mp=Jt(pp),yp=ct({},ka,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),mu=Jt(yp),vp=ct({},is,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:al}),Ep=Jt(vp),Tp=ct({},ui,{propertyName:0,elapsedTime:0,pseudoElement:0}),Sp=Jt(Tp),bp=ct({},ka,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),Lp=Jt(bp),kp=[9,13,27,32],nl=Ne&&"CompositionEvent"in window,wi=null;Ne&&"documentMode"in document&&(wi=document.documentMode);var Ap=Ne&&"TextEvent"in window&&!wi,Hd=Ne&&(!nl||wi&&8<wi&&11>=wi),yu=String.fromCharCode(32),vu=!1;function zd(r,t){switch(r){case"keyup":return kp.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Wd(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Nr=!1;function wp(r,t){switch(r){case"compositionend":return Wd(t);case"keypress":return t.which!==32?null:(vu=!0,yu);case"textInput":return r=t.data,r===yu&&vu?null:r;default:return null}}function Rp(r,t){if(Nr)return r==="compositionend"||!nl&&zd(r,t)?(r=Vd(),Ms=il=Xe=null,Nr=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Hd&&t.locale!=="ko"?null:t.data;default:return null}}var Ip={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Eu(r){var t=r&&r.nodeName&&r.nodeName.toLowerCase();return t==="input"?!!Ip[r.type]:t==="textarea"}function Yd(r,t,e,i){kd(i),t=Zs(t,"onChange"),0<t.length&&(e=new sl("onChange","change",null,e,i),r.push({event:e,listeners:t}))}var Ri=null,Gi=null;function Dp(r){sh(r,0)}function Aa(r){var t=$r(r);if(yd(t))return r}function Cp(r,t){if(r==="change")return t}var jd=!1;if(Ne){var Qa;if(Ne){var Ja="oninput"in document;if(!Ja){var Tu=document.createElement("div");Tu.setAttribute("oninput","return;"),Ja=typeof Tu.oninput=="function"}Qa=Ja}else Qa=!1;jd=Qa&&(!document.documentMode||9<document.documentMode)}function Su(){Ri&&(Ri.detachEvent("onpropertychange",qd),Gi=Ri=null)}function qd(r){if(r.propertyName==="value"&&Aa(Gi)){var t=[];Yd(t,Gi,r,Jo(r)),Id(Dp,t)}}function _p(r,t,e){r==="focusin"?(Su(),Ri=t,Gi=e,Ri.attachEvent("onpropertychange",qd)):r==="focusout"&&Su()}function Pp(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Aa(Gi)}function xp(r,t){if(r==="click")return Aa(t)}function Op(r,t){if(r==="input"||r==="change")return Aa(t)}function Fp(r,t){return r===t&&(r!==0||1/r===1/t)||r!==r&&t!==t}var ve=typeof Object.is=="function"?Object.is:Fp;function Ki(r,t){if(ve(r,t))return!0;if(typeof r!="object"||r===null||typeof t!="object"||t===null)return!1;var e=Object.keys(r),i=Object.keys(t);if(e.length!==i.length)return!1;for(i=0;i<e.length;i++){var s=e[i];if(!$n.call(t,s)||!ve(r[s],t[s]))return!1}return!0}function bu(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function Lu(r,t){var e=bu(r);r=0;for(var i;e;){if(e.nodeType===3){if(i=r+e.textContent.length,r<=t&&i>=t)return{node:e,offset:t-r};r=i}t:{for(;e;){if(e.nextSibling){e=e.nextSibling;break t}e=e.parentNode}e=void 0}e=bu(e)}}function Xd(r,t){return r&&t?r===t?!0:r&&r.nodeType===3?!1:t&&t.nodeType===3?Xd(r,t.parentNode):"contains"in r?r.contains(t):r.compareDocumentPosition?!!(r.compareDocumentPosition(t)&16):!1:!1}function Qd(){for(var r=window,t=Ws();t instanceof r.HTMLIFrameElement;){try{var e=typeof t.contentWindow.location.href=="string"}catch{e=!1}if(e)r=t.contentWindow;else break;t=Ws(r.document)}return t}function ol(r){var t=r&&r.nodeName&&r.nodeName.toLowerCase();return t&&(t==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||t==="textarea"||r.contentEditable==="true")}function Mp(r){var t=Qd(),e=r.focusedElem,i=r.selectionRange;if(t!==e&&e&&e.ownerDocument&&Xd(e.ownerDocument.documentElement,e)){if(i!==null&&ol(e)){if(t=i.start,r=i.end,r===void 0&&(r=t),"selectionStart"in e)e.selectionStart=t,e.selectionEnd=Math.min(r,e.value.length);else if(r=(t=e.ownerDocument||document)&&t.defaultView||window,r.getSelection){r=r.getSelection();var s=e.textContent.length,a=Math.min(i.start,s);i=i.end===void 0?a:Math.min(i.end,s),!r.extend&&a>i&&(s=i,i=a,a=s),s=Lu(e,a);var n=Lu(e,i);s&&n&&(r.rangeCount!==1||r.anchorNode!==s.node||r.anchorOffset!==s.offset||r.focusNode!==n.node||r.focusOffset!==n.offset)&&(t=t.createRange(),t.setStart(s.node,s.offset),r.removeAllRanges(),a>i?(r.addRange(t),r.extend(n.node,n.offset)):(t.setEnd(n.node,n.offset),r.addRange(t)))}}for(t=[],r=e;r=r.parentNode;)r.nodeType===1&&t.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof e.focus=="function"&&e.focus(),e=0;e<t.length;e++)r=t[e],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var Np=Ne&&"documentMode"in document&&11>=document.documentMode,Ur=null,ao=null,Ii=null,no=!1;function ku(r,t,e){var i=e.window===e?e.document:e.nodeType===9?e:e.ownerDocument;no||Ur==null||Ur!==Ws(i)||(i=Ur,"selectionStart"in i&&ol(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Ii&&Ki(Ii,i)||(Ii=i,i=Zs(ao,"onSelect"),0<i.length&&(t=new sl("onSelect","select",null,t,e),r.push({event:t,listeners:i}),t.target=Ur)))}function gs(r,t){var e={};return e[r.toLowerCase()]=t.toLowerCase(),e["Webkit"+r]="webkit"+t,e["Moz"+r]="moz"+t,e}var Br={animationend:gs("Animation","AnimationEnd"),animationiteration:gs("Animation","AnimationIteration"),animationstart:gs("Animation","AnimationStart"),transitionend:gs("Transition","TransitionEnd")},Za={},Jd={};Ne&&(Jd=document.createElement("div").style,"AnimationEvent"in window||(delete Br.animationend.animation,delete Br.animationiteration.animation,delete Br.animationstart.animation),"TransitionEvent"in window||delete Br.transitionend.transition);function wa(r){if(Za[r])return Za[r];if(!Br[r])return r;var t=Br[r],e;for(e in t)if(t.hasOwnProperty(e)&&e in Jd)return Za[r]=t[e];return r}var Zd=wa("animationend"),th=wa("animationiteration"),eh=wa("animationstart"),rh=wa("transitionend"),ih=new Map,Au="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function lr(r,t){ih.set(r,t),Ir(t,[r])}for(var tn=0;tn<Au.length;tn++){var en=Au[tn],Up=en.toLowerCase(),Bp=en[0].toUpperCase()+en.slice(1);lr(Up,"on"+Bp)}lr(Zd,"onAnimationEnd");lr(th,"onAnimationIteration");lr(eh,"onAnimationStart");lr("dblclick","onDoubleClick");lr("focusin","onFocus");lr("focusout","onBlur");lr(rh,"onTransitionEnd");ei("onMouseEnter",["mouseout","mouseover"]);ei("onMouseLeave",["mouseout","mouseover"]);ei("onPointerEnter",["pointerout","pointerover"]);ei("onPointerLeave",["pointerout","pointerover"]);Ir("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ir("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ir("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ir("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ir("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ir("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Li="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),$p=new Set("cancel close invalid load scroll toggle".split(" ").concat(Li));function wu(r,t,e){var i=r.type||"unknown-event";r.currentTarget=e,Ug(i,t,void 0,r),r.currentTarget=null}function sh(r,t){t=(t&4)!==0;for(var e=0;e<r.length;e++){var i=r[e],s=i.event;i=i.listeners;t:{var a=void 0;if(t)for(var n=i.length-1;0<=n;n--){var o=i[n],l=o.instance,u=o.currentTarget;if(o=o.listener,l!==a&&s.isPropagationStopped())break t;wu(s,o,u),a=l}else for(n=0;n<i.length;n++){if(o=i[n],l=o.instance,u=o.currentTarget,o=o.listener,l!==a&&s.isPropagationStopped())break t;wu(s,o,u),a=l}}}if(js)throw r=eo,js=!1,eo=null,r}function et(r,t){var e=t[ho];e===void 0&&(e=t[ho]=new Set);var i=r+"__bubble";e.has(i)||(ah(t,r,2,!1),e.add(i))}function rn(r,t,e){var i=0;t&&(i|=4),ah(e,r,i,t)}var ps="_reactListening"+Math.random().toString(36).slice(2);function Vi(r){if(!r[ps]){r[ps]=!0,hd.forEach(function(e){e!=="selectionchange"&&($p.has(e)||rn(e,!1,r),rn(e,!0,r))});var t=r.nodeType===9?r:r.ownerDocument;t===null||t[ps]||(t[ps]=!0,rn("selectionchange",!1,t))}}function ah(r,t,e,i){switch(Kd(t)){case 1:var s=tp;break;case 4:s=ep;break;default:s=rl}e=s.bind(null,t,e,r),s=void 0,!to||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(s=!0),i?s!==void 0?r.addEventListener(t,e,{capture:!0,passive:s}):r.addEventListener(t,e,!0):s!==void 0?r.addEventListener(t,e,{passive:s}):r.addEventListener(t,e,!1)}function sn(r,t,e,i,s){var a=i;if((t&1)===0&&(t&2)===0&&i!==null)t:for(;;){if(i===null)return;var n=i.tag;if(n===3||n===4){var o=i.stateNode.containerInfo;if(o===s||o.nodeType===8&&o.parentNode===s)break;if(n===4)for(n=i.return;n!==null;){var l=n.tag;if((l===3||l===4)&&(l=n.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;n=n.return}for(;o!==null;){if(n=mr(o),n===null)return;if(l=n.tag,l===5||l===6){i=a=n;continue t}o=o.parentNode}}i=i.return}Id(function(){var u=a,c=Jo(e),d=[];t:{var h=ih.get(r);if(h!==void 0){var f=sl,g=r;switch(r){case"keypress":if(Ns(e)===0)break t;case"keydown":case"keyup":f=mp;break;case"focusin":g="focus",f=Xa;break;case"focusout":g="blur",f=Xa;break;case"beforeblur":case"afterblur":f=Xa;break;case"click":if(e.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=gu;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=sp;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=Ep;break;case Zd:case th:case eh:f=op;break;case rh:f=Sp;break;case"scroll":f=rp;break;case"wheel":f=Lp;break;case"copy":case"cut":case"paste":f=up;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=mu}var p=(t&4)!==0,T=!p&&r==="scroll",y=p?h!==null?h+"Capture":null:h;p=[];for(var v=u,E;v!==null;){E=v;var S=E.stateNode;if(E.tag===5&&S!==null&&(E=S,y!==null&&(S=Ni(v,y),S!=null&&p.push(Hi(v,S,E)))),T)break;v=v.return}0<p.length&&(h=new f(h,g,null,e,c),d.push({event:h,listeners:p}))}}if((t&7)===0){t:{if(h=r==="mouseover"||r==="pointerover",f=r==="mouseout"||r==="pointerout",h&&e!==Jn&&(g=e.relatedTarget||e.fromElement)&&(mr(g)||g[Ue]))break t;if((f||h)&&(h=c.window===c?c:(h=c.ownerDocument)?h.defaultView||h.parentWindow:window,f?(g=e.relatedTarget||e.toElement,f=u,g=g?mr(g):null,g!==null&&(T=Dr(g),g!==T||g.tag!==5&&g.tag!==6)&&(g=null)):(f=null,g=u),f!==g)){if(p=gu,S="onMouseLeave",y="onMouseEnter",v="mouse",(r==="pointerout"||r==="pointerover")&&(p=mu,S="onPointerLeave",y="onPointerEnter",v="pointer"),T=f==null?h:$r(f),E=g==null?h:$r(g),h=new p(S,v+"leave",f,e,c),h.target=T,h.relatedTarget=E,S=null,mr(c)===u&&(p=new p(y,v+"enter",g,e,c),p.target=E,p.relatedTarget=T,S=p),T=S,f&&g)e:{for(p=f,y=g,v=0,E=p;E;E=Cr(E))v++;for(E=0,S=y;S;S=Cr(S))E++;for(;0<v-E;)p=Cr(p),v--;for(;0<E-v;)y=Cr(y),E--;for(;v--;){if(p===y||y!==null&&p===y.alternate)break e;p=Cr(p),y=Cr(y)}p=null}else p=null;f!==null&&Ru(d,h,f,p,!1),g!==null&&T!==null&&Ru(d,T,g,p,!0)}}t:{if(h=u?$r(u):window,f=h.nodeName&&h.nodeName.toLowerCase(),f==="select"||f==="input"&&h.type==="file")var b=Cp;else if(Eu(h))if(jd)b=Op;else{b=Pp;var w=_p}else(f=h.nodeName)&&f.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(b=xp);if(b&&(b=b(r,u))){Yd(d,b,e,c);break t}w&&w(r,h,u),r==="focusout"&&(w=h._wrapperState)&&w.controlled&&h.type==="number"&&Yn(h,"number",h.value)}switch(w=u?$r(u):window,r){case"focusin":(Eu(w)||w.contentEditable==="true")&&(Ur=w,ao=u,Ii=null);break;case"focusout":Ii=ao=Ur=null;break;case"mousedown":no=!0;break;case"contextmenu":case"mouseup":case"dragend":no=!1,ku(d,e,c);break;case"selectionchange":if(Np)break;case"keydown":case"keyup":ku(d,e,c)}var k;if(nl)t:{switch(r){case"compositionstart":var D="onCompositionStart";break t;case"compositionend":D="onCompositionEnd";break t;case"compositionupdate":D="onCompositionUpdate";break t}D=void 0}else Nr?zd(r,e)&&(D="onCompositionEnd"):r==="keydown"&&e.keyCode===229&&(D="onCompositionStart");D&&(Hd&&e.locale!=="ko"&&(Nr||D!=="onCompositionStart"?D==="onCompositionEnd"&&Nr&&(k=Vd()):(Xe=c,il="value"in Xe?Xe.value:Xe.textContent,Nr=!0)),w=Zs(u,D),0<w.length&&(D=new pu(D,r,null,e,c),d.push({event:D,listeners:w}),k?D.data=k:(k=Wd(e),k!==null&&(D.data=k)))),(k=Ap?wp(r,e):Rp(r,e))&&(u=Zs(u,"onBeforeInput"),0<u.length&&(c=new pu("onBeforeInput","beforeinput",null,e,c),d.push({event:c,listeners:u}),c.data=k))}sh(d,t)})}function Hi(r,t,e){return{instance:r,listener:t,currentTarget:e}}function Zs(r,t){for(var e=t+"Capture",i=[];r!==null;){var s=r,a=s.stateNode;s.tag===5&&a!==null&&(s=a,a=Ni(r,e),a!=null&&i.unshift(Hi(r,a,s)),a=Ni(r,t),a!=null&&i.push(Hi(r,a,s))),r=r.return}return i}function Cr(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function Ru(r,t,e,i,s){for(var a=t._reactName,n=[];e!==null&&e!==i;){var o=e,l=o.alternate,u=o.stateNode;if(l!==null&&l===i)break;o.tag===5&&u!==null&&(o=u,s?(l=Ni(e,a),l!=null&&n.unshift(Hi(e,l,o))):s||(l=Ni(e,a),l!=null&&n.push(Hi(e,l,o)))),e=e.return}n.length!==0&&r.push({event:t,listeners:n})}var Gp=/\r\n?/g,Kp=/\u0000|\uFFFD/g;function Iu(r){return(typeof r=="string"?r:""+r).replace(Gp,`
`).replace(Kp,"")}function ms(r,t,e){if(t=Iu(t),Iu(r)!==t&&e)throw Error(O(425))}function ta(){}var oo=null,lo=null;function uo(r,t){return r==="textarea"||r==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var co=typeof setTimeout=="function"?setTimeout:void 0,Vp=typeof clearTimeout=="function"?clearTimeout:void 0,Du=typeof Promise=="function"?Promise:void 0,Hp=typeof queueMicrotask=="function"?queueMicrotask:typeof Du<"u"?function(r){return Du.resolve(null).then(r).catch(zp)}:co;function zp(r){setTimeout(function(){throw r})}function an(r,t){var e=t,i=0;do{var s=e.nextSibling;if(r.removeChild(e),s&&s.nodeType===8)if(e=s.data,e==="/$"){if(i===0){r.removeChild(s),$i(t);return}i--}else e!=="$"&&e!=="$?"&&e!=="$!"||i++;e=s}while(e);$i(t)}function er(r){for(;r!=null;r=r.nextSibling){var t=r.nodeType;if(t===1||t===3)break;if(t===8){if(t=r.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return r}function Cu(r){r=r.previousSibling;for(var t=0;r;){if(r.nodeType===8){var e=r.data;if(e==="$"||e==="$!"||e==="$?"){if(t===0)return r;t--}else e==="/$"&&t++}r=r.previousSibling}return null}var ci=Math.random().toString(36).slice(2),ke="__reactFiber$"+ci,zi="__reactProps$"+ci,Ue="__reactContainer$"+ci,ho="__reactEvents$"+ci,Wp="__reactListeners$"+ci,Yp="__reactHandles$"+ci;function mr(r){var t=r[ke];if(t)return t;for(var e=r.parentNode;e;){if(t=e[Ue]||e[ke]){if(e=t.alternate,t.child!==null||e!==null&&e.child!==null)for(r=Cu(r);r!==null;){if(e=r[ke])return e;r=Cu(r)}return t}r=e,e=r.parentNode}return null}function ss(r){return r=r[ke]||r[Ue],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function $r(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(O(33))}function Ra(r){return r[zi]||null}var fo=[],Gr=-1;function ur(r){return{current:r}}function it(r){0>Gr||(r.current=fo[Gr],fo[Gr]=null,Gr--)}function tt(r,t){Gr++,fo[Gr]=r.current,r.current=t}var or={},Pt=ur(or),Vt=ur(!1),br=or;function ri(r,t){var e=r.type.contextTypes;if(!e)return or;var i=r.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var s={},a;for(a in e)s[a]=t[a];return i&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=t,r.__reactInternalMemoizedMaskedChildContext=s),s}function Ht(r){return r=r.childContextTypes,r!=null}function ea(){it(Vt),it(Pt)}function _u(r,t,e){if(Pt.current!==or)throw Error(O(168));tt(Pt,t),tt(Vt,e)}function nh(r,t,e){var i=r.stateNode;if(t=t.childContextTypes,typeof i.getChildContext!="function")return e;i=i.getChildContext();for(var s in i)if(!(s in t))throw Error(O(108,_g(r)||"Unknown",s));return ct({},e,i)}function ra(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||or,br=Pt.current,tt(Pt,r),tt(Vt,Vt.current),!0}function Pu(r,t,e){var i=r.stateNode;if(!i)throw Error(O(169));e?(r=nh(r,t,br),i.__reactInternalMemoizedMergedChildContext=r,it(Vt),it(Pt),tt(Pt,r)):it(Vt),tt(Vt,e)}var Pe=null,Ia=!1,nn=!1;function oh(r){Pe===null?Pe=[r]:Pe.push(r)}function jp(r){Ia=!0,oh(r)}function cr(){if(!nn&&Pe!==null){nn=!0;var r=0,t=J;try{var e=Pe;for(J=1;r<e.length;r++){var i=e[r];do i=i(!0);while(i!==null)}Pe=null,Ia=!1}catch(s){throw Pe!==null&&(Pe=Pe.slice(r+1)),Pd(Zo,cr),s}finally{J=t,nn=!1}}return null}var Kr=[],Vr=0,ia=null,sa=0,re=[],ie=0,Lr=null,xe=1,Oe="";function hr(r,t){Kr[Vr++]=sa,Kr[Vr++]=ia,ia=r,sa=t}function lh(r,t,e){re[ie++]=xe,re[ie++]=Oe,re[ie++]=Lr,Lr=r;var i=xe;r=Oe;var s=32-me(i)-1;i&=~(1<<s),e+=1;var a=32-me(t)+s;if(30<a){var n=s-s%5;a=(i&(1<<n)-1).toString(32),i>>=n,s-=n,xe=1<<32-me(t)+s|e<<s|i,Oe=a+r}else xe=1<<a|e<<s|i,Oe=r}function ll(r){r.return!==null&&(hr(r,1),lh(r,1,0))}function ul(r){for(;r===ia;)ia=Kr[--Vr],Kr[Vr]=null,sa=Kr[--Vr],Kr[Vr]=null;for(;r===Lr;)Lr=re[--ie],re[ie]=null,Oe=re[--ie],re[ie]=null,xe=re[--ie],re[ie]=null}var qt=null,jt=null,at=!1,fe=null;function uh(r,t){var e=se(5,null,null,0);e.elementType="DELETED",e.stateNode=t,e.return=r,t=r.deletions,t===null?(r.deletions=[e],r.flags|=16):t.push(e)}function xu(r,t){switch(r.tag){case 5:var e=r.type;return t=t.nodeType!==1||e.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(r.stateNode=t,qt=r,jt=er(t.firstChild),!0):!1;case 6:return t=r.pendingProps===""||t.nodeType!==3?null:t,t!==null?(r.stateNode=t,qt=r,jt=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(e=Lr!==null?{id:xe,overflow:Oe}:null,r.memoizedState={dehydrated:t,treeContext:e,retryLane:1073741824},e=se(18,null,null,0),e.stateNode=t,e.return=r,r.child=e,qt=r,jt=null,!0):!1;default:return!1}}function go(r){return(r.mode&1)!==0&&(r.flags&128)===0}function po(r){if(at){var t=jt;if(t){var e=t;if(!xu(r,t)){if(go(r))throw Error(O(418));t=er(e.nextSibling);var i=qt;t&&xu(r,t)?uh(i,e):(r.flags=r.flags&-4097|2,at=!1,qt=r)}}else{if(go(r))throw Error(O(418));r.flags=r.flags&-4097|2,at=!1,qt=r}}}function Ou(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;qt=r}function ys(r){if(r!==qt)return!1;if(!at)return Ou(r),at=!0,!1;var t;if((t=r.tag!==3)&&!(t=r.tag!==5)&&(t=r.type,t=t!=="head"&&t!=="body"&&!uo(r.type,r.memoizedProps)),t&&(t=jt)){if(go(r))throw ch(),Error(O(418));for(;t;)uh(r,t),t=er(t.nextSibling)}if(Ou(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(O(317));t:{for(r=r.nextSibling,t=0;r;){if(r.nodeType===8){var e=r.data;if(e==="/$"){if(t===0){jt=er(r.nextSibling);break t}t--}else e!=="$"&&e!=="$!"&&e!=="$?"||t++}r=r.nextSibling}jt=null}}else jt=qt?er(r.stateNode.nextSibling):null;return!0}function ch(){for(var r=jt;r;)r=er(r.nextSibling)}function ii(){jt=qt=null,at=!1}function cl(r){fe===null?fe=[r]:fe.push(r)}var qp=Ge.ReactCurrentBatchConfig;function de(r,t){if(r&&r.defaultProps){t=ct({},t),r=r.defaultProps;for(var e in r)t[e]===void 0&&(t[e]=r[e]);return t}return t}var aa=ur(null),na=null,Hr=null,dl=null;function hl(){dl=Hr=na=null}function fl(r){var t=aa.current;it(aa),r._currentValue=t}function mo(r,t,e){for(;r!==null;){var i=r.alternate;if((r.childLanes&t)!==t?(r.childLanes|=t,i!==null&&(i.childLanes|=t)):i!==null&&(i.childLanes&t)!==t&&(i.childLanes|=t),r===e)break;r=r.return}}function Jr(r,t){na=r,dl=Hr=null,r=r.dependencies,r!==null&&r.firstContext!==null&&((r.lanes&t)!==0&&(Kt=!0),r.firstContext=null)}function ne(r){var t=r._currentValue;if(dl!==r)if(r={context:r,memoizedValue:t,next:null},Hr===null){if(na===null)throw Error(O(308));Hr=r,na.dependencies={lanes:0,firstContext:r}}else Hr=Hr.next=r;return t}var yr=null;function gl(r){yr===null?yr=[r]:yr.push(r)}function dh(r,t,e,i){var s=t.interleaved;return s===null?(e.next=e,gl(t)):(e.next=s.next,s.next=e),t.interleaved=e,Be(r,i)}function Be(r,t){r.lanes|=t;var e=r.alternate;for(e!==null&&(e.lanes|=t),e=r,r=r.return;r!==null;)r.childLanes|=t,e=r.alternate,e!==null&&(e.childLanes|=t),e=r,r=r.return;return e.tag===3?e.stateNode:null}var ze=!1;function pl(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function hh(r,t){r=r.updateQueue,t.updateQueue===r&&(t.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function Me(r,t){return{eventTime:r,lane:t,tag:0,payload:null,callback:null,next:null}}function rr(r,t,e){var i=r.updateQueue;if(i===null)return null;if(i=i.shared,(q&2)!==0){var s=i.pending;return s===null?t.next=t:(t.next=s.next,s.next=t),i.pending=t,Be(r,e)}return s=i.interleaved,s===null?(t.next=t,gl(i)):(t.next=s.next,s.next=t),i.interleaved=t,Be(r,e)}function Us(r,t,e){if(t=t.updateQueue,t!==null&&(t=t.shared,(e&4194240)!==0)){var i=t.lanes;i&=r.pendingLanes,e|=i,t.lanes=e,tl(r,e)}}function Fu(r,t){var e=r.updateQueue,i=r.alternate;if(i!==null&&(i=i.updateQueue,e===i)){var s=null,a=null;if(e=e.firstBaseUpdate,e!==null){do{var n={eventTime:e.eventTime,lane:e.lane,tag:e.tag,payload:e.payload,callback:e.callback,next:null};a===null?s=a=n:a=a.next=n,e=e.next}while(e!==null);a===null?s=a=t:a=a.next=t}else s=a=t;e={baseState:i.baseState,firstBaseUpdate:s,lastBaseUpdate:a,shared:i.shared,effects:i.effects},r.updateQueue=e;return}r=e.lastBaseUpdate,r===null?e.firstBaseUpdate=t:r.next=t,e.lastBaseUpdate=t}function oa(r,t,e,i){var s=r.updateQueue;ze=!1;var a=s.firstBaseUpdate,n=s.lastBaseUpdate,o=s.shared.pending;if(o!==null){s.shared.pending=null;var l=o,u=l.next;l.next=null,n===null?a=u:n.next=u,n=l;var c=r.alternate;c!==null&&(c=c.updateQueue,o=c.lastBaseUpdate,o!==n&&(o===null?c.firstBaseUpdate=u:o.next=u,c.lastBaseUpdate=l))}if(a!==null){var d=s.baseState;n=0,c=u=l=null,o=a;do{var h=o.lane,f=o.eventTime;if((i&h)===h){c!==null&&(c=c.next={eventTime:f,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});t:{var g=r,p=o;switch(h=t,f=e,p.tag){case 1:if(g=p.payload,typeof g=="function"){d=g.call(f,d,h);break t}d=g;break t;case 3:g.flags=g.flags&-65537|128;case 0:if(g=p.payload,h=typeof g=="function"?g.call(f,d,h):g,h==null)break t;d=ct({},d,h);break t;case 2:ze=!0}}o.callback!==null&&o.lane!==0&&(r.flags|=64,h=s.effects,h===null?s.effects=[o]:h.push(o))}else f={eventTime:f,lane:h,tag:o.tag,payload:o.payload,callback:o.callback,next:null},c===null?(u=c=f,l=d):c=c.next=f,n|=h;if(o=o.next,o===null){if(o=s.shared.pending,o===null)break;h=o,o=h.next,h.next=null,s.lastBaseUpdate=h,s.shared.pending=null}}while(1);if(c===null&&(l=d),s.baseState=l,s.firstBaseUpdate=u,s.lastBaseUpdate=c,t=s.shared.interleaved,t!==null){s=t;do n|=s.lane,s=s.next;while(s!==t)}else a===null&&(s.shared.lanes=0);Ar|=n,r.lanes=n,r.memoizedState=d}}function Mu(r,t,e){if(r=t.effects,t.effects=null,r!==null)for(t=0;t<r.length;t++){var i=r[t],s=i.callback;if(s!==null){if(i.callback=null,i=e,typeof s!="function")throw Error(O(191,s));s.call(i)}}}var fh=new dd.Component().refs;function yo(r,t,e,i){t=r.memoizedState,e=e(i,t),e=e==null?t:ct({},t,e),r.memoizedState=e,r.lanes===0&&(r.updateQueue.baseState=e)}var Da={isMounted:function(r){return(r=r._reactInternals)?Dr(r)===r:!1},enqueueSetState:function(r,t,e){r=r._reactInternals;var i=Ot(),s=sr(r),a=Me(i,s);a.payload=t,e!=null&&(a.callback=e),t=rr(r,a,s),t!==null&&(ye(t,r,s,i),Us(t,r,s))},enqueueReplaceState:function(r,t,e){r=r._reactInternals;var i=Ot(),s=sr(r),a=Me(i,s);a.tag=1,a.payload=t,e!=null&&(a.callback=e),t=rr(r,a,s),t!==null&&(ye(t,r,s,i),Us(t,r,s))},enqueueForceUpdate:function(r,t){r=r._reactInternals;var e=Ot(),i=sr(r),s=Me(e,i);s.tag=2,t!=null&&(s.callback=t),t=rr(r,s,i),t!==null&&(ye(t,r,i,e),Us(t,r,i))}};function Nu(r,t,e,i,s,a,n){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(i,a,n):t.prototype&&t.prototype.isPureReactComponent?!Ki(e,i)||!Ki(s,a):!0}function gh(r,t,e){var i=!1,s=or,a=t.contextType;return typeof a=="object"&&a!==null?a=ne(a):(s=Ht(t)?br:Pt.current,i=t.contextTypes,a=(i=i!=null)?ri(r,s):or),t=new t(e,a),r.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Da,r.stateNode=t,t._reactInternals=r,i&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=s,r.__reactInternalMemoizedMaskedChildContext=a),t}function Uu(r,t,e,i){r=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(e,i),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(e,i),t.state!==r&&Da.enqueueReplaceState(t,t.state,null)}function vo(r,t,e,i){var s=r.stateNode;s.props=e,s.state=r.memoizedState,s.refs=fh,pl(r);var a=t.contextType;typeof a=="object"&&a!==null?s.context=ne(a):(a=Ht(t)?br:Pt.current,s.context=ri(r,a)),s.state=r.memoizedState,a=t.getDerivedStateFromProps,typeof a=="function"&&(yo(r,t,a,e),s.state=r.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(t=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),t!==s.state&&Da.enqueueReplaceState(s,s.state,null),oa(r,e,s,i),s.state=r.memoizedState),typeof s.componentDidMount=="function"&&(r.flags|=4194308)}function mi(r,t,e){if(r=e.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(e._owner){if(e=e._owner,e){if(e.tag!==1)throw Error(O(309));var i=e.stateNode}if(!i)throw Error(O(147,r));var s=i,a=""+r;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===a?t.ref:(t=function(n){var o=s.refs;o===fh&&(o=s.refs={}),n===null?delete o[a]:o[a]=n},t._stringRef=a,t)}if(typeof r!="string")throw Error(O(284));if(!e._owner)throw Error(O(290,r))}return r}function vs(r,t){throw r=Object.prototype.toString.call(t),Error(O(31,r==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":r))}function Bu(r){var t=r._init;return t(r._payload)}function ph(r){function t(y,v){if(r){var E=y.deletions;E===null?(y.deletions=[v],y.flags|=16):E.push(v)}}function e(y,v){if(!r)return null;for(;v!==null;)t(y,v),v=v.sibling;return null}function i(y,v){for(y=new Map;v!==null;)v.key!==null?y.set(v.key,v):y.set(v.index,v),v=v.sibling;return y}function s(y,v){return y=ar(y,v),y.index=0,y.sibling=null,y}function a(y,v,E){return y.index=E,r?(E=y.alternate,E!==null?(E=E.index,E<v?(y.flags|=2,v):E):(y.flags|=2,v)):(y.flags|=1048576,v)}function n(y){return r&&y.alternate===null&&(y.flags|=2),y}function o(y,v,E,S){return v===null||v.tag!==6?(v=fn(E,y.mode,S),v.return=y,v):(v=s(v,E),v.return=y,v)}function l(y,v,E,S){var b=E.type;return b===Mr?c(y,v,E.props.children,S,E.key):v!==null&&(v.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===He&&Bu(b)===v.type)?(S=s(v,E.props),S.ref=mi(y,v,E),S.return=y,S):(S=Hs(E.type,E.key,E.props,null,y.mode,S),S.ref=mi(y,v,E),S.return=y,S)}function u(y,v,E,S){return v===null||v.tag!==4||v.stateNode.containerInfo!==E.containerInfo||v.stateNode.implementation!==E.implementation?(v=gn(E,y.mode,S),v.return=y,v):(v=s(v,E.children||[]),v.return=y,v)}function c(y,v,E,S,b){return v===null||v.tag!==7?(v=Tr(E,y.mode,S,b),v.return=y,v):(v=s(v,E),v.return=y,v)}function d(y,v,E){if(typeof v=="string"&&v!==""||typeof v=="number")return v=fn(""+v,y.mode,E),v.return=y,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case os:return E=Hs(v.type,v.key,v.props,null,y.mode,E),E.ref=mi(y,null,v),E.return=y,E;case Fr:return v=gn(v,y.mode,E),v.return=y,v;case He:var S=v._init;return d(y,S(v._payload),E)}if(Si(v)||di(v))return v=Tr(v,y.mode,E,null),v.return=y,v;vs(y,v)}return null}function h(y,v,E,S){var b=v!==null?v.key:null;if(typeof E=="string"&&E!==""||typeof E=="number")return b!==null?null:o(y,v,""+E,S);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case os:return E.key===b?l(y,v,E,S):null;case Fr:return E.key===b?u(y,v,E,S):null;case He:return b=E._init,h(y,v,b(E._payload),S)}if(Si(E)||di(E))return b!==null?null:c(y,v,E,S,null);vs(y,E)}return null}function f(y,v,E,S,b){if(typeof S=="string"&&S!==""||typeof S=="number")return y=y.get(E)||null,o(v,y,""+S,b);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case os:return y=y.get(S.key===null?E:S.key)||null,l(v,y,S,b);case Fr:return y=y.get(S.key===null?E:S.key)||null,u(v,y,S,b);case He:var w=S._init;return f(y,v,E,w(S._payload),b)}if(Si(S)||di(S))return y=y.get(E)||null,c(v,y,S,b,null);vs(v,S)}return null}function g(y,v,E,S){for(var b=null,w=null,k=v,D=v=0,P=null;k!==null&&D<E.length;D++){k.index>D?(P=k,k=null):P=k.sibling;var R=h(y,k,E[D],S);if(R===null){k===null&&(k=P);break}r&&k&&R.alternate===null&&t(y,k),v=a(R,v,D),w===null?b=R:w.sibling=R,w=R,k=P}if(D===E.length)return e(y,k),at&&hr(y,D),b;if(k===null){for(;D<E.length;D++)k=d(y,E[D],S),k!==null&&(v=a(k,v,D),w===null?b=k:w.sibling=k,w=k);return at&&hr(y,D),b}for(k=i(y,k);D<E.length;D++)P=f(k,y,D,E[D],S),P!==null&&(r&&P.alternate!==null&&k.delete(P.key===null?D:P.key),v=a(P,v,D),w===null?b=P:w.sibling=P,w=P);return r&&k.forEach(function(U){return t(y,U)}),at&&hr(y,D),b}function p(y,v,E,S){var b=di(E);if(typeof b!="function")throw Error(O(150));if(E=b.call(E),E==null)throw Error(O(151));for(var w=b=null,k=v,D=v=0,P=null,R=E.next();k!==null&&!R.done;D++,R=E.next()){k.index>D?(P=k,k=null):P=k.sibling;var U=h(y,k,R.value,S);if(U===null){k===null&&(k=P);break}r&&k&&U.alternate===null&&t(y,k),v=a(U,v,D),w===null?b=U:w.sibling=U,w=U,k=P}if(R.done)return e(y,k),at&&hr(y,D),b;if(k===null){for(;!R.done;D++,R=E.next())R=d(y,R.value,S),R!==null&&(v=a(R,v,D),w===null?b=R:w.sibling=R,w=R);return at&&hr(y,D),b}for(k=i(y,k);!R.done;D++,R=E.next())R=f(k,y,D,R.value,S),R!==null&&(r&&R.alternate!==null&&k.delete(R.key===null?D:R.key),v=a(R,v,D),w===null?b=R:w.sibling=R,w=R);return r&&k.forEach(function(M){return t(y,M)}),at&&hr(y,D),b}function T(y,v,E,S){if(typeof E=="object"&&E!==null&&E.type===Mr&&E.key===null&&(E=E.props.children),typeof E=="object"&&E!==null){switch(E.$$typeof){case os:t:{for(var b=E.key,w=v;w!==null;){if(w.key===b){if(b=E.type,b===Mr){if(w.tag===7){e(y,w.sibling),v=s(w,E.props.children),v.return=y,y=v;break t}}else if(w.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===He&&Bu(b)===w.type){e(y,w.sibling),v=s(w,E.props),v.ref=mi(y,w,E),v.return=y,y=v;break t}e(y,w);break}else t(y,w);w=w.sibling}E.type===Mr?(v=Tr(E.props.children,y.mode,S,E.key),v.return=y,y=v):(S=Hs(E.type,E.key,E.props,null,y.mode,S),S.ref=mi(y,v,E),S.return=y,y=S)}return n(y);case Fr:t:{for(w=E.key;v!==null;){if(v.key===w)if(v.tag===4&&v.stateNode.containerInfo===E.containerInfo&&v.stateNode.implementation===E.implementation){e(y,v.sibling),v=s(v,E.children||[]),v.return=y,y=v;break t}else{e(y,v);break}else t(y,v);v=v.sibling}v=gn(E,y.mode,S),v.return=y,y=v}return n(y);case He:return w=E._init,T(y,v,w(E._payload),S)}if(Si(E))return g(y,v,E,S);if(di(E))return p(y,v,E,S);vs(y,E)}return typeof E=="string"&&E!==""||typeof E=="number"?(E=""+E,v!==null&&v.tag===6?(e(y,v.sibling),v=s(v,E),v.return=y,y=v):(e(y,v),v=fn(E,y.mode,S),v.return=y,y=v),n(y)):e(y,v)}return T}var si=ph(!0),mh=ph(!1),as={},we=ur(as),Wi=ur(as),Yi=ur(as);function vr(r){if(r===as)throw Error(O(174));return r}function ml(r,t){switch(tt(Yi,t),tt(Wi,r),tt(we,as),r=t.nodeType,r){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:qn(null,"");break;default:r=r===8?t.parentNode:t,t=r.namespaceURI||null,r=r.tagName,t=qn(t,r)}it(we),tt(we,t)}function ai(){it(we),it(Wi),it(Yi)}function yh(r){vr(Yi.current);var t=vr(we.current),e=qn(t,r.type);t!==e&&(tt(Wi,r),tt(we,e))}function yl(r){Wi.current===r&&(it(we),it(Wi))}var ot=ur(0);function la(r){for(var t=r;t!==null;){if(t.tag===13){var e=t.memoizedState;if(e!==null&&(e=e.dehydrated,e===null||e.data==="$?"||e.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===r)break;for(;t.sibling===null;){if(t.return===null||t.return===r)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var on=[];function vl(){for(var r=0;r<on.length;r++)on[r]._workInProgressVersionPrimary=null;on.length=0}var Bs=Ge.ReactCurrentDispatcher,ln=Ge.ReactCurrentBatchConfig,kr=0,ut=null,mt=null,Tt=null,ua=!1,Di=!1,ji=0,Xp=0;function It(){throw Error(O(321))}function El(r,t){if(t===null)return!1;for(var e=0;e<t.length&&e<r.length;e++)if(!ve(r[e],t[e]))return!1;return!0}function Tl(r,t,e,i,s,a){if(kr=a,ut=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Bs.current=r===null||r.memoizedState===null?tm:em,r=e(i,s),Di){a=0;do{if(Di=!1,ji=0,25<=a)throw Error(O(301));a+=1,Tt=mt=null,t.updateQueue=null,Bs.current=rm,r=e(i,s)}while(Di)}if(Bs.current=ca,t=mt!==null&&mt.next!==null,kr=0,Tt=mt=ut=null,ua=!1,t)throw Error(O(300));return r}function Sl(){var r=ji!==0;return ji=0,r}function Se(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Tt===null?ut.memoizedState=Tt=r:Tt=Tt.next=r,Tt}function oe(){if(mt===null){var r=ut.alternate;r=r!==null?r.memoizedState:null}else r=mt.next;var t=Tt===null?ut.memoizedState:Tt.next;if(t!==null)Tt=t,mt=r;else{if(r===null)throw Error(O(310));mt=r,r={memoizedState:mt.memoizedState,baseState:mt.baseState,baseQueue:mt.baseQueue,queue:mt.queue,next:null},Tt===null?ut.memoizedState=Tt=r:Tt=Tt.next=r}return Tt}function qi(r,t){return typeof t=="function"?t(r):t}function un(r){var t=oe(),e=t.queue;if(e===null)throw Error(O(311));e.lastRenderedReducer=r;var i=mt,s=i.baseQueue,a=e.pending;if(a!==null){if(s!==null){var n=s.next;s.next=a.next,a.next=n}i.baseQueue=s=a,e.pending=null}if(s!==null){a=s.next,i=i.baseState;var o=n=null,l=null,u=a;do{var c=u.lane;if((kr&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:r(i,u.action);else{var d={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(o=l=d,n=i):l=l.next=d,ut.lanes|=c,Ar|=c}u=u.next}while(u!==null&&u!==a);l===null?n=i:l.next=o,ve(i,t.memoizedState)||(Kt=!0),t.memoizedState=i,t.baseState=n,t.baseQueue=l,e.lastRenderedState=i}if(r=e.interleaved,r!==null){s=r;do a=s.lane,ut.lanes|=a,Ar|=a,s=s.next;while(s!==r)}else s===null&&(e.lanes=0);return[t.memoizedState,e.dispatch]}function cn(r){var t=oe(),e=t.queue;if(e===null)throw Error(O(311));e.lastRenderedReducer=r;var i=e.dispatch,s=e.pending,a=t.memoizedState;if(s!==null){e.pending=null;var n=s=s.next;do a=r(a,n.action),n=n.next;while(n!==s);ve(a,t.memoizedState)||(Kt=!0),t.memoizedState=a,t.baseQueue===null&&(t.baseState=a),e.lastRenderedState=a}return[a,i]}function vh(){}function Eh(r,t){var e=ut,i=oe(),s=t(),a=!ve(i.memoizedState,s);if(a&&(i.memoizedState=s,Kt=!0),i=i.queue,bl(bh.bind(null,e,i,r),[r]),i.getSnapshot!==t||a||Tt!==null&&Tt.memoizedState.tag&1){if(e.flags|=2048,Xi(9,Sh.bind(null,e,i,s,t),void 0,null),St===null)throw Error(O(349));(kr&30)!==0||Th(e,t,s)}return s}function Th(r,t,e){r.flags|=16384,r={getSnapshot:t,value:e},t=ut.updateQueue,t===null?(t={lastEffect:null,stores:null},ut.updateQueue=t,t.stores=[r]):(e=t.stores,e===null?t.stores=[r]:e.push(r))}function Sh(r,t,e,i){t.value=e,t.getSnapshot=i,Lh(t)&&kh(r)}function bh(r,t,e){return e(function(){Lh(t)&&kh(r)})}function Lh(r){var t=r.getSnapshot;r=r.value;try{var e=t();return!ve(r,e)}catch{return!0}}function kh(r){var t=Be(r,1);t!==null&&ye(t,r,1,-1)}function $u(r){var t=Se();return typeof r=="function"&&(r=r()),t.memoizedState=t.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:qi,lastRenderedState:r},t.queue=r,r=r.dispatch=Zp.bind(null,ut,r),[t.memoizedState,r]}function Xi(r,t,e,i){return r={tag:r,create:t,destroy:e,deps:i,next:null},t=ut.updateQueue,t===null?(t={lastEffect:null,stores:null},ut.updateQueue=t,t.lastEffect=r.next=r):(e=t.lastEffect,e===null?t.lastEffect=r.next=r:(i=e.next,e.next=r,r.next=i,t.lastEffect=r)),r}function Ah(){return oe().memoizedState}function $s(r,t,e,i){var s=Se();ut.flags|=r,s.memoizedState=Xi(1|t,e,void 0,i===void 0?null:i)}function Ca(r,t,e,i){var s=oe();i=i===void 0?null:i;var a=void 0;if(mt!==null){var n=mt.memoizedState;if(a=n.destroy,i!==null&&El(i,n.deps)){s.memoizedState=Xi(t,e,a,i);return}}ut.flags|=r,s.memoizedState=Xi(1|t,e,a,i)}function Gu(r,t){return $s(8390656,8,r,t)}function bl(r,t){return Ca(2048,8,r,t)}function wh(r,t){return Ca(4,2,r,t)}function Rh(r,t){return Ca(4,4,r,t)}function Ih(r,t){if(typeof t=="function")return r=r(),t(r),function(){t(null)};if(t!=null)return r=r(),t.current=r,function(){t.current=null}}function Dh(r,t,e){return e=e!=null?e.concat([r]):null,Ca(4,4,Ih.bind(null,t,r),e)}function Ll(){}function Ch(r,t){var e=oe();t=t===void 0?null:t;var i=e.memoizedState;return i!==null&&t!==null&&El(t,i[1])?i[0]:(e.memoizedState=[r,t],r)}function _h(r,t){var e=oe();t=t===void 0?null:t;var i=e.memoizedState;return i!==null&&t!==null&&El(t,i[1])?i[0]:(r=r(),e.memoizedState=[r,t],r)}function Ph(r,t,e){return(kr&21)===0?(r.baseState&&(r.baseState=!1,Kt=!0),r.memoizedState=e):(ve(e,t)||(e=Fd(),ut.lanes|=e,Ar|=e,r.baseState=!0),t)}function Qp(r,t){var e=J;J=e!==0&&4>e?e:4,r(!0);var i=ln.transition;ln.transition={};try{r(!1),t()}finally{J=e,ln.transition=i}}function xh(){return oe().memoizedState}function Jp(r,t,e){var i=sr(r);if(e={lane:i,action:e,hasEagerState:!1,eagerState:null,next:null},Oh(r))Fh(t,e);else if(e=dh(r,t,e,i),e!==null){var s=Ot();ye(e,r,i,s),Mh(e,t,i)}}function Zp(r,t,e){var i=sr(r),s={lane:i,action:e,hasEagerState:!1,eagerState:null,next:null};if(Oh(r))Fh(t,s);else{var a=r.alternate;if(r.lanes===0&&(a===null||a.lanes===0)&&(a=t.lastRenderedReducer,a!==null))try{var n=t.lastRenderedState,o=a(n,e);if(s.hasEagerState=!0,s.eagerState=o,ve(o,n)){var l=t.interleaved;l===null?(s.next=s,gl(t)):(s.next=l.next,l.next=s),t.interleaved=s;return}}catch{}finally{}e=dh(r,t,s,i),e!==null&&(s=Ot(),ye(e,r,i,s),Mh(e,t,i))}}function Oh(r){var t=r.alternate;return r===ut||t!==null&&t===ut}function Fh(r,t){Di=ua=!0;var e=r.pending;e===null?t.next=t:(t.next=e.next,e.next=t),r.pending=t}function Mh(r,t,e){if((e&4194240)!==0){var i=t.lanes;i&=r.pendingLanes,e|=i,t.lanes=e,tl(r,e)}}var ca={readContext:ne,useCallback:It,useContext:It,useEffect:It,useImperativeHandle:It,useInsertionEffect:It,useLayoutEffect:It,useMemo:It,useReducer:It,useRef:It,useState:It,useDebugValue:It,useDeferredValue:It,useTransition:It,useMutableSource:It,useSyncExternalStore:It,useId:It,unstable_isNewReconciler:!1},tm={readContext:ne,useCallback:function(r,t){return Se().memoizedState=[r,t===void 0?null:t],r},useContext:ne,useEffect:Gu,useImperativeHandle:function(r,t,e){return e=e!=null?e.concat([r]):null,$s(4194308,4,Ih.bind(null,t,r),e)},useLayoutEffect:function(r,t){return $s(4194308,4,r,t)},useInsertionEffect:function(r,t){return $s(4,2,r,t)},useMemo:function(r,t){var e=Se();return t=t===void 0?null:t,r=r(),e.memoizedState=[r,t],r},useReducer:function(r,t,e){var i=Se();return t=e!==void 0?e(t):t,i.memoizedState=i.baseState=t,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:t},i.queue=r,r=r.dispatch=Jp.bind(null,ut,r),[i.memoizedState,r]},useRef:function(r){var t=Se();return r={current:r},t.memoizedState=r},useState:$u,useDebugValue:Ll,useDeferredValue:function(r){return Se().memoizedState=r},useTransition:function(){var r=$u(!1),t=r[0];return r=Qp.bind(null,r[1]),Se().memoizedState=r,[t,r]},useMutableSource:function(){},useSyncExternalStore:function(r,t,e){var i=ut,s=Se();if(at){if(e===void 0)throw Error(O(407));e=e()}else{if(e=t(),St===null)throw Error(O(349));(kr&30)!==0||Th(i,t,e)}s.memoizedState=e;var a={value:e,getSnapshot:t};return s.queue=a,Gu(bh.bind(null,i,a,r),[r]),i.flags|=2048,Xi(9,Sh.bind(null,i,a,e,t),void 0,null),e},useId:function(){var r=Se(),t=St.identifierPrefix;if(at){var e=Oe,i=xe;e=(i&~(1<<32-me(i)-1)).toString(32)+e,t=":"+t+"R"+e,e=ji++,0<e&&(t+="H"+e.toString(32)),t+=":"}else e=Xp++,t=":"+t+"r"+e.toString(32)+":";return r.memoizedState=t},unstable_isNewReconciler:!1},em={readContext:ne,useCallback:Ch,useContext:ne,useEffect:bl,useImperativeHandle:Dh,useInsertionEffect:wh,useLayoutEffect:Rh,useMemo:_h,useReducer:un,useRef:Ah,useState:function(){return un(qi)},useDebugValue:Ll,useDeferredValue:function(r){var t=oe();return Ph(t,mt.memoizedState,r)},useTransition:function(){var r=un(qi)[0],t=oe().memoizedState;return[r,t]},useMutableSource:vh,useSyncExternalStore:Eh,useId:xh,unstable_isNewReconciler:!1},rm={readContext:ne,useCallback:Ch,useContext:ne,useEffect:bl,useImperativeHandle:Dh,useInsertionEffect:wh,useLayoutEffect:Rh,useMemo:_h,useReducer:cn,useRef:Ah,useState:function(){return cn(qi)},useDebugValue:Ll,useDeferredValue:function(r){var t=oe();return mt===null?t.memoizedState=r:Ph(t,mt.memoizedState,r)},useTransition:function(){var r=cn(qi)[0],t=oe().memoizedState;return[r,t]},useMutableSource:vh,useSyncExternalStore:Eh,useId:xh,unstable_isNewReconciler:!1};function ni(r,t){try{var e="",i=t;do e+=Cg(i),i=i.return;while(i);var s=e}catch(a){s=`
Error generating stack: `+a.message+`
`+a.stack}return{value:r,source:t,stack:s,digest:null}}function dn(r,t,e){return{value:r,source:null,stack:e!=null?e:null,digest:t!=null?t:null}}function Eo(r,t){try{console.error(t.value)}catch(e){setTimeout(function(){throw e})}}var im=typeof WeakMap=="function"?WeakMap:Map;function Nh(r,t,e){e=Me(-1,e),e.tag=3,e.payload={element:null};var i=t.value;return e.callback=function(){ha||(ha=!0,Io=i),Eo(r,t)},e}function Uh(r,t,e){e=Me(-1,e),e.tag=3;var i=r.type.getDerivedStateFromError;if(typeof i=="function"){var s=t.value;e.payload=function(){return i(s)},e.callback=function(){Eo(r,t)}}var a=r.stateNode;return a!==null&&typeof a.componentDidCatch=="function"&&(e.callback=function(){Eo(r,t),typeof i!="function"&&(ir===null?ir=new Set([this]):ir.add(this));var n=t.stack;this.componentDidCatch(t.value,{componentStack:n!==null?n:""})}),e}function Ku(r,t,e){var i=r.pingCache;if(i===null){i=r.pingCache=new im;var s=new Set;i.set(t,s)}else s=i.get(t),s===void 0&&(s=new Set,i.set(t,s));s.has(e)||(s.add(e),r=ym.bind(null,r,t,e),t.then(r,r))}function Vu(r){do{var t;if((t=r.tag===13)&&(t=r.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return r;r=r.return}while(r!==null);return null}function Hu(r,t,e,i,s){return(r.mode&1)===0?(r===t?r.flags|=65536:(r.flags|=128,e.flags|=131072,e.flags&=-52805,e.tag===1&&(e.alternate===null?e.tag=17:(t=Me(-1,1),t.tag=2,rr(e,t,1))),e.lanes|=1),r):(r.flags|=65536,r.lanes=s,r)}var sm=Ge.ReactCurrentOwner,Kt=!1;function xt(r,t,e,i){t.child=r===null?mh(t,null,e,i):si(t,r.child,e,i)}function zu(r,t,e,i,s){e=e.render;var a=t.ref;return Jr(t,s),i=Tl(r,t,e,i,a,s),e=Sl(),r!==null&&!Kt?(t.updateQueue=r.updateQueue,t.flags&=-2053,r.lanes&=~s,$e(r,t,s)):(at&&e&&ll(t),t.flags|=1,xt(r,t,i,s),t.child)}function Wu(r,t,e,i,s){if(r===null){var a=e.type;return typeof a=="function"&&!_l(a)&&a.defaultProps===void 0&&e.compare===null&&e.defaultProps===void 0?(t.tag=15,t.type=a,Bh(r,t,a,i,s)):(r=Hs(e.type,null,i,t,t.mode,s),r.ref=t.ref,r.return=t,t.child=r)}if(a=r.child,(r.lanes&s)===0){var n=a.memoizedProps;if(e=e.compare,e=e!==null?e:Ki,e(n,i)&&r.ref===t.ref)return $e(r,t,s)}return t.flags|=1,r=ar(a,i),r.ref=t.ref,r.return=t,t.child=r}function Bh(r,t,e,i,s){if(r!==null){var a=r.memoizedProps;if(Ki(a,i)&&r.ref===t.ref)if(Kt=!1,t.pendingProps=i=a,(r.lanes&s)!==0)(r.flags&131072)!==0&&(Kt=!0);else return t.lanes=r.lanes,$e(r,t,s)}return To(r,t,e,i,s)}function $h(r,t,e){var i=t.pendingProps,s=i.children,a=r!==null?r.memoizedState:null;if(i.mode==="hidden")if((t.mode&1)===0)t.memoizedState={baseLanes:0,cachePool:null,transitions:null},tt(Wr,Yt),Yt|=e;else{if((e&1073741824)===0)return r=a!==null?a.baseLanes|e:e,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:r,cachePool:null,transitions:null},t.updateQueue=null,tt(Wr,Yt),Yt|=r,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=a!==null?a.baseLanes:e,tt(Wr,Yt),Yt|=i}else a!==null?(i=a.baseLanes|e,t.memoizedState=null):i=e,tt(Wr,Yt),Yt|=i;return xt(r,t,s,e),t.child}function Gh(r,t){var e=t.ref;(r===null&&e!==null||r!==null&&r.ref!==e)&&(t.flags|=512,t.flags|=2097152)}function To(r,t,e,i,s){var a=Ht(e)?br:Pt.current;return a=ri(t,a),Jr(t,s),e=Tl(r,t,e,i,a,s),i=Sl(),r!==null&&!Kt?(t.updateQueue=r.updateQueue,t.flags&=-2053,r.lanes&=~s,$e(r,t,s)):(at&&i&&ll(t),t.flags|=1,xt(r,t,e,s),t.child)}function Yu(r,t,e,i,s){if(Ht(e)){var a=!0;ra(t)}else a=!1;if(Jr(t,s),t.stateNode===null)Gs(r,t),gh(t,e,i),vo(t,e,i,s),i=!0;else if(r===null){var n=t.stateNode,o=t.memoizedProps;n.props=o;var l=n.context,u=e.contextType;typeof u=="object"&&u!==null?u=ne(u):(u=Ht(e)?br:Pt.current,u=ri(t,u));var c=e.getDerivedStateFromProps,d=typeof c=="function"||typeof n.getSnapshotBeforeUpdate=="function";d||typeof n.UNSAFE_componentWillReceiveProps!="function"&&typeof n.componentWillReceiveProps!="function"||(o!==i||l!==u)&&Uu(t,n,i,u),ze=!1;var h=t.memoizedState;n.state=h,oa(t,i,n,s),l=t.memoizedState,o!==i||h!==l||Vt.current||ze?(typeof c=="function"&&(yo(t,e,c,i),l=t.memoizedState),(o=ze||Nu(t,e,o,i,h,l,u))?(d||typeof n.UNSAFE_componentWillMount!="function"&&typeof n.componentWillMount!="function"||(typeof n.componentWillMount=="function"&&n.componentWillMount(),typeof n.UNSAFE_componentWillMount=="function"&&n.UNSAFE_componentWillMount()),typeof n.componentDidMount=="function"&&(t.flags|=4194308)):(typeof n.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=l),n.props=i,n.state=l,n.context=u,i=o):(typeof n.componentDidMount=="function"&&(t.flags|=4194308),i=!1)}else{n=t.stateNode,hh(r,t),o=t.memoizedProps,u=t.type===t.elementType?o:de(t.type,o),n.props=u,d=t.pendingProps,h=n.context,l=e.contextType,typeof l=="object"&&l!==null?l=ne(l):(l=Ht(e)?br:Pt.current,l=ri(t,l));var f=e.getDerivedStateFromProps;(c=typeof f=="function"||typeof n.getSnapshotBeforeUpdate=="function")||typeof n.UNSAFE_componentWillReceiveProps!="function"&&typeof n.componentWillReceiveProps!="function"||(o!==d||h!==l)&&Uu(t,n,i,l),ze=!1,h=t.memoizedState,n.state=h,oa(t,i,n,s);var g=t.memoizedState;o!==d||h!==g||Vt.current||ze?(typeof f=="function"&&(yo(t,e,f,i),g=t.memoizedState),(u=ze||Nu(t,e,u,i,h,g,l)||!1)?(c||typeof n.UNSAFE_componentWillUpdate!="function"&&typeof n.componentWillUpdate!="function"||(typeof n.componentWillUpdate=="function"&&n.componentWillUpdate(i,g,l),typeof n.UNSAFE_componentWillUpdate=="function"&&n.UNSAFE_componentWillUpdate(i,g,l)),typeof n.componentDidUpdate=="function"&&(t.flags|=4),typeof n.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof n.componentDidUpdate!="function"||o===r.memoizedProps&&h===r.memoizedState||(t.flags|=4),typeof n.getSnapshotBeforeUpdate!="function"||o===r.memoizedProps&&h===r.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=g),n.props=i,n.state=g,n.context=l,i=u):(typeof n.componentDidUpdate!="function"||o===r.memoizedProps&&h===r.memoizedState||(t.flags|=4),typeof n.getSnapshotBeforeUpdate!="function"||o===r.memoizedProps&&h===r.memoizedState||(t.flags|=1024),i=!1)}return So(r,t,e,i,a,s)}function So(r,t,e,i,s,a){Gh(r,t);var n=(t.flags&128)!==0;if(!i&&!n)return s&&Pu(t,e,!1),$e(r,t,a);i=t.stateNode,sm.current=t;var o=n&&typeof e.getDerivedStateFromError!="function"?null:i.render();return t.flags|=1,r!==null&&n?(t.child=si(t,r.child,null,a),t.child=si(t,null,o,a)):xt(r,t,o,a),t.memoizedState=i.state,s&&Pu(t,e,!0),t.child}function Kh(r){var t=r.stateNode;t.pendingContext?_u(r,t.pendingContext,t.pendingContext!==t.context):t.context&&_u(r,t.context,!1),ml(r,t.containerInfo)}function ju(r,t,e,i,s){return ii(),cl(s),t.flags|=256,xt(r,t,e,i),t.child}var bo={dehydrated:null,treeContext:null,retryLane:0};function Lo(r){return{baseLanes:r,cachePool:null,transitions:null}}function Vh(r,t,e){var i=t.pendingProps,s=ot.current,a=!1,n=(t.flags&128)!==0,o;if((o=n)||(o=r!==null&&r.memoizedState===null?!1:(s&2)!==0),o?(a=!0,t.flags&=-129):(r===null||r.memoizedState!==null)&&(s|=1),tt(ot,s&1),r===null)return po(t),r=t.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?((t.mode&1)===0?t.lanes=1:r.data==="$!"?t.lanes=8:t.lanes=1073741824,null):(n=i.children,r=i.fallback,a?(i=t.mode,a=t.child,n={mode:"hidden",children:n},(i&1)===0&&a!==null?(a.childLanes=0,a.pendingProps=n):a=xa(n,i,0,null),r=Tr(r,i,e,null),a.return=t,r.return=t,a.sibling=r,t.child=a,t.child.memoizedState=Lo(e),t.memoizedState=bo,r):kl(t,n));if(s=r.memoizedState,s!==null&&(o=s.dehydrated,o!==null))return am(r,t,n,i,o,s,e);if(a){a=i.fallback,n=t.mode,s=r.child,o=s.sibling;var l={mode:"hidden",children:i.children};return(n&1)===0&&t.child!==s?(i=t.child,i.childLanes=0,i.pendingProps=l,t.deletions=null):(i=ar(s,l),i.subtreeFlags=s.subtreeFlags&14680064),o!==null?a=ar(o,a):(a=Tr(a,n,e,null),a.flags|=2),a.return=t,i.return=t,i.sibling=a,t.child=i,i=a,a=t.child,n=r.child.memoizedState,n=n===null?Lo(e):{baseLanes:n.baseLanes|e,cachePool:null,transitions:n.transitions},a.memoizedState=n,a.childLanes=r.childLanes&~e,t.memoizedState=bo,i}return a=r.child,r=a.sibling,i=ar(a,{mode:"visible",children:i.children}),(t.mode&1)===0&&(i.lanes=e),i.return=t,i.sibling=null,r!==null&&(e=t.deletions,e===null?(t.deletions=[r],t.flags|=16):e.push(r)),t.child=i,t.memoizedState=null,i}function kl(r,t){return t=xa({mode:"visible",children:t},r.mode,0,null),t.return=r,r.child=t}function Es(r,t,e,i){return i!==null&&cl(i),si(t,r.child,null,e),r=kl(t,t.pendingProps.children),r.flags|=2,t.memoizedState=null,r}function am(r,t,e,i,s,a,n){if(e)return t.flags&256?(t.flags&=-257,i=dn(Error(O(422))),Es(r,t,n,i)):t.memoizedState!==null?(t.child=r.child,t.flags|=128,null):(a=i.fallback,s=t.mode,i=xa({mode:"visible",children:i.children},s,0,null),a=Tr(a,s,n,null),a.flags|=2,i.return=t,a.return=t,i.sibling=a,t.child=i,(t.mode&1)!==0&&si(t,r.child,null,n),t.child.memoizedState=Lo(n),t.memoizedState=bo,a);if((t.mode&1)===0)return Es(r,t,n,null);if(s.data==="$!"){if(i=s.nextSibling&&s.nextSibling.dataset,i)var o=i.dgst;return i=o,a=Error(O(419)),i=dn(a,i,void 0),Es(r,t,n,i)}if(o=(n&r.childLanes)!==0,Kt||o){if(i=St,i!==null){switch(n&-n){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=(s&(i.suspendedLanes|n))!==0?0:s,s!==0&&s!==a.retryLane&&(a.retryLane=s,Be(r,s),ye(i,r,s,-1))}return Cl(),i=dn(Error(O(421))),Es(r,t,n,i)}return s.data==="$?"?(t.flags|=128,t.child=r.child,t=vm.bind(null,r),s._reactRetry=t,null):(r=a.treeContext,jt=er(s.nextSibling),qt=t,at=!0,fe=null,r!==null&&(re[ie++]=xe,re[ie++]=Oe,re[ie++]=Lr,xe=r.id,Oe=r.overflow,Lr=t),t=kl(t,i.children),t.flags|=4096,t)}function qu(r,t,e){r.lanes|=t;var i=r.alternate;i!==null&&(i.lanes|=t),mo(r.return,t,e)}function hn(r,t,e,i,s){var a=r.memoizedState;a===null?r.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:e,tailMode:s}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=i,a.tail=e,a.tailMode=s)}function Hh(r,t,e){var i=t.pendingProps,s=i.revealOrder,a=i.tail;if(xt(r,t,i.children,e),i=ot.current,(i&2)!==0)i=i&1|2,t.flags|=128;else{if(r!==null&&(r.flags&128)!==0)t:for(r=t.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&qu(r,e,t);else if(r.tag===19)qu(r,e,t);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break t;for(;r.sibling===null;){if(r.return===null||r.return===t)break t;r=r.return}r.sibling.return=r.return,r=r.sibling}i&=1}if(tt(ot,i),(t.mode&1)===0)t.memoizedState=null;else switch(s){case"forwards":for(e=t.child,s=null;e!==null;)r=e.alternate,r!==null&&la(r)===null&&(s=e),e=e.sibling;e=s,e===null?(s=t.child,t.child=null):(s=e.sibling,e.sibling=null),hn(t,!1,s,e,a);break;case"backwards":for(e=null,s=t.child,t.child=null;s!==null;){if(r=s.alternate,r!==null&&la(r)===null){t.child=s;break}r=s.sibling,s.sibling=e,e=s,s=r}hn(t,!0,e,null,a);break;case"together":hn(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Gs(r,t){(t.mode&1)===0&&r!==null&&(r.alternate=null,t.alternate=null,t.flags|=2)}function $e(r,t,e){if(r!==null&&(t.dependencies=r.dependencies),Ar|=t.lanes,(e&t.childLanes)===0)return null;if(r!==null&&t.child!==r.child)throw Error(O(153));if(t.child!==null){for(r=t.child,e=ar(r,r.pendingProps),t.child=e,e.return=t;r.sibling!==null;)r=r.sibling,e=e.sibling=ar(r,r.pendingProps),e.return=t;e.sibling=null}return t.child}function nm(r,t,e){switch(t.tag){case 3:Kh(t),ii();break;case 5:yh(t);break;case 1:Ht(t.type)&&ra(t);break;case 4:ml(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,s=t.memoizedProps.value;tt(aa,i._currentValue),i._currentValue=s;break;case 13:if(i=t.memoizedState,i!==null)return i.dehydrated!==null?(tt(ot,ot.current&1),t.flags|=128,null):(e&t.child.childLanes)!==0?Vh(r,t,e):(tt(ot,ot.current&1),r=$e(r,t,e),r!==null?r.sibling:null);tt(ot,ot.current&1);break;case 19:if(i=(e&t.childLanes)!==0,(r.flags&128)!==0){if(i)return Hh(r,t,e);t.flags|=128}if(s=t.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),tt(ot,ot.current),i)break;return null;case 22:case 23:return t.lanes=0,$h(r,t,e)}return $e(r,t,e)}var zh,ko,Wh,Yh;zh=function(r,t){for(var e=t.child;e!==null;){if(e.tag===5||e.tag===6)r.appendChild(e.stateNode);else if(e.tag!==4&&e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return;e=e.return}e.sibling.return=e.return,e=e.sibling}};ko=function(){};Wh=function(r,t,e,i){var s=r.memoizedProps;if(s!==i){r=t.stateNode,vr(we.current);var a=null;switch(e){case"input":s=zn(r,s),i=zn(r,i),a=[];break;case"select":s=ct({},s,{value:void 0}),i=ct({},i,{value:void 0}),a=[];break;case"textarea":s=jn(r,s),i=jn(r,i),a=[];break;default:typeof s.onClick!="function"&&typeof i.onClick=="function"&&(r.onclick=ta)}Xn(e,i);var n;e=null;for(u in s)if(!i.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var o=s[u];for(n in o)o.hasOwnProperty(n)&&(e||(e={}),e[n]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Fi.hasOwnProperty(u)?a||(a=[]):(a=a||[]).push(u,null));for(u in i){var l=i[u];if(o=s!=null?s[u]:void 0,i.hasOwnProperty(u)&&l!==o&&(l!=null||o!=null))if(u==="style")if(o){for(n in o)!o.hasOwnProperty(n)||l&&l.hasOwnProperty(n)||(e||(e={}),e[n]="");for(n in l)l.hasOwnProperty(n)&&o[n]!==l[n]&&(e||(e={}),e[n]=l[n])}else e||(a||(a=[]),a.push(u,e)),e=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(a=a||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(a=a||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Fi.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&et("scroll",r),a||o===l||(a=[])):(a=a||[]).push(u,l))}e&&(a=a||[]).push("style",e);var u=a;(t.updateQueue=u)&&(t.flags|=4)}};Yh=function(r,t,e,i){e!==i&&(t.flags|=4)};function yi(r,t){if(!at)switch(r.tailMode){case"hidden":t=r.tail;for(var e=null;t!==null;)t.alternate!==null&&(e=t),t=t.sibling;e===null?r.tail=null:e.sibling=null;break;case"collapsed":e=r.tail;for(var i=null;e!==null;)e.alternate!==null&&(i=e),e=e.sibling;i===null?t||r.tail===null?r.tail=null:r.tail.sibling=null:i.sibling=null}}function Dt(r){var t=r.alternate!==null&&r.alternate.child===r.child,e=0,i=0;if(t)for(var s=r.child;s!==null;)e|=s.lanes|s.childLanes,i|=s.subtreeFlags&14680064,i|=s.flags&14680064,s.return=r,s=s.sibling;else for(s=r.child;s!==null;)e|=s.lanes|s.childLanes,i|=s.subtreeFlags,i|=s.flags,s.return=r,s=s.sibling;return r.subtreeFlags|=i,r.childLanes=e,t}function om(r,t,e){var i=t.pendingProps;switch(ul(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Dt(t),null;case 1:return Ht(t.type)&&ea(),Dt(t),null;case 3:return i=t.stateNode,ai(),it(Vt),it(Pt),vl(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(r===null||r.child===null)&&(ys(t)?t.flags|=4:r===null||r.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,fe!==null&&(_o(fe),fe=null))),ko(r,t),Dt(t),null;case 5:yl(t);var s=vr(Yi.current);if(e=t.type,r!==null&&t.stateNode!=null)Wh(r,t,e,i,s),r.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(t.stateNode===null)throw Error(O(166));return Dt(t),null}if(r=vr(we.current),ys(t)){i=t.stateNode,e=t.type;var a=t.memoizedProps;switch(i[ke]=t,i[zi]=a,r=(t.mode&1)!==0,e){case"dialog":et("cancel",i),et("close",i);break;case"iframe":case"object":case"embed":et("load",i);break;case"video":case"audio":for(s=0;s<Li.length;s++)et(Li[s],i);break;case"source":et("error",i);break;case"img":case"image":case"link":et("error",i),et("load",i);break;case"details":et("toggle",i);break;case"input":su(i,a),et("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!a.multiple},et("invalid",i);break;case"textarea":nu(i,a),et("invalid",i)}Xn(e,a),s=null;for(var n in a)if(a.hasOwnProperty(n)){var o=a[n];n==="children"?typeof o=="string"?i.textContent!==o&&(a.suppressHydrationWarning!==!0&&ms(i.textContent,o,r),s=["children",o]):typeof o=="number"&&i.textContent!==""+o&&(a.suppressHydrationWarning!==!0&&ms(i.textContent,o,r),s=["children",""+o]):Fi.hasOwnProperty(n)&&o!=null&&n==="onScroll"&&et("scroll",i)}switch(e){case"input":ls(i),au(i,a,!0);break;case"textarea":ls(i),ou(i);break;case"select":case"option":break;default:typeof a.onClick=="function"&&(i.onclick=ta)}i=s,t.updateQueue=i,i!==null&&(t.flags|=4)}else{n=s.nodeType===9?s:s.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=Td(e)),r==="http://www.w3.org/1999/xhtml"?e==="script"?(r=n.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof i.is=="string"?r=n.createElement(e,{is:i.is}):(r=n.createElement(e),e==="select"&&(n=r,i.multiple?n.multiple=!0:i.size&&(n.size=i.size))):r=n.createElementNS(r,e),r[ke]=t,r[zi]=i,zh(r,t,!1,!1),t.stateNode=r;t:{switch(n=Qn(e,i),e){case"dialog":et("cancel",r),et("close",r),s=i;break;case"iframe":case"object":case"embed":et("load",r),s=i;break;case"video":case"audio":for(s=0;s<Li.length;s++)et(Li[s],r);s=i;break;case"source":et("error",r),s=i;break;case"img":case"image":case"link":et("error",r),et("load",r),s=i;break;case"details":et("toggle",r),s=i;break;case"input":su(r,i),s=zn(r,i),et("invalid",r);break;case"option":s=i;break;case"select":r._wrapperState={wasMultiple:!!i.multiple},s=ct({},i,{value:void 0}),et("invalid",r);break;case"textarea":nu(r,i),s=jn(r,i),et("invalid",r);break;default:s=i}Xn(e,s),o=s;for(a in o)if(o.hasOwnProperty(a)){var l=o[a];a==="style"?Ld(r,l):a==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&Sd(r,l)):a==="children"?typeof l=="string"?(e!=="textarea"||l!=="")&&Mi(r,l):typeof l=="number"&&Mi(r,""+l):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&(Fi.hasOwnProperty(a)?l!=null&&a==="onScroll"&&et("scroll",r):l!=null&&jo(r,a,l,n))}switch(e){case"input":ls(r),au(r,i,!1);break;case"textarea":ls(r),ou(r);break;case"option":i.value!=null&&r.setAttribute("value",""+nr(i.value));break;case"select":r.multiple=!!i.multiple,a=i.value,a!=null?jr(r,!!i.multiple,a,!1):i.defaultValue!=null&&jr(r,!!i.multiple,i.defaultValue,!0);break;default:typeof s.onClick=="function"&&(r.onclick=ta)}switch(e){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break t;case"img":i=!0;break t;default:i=!1}}i&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Dt(t),null;case 6:if(r&&t.stateNode!=null)Yh(r,t,r.memoizedProps,i);else{if(typeof i!="string"&&t.stateNode===null)throw Error(O(166));if(e=vr(Yi.current),vr(we.current),ys(t)){if(i=t.stateNode,e=t.memoizedProps,i[ke]=t,(a=i.nodeValue!==e)&&(r=qt,r!==null))switch(r.tag){case 3:ms(i.nodeValue,e,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&ms(i.nodeValue,e,(r.mode&1)!==0)}a&&(t.flags|=4)}else i=(e.nodeType===9?e:e.ownerDocument).createTextNode(i),i[ke]=t,t.stateNode=i}return Dt(t),null;case 13:if(it(ot),i=t.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(at&&jt!==null&&(t.mode&1)!==0&&(t.flags&128)===0)ch(),ii(),t.flags|=98560,a=!1;else if(a=ys(t),i!==null&&i.dehydrated!==null){if(r===null){if(!a)throw Error(O(318));if(a=t.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(O(317));a[ke]=t}else ii(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;Dt(t),a=!1}else fe!==null&&(_o(fe),fe=null),a=!0;if(!a)return t.flags&65536?t:null}return(t.flags&128)!==0?(t.lanes=e,t):(i=i!==null,i!==(r!==null&&r.memoizedState!==null)&&i&&(t.child.flags|=8192,(t.mode&1)!==0&&(r===null||(ot.current&1)!==0?yt===0&&(yt=3):Cl())),t.updateQueue!==null&&(t.flags|=4),Dt(t),null);case 4:return ai(),ko(r,t),r===null&&Vi(t.stateNode.containerInfo),Dt(t),null;case 10:return fl(t.type._context),Dt(t),null;case 17:return Ht(t.type)&&ea(),Dt(t),null;case 19:if(it(ot),a=t.memoizedState,a===null)return Dt(t),null;if(i=(t.flags&128)!==0,n=a.rendering,n===null)if(i)yi(a,!1);else{if(yt!==0||r!==null&&(r.flags&128)!==0)for(r=t.child;r!==null;){if(n=la(r),n!==null){for(t.flags|=128,yi(a,!1),i=n.updateQueue,i!==null&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=e,e=t.child;e!==null;)a=e,r=i,a.flags&=14680066,n=a.alternate,n===null?(a.childLanes=0,a.lanes=r,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=n.childLanes,a.lanes=n.lanes,a.child=n.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=n.memoizedProps,a.memoizedState=n.memoizedState,a.updateQueue=n.updateQueue,a.type=n.type,r=n.dependencies,a.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),e=e.sibling;return tt(ot,ot.current&1|2),t.child}r=r.sibling}a.tail!==null&&ht()>oi&&(t.flags|=128,i=!0,yi(a,!1),t.lanes=4194304)}else{if(!i)if(r=la(n),r!==null){if(t.flags|=128,i=!0,e=r.updateQueue,e!==null&&(t.updateQueue=e,t.flags|=4),yi(a,!0),a.tail===null&&a.tailMode==="hidden"&&!n.alternate&&!at)return Dt(t),null}else 2*ht()-a.renderingStartTime>oi&&e!==1073741824&&(t.flags|=128,i=!0,yi(a,!1),t.lanes=4194304);a.isBackwards?(n.sibling=t.child,t.child=n):(e=a.last,e!==null?e.sibling=n:t.child=n,a.last=n)}return a.tail!==null?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=ht(),t.sibling=null,e=ot.current,tt(ot,i?e&1|2:e&1),t):(Dt(t),null);case 22:case 23:return Dl(),i=t.memoizedState!==null,r!==null&&r.memoizedState!==null!==i&&(t.flags|=8192),i&&(t.mode&1)!==0?(Yt&1073741824)!==0&&(Dt(t),t.subtreeFlags&6&&(t.flags|=8192)):Dt(t),null;case 24:return null;case 25:return null}throw Error(O(156,t.tag))}function lm(r,t){switch(ul(t),t.tag){case 1:return Ht(t.type)&&ea(),r=t.flags,r&65536?(t.flags=r&-65537|128,t):null;case 3:return ai(),it(Vt),it(Pt),vl(),r=t.flags,(r&65536)!==0&&(r&128)===0?(t.flags=r&-65537|128,t):null;case 5:return yl(t),null;case 13:if(it(ot),r=t.memoizedState,r!==null&&r.dehydrated!==null){if(t.alternate===null)throw Error(O(340));ii()}return r=t.flags,r&65536?(t.flags=r&-65537|128,t):null;case 19:return it(ot),null;case 4:return ai(),null;case 10:return fl(t.type._context),null;case 22:case 23:return Dl(),null;case 24:return null;default:return null}}var Ts=!1,_t=!1,um=typeof WeakSet=="function"?WeakSet:Set,N=null;function zr(r,t){var e=r.ref;if(e!==null)if(typeof e=="function")try{e(null)}catch(i){dt(r,t,i)}else e.current=null}function jh(r,t,e){try{e()}catch(i){dt(r,t,i)}}var Xu=!1;function cm(r,t){if(oo=Qs,r=Qd(),ol(r)){if("selectionStart"in r)var e={start:r.selectionStart,end:r.selectionEnd};else t:{e=(e=r.ownerDocument)&&e.defaultView||window;var i=e.getSelection&&e.getSelection();if(i&&i.rangeCount!==0){e=i.anchorNode;var s=i.anchorOffset,a=i.focusNode;i=i.focusOffset;try{e.nodeType,a.nodeType}catch{e=null;break t}var n=0,o=-1,l=-1,u=0,c=0,d=r,h=null;e:for(;;){for(var f;d!==e||s!==0&&d.nodeType!==3||(o=n+s),d!==a||i!==0&&d.nodeType!==3||(l=n+i),d.nodeType===3&&(n+=d.nodeValue.length),(f=d.firstChild)!==null;)h=d,d=f;for(;;){if(d===r)break e;if(h===e&&++u===s&&(o=n),h===a&&++c===i&&(l=n),(f=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=f}e=o===-1||l===-1?null:{start:o,end:l}}else e=null}e=e||{start:0,end:0}}else e=null;for(lo={focusedElem:r,selectionRange:e},Qs=!1,N=t;N!==null;)if(t=N,r=t.child,(t.subtreeFlags&1028)!==0&&r!==null)r.return=t,N=r;else for(;N!==null;){t=N;try{var g=t.alternate;if((t.flags&1024)!==0)switch(t.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var p=g.memoizedProps,T=g.memoizedState,y=t.stateNode,v=y.getSnapshotBeforeUpdate(t.elementType===t.type?p:de(t.type,p),T);y.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var E=t.stateNode.containerInfo;E.nodeType===1?E.textContent="":E.nodeType===9&&E.documentElement&&E.removeChild(E.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(O(163))}}catch(S){dt(t,t.return,S)}if(r=t.sibling,r!==null){r.return=t.return,N=r;break}N=t.return}return g=Xu,Xu=!1,g}function Ci(r,t,e){var i=t.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var s=i=i.next;do{if((s.tag&r)===r){var a=s.destroy;s.destroy=void 0,a!==void 0&&jh(t,e,a)}s=s.next}while(s!==i)}}function _a(r,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var e=t=t.next;do{if((e.tag&r)===r){var i=e.create;e.destroy=i()}e=e.next}while(e!==t)}}function Ao(r){var t=r.ref;if(t!==null){var e=r.stateNode;switch(r.tag){case 5:r=e;break;default:r=e}typeof t=="function"?t(r):t.current=r}}function qh(r){var t=r.alternate;t!==null&&(r.alternate=null,qh(t)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(t=r.stateNode,t!==null&&(delete t[ke],delete t[zi],delete t[ho],delete t[Wp],delete t[Yp])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function Xh(r){return r.tag===5||r.tag===3||r.tag===4}function Qu(r){t:for(;;){for(;r.sibling===null;){if(r.return===null||Xh(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue t;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function wo(r,t,e){var i=r.tag;if(i===5||i===6)r=r.stateNode,t?e.nodeType===8?e.parentNode.insertBefore(r,t):e.insertBefore(r,t):(e.nodeType===8?(t=e.parentNode,t.insertBefore(r,e)):(t=e,t.appendChild(r)),e=e._reactRootContainer,e!=null||t.onclick!==null||(t.onclick=ta));else if(i!==4&&(r=r.child,r!==null))for(wo(r,t,e),r=r.sibling;r!==null;)wo(r,t,e),r=r.sibling}function Ro(r,t,e){var i=r.tag;if(i===5||i===6)r=r.stateNode,t?e.insertBefore(r,t):e.appendChild(r);else if(i!==4&&(r=r.child,r!==null))for(Ro(r,t,e),r=r.sibling;r!==null;)Ro(r,t,e),r=r.sibling}var bt=null,he=!1;function Ke(r,t,e){for(e=e.child;e!==null;)Qh(r,t,e),e=e.sibling}function Qh(r,t,e){if(Ae&&typeof Ae.onCommitFiberUnmount=="function")try{Ae.onCommitFiberUnmount(La,e)}catch{}switch(e.tag){case 5:_t||zr(e,t);case 6:var i=bt,s=he;bt=null,Ke(r,t,e),bt=i,he=s,bt!==null&&(he?(r=bt,e=e.stateNode,r.nodeType===8?r.parentNode.removeChild(e):r.removeChild(e)):bt.removeChild(e.stateNode));break;case 18:bt!==null&&(he?(r=bt,e=e.stateNode,r.nodeType===8?an(r.parentNode,e):r.nodeType===1&&an(r,e),$i(r)):an(bt,e.stateNode));break;case 4:i=bt,s=he,bt=e.stateNode.containerInfo,he=!0,Ke(r,t,e),bt=i,he=s;break;case 0:case 11:case 14:case 15:if(!_t&&(i=e.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){s=i=i.next;do{var a=s,n=a.destroy;a=a.tag,n!==void 0&&((a&2)!==0||(a&4)!==0)&&jh(e,t,n),s=s.next}while(s!==i)}Ke(r,t,e);break;case 1:if(!_t&&(zr(e,t),i=e.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=e.memoizedProps,i.state=e.memoizedState,i.componentWillUnmount()}catch(o){dt(e,t,o)}Ke(r,t,e);break;case 21:Ke(r,t,e);break;case 22:e.mode&1?(_t=(i=_t)||e.memoizedState!==null,Ke(r,t,e),_t=i):Ke(r,t,e);break;default:Ke(r,t,e)}}function Ju(r){var t=r.updateQueue;if(t!==null){r.updateQueue=null;var e=r.stateNode;e===null&&(e=r.stateNode=new um),t.forEach(function(i){var s=Em.bind(null,r,i);e.has(i)||(e.add(i),i.then(s,s))})}}function le(r,t){var e=t.deletions;if(e!==null)for(var i=0;i<e.length;i++){var s=e[i];try{var a=r,n=t,o=n;t:for(;o!==null;){switch(o.tag){case 5:bt=o.stateNode,he=!1;break t;case 3:bt=o.stateNode.containerInfo,he=!0;break t;case 4:bt=o.stateNode.containerInfo,he=!0;break t}o=o.return}if(bt===null)throw Error(O(160));Qh(a,n,s),bt=null,he=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(u){dt(s,t,u)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)Jh(t,r),t=t.sibling}function Jh(r,t){var e=r.alternate,i=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(le(t,r),Te(r),i&4){try{Ci(3,r,r.return),_a(3,r)}catch(p){dt(r,r.return,p)}try{Ci(5,r,r.return)}catch(p){dt(r,r.return,p)}}break;case 1:le(t,r),Te(r),i&512&&e!==null&&zr(e,e.return);break;case 5:if(le(t,r),Te(r),i&512&&e!==null&&zr(e,e.return),r.flags&32){var s=r.stateNode;try{Mi(s,"")}catch(p){dt(r,r.return,p)}}if(i&4&&(s=r.stateNode,s!=null)){var a=r.memoizedProps,n=e!==null?e.memoizedProps:a,o=r.type,l=r.updateQueue;if(r.updateQueue=null,l!==null)try{o==="input"&&a.type==="radio"&&a.name!=null&&vd(s,a),Qn(o,n);var u=Qn(o,a);for(n=0;n<l.length;n+=2){var c=l[n],d=l[n+1];c==="style"?Ld(s,d):c==="dangerouslySetInnerHTML"?Sd(s,d):c==="children"?Mi(s,d):jo(s,c,d,u)}switch(o){case"input":Wn(s,a);break;case"textarea":Ed(s,a);break;case"select":var h=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!a.multiple;var f=a.value;f!=null?jr(s,!!a.multiple,f,!1):h!==!!a.multiple&&(a.defaultValue!=null?jr(s,!!a.multiple,a.defaultValue,!0):jr(s,!!a.multiple,a.multiple?[]:"",!1))}s[zi]=a}catch(p){dt(r,r.return,p)}}break;case 6:if(le(t,r),Te(r),i&4){if(r.stateNode===null)throw Error(O(162));s=r.stateNode,a=r.memoizedProps;try{s.nodeValue=a}catch(p){dt(r,r.return,p)}}break;case 3:if(le(t,r),Te(r),i&4&&e!==null&&e.memoizedState.isDehydrated)try{$i(t.containerInfo)}catch(p){dt(r,r.return,p)}break;case 4:le(t,r),Te(r);break;case 13:le(t,r),Te(r),s=r.child,s.flags&8192&&(a=s.memoizedState!==null,s.stateNode.isHidden=a,!a||s.alternate!==null&&s.alternate.memoizedState!==null||(Rl=ht())),i&4&&Ju(r);break;case 22:if(c=e!==null&&e.memoizedState!==null,r.mode&1?(_t=(u=_t)||c,le(t,r),_t=u):le(t,r),Te(r),i&8192){if(u=r.memoizedState!==null,(r.stateNode.isHidden=u)&&!c&&(r.mode&1)!==0)for(N=r,c=r.child;c!==null;){for(d=N=c;N!==null;){switch(h=N,f=h.child,h.tag){case 0:case 11:case 14:case 15:Ci(4,h,h.return);break;case 1:zr(h,h.return);var g=h.stateNode;if(typeof g.componentWillUnmount=="function"){i=h,e=h.return;try{t=i,g.props=t.memoizedProps,g.state=t.memoizedState,g.componentWillUnmount()}catch(p){dt(i,e,p)}}break;case 5:zr(h,h.return);break;case 22:if(h.memoizedState!==null){tc(d);continue}}f!==null?(f.return=h,N=f):tc(d)}c=c.sibling}t:for(c=null,d=r;;){if(d.tag===5){if(c===null){c=d;try{s=d.stateNode,u?(a=s.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none"):(o=d.stateNode,l=d.memoizedProps.style,n=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=bd("display",n))}catch(p){dt(r,r.return,p)}}}else if(d.tag===6){if(c===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(p){dt(r,r.return,p)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===r)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===r)break t;for(;d.sibling===null;){if(d.return===null||d.return===r)break t;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:le(t,r),Te(r),i&4&&Ju(r);break;case 21:break;default:le(t,r),Te(r)}}function Te(r){var t=r.flags;if(t&2){try{t:{for(var e=r.return;e!==null;){if(Xh(e)){var i=e;break t}e=e.return}throw Error(O(160))}switch(i.tag){case 5:var s=i.stateNode;i.flags&32&&(Mi(s,""),i.flags&=-33);var a=Qu(r);Ro(r,a,s);break;case 3:case 4:var n=i.stateNode.containerInfo,o=Qu(r);wo(r,o,n);break;default:throw Error(O(161))}}catch(l){dt(r,r.return,l)}r.flags&=-3}t&4096&&(r.flags&=-4097)}function dm(r,t,e){N=r,Zh(r)}function Zh(r,t,e){for(var i=(r.mode&1)!==0;N!==null;){var s=N,a=s.child;if(s.tag===22&&i){var n=s.memoizedState!==null||Ts;if(!n){var o=s.alternate,l=o!==null&&o.memoizedState!==null||_t;o=Ts;var u=_t;if(Ts=n,(_t=l)&&!u)for(N=s;N!==null;)n=N,l=n.child,n.tag===22&&n.memoizedState!==null?ec(s):l!==null?(l.return=n,N=l):ec(s);for(;a!==null;)N=a,Zh(a),a=a.sibling;N=s,Ts=o,_t=u}Zu(r)}else(s.subtreeFlags&8772)!==0&&a!==null?(a.return=s,N=a):Zu(r)}}function Zu(r){for(;N!==null;){var t=N;if((t.flags&8772)!==0){var e=t.alternate;try{if((t.flags&8772)!==0)switch(t.tag){case 0:case 11:case 15:_t||_a(5,t);break;case 1:var i=t.stateNode;if(t.flags&4&&!_t)if(e===null)i.componentDidMount();else{var s=t.elementType===t.type?e.memoizedProps:de(t.type,e.memoizedProps);i.componentDidUpdate(s,e.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;a!==null&&Mu(t,a,i);break;case 3:var n=t.updateQueue;if(n!==null){if(e=null,t.child!==null)switch(t.child.tag){case 5:e=t.child.stateNode;break;case 1:e=t.child.stateNode}Mu(t,n,e)}break;case 5:var o=t.stateNode;if(e===null&&t.flags&4){e=o;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&e.focus();break;case"img":l.src&&(e.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var u=t.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var d=c.dehydrated;d!==null&&$i(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(O(163))}_t||t.flags&512&&Ao(t)}catch(h){dt(t,t.return,h)}}if(t===r){N=null;break}if(e=t.sibling,e!==null){e.return=t.return,N=e;break}N=t.return}}function tc(r){for(;N!==null;){var t=N;if(t===r){N=null;break}var e=t.sibling;if(e!==null){e.return=t.return,N=e;break}N=t.return}}function ec(r){for(;N!==null;){var t=N;try{switch(t.tag){case 0:case 11:case 15:var e=t.return;try{_a(4,t)}catch(l){dt(t,e,l)}break;case 1:var i=t.stateNode;if(typeof i.componentDidMount=="function"){var s=t.return;try{i.componentDidMount()}catch(l){dt(t,s,l)}}var a=t.return;try{Ao(t)}catch(l){dt(t,a,l)}break;case 5:var n=t.return;try{Ao(t)}catch(l){dt(t,n,l)}}}catch(l){dt(t,t.return,l)}if(t===r){N=null;break}var o=t.sibling;if(o!==null){o.return=t.return,N=o;break}N=t.return}}var hm=Math.ceil,da=Ge.ReactCurrentDispatcher,Al=Ge.ReactCurrentOwner,ae=Ge.ReactCurrentBatchConfig,q=0,St=null,gt=null,At=0,Yt=0,Wr=ur(0),yt=0,Qi=null,Ar=0,Pa=0,wl=0,_i=null,$t=null,Rl=0,oi=1/0,De=null,ha=!1,Io=null,ir=null,Ss=!1,Qe=null,fa=0,Pi=0,Do=null,Ks=-1,Vs=0;function Ot(){return(q&6)!==0?ht():Ks!==-1?Ks:Ks=ht()}function sr(r){return(r.mode&1)===0?1:(q&2)!==0&&At!==0?At&-At:qp.transition!==null?(Vs===0&&(Vs=Fd()),Vs):(r=J,r!==0||(r=window.event,r=r===void 0?16:Kd(r.type)),r)}function ye(r,t,e,i){if(50<Pi)throw Pi=0,Do=null,Error(O(185));rs(r,e,i),((q&2)===0||r!==St)&&(r===St&&((q&2)===0&&(Pa|=e),yt===4&&qe(r,At)),zt(r,i),e===1&&q===0&&(t.mode&1)===0&&(oi=ht()+500,Ia&&cr()))}function zt(r,t){var e=r.callbackNode;qg(r,t);var i=Xs(r,r===St?At:0);if(i===0)e!==null&&cu(e),r.callbackNode=null,r.callbackPriority=0;else if(t=i&-i,r.callbackPriority!==t){if(e!=null&&cu(e),t===1)r.tag===0?jp(rc.bind(null,r)):oh(rc.bind(null,r)),Hp(function(){(q&6)===0&&cr()}),e=null;else{switch(Md(i)){case 1:e=Zo;break;case 4:e=xd;break;case 16:e=qs;break;case 536870912:e=Od;break;default:e=qs}e=lf(e,tf.bind(null,r))}r.callbackPriority=t,r.callbackNode=e}}function tf(r,t){if(Ks=-1,Vs=0,(q&6)!==0)throw Error(O(327));var e=r.callbackNode;if(Zr()&&r.callbackNode!==e)return null;var i=Xs(r,r===St?At:0);if(i===0)return null;if((i&30)!==0||(i&r.expiredLanes)!==0||t)t=ga(r,i);else{t=i;var s=q;q|=2;var a=rf();(St!==r||At!==t)&&(De=null,oi=ht()+500,Er(r,t));do try{pm();break}catch(o){ef(r,o)}while(1);hl(),da.current=a,q=s,gt!==null?t=0:(St=null,At=0,t=yt)}if(t!==0){if(t===2&&(s=ro(r),s!==0&&(i=s,t=Co(r,s))),t===1)throw e=Qi,Er(r,0),qe(r,i),zt(r,ht()),e;if(t===6)qe(r,i);else{if(s=r.current.alternate,(i&30)===0&&!fm(s)&&(t=ga(r,i),t===2&&(a=ro(r),a!==0&&(i=a,t=Co(r,a))),t===1))throw e=Qi,Er(r,0),qe(r,i),zt(r,ht()),e;switch(r.finishedWork=s,r.finishedLanes=i,t){case 0:case 1:throw Error(O(345));case 2:fr(r,$t,De);break;case 3:if(qe(r,i),(i&130023424)===i&&(t=Rl+500-ht(),10<t)){if(Xs(r,0)!==0)break;if(s=r.suspendedLanes,(s&i)!==i){Ot(),r.pingedLanes|=r.suspendedLanes&s;break}r.timeoutHandle=co(fr.bind(null,r,$t,De),t);break}fr(r,$t,De);break;case 4:if(qe(r,i),(i&4194240)===i)break;for(t=r.eventTimes,s=-1;0<i;){var n=31-me(i);a=1<<n,n=t[n],n>s&&(s=n),i&=~a}if(i=s,i=ht()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*hm(i/1960))-i,10<i){r.timeoutHandle=co(fr.bind(null,r,$t,De),i);break}fr(r,$t,De);break;case 5:fr(r,$t,De);break;default:throw Error(O(329))}}}return zt(r,ht()),r.callbackNode===e?tf.bind(null,r):null}function Co(r,t){var e=_i;return r.current.memoizedState.isDehydrated&&(Er(r,t).flags|=256),r=ga(r,t),r!==2&&(t=$t,$t=e,t!==null&&_o(t)),r}function _o(r){$t===null?$t=r:$t.push.apply($t,r)}function fm(r){for(var t=r;;){if(t.flags&16384){var e=t.updateQueue;if(e!==null&&(e=e.stores,e!==null))for(var i=0;i<e.length;i++){var s=e[i],a=s.getSnapshot;s=s.value;try{if(!ve(a(),s))return!1}catch{return!1}}}if(e=t.child,t.subtreeFlags&16384&&e!==null)e.return=t,t=e;else{if(t===r)break;for(;t.sibling===null;){if(t.return===null||t.return===r)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function qe(r,t){for(t&=~wl,t&=~Pa,r.suspendedLanes|=t,r.pingedLanes&=~t,r=r.expirationTimes;0<t;){var e=31-me(t),i=1<<e;r[e]=-1,t&=~i}}function rc(r){if((q&6)!==0)throw Error(O(327));Zr();var t=Xs(r,0);if((t&1)===0)return zt(r,ht()),null;var e=ga(r,t);if(r.tag!==0&&e===2){var i=ro(r);i!==0&&(t=i,e=Co(r,i))}if(e===1)throw e=Qi,Er(r,0),qe(r,t),zt(r,ht()),e;if(e===6)throw Error(O(345));return r.finishedWork=r.current.alternate,r.finishedLanes=t,fr(r,$t,De),zt(r,ht()),null}function Il(r,t){var e=q;q|=1;try{return r(t)}finally{q=e,q===0&&(oi=ht()+500,Ia&&cr())}}function wr(r){Qe!==null&&Qe.tag===0&&(q&6)===0&&Zr();var t=q;q|=1;var e=ae.transition,i=J;try{if(ae.transition=null,J=1,r)return r()}finally{J=i,ae.transition=e,q=t,(q&6)===0&&cr()}}function Dl(){Yt=Wr.current,it(Wr)}function Er(r,t){r.finishedWork=null,r.finishedLanes=0;var e=r.timeoutHandle;if(e!==-1&&(r.timeoutHandle=-1,Vp(e)),gt!==null)for(e=gt.return;e!==null;){var i=e;switch(ul(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&ea();break;case 3:ai(),it(Vt),it(Pt),vl();break;case 5:yl(i);break;case 4:ai();break;case 13:it(ot);break;case 19:it(ot);break;case 10:fl(i.type._context);break;case 22:case 23:Dl()}e=e.return}if(St=r,gt=r=ar(r.current,null),At=Yt=t,yt=0,Qi=null,wl=Pa=Ar=0,$t=_i=null,yr!==null){for(t=0;t<yr.length;t++)if(e=yr[t],i=e.interleaved,i!==null){e.interleaved=null;var s=i.next,a=e.pending;if(a!==null){var n=a.next;a.next=s,i.next=n}e.pending=i}yr=null}return r}function ef(r,t){do{var e=gt;try{if(hl(),Bs.current=ca,ua){for(var i=ut.memoizedState;i!==null;){var s=i.queue;s!==null&&(s.pending=null),i=i.next}ua=!1}if(kr=0,Tt=mt=ut=null,Di=!1,ji=0,Al.current=null,e===null||e.return===null){yt=1,Qi=t,gt=null;break}t:{var a=r,n=e.return,o=e,l=t;if(t=At,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=o,d=c.tag;if((c.mode&1)===0&&(d===0||d===11||d===15)){var h=c.alternate;h?(c.updateQueue=h.updateQueue,c.memoizedState=h.memoizedState,c.lanes=h.lanes):(c.updateQueue=null,c.memoizedState=null)}var f=Vu(n);if(f!==null){f.flags&=-257,Hu(f,n,o,a,t),f.mode&1&&Ku(a,u,t),t=f,l=u;var g=t.updateQueue;if(g===null){var p=new Set;p.add(l),t.updateQueue=p}else g.add(l);break t}else{if((t&1)===0){Ku(a,u,t),Cl();break t}l=Error(O(426))}}else if(at&&o.mode&1){var T=Vu(n);if(T!==null){(T.flags&65536)===0&&(T.flags|=256),Hu(T,n,o,a,t),cl(ni(l,o));break t}}a=l=ni(l,o),yt!==4&&(yt=2),_i===null?_i=[a]:_i.push(a),a=n;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t;var y=Nh(a,l,t);Fu(a,y);break t;case 1:o=l;var v=a.type,E=a.stateNode;if((a.flags&128)===0&&(typeof v.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(ir===null||!ir.has(E)))){a.flags|=65536,t&=-t,a.lanes|=t;var S=Uh(a,o,t);Fu(a,S);break t}}a=a.return}while(a!==null)}af(e)}catch(b){t=b,gt===e&&e!==null&&(gt=e=e.return);continue}break}while(1)}function rf(){var r=da.current;return da.current=ca,r===null?ca:r}function Cl(){(yt===0||yt===3||yt===2)&&(yt=4),St===null||(Ar&268435455)===0&&(Pa&268435455)===0||qe(St,At)}function ga(r,t){var e=q;q|=2;var i=rf();(St!==r||At!==t)&&(De=null,Er(r,t));do try{gm();break}catch(s){ef(r,s)}while(1);if(hl(),q=e,da.current=i,gt!==null)throw Error(O(261));return St=null,At=0,yt}function gm(){for(;gt!==null;)sf(gt)}function pm(){for(;gt!==null&&!$g();)sf(gt)}function sf(r){var t=of(r.alternate,r,Yt);r.memoizedProps=r.pendingProps,t===null?af(r):gt=t,Al.current=null}function af(r){var t=r;do{var e=t.alternate;if(r=t.return,(t.flags&32768)===0){if(e=om(e,t,Yt),e!==null){gt=e;return}}else{if(e=lm(e,t),e!==null){e.flags&=32767,gt=e;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{yt=6,gt=null;return}}if(t=t.sibling,t!==null){gt=t;return}gt=t=r}while(t!==null);yt===0&&(yt=5)}function fr(r,t,e){var i=J,s=ae.transition;try{ae.transition=null,J=1,mm(r,t,e,i)}finally{ae.transition=s,J=i}return null}function mm(r,t,e,i){do Zr();while(Qe!==null);if((q&6)!==0)throw Error(O(327));e=r.finishedWork;var s=r.finishedLanes;if(e===null)return null;if(r.finishedWork=null,r.finishedLanes=0,e===r.current)throw Error(O(177));r.callbackNode=null,r.callbackPriority=0;var a=e.lanes|e.childLanes;if(Xg(r,a),r===St&&(gt=St=null,At=0),(e.subtreeFlags&2064)===0&&(e.flags&2064)===0||Ss||(Ss=!0,lf(qs,function(){return Zr(),null})),a=(e.flags&15990)!==0,(e.subtreeFlags&15990)!==0||a){a=ae.transition,ae.transition=null;var n=J;J=1;var o=q;q|=4,Al.current=null,cm(r,e),Jh(e,r),Mp(lo),Qs=!!oo,lo=oo=null,r.current=e,dm(e),Gg(),q=o,J=n,ae.transition=a}else r.current=e;if(Ss&&(Ss=!1,Qe=r,fa=s),a=r.pendingLanes,a===0&&(ir=null),Hg(e.stateNode),zt(r,ht()),t!==null)for(i=r.onRecoverableError,e=0;e<t.length;e++)s=t[e],i(s.value,{componentStack:s.stack,digest:s.digest});if(ha)throw ha=!1,r=Io,Io=null,r;return(fa&1)!==0&&r.tag!==0&&Zr(),a=r.pendingLanes,(a&1)!==0?r===Do?Pi++:(Pi=0,Do=r):Pi=0,cr(),null}function Zr(){if(Qe!==null){var r=Md(fa),t=ae.transition,e=J;try{if(ae.transition=null,J=16>r?16:r,Qe===null)var i=!1;else{if(r=Qe,Qe=null,fa=0,(q&6)!==0)throw Error(O(331));var s=q;for(q|=4,N=r.current;N!==null;){var a=N,n=a.child;if((N.flags&16)!==0){var o=a.deletions;if(o!==null){for(var l=0;l<o.length;l++){var u=o[l];for(N=u;N!==null;){var c=N;switch(c.tag){case 0:case 11:case 15:Ci(8,c,a)}var d=c.child;if(d!==null)d.return=c,N=d;else for(;N!==null;){c=N;var h=c.sibling,f=c.return;if(qh(c),c===u){N=null;break}if(h!==null){h.return=f,N=h;break}N=f}}}var g=a.alternate;if(g!==null){var p=g.child;if(p!==null){g.child=null;do{var T=p.sibling;p.sibling=null,p=T}while(p!==null)}}N=a}}if((a.subtreeFlags&2064)!==0&&n!==null)n.return=a,N=n;else t:for(;N!==null;){if(a=N,(a.flags&2048)!==0)switch(a.tag){case 0:case 11:case 15:Ci(9,a,a.return)}var y=a.sibling;if(y!==null){y.return=a.return,N=y;break t}N=a.return}}var v=r.current;for(N=v;N!==null;){n=N;var E=n.child;if((n.subtreeFlags&2064)!==0&&E!==null)E.return=n,N=E;else t:for(n=v;N!==null;){if(o=N,(o.flags&2048)!==0)try{switch(o.tag){case 0:case 11:case 15:_a(9,o)}}catch(b){dt(o,o.return,b)}if(o===n){N=null;break t}var S=o.sibling;if(S!==null){S.return=o.return,N=S;break t}N=o.return}}if(q=s,cr(),Ae&&typeof Ae.onPostCommitFiberRoot=="function")try{Ae.onPostCommitFiberRoot(La,r)}catch{}i=!0}return i}finally{J=e,ae.transition=t}}return!1}function ic(r,t,e){t=ni(e,t),t=Nh(r,t,1),r=rr(r,t,1),t=Ot(),r!==null&&(rs(r,1,t),zt(r,t))}function dt(r,t,e){if(r.tag===3)ic(r,r,e);else for(;t!==null;){if(t.tag===3){ic(t,r,e);break}else if(t.tag===1){var i=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(ir===null||!ir.has(i))){r=ni(e,r),r=Uh(t,r,1),t=rr(t,r,1),r=Ot(),t!==null&&(rs(t,1,r),zt(t,r));break}}t=t.return}}function ym(r,t,e){var i=r.pingCache;i!==null&&i.delete(t),t=Ot(),r.pingedLanes|=r.suspendedLanes&e,St===r&&(At&e)===e&&(yt===4||yt===3&&(At&130023424)===At&&500>ht()-Rl?Er(r,0):wl|=e),zt(r,t)}function nf(r,t){t===0&&((r.mode&1)===0?t=1:(t=ds,ds<<=1,(ds&130023424)===0&&(ds=4194304)));var e=Ot();r=Be(r,t),r!==null&&(rs(r,t,e),zt(r,e))}function vm(r){var t=r.memoizedState,e=0;t!==null&&(e=t.retryLane),nf(r,e)}function Em(r,t){var e=0;switch(r.tag){case 13:var i=r.stateNode,s=r.memoizedState;s!==null&&(e=s.retryLane);break;case 19:i=r.stateNode;break;default:throw Error(O(314))}i!==null&&i.delete(t),nf(r,e)}var of;of=function(r,t,e){if(r!==null)if(r.memoizedProps!==t.pendingProps||Vt.current)Kt=!0;else{if((r.lanes&e)===0&&(t.flags&128)===0)return Kt=!1,nm(r,t,e);Kt=(r.flags&131072)!==0}else Kt=!1,at&&(t.flags&1048576)!==0&&lh(t,sa,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;Gs(r,t),r=t.pendingProps;var s=ri(t,Pt.current);Jr(t,e),s=Tl(null,t,i,r,s,e);var a=Sl();return t.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ht(i)?(a=!0,ra(t)):a=!1,t.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,pl(t),s.updater=Da,t.stateNode=s,s._reactInternals=t,vo(t,i,r,e),t=So(null,t,i,!0,a,e)):(t.tag=0,at&&a&&ll(t),xt(null,t,s,e),t=t.child),t;case 16:i=t.elementType;t:{switch(Gs(r,t),r=t.pendingProps,s=i._init,i=s(i._payload),t.type=i,s=t.tag=Sm(i),r=de(i,r),s){case 0:t=To(null,t,i,r,e);break t;case 1:t=Yu(null,t,i,r,e);break t;case 11:t=zu(null,t,i,r,e);break t;case 14:t=Wu(null,t,i,de(i.type,r),e);break t}throw Error(O(306,i,""))}return t;case 0:return i=t.type,s=t.pendingProps,s=t.elementType===i?s:de(i,s),To(r,t,i,s,e);case 1:return i=t.type,s=t.pendingProps,s=t.elementType===i?s:de(i,s),Yu(r,t,i,s,e);case 3:t:{if(Kh(t),r===null)throw Error(O(387));i=t.pendingProps,a=t.memoizedState,s=a.element,hh(r,t),oa(t,i,null,e);var n=t.memoizedState;if(i=n.element,a.isDehydrated)if(a={element:i,isDehydrated:!1,cache:n.cache,pendingSuspenseBoundaries:n.pendingSuspenseBoundaries,transitions:n.transitions},t.updateQueue.baseState=a,t.memoizedState=a,t.flags&256){s=ni(Error(O(423)),t),t=ju(r,t,i,e,s);break t}else if(i!==s){s=ni(Error(O(424)),t),t=ju(r,t,i,e,s);break t}else for(jt=er(t.stateNode.containerInfo.firstChild),qt=t,at=!0,fe=null,e=mh(t,null,i,e),t.child=e;e;)e.flags=e.flags&-3|4096,e=e.sibling;else{if(ii(),i===s){t=$e(r,t,e);break t}xt(r,t,i,e)}t=t.child}return t;case 5:return yh(t),r===null&&po(t),i=t.type,s=t.pendingProps,a=r!==null?r.memoizedProps:null,n=s.children,uo(i,s)?n=null:a!==null&&uo(i,a)&&(t.flags|=32),Gh(r,t),xt(r,t,n,e),t.child;case 6:return r===null&&po(t),null;case 13:return Vh(r,t,e);case 4:return ml(t,t.stateNode.containerInfo),i=t.pendingProps,r===null?t.child=si(t,null,i,e):xt(r,t,i,e),t.child;case 11:return i=t.type,s=t.pendingProps,s=t.elementType===i?s:de(i,s),zu(r,t,i,s,e);case 7:return xt(r,t,t.pendingProps,e),t.child;case 8:return xt(r,t,t.pendingProps.children,e),t.child;case 12:return xt(r,t,t.pendingProps.children,e),t.child;case 10:t:{if(i=t.type._context,s=t.pendingProps,a=t.memoizedProps,n=s.value,tt(aa,i._currentValue),i._currentValue=n,a!==null)if(ve(a.value,n)){if(a.children===s.children&&!Vt.current){t=$e(r,t,e);break t}}else for(a=t.child,a!==null&&(a.return=t);a!==null;){var o=a.dependencies;if(o!==null){n=a.child;for(var l=o.firstContext;l!==null;){if(l.context===i){if(a.tag===1){l=Me(-1,e&-e),l.tag=2;var u=a.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}a.lanes|=e,l=a.alternate,l!==null&&(l.lanes|=e),mo(a.return,e,t),o.lanes|=e;break}l=l.next}}else if(a.tag===10)n=a.type===t.type?null:a.child;else if(a.tag===18){if(n=a.return,n===null)throw Error(O(341));n.lanes|=e,o=n.alternate,o!==null&&(o.lanes|=e),mo(n,e,t),n=a.sibling}else n=a.child;if(n!==null)n.return=a;else for(n=a;n!==null;){if(n===t){n=null;break}if(a=n.sibling,a!==null){a.return=n.return,n=a;break}n=n.return}a=n}xt(r,t,s.children,e),t=t.child}return t;case 9:return s=t.type,i=t.pendingProps.children,Jr(t,e),s=ne(s),i=i(s),t.flags|=1,xt(r,t,i,e),t.child;case 14:return i=t.type,s=de(i,t.pendingProps),s=de(i.type,s),Wu(r,t,i,s,e);case 15:return Bh(r,t,t.type,t.pendingProps,e);case 17:return i=t.type,s=t.pendingProps,s=t.elementType===i?s:de(i,s),Gs(r,t),t.tag=1,Ht(i)?(r=!0,ra(t)):r=!1,Jr(t,e),gh(t,i,s),vo(t,i,s,e),So(null,t,i,!0,r,e);case 19:return Hh(r,t,e);case 22:return $h(r,t,e)}throw Error(O(156,t.tag))};function lf(r,t){return Pd(r,t)}function Tm(r,t,e,i){this.tag=r,this.key=e,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function se(r,t,e,i){return new Tm(r,t,e,i)}function _l(r){return r=r.prototype,!(!r||!r.isReactComponent)}function Sm(r){if(typeof r=="function")return _l(r)?1:0;if(r!=null){if(r=r.$$typeof,r===Xo)return 11;if(r===Qo)return 14}return 2}function ar(r,t){var e=r.alternate;return e===null?(e=se(r.tag,t,r.key,r.mode),e.elementType=r.elementType,e.type=r.type,e.stateNode=r.stateNode,e.alternate=r,r.alternate=e):(e.pendingProps=t,e.type=r.type,e.flags=0,e.subtreeFlags=0,e.deletions=null),e.flags=r.flags&14680064,e.childLanes=r.childLanes,e.lanes=r.lanes,e.child=r.child,e.memoizedProps=r.memoizedProps,e.memoizedState=r.memoizedState,e.updateQueue=r.updateQueue,t=r.dependencies,e.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},e.sibling=r.sibling,e.index=r.index,e.ref=r.ref,e}function Hs(r,t,e,i,s,a){var n=2;if(i=r,typeof r=="function")_l(r)&&(n=1);else if(typeof r=="string")n=5;else t:switch(r){case Mr:return Tr(e.children,s,a,t);case qo:n=8,s|=8;break;case Gn:return r=se(12,e,t,s|2),r.elementType=Gn,r.lanes=a,r;case Kn:return r=se(13,e,t,s),r.elementType=Kn,r.lanes=a,r;case Vn:return r=se(19,e,t,s),r.elementType=Vn,r.lanes=a,r;case pd:return xa(e,s,a,t);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case fd:n=10;break t;case gd:n=9;break t;case Xo:n=11;break t;case Qo:n=14;break t;case He:n=16,i=null;break t}throw Error(O(130,r==null?r:typeof r,""))}return t=se(n,e,t,s),t.elementType=r,t.type=i,t.lanes=a,t}function Tr(r,t,e,i){return r=se(7,r,i,t),r.lanes=e,r}function xa(r,t,e,i){return r=se(22,r,i,t),r.elementType=pd,r.lanes=e,r.stateNode={isHidden:!1},r}function fn(r,t,e){return r=se(6,r,null,t),r.lanes=e,r}function gn(r,t,e){return t=se(4,r.children!==null?r.children:[],r.key,t),t.lanes=e,t.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},t}function bm(r,t,e,i,s){this.tag=t,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ya(0),this.expirationTimes=Ya(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ya(0),this.identifierPrefix=i,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Pl(r,t,e,i,s,a,n,o,l){return r=new bm(r,t,e,o,l),t===1?(t=1,a===!0&&(t|=8)):t=0,a=se(3,null,null,t),r.current=a,a.stateNode=r,a.memoizedState={element:i,isDehydrated:e,cache:null,transitions:null,pendingSuspenseBoundaries:null},pl(a),r}function Lm(r,t,e){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Fr,key:i==null?null:""+i,children:r,containerInfo:t,implementation:e}}function uf(r){if(!r)return or;r=r._reactInternals;t:{if(Dr(r)!==r||r.tag!==1)throw Error(O(170));var t=r;do{switch(t.tag){case 3:t=t.stateNode.context;break t;case 1:if(Ht(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break t}}t=t.return}while(t!==null);throw Error(O(171))}if(r.tag===1){var e=r.type;if(Ht(e))return nh(r,e,t)}return t}function cf(r,t,e,i,s,a,n,o,l){return r=Pl(e,i,!0,r,s,a,n,o,l),r.context=uf(null),e=r.current,i=Ot(),s=sr(e),a=Me(i,s),a.callback=t!=null?t:null,rr(e,a,s),r.current.lanes=s,rs(r,s,i),zt(r,i),r}function Oa(r,t,e,i){var s=t.current,a=Ot(),n=sr(s);return e=uf(e),t.context===null?t.context=e:t.pendingContext=e,t=Me(a,n),t.payload={element:r},i=i===void 0?null:i,i!==null&&(t.callback=i),r=rr(s,t,n),r!==null&&(ye(r,s,n,a),Us(r,s,n)),n}function pa(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function sc(r,t){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var e=r.retryLane;r.retryLane=e!==0&&e<t?e:t}}function xl(r,t){sc(r,t),(r=r.alternate)&&sc(r,t)}function km(){return null}var df=typeof reportError=="function"?reportError:function(r){console.error(r)};function Ol(r){this._internalRoot=r}Fa.prototype.render=Ol.prototype.render=function(r){var t=this._internalRoot;if(t===null)throw Error(O(409));Oa(r,t,null,null)};Fa.prototype.unmount=Ol.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var t=r.containerInfo;wr(function(){Oa(null,r,null,null)}),t[Ue]=null}};function Fa(r){this._internalRoot=r}Fa.prototype.unstable_scheduleHydration=function(r){if(r){var t=Bd();r={blockedOn:null,target:r,priority:t};for(var e=0;e<je.length&&t!==0&&t<je[e].priority;e++);je.splice(e,0,r),e===0&&Gd(r)}};function Fl(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function Ma(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function ac(){}function Am(r,t,e,i,s){if(s){if(typeof i=="function"){var a=i;i=function(){var u=pa(n);a.call(u)}}var n=cf(t,i,r,0,null,!1,!1,"",ac);return r._reactRootContainer=n,r[Ue]=n.current,Vi(r.nodeType===8?r.parentNode:r),wr(),n}for(;s=r.lastChild;)r.removeChild(s);if(typeof i=="function"){var o=i;i=function(){var u=pa(l);o.call(u)}}var l=Pl(r,0,!1,null,null,!1,!1,"",ac);return r._reactRootContainer=l,r[Ue]=l.current,Vi(r.nodeType===8?r.parentNode:r),wr(function(){Oa(t,l,e,i)}),l}function Na(r,t,e,i,s){var a=e._reactRootContainer;if(a){var n=a;if(typeof s=="function"){var o=s;s=function(){var l=pa(n);o.call(l)}}Oa(t,n,r,s)}else n=Am(e,t,r,s,i);return pa(n)}Nd=function(r){switch(r.tag){case 3:var t=r.stateNode;if(t.current.memoizedState.isDehydrated){var e=bi(t.pendingLanes);e!==0&&(tl(t,e|1),zt(t,ht()),(q&6)===0&&(oi=ht()+500,cr()))}break;case 13:wr(function(){var i=Be(r,1);if(i!==null){var s=Ot();ye(i,r,1,s)}}),xl(r,1)}};el=function(r){if(r.tag===13){var t=Be(r,134217728);if(t!==null){var e=Ot();ye(t,r,134217728,e)}xl(r,134217728)}};Ud=function(r){if(r.tag===13){var t=sr(r),e=Be(r,t);if(e!==null){var i=Ot();ye(e,r,t,i)}xl(r,t)}};Bd=function(){return J};$d=function(r,t){var e=J;try{return J=r,t()}finally{J=e}};Zn=function(r,t,e){switch(t){case"input":if(Wn(r,e),t=e.name,e.type==="radio"&&t!=null){for(e=r;e.parentNode;)e=e.parentNode;for(e=e.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<e.length;t++){var i=e[t];if(i!==r&&i.form===r.form){var s=Ra(i);if(!s)throw Error(O(90));yd(i),Wn(i,s)}}}break;case"textarea":Ed(r,e);break;case"select":t=e.value,t!=null&&jr(r,!!e.multiple,t,!1)}};wd=Il;Rd=wr;var wm={usingClientEntryPoint:!1,Events:[ss,$r,Ra,kd,Ad,Il]},vi={findFiberByHostInstance:mr,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},Rm={bundleType:vi.bundleType,version:vi.version,rendererPackageName:vi.rendererPackageName,rendererConfig:vi.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ge.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=Cd(r),r===null?null:r.stateNode},findFiberByHostInstance:vi.findFiberByHostInstance||km,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var bs=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!bs.isDisabled&&bs.supportsFiber)try{La=bs.inject(Rm),Ae=bs}catch{}}Qt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=wm;Qt.createPortal=function(r,t){var e=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Fl(t))throw Error(O(200));return Lm(r,t,null,e)};Qt.createRoot=function(r,t){if(!Fl(r))throw Error(O(299));var e=!1,i="",s=df;return t!=null&&(t.unstable_strictMode===!0&&(e=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(s=t.onRecoverableError)),t=Pl(r,1,!1,null,null,e,!1,i,s),r[Ue]=t.current,Vi(r.nodeType===8?r.parentNode:r),new Ol(t)};Qt.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var t=r._reactInternals;if(t===void 0)throw typeof r.render=="function"?Error(O(188)):(r=Object.keys(r).join(","),Error(O(268,r)));return r=Cd(t),r=r===null?null:r.stateNode,r};Qt.flushSync=function(r){return wr(r)};Qt.hydrate=function(r,t,e){if(!Ma(t))throw Error(O(200));return Na(null,r,t,!0,e)};Qt.hydrateRoot=function(r,t,e){if(!Fl(r))throw Error(O(405));var i=e!=null&&e.hydratedSources||null,s=!1,a="",n=df;if(e!=null&&(e.unstable_strictMode===!0&&(s=!0),e.identifierPrefix!==void 0&&(a=e.identifierPrefix),e.onRecoverableError!==void 0&&(n=e.onRecoverableError)),t=cf(t,null,r,1,e!=null?e:null,s,!1,a,n),r[Ue]=t.current,Vi(r),i)for(r=0;r<i.length;r++)e=i[r],s=e._getVersion,s=s(e._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[e,s]:t.mutableSourceEagerHydrationData.push(e,s);return new Fa(t)};Qt.render=function(r,t,e){if(!Ma(t))throw Error(O(200));return Na(null,r,t,!1,e)};Qt.unmountComponentAtNode=function(r){if(!Ma(r))throw Error(O(40));return r._reactRootContainer?(wr(function(){Na(null,null,r,!1,function(){r._reactRootContainer=null,r[Ue]=null})}),!0):!1};Qt.unstable_batchedUpdates=Il;Qt.unstable_renderSubtreeIntoContainer=function(r,t,e,i){if(!Ma(e))throw Error(O(200));if(r==null||r._reactInternals===void 0)throw Error(O(38));return Na(r,t,e,!1,i)};Qt.version="18.2.0-next-9e3b772b8-20220608";(function(r){function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}t(),r.exports=Qt})(ld);var nc=ld.exports;Bn.createRoot=nc.createRoot,Bn.hydrateRoot=nc.hydrateRoot;function Im(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var hf={exports:{}};(function(r,t){(function(e){var i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,a=/(?:\/|^)\.(?=\/)/g,n=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(l,u,c){if(c=c||{},l=l.trim(),u=u.trim(),!u){if(!c.alwaysNormalize)return l;var d=o.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");return d.path=o.normalizePath(d.path),o.buildURLFromParts(d)}var h=o.parseURL(u);if(!h)throw new Error("Error trying to parse relative URL.");if(h.scheme)return c.alwaysNormalize?(h.path=o.normalizePath(h.path),o.buildURLFromParts(h)):u;var f=o.parseURL(l);if(!f)throw new Error("Error trying to parse base URL.");if(!f.netLoc&&f.path&&f.path[0]!=="/"){var g=s.exec(f.path);f.netLoc=g[1],f.path=g[2]}f.netLoc&&!f.path&&(f.path="/");var p={scheme:f.scheme,netLoc:h.netLoc,path:null,params:h.params,query:h.query,fragment:h.fragment};if(!h.netLoc&&(p.netLoc=f.netLoc,h.path[0]!=="/"))if(!h.path)p.path=f.path,h.params||(p.params=f.params,h.query||(p.query=f.query));else{var T=f.path,y=T.substring(0,T.lastIndexOf("/")+1)+h.path;p.path=o.normalizePath(y)}return p.path===null&&(p.path=c.alwaysNormalize?o.normalizePath(h.path):h.path),o.buildURLFromParts(p)},parseURL:function(l){var u=i.exec(l);return u?{scheme:u[1]||"",netLoc:u[2]||"",path:u[3]||"",params:u[4]||"",query:u[5]||"",fragment:u[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(a,"");l.length!==(l=l.replace(n,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};r.exports=o})()})(hf);var Ml=hf.exports;function oc(r,t){var e=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),e.push.apply(e,i)}return e}function Wt(r){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?oc(Object(e),!0).forEach(function(i){Dm(r,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(e)):oc(Object(e)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(e,i))})}return r}function Dm(r,t,e){return t=_m(t),t in r?Object.defineProperty(r,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):r[t]=e,r}function vt(){return vt=Object.assign?Object.assign.bind():function(r){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},vt.apply(this,arguments)}function Cm(r,t){if(typeof r!="object"||r===null)return r;var e=r[Symbol.toPrimitive];if(e!==void 0){var i=e.call(r,t||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(r)}function _m(r){var t=Cm(r,"string");return typeof t=="symbol"?t:String(t)}const B=Number.isFinite||function(r){return typeof r=="number"&&isFinite(r)};let m=function(r){return r.MEDIA_ATTACHING="hlsMediaAttaching",r.MEDIA_ATTACHED="hlsMediaAttached",r.MEDIA_DETACHING="hlsMediaDetaching",r.MEDIA_DETACHED="hlsMediaDetached",r.BUFFER_RESET="hlsBufferReset",r.BUFFER_CODECS="hlsBufferCodecs",r.BUFFER_CREATED="hlsBufferCreated",r.BUFFER_APPENDING="hlsBufferAppending",r.BUFFER_APPENDED="hlsBufferAppended",r.BUFFER_EOS="hlsBufferEos",r.BUFFER_FLUSHING="hlsBufferFlushing",r.BUFFER_FLUSHED="hlsBufferFlushed",r.MANIFEST_LOADING="hlsManifestLoading",r.MANIFEST_LOADED="hlsManifestLoaded",r.MANIFEST_PARSED="hlsManifestParsed",r.LEVEL_SWITCHING="hlsLevelSwitching",r.LEVEL_SWITCHED="hlsLevelSwitched",r.LEVEL_LOADING="hlsLevelLoading",r.LEVEL_LOADED="hlsLevelLoaded",r.LEVEL_UPDATED="hlsLevelUpdated",r.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",r.LEVELS_UPDATED="hlsLevelsUpdated",r.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",r.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",r.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",r.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",r.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",r.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",r.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",r.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",r.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",r.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",r.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",r.CUES_PARSED="hlsCuesParsed",r.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",r.INIT_PTS_FOUND="hlsInitPtsFound",r.FRAG_LOADING="hlsFragLoading",r.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",r.FRAG_LOADED="hlsFragLoaded",r.FRAG_DECRYPTED="hlsFragDecrypted",r.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",r.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",r.FRAG_PARSING_METADATA="hlsFragParsingMetadata",r.FRAG_PARSED="hlsFragParsed",r.FRAG_BUFFERED="hlsFragBuffered",r.FRAG_CHANGED="hlsFragChanged",r.FPS_DROP="hlsFpsDrop",r.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",r.ERROR="hlsError",r.DESTROYING="hlsDestroying",r.KEY_LOADING="hlsKeyLoading",r.KEY_LOADED="hlsKeyLoaded",r.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",r.BACK_BUFFER_REACHED="hlsBackBufferReached",r}({}),$=function(r){return r.NETWORK_ERROR="networkError",r.MEDIA_ERROR="mediaError",r.KEY_SYSTEM_ERROR="keySystemError",r.MUX_ERROR="muxError",r.OTHER_ERROR="otherError",r}({}),I=function(r){return r.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",r.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",r.KEY_SYSTEM_NO_SESSION="keySystemNoSession",r.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",r.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",r.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",r.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",r.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",r.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",r.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",r.MANIFEST_LOAD_ERROR="manifestLoadError",r.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",r.MANIFEST_PARSING_ERROR="manifestParsingError",r.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",r.LEVEL_EMPTY_ERROR="levelEmptyError",r.LEVEL_LOAD_ERROR="levelLoadError",r.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",r.LEVEL_PARSING_ERROR="levelParsingError",r.LEVEL_SWITCH_ERROR="levelSwitchError",r.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",r.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",r.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",r.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",r.FRAG_LOAD_ERROR="fragLoadError",r.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",r.FRAG_DECRYPT_ERROR="fragDecryptError",r.FRAG_PARSING_ERROR="fragParsingError",r.FRAG_GAP="fragGap",r.REMUX_ALLOC_ERROR="remuxAllocError",r.KEY_LOAD_ERROR="keyLoadError",r.KEY_LOAD_TIMEOUT="keyLoadTimeOut",r.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",r.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",r.BUFFER_APPEND_ERROR="bufferAppendError",r.BUFFER_APPENDING_ERROR="bufferAppendingError",r.BUFFER_STALLED_ERROR="bufferStalledError",r.BUFFER_FULL_ERROR="bufferFullError",r.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",r.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",r.INTERNAL_EXCEPTION="internalException",r.INTERNAL_ABORTED="aborted",r.UNKNOWN="unknown",r}({});const gr=function(){},Po={trace:gr,debug:gr,log:gr,warn:gr,info:gr,error:gr};let xi=Po;function Pm(r){const t=self.console[r];return t?t.bind(self.console,`[${r}] >`):gr}function xm(r,...t){t.forEach(function(e){xi[e]=r[e]?r[e].bind(r):Pm(e)})}function Om(r,t){if(self.console&&r===!0||typeof r=="object"){xm(r,"debug","log","info","warn","error");try{xi.log(`Debug logs enabled for "${t}" in hls.js version 1.4.4`)}catch{xi=Po}}else xi=Po}const L=xi,Fm=/^(\d+)x(\d+)$/,lc=/(.+?)=(".*?"|.*?)(?:,|$)/g;class nt{constructor(t){typeof t=="string"&&(t=nt.parseAttrList(t));for(const e in t)t.hasOwnProperty(e)&&(e.substring(0,2)==="X-"&&(this.clientAttrs=this.clientAttrs||[],this.clientAttrs.push(e)),this[e]=t[e])}decimalInteger(t){const e=parseInt(this[t],10);return e>Number.MAX_SAFE_INTEGER?1/0:e}hexadecimalInteger(t){if(this[t]){let e=(this[t]||"0x").slice(2);e=(e.length&1?"0":"")+e;const i=new Uint8Array(e.length/2);for(let s=0;s<e.length/2;s++)i[s]=parseInt(e.slice(s*2,s*2+2),16);return i}else return null}hexadecimalIntegerAsNumber(t){const e=parseInt(this[t],16);return e>Number.MAX_SAFE_INTEGER?1/0:e}decimalFloatingPoint(t){return parseFloat(this[t])}optionalFloat(t,e){const i=this[t];return i?parseFloat(i):e}enumeratedString(t){return this[t]}bool(t){return this[t]==="YES"}decimalResolution(t){const e=Fm.exec(this[t]);if(e!==null)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}}static parseAttrList(t){let e;const i={},s='"';for(lc.lastIndex=0;(e=lc.exec(t))!==null;){let a=e[2];a.indexOf(s)===0&&a.lastIndexOf(s)===a.length-1&&(a=a.slice(1,-1));const n=e[1].trim();i[n]=a}return i}}function Mm(r){return r!=="ID"&&r!=="CLASS"&&r!=="START-DATE"&&r!=="DURATION"&&r!=="END-DATE"&&r!=="END-ON-NEXT"}function Nm(r){return r==="SCTE35-OUT"||r==="SCTE35-IN"}class ff{constructor(t,e){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,e){const i=e.attr;for(const s in i)if(Object.prototype.hasOwnProperty.call(t,s)&&t[s]!==i[s]){L.warn(`DATERANGE tag attribute: "${s}" does not match for tags with ID: "${t.ID}"`),this._badValueForSameId=s;break}t=vt(new nt({}),i,t)}if(this.attr=t,this._startDate=new Date(t["START-DATE"]),"END-DATE"in this.attr){const i=new Date(this.attr["END-DATE"]);B(i.getTime())&&(this._endDate=i)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const t=this.duration;return t!==null?new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const t=this.attr.decimalFloatingPoint("DURATION");if(B(t))return t}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&B(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class Ua{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Z={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class gf{constructor(t){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[Z.AUDIO]:null,[Z.VIDEO]:null,[Z.AUDIOVIDEO]:null},this.baseurl=t}setByteRange(t,e){const i=t.split("@",2),s=[];i.length===1?s[0]=e?e.byteRangeEndOffset:0:s[0]=parseInt(i[1]),s[1]=parseInt(i[0])+s[0],this._byteRange=s}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Ml.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(t){this._url=t}}class pn extends gf{constructor(t,e){super(e),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new Ua,this.urlId=0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.type=t}get decryptdata(){const{levelkeys:t}=this;if(!t&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const e=this.levelkeys.identity;if(e)this._decryptdata=e.getDecryptData(this.sn);else{const i=Object.keys(this.levelkeys);if(i.length===1)return this._decryptdata=this.levelkeys[i[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null||!B(this.programDateTime))return null;const t=B(this.duration)?this.duration:0;return this.programDateTime+t*1e3}get encrypted(){var t;if((t=this._decryptdata)!=null&&t.encrypted)return!0;if(this.levelkeys){const e=Object.keys(this.levelkeys),i=e.length;if(i>1||i===1&&this.levelkeys[e[0]].encrypted)return!0}return!1}setKeyFormat(t){if(this.levelkeys){const e=this.levelkeys[t];e&&!this._decryptdata&&(this._decryptdata=e.getDecryptData(this.sn))}}abortRequests(){var t,e;(t=this.loader)==null||t.abort(),(e=this.keyLoader)==null||e.abort()}setElementaryStreamInfo(t,e,i,s,a,n=!1){const{elementaryStreams:o}=this,l=o[t];if(!l){o[t]={startPTS:e,endPTS:i,startDTS:s,endDTS:a,partial:n};return}l.startPTS=Math.min(l.startPTS,e),l.endPTS=Math.max(l.endPTS,i),l.startDTS=Math.min(l.startDTS,s),l.endDTS=Math.max(l.endDTS,a)}clearElementaryStreamInfo(){const{elementaryStreams:t}=this;t[Z.AUDIO]=null,t[Z.VIDEO]=null,t[Z.AUDIOVIDEO]=null}}class Um extends gf{constructor(t,e,i,s,a){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new Ua,this.duration=t.decimalFloatingPoint("DURATION"),this.gap=t.bool("GAP"),this.independent=t.bool("INDEPENDENT"),this.relurl=t.enumeratedString("URI"),this.fragment=e,this.index=s;const n=t.enumeratedString("BYTERANGE");n&&this.setByteRange(n,a),a&&(this.fragOffset=a.fragOffset+a.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:t}=this;return!!(t.audio||t.video||t.audiovideo)}}const Bm=10;class $m{constructor(t){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=t}reloaded(t){if(!t){this.advanced=!0,this.updated=!0;return}const e=this.lastPartSn-t.lastPartSn,i=this.lastPartIndex-t.lastPartIndex;this.updated=this.endSN!==t.endSN||!!i||!!e,this.advanced=this.endSN>t.endSN||e>0||e===0&&i>0,this.updated||this.advanced?this.misses=Math.floor(t.misses*.6):this.misses=t.misses+1,this.availabilityDelay=t.availabilityDelay}get hasProgramDateTime(){return this.fragments.length?B(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||Bm}get drift(){const t=this.driftEndTime-this.driftStartTime;return t>0?(this.driftEnd-this.driftStart)*1e3/t:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var t;return(t=this.partList)!=null&&t.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var t;return(t=this.fragments)!=null&&t.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var t;return(t=this.partList)!=null&&t.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var t;return(t=this.partList)!=null&&t.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function Nl(r){return Uint8Array.from(atob(r),t=>t.charCodeAt(0))}function Gm(r){const t=pf(r).subarray(0,16),e=new Uint8Array(16);return e.set(t,16-t.length),e}function Km(r){const t=function(e,i,s){const a=e[i];e[i]=e[s],e[s]=a};t(r,0,3),t(r,1,2),t(r,4,5),t(r,6,7)}function Vm(r){const t=r.split(":");let e=null;if(t[0]==="data"&&t.length===2){const i=t[1].split(";"),s=i[i.length-1].split(",");if(s.length===2){const a=s[0]==="base64",n=s[1];a?(i.splice(-1,1),e=Nl(n)):e=Gm(n)}}return e}function pf(r){return Uint8Array.from(unescape(encodeURIComponent(r)),t=>t.charCodeAt(0))}var lt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Gt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function uc(r){switch(r){case Gt.FAIRPLAY:return lt.FAIRPLAY;case Gt.PLAYREADY:return lt.PLAYREADY;case Gt.WIDEVINE:return lt.WIDEVINE;case Gt.CLEARKEY:return lt.CLEARKEY}}var mf={WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function Hm(r){if(r===mf.WIDEVINE)return lt.WIDEVINE}function cc(r){switch(r){case lt.FAIRPLAY:return Gt.FAIRPLAY;case lt.PLAYREADY:return Gt.PLAYREADY;case lt.WIDEVINE:return Gt.WIDEVINE;case lt.CLEARKEY:return Gt.CLEARKEY}}function mn(r){const{drmSystems:t,widevineLicenseUrl:e}=r,i=t?[lt.FAIRPLAY,lt.WIDEVINE,lt.PLAYREADY,lt.CLEARKEY].filter(s=>!!t[s]):[];return!i[lt.WIDEVINE]&&e&&i.push(lt.WIDEVINE),i}const yf=function(){return typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function zm(r,t,e,i){let s;switch(r){case lt.FAIRPLAY:s=["cenc","sinf"];break;case lt.WIDEVINE:case lt.PLAYREADY:s=["cenc"];break;case lt.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${r}`)}return Wm(s,t,e,i)}function Wm(r,t,e,i){return[{initDataTypes:r,persistentState:i.persistentState||"not-allowed",distinctiveIdentifier:i.distinctiveIdentifier||"not-allowed",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:t.map(s=>({contentType:`audio/mp4; codecs="${s}"`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:e.map(s=>({contentType:`video/mp4; codecs="${s}"`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))}]}function Sr(r,t,e){return Uint8Array.prototype.slice?r.slice(t,e):new Uint8Array(Array.prototype.slice.call(r,t,e))}const Ul=(r,t)=>t+10<=r.length&&r[t]===73&&r[t+1]===68&&r[t+2]===51&&r[t+3]<255&&r[t+4]<255&&r[t+6]<128&&r[t+7]<128&&r[t+8]<128&&r[t+9]<128,vf=(r,t)=>t+10<=r.length&&r[t]===51&&r[t+1]===68&&r[t+2]===73&&r[t+3]<255&&r[t+4]<255&&r[t+6]<128&&r[t+7]<128&&r[t+8]<128&&r[t+9]<128,ma=(r,t)=>{const e=t;let i=0;for(;Ul(r,t);){i+=10;const s=Ba(r,t+6);i+=s,vf(r,t+10)&&(i+=10),t+=i}if(i>0)return r.subarray(e,e+i)},Ba=(r,t)=>{let e=0;return e=(r[t]&127)<<21,e|=(r[t+1]&127)<<14,e|=(r[t+2]&127)<<7,e|=r[t+3]&127,e},Ym=(r,t)=>Ul(r,t)&&Ba(r,t+6)+10<=r.length-t,jm=r=>{const t=Tf(r);for(let e=0;e<t.length;e++){const i=t[e];if(Ef(i))return t0(i)}},Ef=r=>r&&r.key==="PRIV"&&r.info==="com.apple.streaming.transportStreamTimestamp",qm=r=>{const t=String.fromCharCode(r[0],r[1],r[2],r[3]),e=Ba(r,4),i=10;return{type:t,size:e,data:r.subarray(i,i+e)}},Tf=r=>{let t=0;const e=[];for(;Ul(r,t);){const i=Ba(r,t+6);t+=10;const s=t+i;for(;t+8<s;){const a=qm(r.subarray(t)),n=Xm(a);n&&e.push(n),t+=a.size+10}vf(r,t)&&(t+=10)}return e},Xm=r=>r.type==="PRIV"?Qm(r):r.type[0]==="W"?Zm(r):Jm(r),Qm=r=>{if(r.size<2)return;const t=Re(r.data,!0),e=new Uint8Array(r.data.subarray(t.length+1));return{key:r.type,info:t,data:e.buffer}},Jm=r=>{if(r.size<2)return;if(r.type==="TXXX"){let e=1;const i=Re(r.data.subarray(e),!0);e+=i.length+1;const s=Re(r.data.subarray(e));return{key:r.type,info:i,data:s}}const t=Re(r.data.subarray(1));return{key:r.type,data:t}},Zm=r=>{if(r.type==="WXXX"){if(r.size<2)return;let e=1;const i=Re(r.data.subarray(e),!0);e+=i.length+1;const s=Re(r.data.subarray(e));return{key:r.type,info:i,data:s}}const t=Re(r.data);return{key:r.type,data:t}},t0=r=>{if(r.data.byteLength===8){const t=new Uint8Array(r.data),e=t[3]&1;let i=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return i/=45,e&&(i+=4772185884e-2),Math.round(i)}},Re=(r,t=!1)=>{const e=e0();if(e){const u=e.decode(r);if(t){const c=u.indexOf("\0");return c!==-1?u.substring(0,c):u}return u.replace(/\0/g,"")}const i=r.length;let s,a,n,o="",l=0;for(;l<i;){if(s=r[l++],s===0&&t)return o;if(!(s===0||s===3))switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(s);break;case 12:case 13:a=r[l++],o+=String.fromCharCode((s&31)<<6|a&63);break;case 14:a=r[l++],n=r[l++],o+=String.fromCharCode((s&15)<<12|(a&63)<<6|(n&63)<<0);break}}return o};let yn;function e0(){return!yn&&typeof self.TextDecoder<"u"&&(yn=new self.TextDecoder("utf-8")),yn}const be={hexDump:function(r){let t="";for(let e=0;e<r.length;e++){let i=r[e].toString(16);i.length<2&&(i="0"+i),t+=i}return t}},ya=Math.pow(2,32)-1,r0=[].push,Sf={video:1,audio:2,id3:3,text:4};function Lt(r){return String.fromCharCode.apply(null,r)}function bf(r,t){const e=r[t]<<8|r[t+1];return e<0?65536+e:e}function V(r,t){const e=Lf(r,t);return e<0?4294967296+e:e}function Lf(r,t){return r[t]<<24|r[t+1]<<16|r[t+2]<<8|r[t+3]}function vn(r,t,e){r[t]=e>>24,r[t+1]=e>>16&255,r[t+2]=e>>8&255,r[t+3]=e&255}function j(r,t){const e=[];if(!t.length)return e;const i=r.byteLength;for(let s=0;s<i;){const a=V(r,s),n=Lt(r.subarray(s+4,s+8)),o=a>1?s+a:i;if(n===t[0])if(t.length===1)e.push(r.subarray(s+8,o));else{const l=j(r.subarray(s+8,o),t.slice(1));l.length&&r0.apply(e,l)}s=o}return e}function i0(r){const t=[],e=r[0];let i=8;const s=V(r,i);i+=4;const a=0,n=0;e===0?i+=8:i+=16,i+=2;let o=r.length+n;const l=bf(r,i);i+=2;for(let u=0;u<l;u++){let c=i;const d=V(r,c);c+=4;const h=d&2147483647;if((d&2147483648)>>>31===1)return L.warn("SIDX has hierarchical references (not supported)"),null;const f=V(r,c);c+=4,t.push({referenceSize:h,subsegmentDuration:f,info:{duration:f/s,start:o,end:o+h-1}}),o+=h,c+=4,i=c}return{earliestPresentationTime:a,timescale:s,version:e,referencesCount:l,references:t}}function kf(r){const t=[],e=j(r,["moov","trak"]);for(let i=0;i<e.length;i++){const s=e[i],a=j(s,["tkhd"])[0];if(a){let n=a[0],o=n===0?12:20;const l=V(a,o),u=j(s,["mdia","mdhd"])[0];if(u){n=u[0],o=n===0?12:20;const c=V(u,o),d=j(s,["mdia","hdlr"])[0];if(d){const h=Lt(d.subarray(8,12)),f={soun:Z.AUDIO,vide:Z.VIDEO}[h];if(f){const g=j(s,["mdia","minf","stbl","stsd"])[0];let p;g&&(p=Lt(g.subarray(12,16))),t[l]={timescale:c,type:f},t[f]={timescale:c,id:l,codec:p}}}}}}return j(r,["moov","mvex","trex"]).forEach(i=>{const s=V(i,4),a=t[s];a&&(a.default={duration:V(i,12),flags:V(i,20)})}),t}function s0(r,t){if(!r||!t)return r;const e=t.keyId;return e&&t.isCommonEncryption&&j(r,["moov","trak"]).forEach(i=>{const s=j(i,["mdia","minf","stbl","stsd"])[0].subarray(8);let a=j(s,["enca"]);const n=a.length>0;n||(a=j(s,["encv"])),a.forEach(o=>{const l=n?o.subarray(28):o.subarray(78);j(l,["sinf"]).forEach(u=>{const c=Af(u);if(c){const d=c.subarray(8,24);d.some(h=>h!==0)||(L.log(`[eme] Patching keyId in 'enc${n?"a":"v"}>sinf>>tenc' box: ${be.hexDump(d)} -> ${be.hexDump(e)}`),c.set(e,8))}})})}),r}function Af(r){const t=j(r,["schm"])[0];if(t){const e=Lt(t.subarray(4,8));if(e==="cbcs"||e==="cenc")return j(r,["schi","tenc"])[0]}return L.error("[eme] missing 'schm' box"),null}function a0(r,t){return j(t,["moof","traf"]).reduce((e,i)=>{const s=j(i,["tfdt"])[0],a=s[0],n=j(i,["tfhd"]).reduce((o,l)=>{const u=V(l,4),c=r[u];if(c){let d=V(s,4);if(a===1){if(d===ya)return L.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),o;d*=ya+1,d+=V(s,8)}const h=c.timescale||9e4,f=d/h;if(isFinite(f)&&(o===null||f<o))return f}return o},null);return n!==null&&isFinite(n)&&(e===null||n<e)?n:e},null)}function n0(r,t){let e=0,i=0,s=0;const a=j(r,["moof","traf"]);for(let n=0;n<a.length;n++){const o=a[n],l=j(o,["tfhd"])[0],u=V(l,4),c=t[u];if(!c)continue;const d=c.default,h=V(l,0)|(d==null?void 0:d.flags);let f=d==null?void 0:d.duration;h&8&&(h&2?f=V(l,12):f=V(l,8));const g=c.timescale||9e4,p=j(o,["trun"]);for(let T=0;T<p.length;T++){if(e=o0(p[T]),!e&&f){const y=V(p[T],4);e=f*y}c.type===Z.VIDEO?i+=e/g:c.type===Z.AUDIO&&(s+=e/g)}}if(i===0&&s===0){let n=0;const o=j(r,["sidx"]);for(let l=0;l<o.length;l++){const u=i0(o[l]);u!=null&&u.references&&(n+=u.references.reduce((c,d)=>c+d.info.duration||0,0))}return n}return i||s}function o0(r){const t=V(r,0);let e=8;t&1&&(e+=4),t&4&&(e+=4);let i=0;const s=V(r,4);for(let a=0;a<s;a++){if(t&256){const n=V(r,e);i+=n,e+=4}t&512&&(e+=4),t&1024&&(e+=4),t&2048&&(e+=4)}return i}function l0(r,t,e){j(t,["moof","traf"]).forEach(i=>{j(i,["tfhd"]).forEach(s=>{const a=V(s,4),n=r[a];if(!n)return;const o=n.timescale||9e4;j(i,["tfdt"]).forEach(l=>{const u=l[0];let c=V(l,4);if(u===0)c-=e*o,c=Math.max(c,0),vn(l,4,c);else{c*=Math.pow(2,32),c+=V(l,8),c-=e*o,c=Math.max(c,0);const d=Math.floor(c/(ya+1)),h=Math.floor(c%(ya+1));vn(l,4,d),vn(l,8,h)}})})})}function u0(r){const t={valid:null,remainder:null},e=j(r,["moof"]);if(e){if(e.length<2)return t.remainder=r,t}else return t;const i=e[e.length-1];return t.valid=Sr(r,0,i.byteOffset-8),t.remainder=Sr(r,i.byteOffset-8),t}function Rr(r,t){const e=new Uint8Array(r.length+t.length);return e.set(r),e.set(t,r.length),e}function dc(r,t){const e=[],i=t.samples,s=t.timescale,a=t.id;let n=!1;return j(i,["moof"]).map(o=>{const l=o.byteOffset-8;j(o,["traf"]).map(u=>{const c=j(u,["tfdt"]).map(d=>{const h=d[0];let f=V(d,4);return h===1&&(f*=Math.pow(2,32),f+=V(d,8)),f/s})[0];return c!==void 0&&(r=c),j(u,["tfhd"]).map(d=>{const h=V(d,4),f=V(d,0)&16777215,g=(f&1)!==0,p=(f&2)!==0,T=(f&8)!==0;let y=0;const v=(f&16)!==0;let E=0;const S=(f&32)!==0;let b=8;h===a&&(g&&(b+=8),p&&(b+=4),T&&(y=V(d,b),b+=4),v&&(E=V(d,b),b+=4),S&&(b+=4),t.type==="video"&&(n=c0(t.codec)),j(u,["trun"]).map(w=>{const k=w[0],D=V(w,0)&16777215,P=(D&1)!==0;let R=0;const U=(D&4)!==0,M=(D&256)!==0;let Y=0;const pt=(D&512)!==0;let H=0;const st=(D&1024)!==0,Q=(D&2048)!==0;let C=0;const x=V(w,4);let F=8;P&&(R=V(w,F),F+=4),U&&(F+=4);let K=R+l;for(let z=0;z<x;z++){if(M?(Y=V(w,F),F+=4):Y=y,pt?(H=V(w,F),F+=4):H=E,st&&(F+=4),Q&&(k===0?C=V(w,F):C=Lf(w,F),F+=4),t.type===Z.VIDEO){let Et=0;for(;Et<H;){const ft=V(i,K);if(K+=4,d0(n,i[K])){const Rt=i.subarray(K,K+ft);wf(Rt,n?2:1,r+C/s,e)}K+=ft,Et+=ft+4}}r+=Y/s}}))})})}),e}function c0(r){if(!r)return!1;const t=r.indexOf("."),e=t<0?r:r.substring(0,t);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function d0(r,t){if(r){const e=t>>1&63;return e===39||e===40}else return(t&31)===6}function wf(r,t,e,i){const s=Rf(r);let a=0;a+=t;let n=0,o=0,l=!1,u=0;for(;a<s.length;){n=0;do{if(a>=s.length)break;u=s[a++],n+=u}while(u===255);o=0;do{if(a>=s.length)break;u=s[a++],o+=u}while(u===255);const c=s.length-a;if(!l&&n===4&&a<s.length){if(l=!0,s[a++]===181){const d=bf(s,a);if(a+=2,d===49){const h=V(s,a);if(a+=4,h===1195456820){const f=s[a++];if(f===3){const g=s[a++],p=31&g,T=64&g,y=T?2+p*3:0,v=new Uint8Array(y);if(T){v[0]=g;for(let E=1;E<y;E++)v[E]=s[a++]}i.push({type:f,payloadType:n,pts:e,bytes:v})}}}}}else if(n===5&&o<c){if(l=!0,o>16){const d=[];for(let g=0;g<16;g++){const p=s[a++].toString(16);d.push(p.length==1?"0"+p:p),(g===3||g===5||g===7||g===9)&&d.push("-")}const h=o-16,f=new Uint8Array(h);for(let g=0;g<h;g++)f[g]=s[a++];i.push({payloadType:n,pts:e,uuid:d.join(""),userData:Re(f),userDataBytes:f})}}else if(o<c)a+=o;else if(o>c)break}}function Rf(r){const t=r.byteLength,e=[];let i=1;for(;i<t-2;)r[i]===0&&r[i+1]===0&&r[i+2]===3?(e.push(i+2),i+=2):i++;if(e.length===0)return r;const s=t-e.length,a=new Uint8Array(s);let n=0;for(i=0;i<s;n++,i++)n===e[0]&&(n++,e.shift()),a[i]=r[n];return a}function h0(r){const t=r[0];let e="",i="",s=0,a=0,n=0,o=0,l=0,u=0;if(t===0){for(;Lt(r.subarray(u,u+1))!=="\0";)e+=Lt(r.subarray(u,u+1)),u+=1;for(e+=Lt(r.subarray(u,u+1)),u+=1;Lt(r.subarray(u,u+1))!=="\0";)i+=Lt(r.subarray(u,u+1)),u+=1;i+=Lt(r.subarray(u,u+1)),u+=1,s=V(r,12),a=V(r,16),o=V(r,20),l=V(r,24),u=28}else if(t===1){u+=4,s=V(r,u),u+=4;const d=V(r,u);u+=4;const h=V(r,u);for(u+=4,n=2**32*d+h,Number.isSafeInteger(n)||(n=Number.MAX_SAFE_INTEGER,L.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=V(r,u),u+=4,l=V(r,u),u+=4;Lt(r.subarray(u,u+1))!=="\0";)e+=Lt(r.subarray(u,u+1)),u+=1;for(e+=Lt(r.subarray(u,u+1)),u+=1;Lt(r.subarray(u,u+1))!=="\0";)i+=Lt(r.subarray(u,u+1)),u+=1;i+=Lt(r.subarray(u,u+1)),u+=1}const c=r.subarray(u,r.byteLength);return{schemeIdUri:e,value:i,timeScale:s,presentationTime:n,presentationTimeDelta:a,eventDuration:o,id:l,payload:c}}function f0(r,...t){const e=t.length;let i=8,s=e;for(;s--;)i+=t[s].byteLength;const a=new Uint8Array(i);for(a[0]=i>>24&255,a[1]=i>>16&255,a[2]=i>>8&255,a[3]=i&255,a.set(r,4),s=0,i=8;s<e;s++)a.set(t[s],i),i+=t[s].byteLength;return a}function g0(r,t,e){if(r.byteLength!==16)throw new RangeError("Invalid system id");let i,s;if(t){i=1,s=new Uint8Array(t.length*16);for(let o=0;o<t.length;o++){const l=t[o];if(l.byteLength!==16)throw new RangeError("Invalid key");s.set(l,o*16)}}else i=0,s=new Uint8Array;let a;i>0?(a=new Uint8Array(4),t.length>0&&new DataView(a.buffer).setUint32(0,t.length,!1)):a=new Uint8Array;const n=new Uint8Array(4);return e&&e.byteLength>0&&new DataView(n.buffer).setUint32(0,e.byteLength,!1),f0([112,115,115,104],new Uint8Array([i,0,0,0]),r,a,s,n,e||new Uint8Array)}function p0(r){if(!(r instanceof ArrayBuffer)||r.byteLength<32)return null;const t={version:0,systemId:"",kids:null,data:null},e=new DataView(r),i=e.getUint32(0);if(r.byteLength!==i&&i>44||e.getUint32(4)!==1886614376||(t.version=e.getUint32(8)>>>24,t.version>1))return null;t.systemId=be.hexDump(new Uint8Array(r,12,16));const s=e.getUint32(28);if(t.version===0){if(i-32<s)return null;t.data=new Uint8Array(r,32,s)}else if(t.version===1){t.kids=[];for(let a=0;a<s;a++)t.kids.push(new Uint8Array(r,32+a*16,16))}return t}let Ls={};class Ji{static clearKeyUriToKeyIdMap(){Ls={}}constructor(t,e,i,s=[1],a=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=t,this.uri=e,this.keyFormat=i,this.keyFormatVersions=s,this.iv=a,this.encrypted=t?t!=="NONE":!1,this.isCommonEncryption=this.encrypted&&t!=="AES-128"}isSupported(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Gt.FAIRPLAY:case Gt.WIDEVINE:case Gt.PLAYREADY:case Gt.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(t){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof t!="number"&&(this.method==="AES-128"&&!this.iv&&L.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),t=0);const i=m0(t);return new Ji(this.method,this.uri,"identity",this.keyFormatVersions,i)}const e=Vm(this.uri);if(e)switch(this.keyFormat){case Gt.WIDEVINE:this.pssh=e,e.length>=22&&(this.keyId=e.subarray(e.length-22,e.length-6));break;case Gt.PLAYREADY:{const i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=g0(i,null,e);const s=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2),a=String.fromCharCode.apply(null,Array.from(s)),n=a.substring(a.indexOf("<"),a.length),o=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("KID")[0];if(o){const l=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(l){const u=Nl(l).subarray(0,16);Km(u),this.keyId=u}}break}default:{let i=e.subarray(0,16);if(i.length!==16){const s=new Uint8Array(16);s.set(i,16-i.length),i=s}this.keyId=i;break}}if(!this.keyId||this.keyId.byteLength!==16){let i=Ls[this.uri];if(!i){const s=Object.keys(Ls).length%Number.MAX_SAFE_INTEGER;i=new Uint8Array(16),new DataView(i.buffer,12,4).setUint32(0,s),Ls[this.uri]=i}this.keyId=i}return this}}function m0(r){const t=new Uint8Array(16);for(let e=12;e<16;e++)t[e]=r>>8*(15-e)&255;return t}const If=/\{\$([a-zA-Z0-9-_]+)\}/g;function hc(r){return If.test(r)}function Ut(r,t,e){if(r.variableList!==null||r.hasVariableRefs)for(let i=e.length;i--;){const s=e[i],a=t[s];a&&(t[s]=xo(r,a))}}function xo(r,t){if(r.variableList!==null||r.hasVariableRefs){const e=r.variableList;return t.replace(If,i=>{const s=i.substring(2,i.length-1),a=e==null?void 0:e[s];return a===void 0?(r.playlistParsingError||(r.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${s}"`)),i):a})}return t}function fc(r,t,e){let i=r.variableList;i||(r.variableList=i={});let s,a;if("QUERYPARAM"in t){s=t.QUERYPARAM;try{const n=new self.URL(e).searchParams;if(n.has(s))a=n.get(s);else throw new Error(`"${s}" does not match any query parameter in URI: "${e}"`)}catch(n){r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${n.message}`))}}else s=t.NAME,a=t.VALUE;s in i?r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${s}"`)):i[s]=a||""}function y0(r,t,e){const i=t.IMPORT;if(e&&i in e){let s=r.variableList;s||(r.variableList=s={}),s[i]=e[i]}else r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}function $a(){if(!(typeof self>"u"))return self.MediaSource||self.WebKitMediaSource}const v0={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}},gc=$a();function E0(r,t){const e=v0[t];return!!e&&e[r.slice(0,4)]===!0}function En(r,t){var e;return(e=gc==null?void 0:gc.isTypeSupported(`${t||"video"}/mp4;codecs="${r}"`))!=null?e:!1}const pc=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,mc=/#EXT-X-MEDIA:(.*)/g,T0=/^#EXT(?:INF|-X-TARGETDURATION):/m,yc=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),S0=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class pe{static findGroup(t,e){for(let i=0;i<t.length;i++){const s=t[i];if(s.id===e)return s}}static convertAVC1ToAVCOTI(t){const e=t.split(".");if(e.length>2){let i=e.shift()+".";return i+=parseInt(e.shift()).toString(16),i+=("000"+parseInt(e.shift()).toString(16)).slice(-4),i}return t}static resolve(t,e){return Ml.buildAbsoluteURL(e,t,{alwaysNormalize:!0})}static isMediaPlaylist(t){return T0.test(t)}static parseMasterPlaylist(t,e){const i=hc(t),s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:i},a=[];pc.lastIndex=0;let n;for(;(n=pc.exec(t))!=null;)if(n[1]){var o;const u=new nt(n[1]);Ut(s,u,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const c=xo(s,n[2]),d={attrs:u,bitrate:u.decimalInteger("AVERAGE-BANDWIDTH")||u.decimalInteger("BANDWIDTH"),name:u.NAME,url:pe.resolve(c,e)},h=u.decimalResolution("RESOLUTION");h&&(d.width=h.width,d.height=h.height),b0((u.CODECS||"").split(/[ ,]+/).filter(f=>f),d),d.videoCodec&&d.videoCodec.indexOf("avc1")!==-1&&(d.videoCodec=pe.convertAVC1ToAVCOTI(d.videoCodec)),(o=d.unknownCodecs)!=null&&o.length||a.push(d),s.levels.push(d)}else if(n[3]){const u=n[3],c=n[4];switch(u){case"SESSION-DATA":{const d=new nt(c);Ut(s,d,["DATA-ID","LANGUAGE","VALUE","URI"]);const h=d["DATA-ID"];h&&(s.sessionData===null&&(s.sessionData={}),s.sessionData[h]=d);break}case"SESSION-KEY":{const d=vc(c,e,s);d.encrypted&&d.isSupported()?(s.sessionKeys===null&&(s.sessionKeys=[]),s.sessionKeys.push(d)):L.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${c}"`);break}case"DEFINE":{{const d=new nt(c);Ut(s,d,["NAME","VALUE","QUERYPARAM"]),fc(s,d,e)}break}case"CONTENT-STEERING":{const d=new nt(c);Ut(s,d,["SERVER-URI","PATHWAY-ID"]),s.contentSteering={uri:pe.resolve(d["SERVER-URI"],e),pathwayId:d["PATHWAY-ID"]||"."};break}case"START":{s.startTimeOffset=Ec(c);break}}}const l=a.length>0&&a.length<s.levels.length;return s.levels=l?a:s.levels,s.levels.length===0&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(t,e,i){let s;const a={},n=i.levels,o={AUDIO:n.map(u=>({id:u.attrs.AUDIO,audioCodec:u.audioCodec})),SUBTITLES:n.map(u=>({id:u.attrs.SUBTITLES,textCodec:u.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(mc.lastIndex=0;(s=mc.exec(t))!==null;){const u=new nt(s[1]),c=u.TYPE;if(c){const d=o[c],h=a[c]||[];a[c]=h,Ut(i,u,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const f={attrs:u,bitrate:0,id:l++,groupId:u["GROUP-ID"]||"",instreamId:u["INSTREAM-ID"],name:u.NAME||u.LANGUAGE||"",type:c,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:u.LANGUAGE,url:u.URI?pe.resolve(u.URI,e):""};if(d!=null&&d.length){const g=pe.findGroup(d,f.groupId)||d[0];Tc(f,g,"audioCodec"),Tc(f,g,"textCodec")}h.push(f)}}return a}static parseLevelPlaylist(t,e,i,s,a,n){const o=new $m(e),l=o.fragments;let u=null,c=0,d=0,h=0,f=0,g=null,p=new pn(s,e),T,y,v,E=-1,S=!1;for(yc.lastIndex=0,o.m3u8=t,o.hasVariableRefs=hc(t);(T=yc.exec(t))!==null;){S&&(S=!1,p=new pn(s,e),p.start=h,p.sn=c,p.cc=f,p.level=i,u&&(p.initSegment=u,p.rawProgramDateTime=u.rawProgramDateTime,u.rawProgramDateTime=null));const D=T[1];if(D){p.duration=parseFloat(D);const P=(" "+T[2]).slice(1);p.title=P||null,p.tagList.push(P?["INF",D,P]:["INF",D])}else if(T[3]){if(B(p.duration)){p.start=h,v&&Lc(p,v,o),p.sn=c,p.level=i,p.cc=f,p.urlId=a,l.push(p);const P=(" "+T[3]).slice(1);p.relurl=xo(o,P),Sc(p,g),g=p,h+=p.duration,c++,d=0,S=!0}}else if(T[4]){const P=(" "+T[4]).slice(1);g?p.setByteRange(P,g):p.setByteRange(P)}else if(T[5])p.rawProgramDateTime=(" "+T[5]).slice(1),p.tagList.push(["PROGRAM-DATE-TIME",p.rawProgramDateTime]),E===-1&&(E=l.length);else{if(T=T[0].match(S0),!T){L.warn("No matches on slow regex match for level playlist!");continue}for(y=1;y<T.length&&!(typeof T[y]<"u");y++);const P=(" "+T[y]).slice(1),R=(" "+T[y+1]).slice(1),U=T[y+2]?(" "+T[y+2]).slice(1):"";switch(P){case"PLAYLIST-TYPE":o.type=R.toUpperCase();break;case"MEDIA-SEQUENCE":c=o.startSN=parseInt(R);break;case"SKIP":{const M=new nt(R);Ut(o,M,["RECENTLY-REMOVED-DATERANGES"]);const Y=M.decimalInteger("SKIPPED-SEGMENTS");if(B(Y)){o.skippedSegments=Y;for(let H=Y;H--;)l.unshift(null);c+=Y}const pt=M.enumeratedString("RECENTLY-REMOVED-DATERANGES");pt&&(o.recentlyRemovedDateranges=pt.split("	"));break}case"TARGETDURATION":o.targetduration=Math.max(parseInt(R),1);break;case"VERSION":o.version=parseInt(R);break;case"EXTM3U":break;case"ENDLIST":o.live=!1;break;case"#":(R||U)&&p.tagList.push(U?[R,U]:[R]);break;case"DISCONTINUITY":f++,p.tagList.push(["DIS"]);break;case"GAP":p.gap=!0,p.tagList.push([P]);break;case"BITRATE":p.tagList.push([P,R]);break;case"DATERANGE":{const M=new nt(R);Ut(o,M,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),Ut(o,M,M.clientAttrs);const Y=new ff(M,o.dateRanges[M.ID]);Y.isValid||o.skippedSegments?o.dateRanges[Y.id]=Y:L.warn(`Ignoring invalid DATERANGE tag: "${R}"`),p.tagList.push(["EXT-X-DATERANGE",R]);break}case"DEFINE":{{const M=new nt(R);Ut(o,M,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in M?y0(o,M,n):fc(o,M,e)}break}case"DISCONTINUITY-SEQUENCE":f=parseInt(R);break;case"KEY":{const M=vc(R,e,o);if(M.isSupported()){if(M.method==="NONE"){v=void 0;break}v||(v={}),v[M.keyFormat]&&(v=vt({},v)),v[M.keyFormat]=M}else L.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${R}"`);break}case"START":o.startTimeOffset=Ec(R);break;case"MAP":{const M=new nt(R);if(Ut(o,M,["BYTERANGE","URI"]),p.duration){const Y=new pn(s,e);bc(Y,M,i,v),u=Y,p.initSegment=u,u.rawProgramDateTime&&!p.rawProgramDateTime&&(p.rawProgramDateTime=u.rawProgramDateTime)}else bc(p,M,i,v),u=p,S=!0;break}case"SERVER-CONTROL":{const M=new nt(R);o.canBlockReload=M.bool("CAN-BLOCK-RELOAD"),o.canSkipUntil=M.optionalFloat("CAN-SKIP-UNTIL",0),o.canSkipDateRanges=o.canSkipUntil>0&&M.bool("CAN-SKIP-DATERANGES"),o.partHoldBack=M.optionalFloat("PART-HOLD-BACK",0),o.holdBack=M.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const M=new nt(R);o.partTarget=M.decimalFloatingPoint("PART-TARGET");break}case"PART":{let M=o.partList;M||(M=o.partList=[]);const Y=d>0?M[M.length-1]:void 0,pt=d++,H=new nt(R);Ut(o,H,["BYTERANGE","URI"]);const st=new Um(H,p,e,pt,Y);M.push(st),p.duration+=st.duration;break}case"PRELOAD-HINT":{const M=new nt(R);Ut(o,M,["URI"]),o.preloadHint=M;break}case"RENDITION-REPORT":{const M=new nt(R);Ut(o,M,["URI"]),o.renditionReports=o.renditionReports||[],o.renditionReports.push(M);break}default:L.warn(`line parsed but not handled: ${T}`);break}}}g&&!g.relurl?(l.pop(),h-=g.duration,o.partList&&(o.fragmentHint=g)):o.partList&&(Sc(p,g),p.cc=f,o.fragmentHint=p,v&&Lc(p,v,o));const b=l.length,w=l[0],k=l[b-1];if(h+=o.skippedSegments*o.targetduration,h>0&&b&&k){o.averagetargetduration=h/b;const D=k.sn;o.endSN=D!=="initSegment"?D:0,o.live||(k.endList=!0),w&&(o.startCC=w.cc)}else o.endSN=0,o.startCC=0;return o.fragmentHint&&(h+=o.fragmentHint.duration),o.totalduration=h,o.endCC=f,E>0&&L0(l,E),o}}function vc(r,t,e){var i,s;const a=new nt(r);Ut(e,a,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const n=(i=a.METHOD)!=null?i:"",o=a.URI,l=a.hexadecimalInteger("IV"),u=a.KEYFORMATVERSIONS,c=(s=a.KEYFORMAT)!=null?s:"identity";o&&a.IV&&!l&&L.error(`Invalid IV: ${a.IV}`);const d=o?pe.resolve(o,t):"",h=(u||"1").split("/").map(Number).filter(Number.isFinite);return new Ji(n,d,c,h,l)}function Ec(r){const t=new nt(r).decimalFloatingPoint("TIME-OFFSET");return B(t)?t:null}function b0(r,t){["video","audio","text"].forEach(e=>{const i=r.filter(s=>E0(s,e));if(i.length){const s=i.filter(a=>a.lastIndexOf("avc1",0)===0||a.lastIndexOf("mp4a",0)===0);t[`${e}Codec`]=s.length>0?s[0]:i[0],r=r.filter(a=>i.indexOf(a)===-1)}}),t.unknownCodecs=r}function Tc(r,t,e){const i=t[e];i&&(r[e]=i)}function L0(r,t){let e=r[t];for(let i=t;i--;){const s=r[i];if(!s)return;s.programDateTime=e.programDateTime-s.duration*1e3,e=s}}function Sc(r,t){r.rawProgramDateTime?r.programDateTime=Date.parse(r.rawProgramDateTime):t!=null&&t.programDateTime&&(r.programDateTime=t.endProgramDateTime),B(r.programDateTime)||(r.programDateTime=null,r.rawProgramDateTime=null)}function bc(r,t,e,i){r.relurl=t.URI,t.BYTERANGE&&r.setByteRange(t.BYTERANGE),r.level=e,r.sn="initSegment",i&&(r.levelkeys=i),r.initSegment=null}function Lc(r,t,e){r.levelkeys=t;const{encryptedFragments:i}=e;(!i.length||i[i.length-1].levelkeys!==t)&&Object.keys(t).some(s=>t[s].isCommonEncryption)&&i.push(r)}var X={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},G={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function kc(r){const{type:t}=r;switch(t){case X.AUDIO_TRACK:return G.AUDIO;case X.SUBTITLE_TRACK:return G.SUBTITLE;default:return G.MAIN}}function Tn(r,t){let e=r.url;return(e===void 0||e.indexOf("data:")===0)&&(e=t.url),e}class k0{constructor(t){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=t,this.registerListeners()}startLoad(t){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:t}=this;t.on(m.MANIFEST_LOADING,this.onManifestLoading,this),t.on(m.LEVEL_LOADING,this.onLevelLoading,this),t.on(m.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(m.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:t}=this;t.off(m.MANIFEST_LOADING,this.onManifestLoading,this),t.off(m.LEVEL_LOADING,this.onLevelLoading,this),t.off(m.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(m.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(t){const e=this.hls.config,i=e.pLoader,s=e.loader,a=i||s,n=new a(e);return this.loaders[t.type]=n,n}getInternalLoader(t){return this.loaders[t.type]}resetInternalLoader(t){this.loaders[t]&&delete this.loaders[t]}destroyInternalLoaders(){for(const t in this.loaders){const e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(t,e){const{url:i}=e;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:X.MANIFEST,url:i,deliveryDirectives:null})}onLevelLoading(t,e){const{id:i,level:s,url:a,deliveryDirectives:n}=e;this.load({id:i,level:s,responseType:"text",type:X.LEVEL,url:a,deliveryDirectives:n})}onAudioTrackLoading(t,e){const{id:i,groupId:s,url:a,deliveryDirectives:n}=e;this.load({id:i,groupId:s,level:null,responseType:"text",type:X.AUDIO_TRACK,url:a,deliveryDirectives:n})}onSubtitleTrackLoading(t,e){const{id:i,groupId:s,url:a,deliveryDirectives:n}=e;this.load({id:i,groupId:s,level:null,responseType:"text",type:X.SUBTITLE_TRACK,url:a,deliveryDirectives:n})}load(t){var e;const i=this.hls.config;let s=this.getInternalLoader(t);if(s){const u=s.context;if(u&&u.url===t.url){L.trace("[playlist-loader]: playlist request ongoing");return}L.log(`[playlist-loader]: aborting previous loader for type: ${t.type}`),s.abort()}let a;if(t.type===X.MANIFEST?a=i.manifestLoadPolicy.default:a=vt({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(t),(e=t.deliveryDirectives)!=null&&e.part){let u;if(t.type===X.LEVEL&&t.level!==null?u=this.hls.levels[t.level].details:t.type===X.AUDIO_TRACK&&t.id!==null?u=this.hls.audioTracks[t.id].details:t.type===X.SUBTITLE_TRACK&&t.id!==null&&(u=this.hls.subtitleTracks[t.id].details),u){const c=u.partTarget,d=u.targetduration;if(c&&d){const h=Math.max(c*3,d*.8)*1e3;a=vt({},a,{maxTimeToFirstByteMs:Math.min(h,a.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(h,a.maxTimeToFirstByteMs)})}}}const n=a.errorRetry||a.timeoutRetry||{},o={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:n.maxNumRetry||0,retryDelay:n.retryDelayMs||0,maxRetryDelay:n.maxRetryDelayMs||0},l={onSuccess:(u,c,d,h)=>{const f=this.getInternalLoader(d);this.resetInternalLoader(d.type);const g=u.data;if(g.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(u,d,new Error("no EXTM3U delimiter"),h||null,c);return}c.parsing.start=performance.now(),pe.isMediaPlaylist(g)?this.handleTrackOrLevelPlaylist(u,c,d,h||null,f):this.handleMasterPlaylist(u,c,d,h)},onError:(u,c,d,h)=>{this.handleNetworkError(c,d,!1,u,h)},onTimeout:(u,c,d)=>{this.handleNetworkError(c,d,!0,void 0,u)}};s.load(t,o,l)}handleMasterPlaylist(t,e,i,s){const a=this.hls,n=t.data,o=Tn(t,i),l=pe.parseMasterPlaylist(n,o);if(l.playlistParsingError){this.handleManifestParsingError(t,i,l.playlistParsingError,s,e);return}const{contentSteering:u,levels:c,sessionData:d,sessionKeys:h,startTimeOffset:f,variableList:g}=l;this.variableList=g;const{AUDIO:p=[],SUBTITLES:T,"CLOSED-CAPTIONS":y}=pe.parseMasterPlaylistMedia(n,o,l);p.length&&!p.some(v=>!v.url)&&c[0].audioCodec&&!c[0].attrs.AUDIO&&(L.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new nt({}),bitrate:0,url:""})),a.trigger(m.MANIFEST_LOADED,{levels:c,audioTracks:p,subtitles:T,captions:y,contentSteering:u,url:o,stats:e,networkDetails:s,sessionData:d,sessionKeys:h,startTimeOffset:f,variableList:g})}handleTrackOrLevelPlaylist(t,e,i,s,a){const n=this.hls,{id:o,level:l,type:u}=i,c=Tn(t,i),d=B(o)?o:0,h=B(l)?l:d,f=kc(i),g=pe.parseLevelPlaylist(t.data,c,h,f,d,this.variableList);if(u===X.MANIFEST){const p={attrs:new nt({}),bitrate:0,details:g,name:"",url:c};n.trigger(m.MANIFEST_LOADED,{levels:[p],audioTracks:[],url:c,stats:e,networkDetails:s,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}e.parsing.end=performance.now(),i.levelDetails=g,this.handlePlaylistLoaded(g,t,e,i,s,a)}handleManifestParsingError(t,e,i,s,a){this.hls.trigger(m.ERROR,{type:$.NETWORK_ERROR,details:I.MANIFEST_PARSING_ERROR,fatal:e.type===X.MANIFEST,url:t.url,err:i,error:i,reason:i.message,response:t,context:e,networkDetails:s,stats:a})}handleNetworkError(t,e,i=!1,s,a){let n=`A network ${i?"timeout":"error"+(s?" (status "+s.code+")":"")} occurred while loading ${t.type}`;t.type===X.LEVEL?n+=`: ${t.level} id: ${t.id}`:(t.type===X.AUDIO_TRACK||t.type===X.SUBTITLE_TRACK)&&(n+=` id: ${t.id} group-id: "${t.groupId}"`);const o=new Error(n);L.warn(`[playlist-loader]: ${n}`);let l=I.UNKNOWN,u=!1;const c=this.getInternalLoader(t);switch(t.type){case X.MANIFEST:l=i?I.MANIFEST_LOAD_TIMEOUT:I.MANIFEST_LOAD_ERROR,u=!0;break;case X.LEVEL:l=i?I.LEVEL_LOAD_TIMEOUT:I.LEVEL_LOAD_ERROR,u=!1;break;case X.AUDIO_TRACK:l=i?I.AUDIO_TRACK_LOAD_TIMEOUT:I.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case X.SUBTITLE_TRACK:l=i?I.SUBTITLE_TRACK_LOAD_TIMEOUT:I.SUBTITLE_LOAD_ERROR,u=!1;break}c&&this.resetInternalLoader(t.type);const d={type:$.NETWORK_ERROR,details:l,fatal:u,url:t.url,loader:c,context:t,error:o,networkDetails:e,stats:a};if(s){const h=(e==null?void 0:e.url)||t.url;d.response=Wt({url:h,data:void 0},s)}this.hls.trigger(m.ERROR,d)}handlePlaylistLoaded(t,e,i,s,a,n){const o=this.hls,{type:l,level:u,id:c,groupId:d,deliveryDirectives:h}=s,f=Tn(e,s),g=kc(s),p=typeof s.level=="number"&&g===G.MAIN?u:void 0;if(!t.fragments.length){const y=new Error("No Segments found in Playlist");o.trigger(m.ERROR,{type:$.NETWORK_ERROR,details:I.LEVEL_EMPTY_ERROR,fatal:!1,url:f,error:y,reason:y.message,response:e,context:s,level:p,parent:g,networkDetails:a,stats:i});return}t.targetduration||(t.playlistParsingError=new Error("Missing Target Duration"));const T=t.playlistParsingError;if(T){o.trigger(m.ERROR,{type:$.NETWORK_ERROR,details:I.LEVEL_PARSING_ERROR,fatal:!1,url:f,error:T,reason:T.message,response:e,context:s,level:p,parent:g,networkDetails:a,stats:i});return}switch(t.live&&n&&(n.getCacheAge&&(t.ageHeader=n.getCacheAge()||0),(!n.getCacheAge||isNaN(t.ageHeader))&&(t.ageHeader=0)),l){case X.MANIFEST:case X.LEVEL:o.trigger(m.LEVEL_LOADED,{details:t,level:p||0,id:c||0,stats:i,networkDetails:a,deliveryDirectives:h});break;case X.AUDIO_TRACK:o.trigger(m.AUDIO_TRACK_LOADED,{details:t,id:c||0,groupId:d||"",stats:i,networkDetails:a,deliveryDirectives:h});break;case X.SUBTITLE_TRACK:o.trigger(m.SUBTITLE_TRACK_LOADED,{details:t,id:c||0,groupId:d||"",stats:i,networkDetails:a,deliveryDirectives:h});break}}}function Df(r,t){let e;try{e=new Event("addtrack")}catch{e=document.createEvent("Event"),e.initEvent("addtrack",!1,!1)}e.track=r,t.dispatchEvent(e)}function Cf(r,t){const e=r.mode;if(e==="disabled"&&(r.mode="hidden"),r.cues&&!r.cues.getCueById(t.id))try{if(r.addCue(t),!r.cues.getCueById(t.id))throw new Error(`addCue is failed for: ${t}`)}catch(i){L.debug(`[texttrack-utils]: ${i}`);const s=new self.TextTrackCue(t.startTime,t.endTime,t.text);s.id=t.id,r.addCue(s)}e==="disabled"&&(r.mode=e)}function Yr(r){const t=r.mode;if(t==="disabled"&&(r.mode="hidden"),r.cues)for(let e=r.cues.length;e--;)r.removeCue(r.cues[e]);t==="disabled"&&(r.mode=t)}function Oo(r,t,e,i){const s=r.mode;if(s==="disabled"&&(r.mode="hidden"),r.cues&&r.cues.length>0){const a=w0(r.cues,t,e);for(let n=0;n<a.length;n++)(!i||i(a[n]))&&r.removeCue(a[n])}s==="disabled"&&(r.mode=s)}function A0(r,t){if(t<r[0].startTime)return 0;const e=r.length-1;if(t>r[e].endTime)return-1;let i=0,s=e;for(;i<=s;){const a=Math.floor((s+i)/2);if(t<r[a].startTime)s=a-1;else if(t>r[a].startTime&&i<e)i=a+1;else return a}return r[i].startTime-t<t-r[s].startTime?i:s}function w0(r,t,e){const i=[],s=A0(r,t);if(s>-1)for(let a=s,n=r.length;a<n;a++){const o=r[a];if(o.startTime>=t&&o.endTime<=e)i.push(o);else if(o.startTime>e)return i}return i}var ge={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"};const R0=.25;function Fo(){if(!(typeof self>"u"))return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}const ks=(()=>{const r=Fo();try{new r(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function Sn(r,t){return r.getTime()/1e3-t}function I0(r){return Uint8Array.from(r.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class D0{constructor(t){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=t,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:t}=this;t.on(m.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(m.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(m.MANIFEST_LOADING,this.onManifestLoading,this),t.on(m.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.on(m.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(m.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:t}=this;t.off(m.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(m.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(m.MANIFEST_LOADING,this.onManifestLoading,this),t.off(m.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.off(m.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(m.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(t,e){this.media=e.media}onMediaDetaching(){!this.id3Track||(Yr(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(t){const e=this.getID3Track(t.textTracks);return e.mode="hidden",e}getID3Track(t){if(this.media){for(let e=0;e<t.length;e++){const i=t[e];if(i.kind==="metadata"&&i.label==="id3")return Df(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(t,e){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:i,enableID3MetadataCues:s}}}=this;if(!i&&!s)return;const{samples:a}=e;this.id3Track||(this.id3Track=this.createTrack(this.media));const n=Fo();for(let o=0;o<a.length;o++){const l=a[o].type;if(l===ge.emsg&&!i||!s)continue;const u=Tf(a[o].data);if(u){const c=a[o].pts;let d=c+a[o].duration;d>ks&&(d=ks),d-c<=0&&(d=c+R0);for(let h=0;h<u.length;h++){const f=u[h];if(!Ef(f)){this.updateId3CueEnds(c);const g=new n(c,d,"");g.value=f,l&&(g.type=l),this.id3Track.addCue(g)}}}}}updateId3CueEnds(t){var e;const i=(e=this.id3Track)==null?void 0:e.cues;if(i)for(let s=i.length;s--;){const a=i[s];a.startTime<t&&a.endTime===ks&&(a.endTime=t)}}onBufferFlushing(t,{startOffset:e,endOffset:i,type:s}){const{id3Track:a,hls:n}=this;if(!n)return;const{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:l}}=n;if(a&&(o||l)){let u;s==="audio"?u=c=>c.type===ge.audioId3&&l:s==="video"?u=c=>c.type===ge.emsg&&o:u=c=>c.type===ge.audioId3&&l||c.type===ge.emsg&&o,Oo(a,e,i,u)}}onLevelUpdated(t,{details:e}){if(!this.media||!e.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:i,id3Track:s}=this,{dateRanges:a}=e,n=Object.keys(a);if(s){const c=Object.keys(i).filter(d=>!n.includes(d));for(let d=c.length;d--;){const h=c[d];Object.keys(i[h].cues).forEach(f=>{s.removeCue(i[h].cues[f])}),delete i[h]}}const o=e.fragments[e.fragments.length-1];if(n.length===0||!B(o==null?void 0:o.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const l=o.programDateTime/1e3-o.start,u=Fo();for(let c=0;c<n.length;c++){const d=n[c],h=a[d],f=i[d],g=(f==null?void 0:f.cues)||{};let p=(f==null?void 0:f.durationKnown)||!1;const T=Sn(h.startDate,l);let y=ks;const v=h.endDate;if(v)y=Sn(v,l),p=!0;else if(h.endOnNext&&!p){const S=n.reduce((b,w)=>{const k=a[w];return k.class===h.class&&k.id!==w&&k.startDate>h.startDate&&b.push(k),b},[]).sort((b,w)=>b.startDate.getTime()-w.startDate.getTime())[0];S&&(y=Sn(S.startDate,l),p=!0)}const E=Object.keys(h.attr);for(let S=0;S<E.length;S++){const b=E[S];if(!Mm(b))continue;let w=g[b];if(w)p&&!f.durationKnown&&(w.endTime=y);else{let k=h.attr[b];w=new u(T,y,""),Nm(b)&&(k=I0(k)),w.value={key:b,data:k},w.type=ge.dateRange,w.id=d,this.id3Track.addCue(w),g[b]=w}}i[d]={cues:g,dateRange:h,durationKnown:p}}}}class C0{constructor(t){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=t,this.config=t.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:t,levelDetails:e}=this;return t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:e?t.liveMaxLatencyDurationCount*e.targetduration:0}get targetLatency(){const{levelDetails:t}=this;if(t===null)return null;const{holdBack:e,partHoldBack:i,targetduration:s}=t,{liveSyncDuration:a,liveSyncDurationCount:n,lowLatencyMode:o}=this.config,l=this.hls.userConfig;let u=o&&i||e;(l.liveSyncDuration||l.liveSyncDurationCount||u===0)&&(u=a!==void 0?a:n*s);const c=s,d=1;return u+Math.min(this.stallCount*d,c)}get liveSyncPosition(){const t=this.estimateLiveEdge(),e=this.targetLatency,i=this.levelDetails;if(t===null||e===null||i===null)return null;const s=i.edge,a=t-e-this.edgeStalled,n=s-i.totalduration,o=s-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(n,a),o)}get drift(){const{levelDetails:t}=this;return t===null?1:t.drift}get edgeStalled(){const{levelDetails:t}=this;if(t===null)return 0;const e=(this.config.lowLatencyMode&&t.partTarget||t.targetduration)*3;return Math.max(t.age-e,0)}get forwardBufferLength(){const{media:t,levelDetails:e}=this;if(!t||!e)return 0;const i=t.buffered.length;return(i?t.buffered.end(i-1):e.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(m.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(m.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(m.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(m.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(m.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(m.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(m.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(m.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(m.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(m.ERROR,this.onError,this)}onMediaAttached(t,e){this.media=e.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(t,{details:e}){this.levelDetails=e,e.advanced&&this.timeupdate(),!e.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(t,e){var i;e.details===I.BUFFER_STALLED_ERROR&&(this.stallCount++,(i=this.levelDetails)!=null&&i.live&&L.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:t,levelDetails:e}=this;if(!t||!e)return;this.currentTime=t.currentTime;const i=this.computeLatency();if(i===null)return;this._latency=i;const{lowLatencyMode:s,maxLiveSyncPlaybackRate:a}=this.config;if(!s||a===1)return;const n=this.targetLatency;if(n===null)return;const o=i-n,l=Math.min(this.maxLatency,n+e.targetduration),u=o<l;if(e.live&&u&&o>.05&&this.forwardBufferLength>1){const c=Math.min(2,Math.max(1,a)),d=Math.round(2/(1+Math.exp(-.75*o-this.edgeStalled))*20)/20;t.playbackRate=Math.min(c,Math.max(1,d))}else t.playbackRate!==1&&t.playbackRate!==0&&(t.playbackRate=1)}estimateLiveEdge(){const{levelDetails:t}=this;return t===null?null:t.edge+t.age}computeLatency(){const t=this.estimateLiveEdge();return t===null?null:t-this.currentTime}}const Mo=["NONE","TYPE-0","TYPE-1",null];var Oi={No:"",Yes:"YES",v2:"v2"};function _0(r,t){const{canSkipUntil:e,canSkipDateRanges:i,endSN:s}=r,a=t!==void 0?t-s:0;return e&&a<e?i?Oi.v2:Oi.Yes:Oi.No}class Ac{constructor(t,e,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=t,this.part=e,this.skip=i}addDirectives(t){const e=new self.URL(t);return this.msn!==void 0&&e.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.href}}class Zi{constructor(t){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[t.url],this._attrs=[t.attrs],this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.unknownCodecs=t.unknownCodecs,this.codecSet=[t.videoCodec,t.audioCodec].filter(e=>e).join(",").replace(/\.[^.,]+/g,"")}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get attrs(){return this._attrs[this._urlId]}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get uri(){return this.url[this._urlId]||""}get urlId(){return this._urlId}set urlId(t){const e=t%this.url.length;this._urlId!==e&&(this.fragmentError=0,this.loadError=0,this.details=void 0,this._urlId=e)}get audioGroupId(){var t;return(t=this.audioGroupIds)==null?void 0:t[this.urlId]}get textGroupId(){var t;return(t=this.textGroupIds)==null?void 0:t[this.urlId]}addFallback(t){this.url.push(t.url),this._attrs.push(t.attrs)}}function bn(r,t){const e=t.startPTS;if(B(e)){let i=0,s;t.sn>r.sn?(i=e-r.start,s=r):(i=r.start-e,s=t),s.duration!==i&&(s.duration=i)}else t.sn>r.sn?r.cc===t.cc&&r.minEndPTS?t.start=r.start+(r.minEndPTS-r.start):t.start=r.start+r.duration:t.start=Math.max(r.start-t.duration,0)}function _f(r,t,e,i,s,a){i-e<=0&&(L.warn("Fragment should have a positive duration",t),i=e+t.duration,a=s+t.duration);let n=e,o=i;const l=t.startPTS,u=t.endPTS;if(B(l)){const p=Math.abs(l-e);B(t.deltaPTS)?t.deltaPTS=Math.max(p,t.deltaPTS):t.deltaPTS=p,n=Math.max(e,l),e=Math.min(e,l),s=Math.min(s,t.startDTS),o=Math.min(i,u),i=Math.max(i,u),a=Math.max(a,t.endDTS)}const c=e-t.start;t.start!==0&&(t.start=e),t.duration=i-t.start,t.startPTS=e,t.maxStartPTS=n,t.startDTS=s,t.endPTS=i,t.minEndPTS=o,t.endDTS=a;const d=t.sn;if(!r||d<r.startSN||d>r.endSN)return 0;let h;const f=d-r.startSN,g=r.fragments;for(g[f]=t,h=f;h>0;h--)bn(g[h],g[h-1]);for(h=f;h<g.length-1;h++)bn(g[h],g[h+1]);return r.fragmentHint&&bn(g[g.length-1],r.fragmentHint),r.PTSKnown=r.alignedSliding=!0,c}function P0(r,t){let e=null;const i=r.fragments;for(let l=i.length-1;l>=0;l--){const u=i[l].initSegment;if(u){e=u;break}}r.fragmentHint&&delete r.fragmentHint.endPTS;let s=0,a;if(F0(r,t,(l,u)=>{l.relurl&&(s=l.cc-u.cc),B(l.startPTS)&&B(l.endPTS)&&(u.start=u.startPTS=l.startPTS,u.startDTS=l.startDTS,u.maxStartPTS=l.maxStartPTS,u.endPTS=l.endPTS,u.endDTS=l.endDTS,u.minEndPTS=l.minEndPTS,u.duration=l.endPTS-l.startPTS,u.duration&&(a=u),t.PTSKnown=t.alignedSliding=!0),u.elementaryStreams=l.elementaryStreams,u.loader=l.loader,u.stats=l.stats,u.urlId=l.urlId,l.initSegment&&(u.initSegment=l.initSegment,e=l.initSegment)}),e&&(t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments).forEach(l=>{var u;(!l.initSegment||l.initSegment.relurl===((u=e)==null?void 0:u.relurl))&&(l.initSegment=e)}),t.skippedSegments)if(t.deltaUpdateFailed=t.fragments.some(l=>!l),t.deltaUpdateFailed){L.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let l=t.skippedSegments;l--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}else t.canSkipDateRanges&&(t.dateRanges=x0(r.dateRanges,t.dateRanges,t.recentlyRemovedDateranges));const n=t.fragments;if(s){L.warn("discontinuity sliding from playlist, take drift into account");for(let l=0;l<n.length;l++)n[l].cc+=s}t.skippedSegments&&(t.startCC=t.fragments[0].cc),O0(r.partList,t.partList,(l,u)=>{u.elementaryStreams=l.elementaryStreams,u.stats=l.stats}),a?_f(t,a,a.startPTS,a.endPTS,a.startDTS,a.endDTS):Pf(r,t),n.length&&(t.totalduration=t.edge-n[0].start),t.driftStartTime=r.driftStartTime,t.driftStart=r.driftStart;const o=t.advancedDateTime;if(t.advanced&&o){const l=t.edge;t.driftStart||(t.driftStartTime=o,t.driftStart=l),t.driftEndTime=o,t.driftEnd=l}else t.driftEndTime=r.driftEndTime,t.driftEnd=r.driftEnd,t.advancedDateTime=r.advancedDateTime}function x0(r,t,e){const i=vt({},r);return e&&e.forEach(s=>{delete i[s]}),Object.keys(t).forEach(s=>{const a=new ff(t[s].attr,i[s]);a.isValid?i[s]=a:L.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(t[s].attr)}"`)}),i}function O0(r,t,e){if(r&&t){let i=0;for(let s=0,a=r.length;s<=a;s++){const n=r[s],o=t[s+i];n&&o&&n.index===o.index&&n.fragment.sn===o.fragment.sn?e(n,o):i--}}}function F0(r,t,e){const i=t.skippedSegments,s=Math.max(r.startSN,t.startSN)-t.startSN,a=(r.fragmentHint?1:0)+(i?t.endSN:Math.min(r.endSN,t.endSN))-t.startSN,n=t.startSN-r.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments;for(let u=s;u<=a;u++){const c=l[n+u];let d=o[u];i&&!d&&u<i&&(d=t.fragments[u]=c),c&&d&&e(c,d)}}function Pf(r,t){const e=t.startSN+t.skippedSegments-r.startSN,i=r.fragments;e<0||e>=i.length||No(t,i[e].start)}function No(r,t){if(t){const e=r.fragments;for(let i=r.skippedSegments;i<e.length;i++)e[i].start+=t;r.fragmentHint&&(r.fragmentHint.start+=t)}}function M0(r,t=1/0){let e=1e3*r.targetduration;if(r.updated){const i=r.fragments,s=4;if(i.length&&e*s>t){const a=i[i.length-1].duration*1e3;a<e&&(e=a)}}else e/=2;return Math.round(e)}function N0(r,t,e){if(!(r!=null&&r.details))return null;const i=r.details;let s=i.fragments[t-i.startSN];return s||(s=i.fragmentHint,s&&s.sn===t)?s:t<i.startSN&&e&&e.sn===t?e:null}function wc(r,t,e){var i;return r!=null&&r.details?xf((i=r.details)==null?void 0:i.partList,t,e):null}function xf(r,t,e){if(r)for(let i=r.length;i--;){const s=r[i];if(s.index===e&&s.fragment.sn===t)return s}return null}function va(r){switch(r.details){case I.FRAG_LOAD_TIMEOUT:case I.KEY_LOAD_TIMEOUT:case I.LEVEL_LOAD_TIMEOUT:case I.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Rc(r,t){const e=va(t);return r.default[`${e?"timeout":"error"}Retry`]}function Bl(r,t){const e=r.backoff==="linear"?1:Math.pow(2,t);return Math.min(e*r.retryDelayMs,r.maxRetryDelayMs)}function Ic(r){return Wt(Wt({},r),{errorRetry:null,timeoutRetry:null})}function Ea(r,t,e,i){return!!r&&t<r.maxNumRetry&&(U0(i)||!!e)}function U0(r){return r===0&&navigator.onLine===!1||!!r&&(r<400||r>499)}const Of={search:function(r,t){let e=0,i=r.length-1,s=null,a=null;for(;e<=i;){s=(e+i)/2|0,a=r[s];const n=t(a);if(n>0)e=s+1;else if(n<0)i=s-1;else return a}return null}};function B0(r,t,e){if(t===null||!Array.isArray(r)||!r.length||!B(t))return null;const i=r[0].programDateTime;if(t<(i||0))return null;const s=r[r.length-1].endProgramDateTime;if(t>=(s||0))return null;e=e||0;for(let a=0;a<r.length;++a){const n=r[a];if($0(t,e,n))return n}return null}function ts(r,t,e=0,i=0){let s=null;if(r?s=t[r.sn-t[0].sn+1]||null:e===0&&t[0].start===0&&(s=t[0]),s&&Uo(e,i,s)===0)return s;const a=Of.search(t,Uo.bind(null,e,i));return a&&(a!==r||!s)?a:s}function Uo(r=0,t=0,e){if(e.start<=r&&e.start+e.duration>r)return 0;const i=Math.min(t,e.duration+(e.deltaPTS?e.deltaPTS:0));return e.start+e.duration-i<=r?1:e.start-i>r&&e.start?-1:0}function $0(r,t,e){const i=Math.min(t,e.duration+(e.deltaPTS?e.deltaPTS:0))*1e3;return(e.endProgramDateTime||0)-i>r}function G0(r,t){return Of.search(r,e=>e.cc<t?1:e.cc>t?-1:0)}const K0=3e5;var Bt={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},ue={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class V0{constructor(t){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=t,this.log=L.log.bind(L,"[info]:"),this.warn=L.warn.bind(L,"[warning]:"),this.error=L.error.bind(L,"[error]:"),this.registerListeners()}registerListeners(){const t=this.hls;t.on(m.ERROR,this.onError,this),t.on(m.MANIFEST_LOADING,this.onManifestLoading,this),t.on(m.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const t=this.hls;!t||(t.off(m.ERROR,this.onError,this),t.off(m.ERROR,this.onErrorOut,this),t.off(m.MANIFEST_LOADING,this.onManifestLoading,this),t.off(m.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(t){this.playlistError=0}stopLoad(){}getVariantLevelIndex(t){return(t==null?void 0:t.type)===G.MAIN?t.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(t,e){var i;if(e.fatal)return;const s=this.hls,a=e.context;switch(e.details){case I.FRAG_LOAD_ERROR:case I.FRAG_LOAD_TIMEOUT:case I.KEY_LOAD_ERROR:case I.KEY_LOAD_TIMEOUT:e.errorAction=this.getFragRetryOrSwitchAction(e);return;case I.FRAG_GAP:case I.FRAG_PARSING_ERROR:case I.FRAG_DECRYPT_ERROR:{e.errorAction=this.getFragRetryOrSwitchAction(e),e.errorAction.action=Bt.SendAlternateToPenaltyBox;return}case I.LEVEL_EMPTY_ERROR:case I.LEVEL_PARSING_ERROR:{var n,o;const l=e.parent===G.MAIN?e.level:s.loadLevel;e.details===I.LEVEL_EMPTY_ERROR&&!!((n=e.context)!=null&&(o=n.levelDetails)!=null&&o.live)?e.errorAction=this.getPlaylistRetryOrSwitchAction(e,l):(e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,l))}return;case I.LEVEL_LOAD_ERROR:case I.LEVEL_LOAD_TIMEOUT:typeof(a==null?void 0:a.level)=="number"&&(e.errorAction=this.getPlaylistRetryOrSwitchAction(e,a.level));return;case I.AUDIO_TRACK_LOAD_ERROR:case I.AUDIO_TRACK_LOAD_TIMEOUT:case I.SUBTITLE_LOAD_ERROR:case I.SUBTITLE_TRACK_LOAD_TIMEOUT:if(a){const l=s.levels[s.loadLevel];if(l&&(a.type===X.AUDIO_TRACK&&a.groupId===l.audioGroupId||a.type===X.SUBTITLE_TRACK&&a.groupId===l.textGroupId)){e.errorAction=this.getPlaylistRetryOrSwitchAction(e,s.loadLevel),e.errorAction.action=Bt.SendAlternateToPenaltyBox,e.errorAction.flags=ue.MoveAllAlternatesMatchingHost;return}}return;case I.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const l=s.levels[s.loadLevel],u=l==null?void 0:l.attrs["HDCP-LEVEL"];u&&(e.errorAction={action:Bt.SendAlternateToPenaltyBox,flags:ue.MoveAllAlternatesMatchingHDCP,hdcpLevel:u})}return;case I.BUFFER_ADD_CODEC_ERROR:case I.REMUX_ALLOC_ERROR:e.errorAction=this.getLevelSwitchAction(e,(i=e.level)!=null?i:s.loadLevel);return;case I.INTERNAL_EXCEPTION:case I.BUFFER_APPENDING_ERROR:case I.BUFFER_APPEND_ERROR:case I.BUFFER_FULL_ERROR:case I.LEVEL_SWITCH_ERROR:case I.BUFFER_STALLED_ERROR:case I.BUFFER_SEEK_OVER_HOLE:case I.BUFFER_NUDGE_ON_STALL:e.errorAction={action:Bt.DoNothing,flags:ue.None};return}if(e.type===$.KEY_SYSTEM_ERROR){const l=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,l);return}}getPlaylistRetryOrSwitchAction(t,e){var i;const s=this.hls,a=Rc(s.config.playlistLoadPolicy,t),n=this.playlistError++,o=(i=t.response)==null?void 0:i.code;if(Ea(a,n,va(t),o))return{action:Bt.RetryRequest,flags:ue.None,retryConfig:a,retryCount:n};const l=this.getLevelSwitchAction(t,e);return a&&(l.retryConfig=a,l.retryCount=n),l}getFragRetryOrSwitchAction(t){const e=this.hls,i=this.getVariantLevelIndex(t.frag),s=e.levels[i],{fragLoadPolicy:a,keyLoadPolicy:n}=e.config,o=Rc(t.details.startsWith("key")?n:a,t),l=e.levels.reduce((d,h)=>d+h.fragmentError,0);if(s){var u;t.details!==I.FRAG_GAP&&s.fragmentError++;const d=(u=t.response)==null?void 0:u.code;if(Ea(o,l,va(t),d))return{action:Bt.RetryRequest,flags:ue.None,retryConfig:o,retryCount:l}}const c=this.getLevelSwitchAction(t,i);return o&&(c.retryConfig=o,c.retryCount=l),c}getLevelSwitchAction(t,e){const i=this.hls;e==null&&(e=i.loadLevel);const s=this.hls.levels[e];if(s&&(s.loadError++,i.autoLevelEnabled)){var a,n;let o=-1;const l=i.levels,u=(a=t.frag)==null?void 0:a.type,{type:c,groupId:d}=(n=t.context)!=null?n:{};for(let h=l.length;h--;){const f=(h+i.loadLevel)%l.length;if(f!==i.loadLevel&&l[f].loadError===0){const g=l[f];if(t.details===I.FRAG_GAP&&t.frag){const p=l[f].details;if(p){const T=ts(t.frag,p.fragments,t.frag.start);if(T!=null&&T.gap)continue}}else if(c===X.AUDIO_TRACK&&d===g.audioGroupId||c===X.SUBTITLE_TRACK&&d===g.textGroupId||u===G.AUDIO&&s.audioGroupId===g.audioGroupId||u===G.SUBTITLE&&s.textGroupId===g.textGroupId)continue;o=f;break}}if(o>-1&&i.loadLevel!==o)return t.levelRetry=!0,this.playlistError=0,{action:Bt.SendAlternateToPenaltyBox,flags:ue.None,nextAutoLevel:o}}return{action:Bt.SendAlternateToPenaltyBox,flags:ue.MoveAllAlternatesMatchingHost}}onErrorOut(t,e){var i;switch((i=e.errorAction)==null?void 0:i.action){case Bt.DoNothing:break;case Bt.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(e),!e.errorAction.resolved&&e.details!==I.FRAG_GAP&&(e.fatal=!0);break}if(e.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(t){const e=this.hls,i=t.errorAction;if(!i)return;const{flags:s,hdcpLevel:a,nextAutoLevel:n}=i;switch(s){case ue.None:this.switchLevel(t,n);break;case ue.MoveAllAlternatesMatchingHost:i.resolved||(i.resolved=this.redundantFailover(t));break;case ue.MoveAllAlternatesMatchingHDCP:a&&(e.maxHdcpLevel=Mo[Mo.indexOf(a)-1],i.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${e.maxHdcpLevel}" or lower`);break}i.resolved||this.switchLevel(t,n)}switchLevel(t,e){e!==void 0&&t.errorAction&&(this.warn(`switching to level ${e} after ${t.details}`),this.hls.nextAutoLevel=e,t.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}redundantFailover(t){const{hls:e,penalizedRenditions:i}=this,s=t.parent===G.MAIN?t.level:e.loadLevel,a=e.levels[s],n=a.url.length,o=t.frag?t.frag.urlId:a.urlId;a.urlId===o&&(!t.frag||a.details)&&this.penalizeRendition(a,t);for(let l=1;l<n;l++){const u=(o+l)%n,c=i[u];if(!c||H0(c,t,i[o]))return this.warn(`Switching to Redundant Stream ${u+1}/${n}: "${a.url[u]}" after ${t.details}`),this.playlistError=0,e.levels.forEach(d=>{d.urlId=u}),e.nextLoadLevel=s,!0}return!1}penalizeRendition(t,e){const{penalizedRenditions:i}=this,s=i[t.urlId]||{lastErrorPerfMs:0,errors:[],details:void 0};s.lastErrorPerfMs=performance.now(),s.errors.push(e),s.details=t.details,i[t.urlId]=s}}function H0(r,t,e){if(performance.now()-r.lastErrorPerfMs>K0)return!0;const i=r.details;if(t.details===I.FRAG_GAP&&i&&t.frag){const s=t.frag.start,a=ts(null,i.fragments,s);if(a&&!a.gap)return!0}if(e&&r.errors.length<e.errors.length){const s=r.errors[r.errors.length-1];if(i&&s.frag&&t.frag&&Math.abs(s.frag.start-t.frag.start)>i.targetduration*3)return!0}return!1}class $l{constructor(t,e){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=L.log.bind(L,`${e}:`),this.warn=L.warn.bind(L,`${e}:`),this.hls=t}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){clearTimeout(this.timer),this.timer=-1}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(t,e){const i=e==null?void 0:e.renditionReports;if(i){let s=-1;for(let a=0;a<i.length;a++){const n=i[a];let o;try{o=new self.URL(n.URI,e.url).href}catch(l){L.warn(`Could not construct new URL for Rendition Report: ${l}`),o=n.URI||""}if(o===t){s=a;break}else o===t.substring(0,o.length)&&(s=a)}if(s!==-1){const a=i[s],n=parseInt(a["LAST-MSN"])||(e==null?void 0:e.lastPartSn);let o=parseInt(a["LAST-PART"])||(e==null?void 0:e.lastPartIndex);if(this.hls.config.lowLatencyMode){const l=Math.min(e.age-e.partTarget,e.targetduration);o>=0&&l>e.partTarget&&(o+=1)}return new Ac(n,o>=0?o:void 0,Oi.No)}}}loadPlaylist(t){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(t){return this.canLoad&&!!t&&!!t.url&&(!t.details||t.details.live)}shouldReloadPlaylist(t){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(t)}playlistLoaded(t,e,i){const{details:s,stats:a}=e,n=self.performance.now(),o=a.loading.first?Math.max(0,n-a.loading.first):0;if(s.advancedDateTime=Date.now()-o,s.live||i!=null&&i.live){if(s.reloaded(i),i&&this.log(`live playlist ${t} ${s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:"MISSED"}`),i&&s.fragments.length>0&&P0(i,s),!this.canLoad||!s.live)return;let l,u,c;if(s.canBlockReload&&s.endSN&&s.advanced){const T=this.hls.config.lowLatencyMode,y=s.lastPartSn,v=s.endSN,E=s.lastPartIndex,S=E!==-1,b=y===v,w=T?0:E;S?(u=b?v+1:y,c=b?w:E+1):u=v+1;const k=s.age,D=k+s.ageHeader;let P=Math.min(D-s.partTarget,s.targetduration*1.5);if(P>0){if(i&&P>i.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${i.tuneInGoal} to: ${P} with playlist age: ${s.age}`),P=0;else{const R=Math.floor(P/s.targetduration);if(u+=R,c!==void 0){const U=Math.round(P%s.targetduration/s.partTarget);c+=U}this.log(`CDN Tune-in age: ${s.ageHeader}s last advanced ${k.toFixed(2)}s goal: ${P} skip sn ${R} to part ${c}`)}s.tuneInGoal=P}if(l=this.getDeliveryDirectives(s,e.deliveryDirectives,u,c),T||!b){this.loadPlaylist(l);return}}else s.canBlockReload&&(l=this.getDeliveryDirectives(s,e.deliveryDirectives,u,c));const d=this.hls.mainForwardBufferInfo,h=d?d.end-d.len:0,f=(s.edge-h)*1e3,g=M0(s,f);s.updated&&n>this.requestScheduled+g&&(this.requestScheduled=a.loading.start),u!==void 0&&s.canBlockReload?this.requestScheduled=a.loading.first+g-(s.partTarget*1e3||1e3):this.requestScheduled===-1||this.requestScheduled+g<n?this.requestScheduled=n:this.requestScheduled-n<=0&&(this.requestScheduled+=g);let p=this.requestScheduled-n;p=Math.max(0,p),this.log(`reload live playlist ${t} in ${Math.round(p)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(l),p)}else this.clearTimer()}getDeliveryDirectives(t,e,i,s){let a=_0(t,i);return e!=null&&e.skip&&t.deltaUpdateFailed&&(i=e.msn,s=e.part,a=Oi.No),new Ac(i,s,a)}checkRetry(t){const e=t.details,i=va(t),s=t.errorAction,{action:a,retryCount:n=0,retryConfig:o}=s||{},l=!!s&&!!o&&(a===Bt.RetryRequest||!s.resolved&&a===Bt.SendAlternateToPenaltyBox);if(l){var u;if(this.requestScheduled=-1,n>=o.maxNumRetry)return!1;if(i&&(u=t.context)!=null&&u.deliveryDirectives)this.warn(`Retrying playlist loading ${n+1}/${o.maxNumRetry} after "${e}" without delivery-directives`),this.loadPlaylist();else{const c=Bl(o,n);this.timer=self.setTimeout(()=>this.loadPlaylist(),c),this.warn(`Retrying playlist loading ${n+1}/${o.maxNumRetry} after "${e}" in ${c}ms`)}t.levelRetry=!0,s.resolved=!0}return l}}let Ln;class z0 extends $l{constructor(t,e){super(t,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=e,this._registerListeners()}_registerListeners(){const{hls:t}=this;t.on(m.MANIFEST_LOADING,this.onManifestLoading,this),t.on(m.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(m.LEVEL_LOADED,this.onLevelLoaded,this),t.on(m.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(m.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(m.FRAG_LOADED,this.onFragLoaded,this),t.on(m.ERROR,this.onError,this)}_unregisterListeners(){const{hls:t}=this;t.off(m.MANIFEST_LOADING,this.onManifestLoading,this),t.off(m.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(m.LEVEL_LOADED,this.onLevelLoaded,this),t.off(m.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(m.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(m.FRAG_LOADED,this.onFragLoaded,this),t.off(m.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}startLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.startLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[]}onManifestLoading(t,e){this.resetLevels()}onManifestLoaded(t,e){const i=[],s={};let a;e.levels.forEach(n=>{var o;const l=n.attrs;((o=n.audioCodec)==null?void 0:o.indexOf("mp4a.40.34"))!==-1&&(Ln||(Ln=/chrome|firefox/i.test(navigator.userAgent)),Ln&&(n.audioCodec=void 0));const{AUDIO:u,CODECS:c,"FRAME-RATE":d,"PATHWAY-ID":h,RESOLUTION:f,SUBTITLES:g}=l,p=`${`${h||"."}-`}${n.bitrate}-${f}-${d}-${c}`;a=s[p],a?a.addFallback(n):(a=new Zi(n),s[p]=a,i.push(a)),Ta(a,"audio",u),Ta(a,"text",g)}),this.filterAndSortMediaOptions(i,e)}filterAndSortMediaOptions(t,e){let i=[],s=[],a=!1,n=!1,o=!1,l=t.filter(({audioCodec:f,videoCodec:g,width:p,height:T,unknownCodecs:y})=>(a||(a=!!(p&&T)),n||(n=!!g),o||(o=!!f),!(y!=null&&y.length)&&(!f||En(f,"audio"))&&(!g||En(g,"video"))));if((a||n)&&o&&(l=l.filter(({videoCodec:f,width:g,height:p})=>!!f||!!(g&&p))),l.length===0){Promise.resolve().then(()=>{if(this.hls){const f=new Error("no level with compatible codecs found in manifest");this.hls.trigger(m.ERROR,{type:$.MEDIA_ERROR,details:I.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:e.url,error:f,reason:f.message})}});return}e.audioTracks&&(i=e.audioTracks.filter(f=>!f.audioCodec||En(f.audioCodec,"audio")),Dc(i)),e.subtitles&&(s=e.subtitles,Dc(s));const u=l.slice(0);l.sort((f,g)=>f.attrs["HDCP-LEVEL"]!==g.attrs["HDCP-LEVEL"]?(f.attrs["HDCP-LEVEL"]||"")>(g.attrs["HDCP-LEVEL"]||"")?1:-1:f.bitrate!==g.bitrate?f.bitrate-g.bitrate:f.attrs["FRAME-RATE"]!==g.attrs["FRAME-RATE"]?f.attrs.decimalFloatingPoint("FRAME-RATE")-g.attrs.decimalFloatingPoint("FRAME-RATE"):f.attrs.SCORE!==g.attrs.SCORE?f.attrs.decimalFloatingPoint("SCORE")-g.attrs.decimalFloatingPoint("SCORE"):a&&f.height!==g.height?f.height-g.height:0);let c=u[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==u.length)){for(let f=0;f<u.length;f++)if(u[f].pathwayId===l[0].pathwayId){c=u[f];break}}this._levels=l;for(let f=0;f<l.length;f++)if(l[f]===c){this._firstLevel=f,this.log(`manifest loaded, ${l.length} level(s) found, first bitrate: ${c.bitrate}`);break}const d=o&&!n,h={levels:l,audioTracks:i,subtitleTracks:s,sessionData:e.sessionData,sessionKeys:e.sessionKeys,firstLevel:this._firstLevel,stats:e.stats,audio:o,video:n,altAudio:!d&&i.some(f=>!!f.url)};this.hls.trigger(m.MANIFEST_PARSED,h),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return this._levels.length===0?null:this._levels}get level(){return this.currentLevelIndex}set level(t){const e=this._levels;if(e.length===0)return;if(t<0||t>=e.length){const c=new Error("invalid level idx"),d=t<0;if(this.hls.trigger(m.ERROR,{type:$.OTHER_ERROR,details:I.LEVEL_SWITCH_ERROR,level:t,fatal:d,error:c,reason:c.message}),d)return;t=Math.min(t,e.length-1)}const i=this.currentLevelIndex,s=this.currentLevel,a=s?s.attrs["PATHWAY-ID"]:void 0,n=e[t],o=n.attrs["PATHWAY-ID"];if(this.currentLevelIndex=t,this.currentLevel=n,i===t&&n.details&&s&&a===o)return;this.log(`Switching to level ${t}${o?" with Pathway "+o:""} from level ${i}${a?" with Pathway "+a:""}`);const l=vt({},n,{level:t,maxBitrate:n.maxBitrate,attrs:n.attrs,uri:n.uri,urlId:n.urlId});delete l._attrs,delete l._urlId,this.hls.trigger(m.LEVEL_SWITCHING,l);const u=n.details;if(!u||u.live){const c=this.switchParams(n.uri,s==null?void 0:s.details);this.loadPlaylist(c)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(t){this.manualLevelIndex=t,this._startLevel===void 0&&(this._startLevel=t),t!==-1&&(this.level=t)}get firstLevel(){return this._firstLevel}set firstLevel(t){this._firstLevel=t}get startLevel(){if(this._startLevel===void 0){const t=this.hls.config.startLevel;return t!==void 0?t:this._firstLevel}else return this._startLevel}set startLevel(t){this._startLevel=t}onError(t,e){e.fatal||!e.context||e.context.type===X.LEVEL&&e.context.level===this.level&&this.checkRetry(e)}onFragLoaded(t,{frag:e}){if(e!==void 0&&e.type===G.MAIN){const i=this._levels[e.level];i!==void 0&&(i.loadError=0)}}onLevelLoaded(t,e){var i;const{level:s,details:a}=e,n=this._levels[s];if(!n){var o;this.warn(`Invalid level index ${s}`),(o=e.deliveryDirectives)!=null&&o.skip&&(a.deltaUpdateFailed=!0);return}s===this.currentLevelIndex?(n.fragmentError===0&&(n.loadError=0),this.playlistLoaded(s,e,n.details)):(i=e.deliveryDirectives)!=null&&i.skip&&(a.deltaUpdateFailed=!0)}onAudioTrackSwitched(t,e){const i=this.currentLevel;if(!i)return;const s=this.hls.audioTracks[e.id].groupId;if(i.audioGroupIds&&i.audioGroupId!==s){let a=-1;for(let n=0;n<i.audioGroupIds.length;n++)if(i.audioGroupIds[n]===s){a=n;break}a!==-1&&a!==i.urlId&&(i.urlId=a,this.canLoad&&this.startLoad())}}loadPlaylist(t){super.loadPlaylist();const e=this.currentLevelIndex,i=this.currentLevel;if(i&&this.shouldLoadPlaylist(i)){const s=i.urlId;let a=i.uri;if(t)try{a=t.addDirectives(a)}catch(o){this.warn(`Could not construct new URL with HLS Delivery Directives: ${o}`)}const n=i.attrs["PATHWAY-ID"];this.log(`Loading level index ${e}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""} with${n?" Pathway "+n:""} URI ${s+1}/${i.url.length} ${a}`),this.clearTimer(),this.hls.trigger(m.LEVEL_LOADING,{url:a,level:e,id:s,deliveryDirectives:t||null})}}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(t){this.level=t,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=t)}removeLevel(t,e){const i=(a,n)=>n!==e,s=this._levels.filter((a,n)=>n!==t?!0:a.url.length>1&&e!==void 0?(a.url=a.url.filter(i),a.audioGroupIds&&(a.audioGroupIds=a.audioGroupIds.filter(i)),a.textGroupIds&&(a.textGroupIds=a.textGroupIds.filter(i)),a.urlId=0,!0):(this.steering&&this.steering.removeLevel(a),!1));this.hls.trigger(m.LEVELS_UPDATED,{levels:s})}onLevelsUpdated(t,{levels:e}){e.forEach((i,s)=>{const{details:a}=i;a!=null&&a.fragments&&a.fragments.forEach(n=>{n.level=s})}),this._levels=e}}function Ta(r,t,e){!e||(t==="audio"?(r.audioGroupIds||(r.audioGroupIds=[]),r.audioGroupIds[r.url.length-1]=e):t==="text"&&(r.textGroupIds||(r.textGroupIds=[]),r.textGroupIds[r.url.length-1]=e))}function Dc(r){const t={};r.forEach(e=>{const i=e.groupId||"";e.id=t[i]=t[i]||0,t[i]++})}var kt={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class W0{constructor(t){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=t,this._registerListeners()}_registerListeners(){const{hls:t}=this;t.on(m.BUFFER_APPENDED,this.onBufferAppended,this),t.on(m.FRAG_BUFFERED,this.onFragBuffered,this),t.on(m.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:t}=this;t.off(m.BUFFER_APPENDED,this.onBufferAppended,this),t.off(m.FRAG_BUFFERED,this.onFragBuffered,this),t.off(m.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(t,e){const i=this.activePartLists[e];if(i)for(let s=i.length;s--;){const a=i[s];if(!a)break;const n=a.end;if(a.start<=t&&n!==null&&t<=n)return a}return this.getBufferedFrag(t,e)}getBufferedFrag(t,e){const{fragments:i}=this,s=Object.keys(i);for(let a=s.length;a--;){const n=i[s[a]];if((n==null?void 0:n.body.type)===e&&n.buffered){const o=n.body;if(o.start<=t&&t<=o.end)return o}}return null}detectEvictedFragments(t,e,i,s){this.timeRanges&&(this.timeRanges[t]=e);const a=(s==null?void 0:s.fragment.sn)||-1;Object.keys(this.fragments).forEach(n=>{const o=this.fragments[n];if(!o||a>=o.body.sn)return;if(!o.buffered&&!o.loaded){o.body.type===i&&this.removeFragment(o.body);return}const l=o.range[t];!l||l.time.some(u=>{const c=!this.isTimeBuffered(u.startPTS,u.endPTS,e);return c&&this.removeFragment(o.body),c})})}detectPartialFragments(t){const e=this.timeRanges,{frag:i,part:s}=t;if(!e||i.sn==="initSegment")return;const a=_r(i),n=this.fragments[a];if(!n)return;const o=!i.relurl;Object.keys(e).forEach(l=>{const u=i.elementaryStreams[l];if(!u)return;const c=e[l],d=o||u.partial===!0;n.range[l]=this.getBufferedTimes(i,s,d,c)}),n.loaded=null,Object.keys(n.range).length?(n.buffered=!0,n.body.endList&&(this.endListFragments[n.body.type]=n),As(n)||this.removeParts(i.sn-1,i.type)):this.removeFragment(n.body)}removeParts(t,e){const i=this.activePartLists[e];!i||(this.activePartLists[e]=i.filter(s=>s.fragment.sn>=t))}fragBuffered(t,e){const i=_r(t);let s=this.fragments[i];!s&&e&&(s=this.fragments[i]={body:t,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},t.gap&&(this.hasGaps=!0)),s&&(s.loaded=null,s.buffered=!0)}getBufferedTimes(t,e,i,s){const a={time:[],partial:i},n=t.start,o=t.end,l=t.minEndPTS||o,u=t.maxStartPTS||n;for(let c=0;c<s.length;c++){const d=s.start(c)-this.bufferPadding,h=s.end(c)+this.bufferPadding;if(u>=d&&l<=h){a.time.push({startPTS:Math.max(n,s.start(c)),endPTS:Math.min(o,s.end(c))});break}else if(n<h&&o>d)a.partial=!0,a.time.push({startPTS:Math.max(n,s.start(c)),endPTS:Math.min(o,s.end(c))});else if(o<=d)break}return a}getPartialFragment(t){let e=null,i,s,a,n=0;const{bufferPadding:o,fragments:l}=this;return Object.keys(l).forEach(u=>{const c=l[u];!c||As(c)&&(s=c.body.start-o,a=c.body.end+o,t>=s&&t<=a&&(i=Math.min(t-s,a-t),n<=i&&(e=c.body,n=i)))}),e}isEndListAppended(t){const e=this.endListFragments[t];return e!==void 0&&(e.buffered||As(e))}getState(t){const e=_r(t),i=this.fragments[e];return i?i.buffered?As(i)?kt.PARTIAL:kt.OK:kt.APPENDING:kt.NOT_LOADED}isTimeBuffered(t,e,i){let s,a;for(let n=0;n<i.length;n++){if(s=i.start(n)-this.bufferPadding,a=i.end(n)+this.bufferPadding,t>=s&&e<=a)return!0;if(e<=s)return!1}return!1}onFragLoaded(t,e){const{frag:i,part:s}=e;if(i.sn==="initSegment"||i.bitrateTest)return;const a=s?null:e,n=_r(i);this.fragments[n]={body:i,appendedPTS:null,loaded:a,buffered:!1,range:Object.create(null)}}onBufferAppended(t,e){const{frag:i,part:s,timeRanges:a}=e;if(i.sn==="initSegment")return;const n=i.type;if(s){let o=this.activePartLists[n];o||(this.activePartLists[n]=o=[]),o.push(s)}this.timeRanges=a,Object.keys(a).forEach(o=>{const l=a[o];this.detectEvictedFragments(o,l,n,s)})}onFragBuffered(t,e){this.detectPartialFragments(e)}hasFragment(t){const e=_r(t);return!!this.fragments[e]}hasParts(t){var e;return!!((e=this.activePartLists[t])!=null&&e.length)}removeFragmentsInRange(t,e,i,s,a){s&&!this.hasGaps||Object.keys(this.fragments).forEach(n=>{const o=this.fragments[n];if(!o)return;const l=o.body;l.type!==i||s&&!l.gap||l.start<e&&l.end>t&&(o.buffered||a)&&this.removeFragment(l)})}removeFragment(t){const e=_r(t);t.stats.loaded=0,t.clearElementaryStreamInfo();const i=this.activePartLists[t.type];if(i){const s=t.sn;this.activePartLists[t.type]=i.filter(a=>a.fragment.sn!==s)}delete this.fragments[e],t.endList&&delete this.endListFragments[t.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function As(r){var t,e,i;return r.buffered&&(r.body.gap||((t=r.range.video)==null?void 0:t.partial)||((e=r.range.audio)==null?void 0:e.partial)||((i=r.range.audiovideo)==null?void 0:i.partial))}function _r(r){return`${r.type}_${r.level}_${r.urlId}_${r.sn}`}const Cc=Math.pow(2,17);class Y0{constructor(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(t,e){const i=t.url;if(!i)return Promise.reject(new Ce({type:$.NETWORK_ERROR,details:I.FRAG_LOAD_ERROR,fatal:!1,frag:t,error:new Error(`Fragment does not have a ${i?"part list":"url"}`),networkDetails:null}));this.abort();const s=this.config,a=s.fLoader,n=s.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),t.gap){l(Pc(t));return}const u=this.loader=t.loader=a?new a(s):new n(s),c=_c(t),d=Ic(s.fragLoadPolicy.default),h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:t.sn==="initSegment"?1/0:Cc};t.stats=u.stats,u.load(c,h,{onSuccess:(f,g,p,T)=>{this.resetLoader(t,u);let y=f.data;p.resetIV&&t.decryptdata&&(t.decryptdata.iv=new Uint8Array(y.slice(0,16)),y=y.slice(16)),o({frag:t,part:null,payload:y,networkDetails:T})},onError:(f,g,p,T)=>{this.resetLoader(t,u),l(new Ce({type:$.NETWORK_ERROR,details:I.FRAG_LOAD_ERROR,fatal:!1,frag:t,response:Wt({url:i,data:void 0},f),error:new Error(`HTTP Error ${f.code} ${f.text}`),networkDetails:p,stats:T}))},onAbort:(f,g,p)=>{this.resetLoader(t,u),l(new Ce({type:$.NETWORK_ERROR,details:I.INTERNAL_ABORTED,fatal:!1,frag:t,error:new Error("Aborted"),networkDetails:p,stats:f}))},onTimeout:(f,g,p)=>{this.resetLoader(t,u),l(new Ce({type:$.NETWORK_ERROR,details:I.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:p,stats:f}))},onProgress:(f,g,p,T)=>{e&&e({frag:t,part:null,payload:p,networkDetails:T})}})})}loadPart(t,e,i){this.abort();const s=this.config,a=s.fLoader,n=s.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),t.gap||e.gap){l(Pc(t,e));return}const u=this.loader=t.loader=a?new a(s):new n(s),c=_c(t,e),d=Ic(s.fragLoadPolicy.default),h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Cc};e.stats=u.stats,u.load(c,h,{onSuccess:(f,g,p,T)=>{this.resetLoader(t,u),this.updateStatsFromPart(t,e);const y={frag:t,part:e,payload:f.data,networkDetails:T};i(y),o(y)},onError:(f,g,p,T)=>{this.resetLoader(t,u),l(new Ce({type:$.NETWORK_ERROR,details:I.FRAG_LOAD_ERROR,fatal:!1,frag:t,part:e,response:Wt({url:c.url,data:void 0},f),error:new Error(`HTTP Error ${f.code} ${f.text}`),networkDetails:p,stats:T}))},onAbort:(f,g,p)=>{t.stats.aborted=e.stats.aborted,this.resetLoader(t,u),l(new Ce({type:$.NETWORK_ERROR,details:I.INTERNAL_ABORTED,fatal:!1,frag:t,part:e,error:new Error("Aborted"),networkDetails:p,stats:f}))},onTimeout:(f,g,p)=>{this.resetLoader(t,u),l(new Ce({type:$.NETWORK_ERROR,details:I.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,part:e,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:p,stats:f}))}})})}updateStatsFromPart(t,e){const i=t.stats,s=e.stats,a=s.total;if(i.loaded+=s.loaded,a){const l=Math.round(t.duration/e.duration),u=Math.min(Math.round(i.loaded/a),l),c=(l-u)*Math.round(i.loaded/u);i.total=i.loaded+c}else i.total=Math.max(i.loaded,i.total);const n=i.loading,o=s.loading;n.start?n.first+=o.first-o.start:(n.start=o.start,n.first=o.first),n.end=o.end}resetLoader(t,e){t.loader=null,this.loader===e&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),e.destroy()}}function _c(r,t=null){const e=t||r,i={frag:r,part:t,responseType:"arraybuffer",url:e.url,headers:{},rangeStart:0,rangeEnd:0},s=e.byteRangeStartOffset,a=e.byteRangeEndOffset;if(B(s)&&B(a)){var n;let o=s,l=a;if(r.sn==="initSegment"&&((n=r.decryptdata)==null?void 0:n.method)==="AES-128"){const u=a-s;u%16&&(l=a+(16-u%16)),s!==0&&(i.resetIV=!0,o=s-16)}i.rangeStart=o,i.rangeEnd=l}return i}function Pc(r,t){const e=new Error(`GAP ${r.gap?"tag":"attribute"} found`),i={type:$.MEDIA_ERROR,details:I.FRAG_GAP,fatal:!1,frag:r,error:e,networkDetails:null};return t&&(i.part=t),(t||r).stats.aborted=!0,new Ce(i)}class Ce extends Error{constructor(t){super(t.error.message),this.data=void 0,this.data=t}}class j0{constructor(t){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=t}abort(t){for(const e in this.keyUriToKeyInfo){const i=this.keyUriToKeyInfo[e].loader;if(i){if(t&&t!==i.context.frag.type)return;i.abort()}}}detach(){for(const t in this.keyUriToKeyInfo){const e=this.keyUriToKeyInfo[t];(e.mediaKeySessionContext||e.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[t]}}destroy(){this.detach();for(const t in this.keyUriToKeyInfo){const e=this.keyUriToKeyInfo[t].loader;e&&e.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(t,e=I.KEY_LOAD_ERROR,i,s,a){return new Ce({type:$.NETWORK_ERROR,details:e,fatal:!1,frag:t,response:a,error:i,networkDetails:s})}loadClear(t,e){if(this.emeController&&this.config.emeEnabled){const{sn:i,cc:s}=t;for(let a=0;a<e.length;a++){const n=e[a];if(s<=n.cc&&(i==="initSegment"||n.sn==="initSegment"||i<n.sn)){this.emeController.selectKeySystemFormat(n).then(o=>{n.setKeyFormat(o)});break}}}}load(t){return!t.decryptdata&&t.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(t).then(e=>this.loadInternal(t,e)):this.loadInternal(t)}loadInternal(t,e){var i,s;e&&t.setKeyFormat(e);const a=t.decryptdata;if(!a){const u=new Error(e?`Expected frag.decryptdata to be defined after setting format ${e}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(t,I.KEY_LOAD_ERROR,u))}const n=a.uri;if(!n)return Promise.reject(this.createKeyLoadError(t,I.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${n}"`)));let o=this.keyUriToKeyInfo[n];if((i=o)!=null&&i.decryptdata.key)return a.key=o.decryptdata.key,Promise.resolve({frag:t,keyInfo:o});if((s=o)!=null&&s.keyLoadPromise){var l;switch((l=o.mediaKeySessionContext)==null?void 0:l.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return o.keyLoadPromise.then(u=>(a.key=u.keyInfo.decryptdata.key,{frag:t,keyInfo:o}))}}switch(o=this.keyUriToKeyInfo[n]={decryptdata:a,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},a.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return a.keyFormat==="identity"?this.loadKeyHTTP(o,t):this.loadKeyEME(o,t);case"AES-128":return this.loadKeyHTTP(o,t);default:return Promise.reject(this.createKeyLoadError(t,I.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${a.method}"`)))}}loadKeyEME(t,e){const i={frag:e,keyInfo:t};if(this.emeController&&this.config.emeEnabled){const s=this.emeController.loadKey(i);if(s)return(t.keyLoadPromise=s.then(a=>(t.mediaKeySessionContext=a,i))).catch(a=>{throw t.keyLoadPromise=null,a})}return Promise.resolve(i)}loadKeyHTTP(t,e){const i=this.config,s=i.loader,a=new s(i);return e.keyLoader=t.loader=a,t.keyLoadPromise=new Promise((n,o)=>{const l={keyInfo:t,frag:e,responseType:"arraybuffer",url:t.decryptdata.uri},u=i.keyLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(h,f,g,p)=>{const{frag:T,keyInfo:y,url:v}=g;if(!T.decryptdata||y!==this.keyUriToKeyInfo[v])return o(this.createKeyLoadError(T,I.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),p));y.decryptdata.key=T.decryptdata.key=new Uint8Array(h.data),T.keyLoader=null,y.loader=null,n({frag:T,keyInfo:y})},onError:(h,f,g,p)=>{this.resetLoader(f),o(this.createKeyLoadError(e,I.KEY_LOAD_ERROR,new Error(`HTTP Error ${h.code} loading key ${h.text}`),g,Wt({url:l.url,data:void 0},h)))},onTimeout:(h,f,g)=>{this.resetLoader(f),o(this.createKeyLoadError(e,I.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),g))},onAbort:(h,f,g)=>{this.resetLoader(f),o(this.createKeyLoadError(e,I.INTERNAL_ABORTED,new Error("key loading aborted"),g))}};a.load(l,c,d)})}resetLoader(t){const{frag:e,keyInfo:i,url:s}=t,a=i.loader;e.keyLoader===a&&(e.keyLoader=null,i.loader=null),delete this.keyUriToKeyInfo[s],a&&a.destroy()}}class q0{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(t){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,t),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}const X0={length:0,start:()=>0,end:()=>0};class rt{static isBuffered(t,e){try{if(t){const i=rt.getBuffered(t);for(let s=0;s<i.length;s++)if(e>=i.start(s)&&e<=i.end(s))return!0}}catch{}return!1}static bufferInfo(t,e,i){try{if(t){const s=rt.getBuffered(t),a=[];let n;for(n=0;n<s.length;n++)a.push({start:s.start(n),end:s.end(n)});return this.bufferedInfo(a,e,i)}}catch{}return{len:0,start:e,end:e,nextStart:void 0}}static bufferedInfo(t,e,i){e=Math.max(0,e),t.sort(function(u,c){return u.start-c.start||c.end-u.end});let s=[];if(i)for(let u=0;u<t.length;u++){const c=s.length;if(c){const d=s[c-1].end;t[u].start-d<i?t[u].end>d&&(s[c-1].end=t[u].end):s.push(t[u])}else s.push(t[u])}else s=t;let a=0,n,o=e,l=e;for(let u=0;u<s.length;u++){const c=s[u].start,d=s[u].end;if(e+i>=c&&e<d)o=c,l=d,a=l-e;else if(e+i<c){n=c;break}}return{len:a,start:o||0,end:l||0,nextStart:n}}static getBuffered(t){try{return t.buffered}catch(e){return L.log("failed to get media.buffered",e),X0}}}class Gl{constructor(t,e,i,s=0,a=-1,n=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=ws(),this.buffering={audio:ws(),video:ws(),audiovideo:ws()},this.level=t,this.sn=e,this.id=i,this.size=s,this.part=a,this.partial=n}}function ws(){return{start:0,executeStart:0,executeEnd:0,end:0}}function Ff(r,t){let e=null;for(let i=0,s=r.length;i<s;i++){const a=r[i];if(a&&a.cc===t){e=a;break}}return e}function Q0(r,t,e){return!!(t.details&&(e.endCC>e.startCC||r&&r.cc<e.startCC))}function J0(r,t,e=0){const i=r.fragments,s=t.fragments;if(!s.length||!i.length){L.log("No fragments to align");return}const a=Ff(i,s[0].cc);if(!a||a&&!a.startPTS){L.log("No frag in previous level to align on");return}return a}function xc(r,t){if(r){const e=r.start+t;r.start=r.startPTS=e,r.endPTS=e+r.duration}}function Kl(r,t){const e=t.fragments;for(let i=0,s=e.length;i<s;i++)xc(e[i],r);t.fragmentHint&&xc(t.fragmentHint,r),t.alignedSliding=!0}function Z0(r,t,e){!t||(ty(r,e,t),!e.alignedSliding&&t.details&&ey(e,t.details),!e.alignedSliding&&t.details&&!e.skippedSegments&&Pf(t.details,e))}function ty(r,t,e){if(Q0(r,e,t)){const i=J0(e.details,t);i&&B(i.start)&&(L.log(`Adjusting PTS using last level due to CC increase within current level ${t.url}`),Kl(i.start,t))}}function ey(r,t){if(!t.fragments.length||!r.hasProgramDateTime||!t.hasProgramDateTime)return;const e=t.fragments[0].programDateTime,i=r.fragments[0].programDateTime,s=(i-e)/1e3+t.fragments[0].start;s&&B(s)&&(L.log(`Adjusting PTS using programDateTime delta ${i-e}ms, sliding:${s.toFixed(3)} ${r.url} `),Kl(s,r))}function Mf(r,t){if(!r.hasProgramDateTime||!t.hasProgramDateTime)return;const e=r.fragments,i=t.fragments;if(!e.length||!i.length)return;const s=Math.round(i.length/2)-1,a=i[s],n=Ff(e,a.cc)||e[Math.round(e.length/2)-1],o=a.programDateTime,l=n.programDateTime;if(o===null||l===null)return;const u=(l-o)/1e3-(n.start-a.start);Kl(u,r)}class ry{constructor(t,e){this.subtle=void 0,this.aesIV=void 0,this.subtle=t,this.aesIV=e}decrypt(t,e){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t)}}class iy{constructor(t,e){this.subtle=void 0,this.key=void 0,this.subtle=t,this.key=e}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}function sy(r){const t=r.byteLength,e=t&&new DataView(r.buffer).getUint8(t-1);return e?Sr(r,0,t-e):r}class ay{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(t){const e=new DataView(t),i=new Uint32Array(4);for(let s=0;s<4;s++)i[s]=e.getUint32(s*4);return i}initTable(){const t=this.sBox,e=this.invSBox,i=this.subMix,s=i[0],a=i[1],n=i[2],o=i[3],l=this.invSubMix,u=l[0],c=l[1],d=l[2],h=l[3],f=new Uint32Array(256);let g=0,p=0,T=0;for(T=0;T<256;T++)T<128?f[T]=T<<1:f[T]=T<<1^283;for(T=0;T<256;T++){let y=p^p<<1^p<<2^p<<3^p<<4;y=y>>>8^y&255^99,t[g]=y,e[y]=g;const v=f[g],E=f[v],S=f[E];let b=f[y]*257^y*16843008;s[g]=b<<24|b>>>8,a[g]=b<<16|b>>>16,n[g]=b<<8|b>>>24,o[g]=b,b=S*16843009^E*65537^v*257^g*16843008,u[y]=b<<24|b>>>8,c[y]=b<<16|b>>>16,d[y]=b<<8|b>>>24,h[y]=b,g?(g=v^f[f[f[S^v]]],p^=f[f[p]]):g=p=1}}expandKey(t){const e=this.uint8ArrayToUint32Array_(t);let i=!0,s=0;for(;s<e.length&&i;)i=e[s]===this.key[s],s++;if(i)return;this.key=e;const a=this.keySize=e.length;if(a!==4&&a!==6&&a!==8)throw new Error("Invalid aes key size="+a);const n=this.ksRows=(a+6+1)*4;let o,l;const u=this.keySchedule=new Uint32Array(n),c=this.invKeySchedule=new Uint32Array(n),d=this.sBox,h=this.rcon,f=this.invSubMix,g=f[0],p=f[1],T=f[2],y=f[3];let v,E;for(o=0;o<n;o++){if(o<a){v=u[o]=e[o];continue}E=v,o%a===0?(E=E<<8|E>>>24,E=d[E>>>24]<<24|d[E>>>16&255]<<16|d[E>>>8&255]<<8|d[E&255],E^=h[o/a|0]<<24):a>6&&o%a===4&&(E=d[E>>>24]<<24|d[E>>>16&255]<<16|d[E>>>8&255]<<8|d[E&255]),u[o]=v=(u[o-a]^E)>>>0}for(l=0;l<n;l++)o=n-l,l&3?E=u[o]:E=u[o-4],l<4||o<=4?c[l]=E:c[l]=g[d[E>>>24]]^p[d[E>>>16&255]]^T[d[E>>>8&255]]^y[d[E&255]],c[l]=c[l]>>>0}networkToHostOrderSwap(t){return t<<24|(t&65280)<<8|(t&16711680)>>8|t>>>24}decrypt(t,e,i){const s=this.keySize+6,a=this.invKeySchedule,n=this.invSBox,o=this.invSubMix,l=o[0],u=o[1],c=o[2],d=o[3],h=this.uint8ArrayToUint32Array_(i);let f=h[0],g=h[1],p=h[2],T=h[3];const y=new Int32Array(t),v=new Int32Array(y.length);let E,S,b,w,k,D,P,R,U,M,Y,pt,H,st;const Q=this.networkToHostOrderSwap;for(;e<y.length;){for(U=Q(y[e]),M=Q(y[e+1]),Y=Q(y[e+2]),pt=Q(y[e+3]),k=U^a[0],D=pt^a[1],P=Y^a[2],R=M^a[3],H=4,st=1;st<s;st++)E=l[k>>>24]^u[D>>16&255]^c[P>>8&255]^d[R&255]^a[H],S=l[D>>>24]^u[P>>16&255]^c[R>>8&255]^d[k&255]^a[H+1],b=l[P>>>24]^u[R>>16&255]^c[k>>8&255]^d[D&255]^a[H+2],w=l[R>>>24]^u[k>>16&255]^c[D>>8&255]^d[P&255]^a[H+3],k=E,D=S,P=b,R=w,H=H+4;E=n[k>>>24]<<24^n[D>>16&255]<<16^n[P>>8&255]<<8^n[R&255]^a[H],S=n[D>>>24]<<24^n[P>>16&255]<<16^n[R>>8&255]<<8^n[k&255]^a[H+1],b=n[P>>>24]<<24^n[R>>16&255]<<16^n[k>>8&255]<<8^n[D&255]^a[H+2],w=n[R>>>24]<<24^n[k>>16&255]<<16^n[D>>8&255]<<8^n[P&255]^a[H+3],v[e]=Q(E^f),v[e+1]=Q(w^g),v[e+2]=Q(b^p),v[e+3]=Q(S^T),f=U,g=M,p=Y,T=pt,e=e+4}return v.buffer}}const ny=16;class Vl{constructor(t,{removePKCS7Padding:e=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=t.enableSoftwareAES,this.removePKCS7Padding=e,e)try{const i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch{}this.subtle===null&&(this.useSoftware=!0)}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:t,remainderData:e}=this;if(!t||e)return this.reset(),null;const i=new Uint8Array(t);return this.reset(),this.removePKCS7Padding?sy(i):i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(t,e,i){return this.useSoftware?new Promise((s,a)=>{this.softwareDecrypt(new Uint8Array(t),e,i);const n=this.flush();n?s(n.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(t),e,i)}softwareDecrypt(t,e,i){const{currentIV:s,currentResult:a,remainderData:n}=this;this.logOnce("JS AES decrypt"),n&&(t=Rr(n,t),this.remainderData=null);const o=this.getValidChunk(t);if(!o.length)return null;s&&(i=s);let l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new ay),l.expandKey(e);const u=a;return this.currentResult=l.decrypt(o.buffer,0,i),this.currentIV=Sr(o,-16).buffer,u||null}webCryptoDecrypt(t,e,i){const s=this.subtle;return(this.key!==e||!this.fastAesKey)&&(this.key=e,this.fastAesKey=new iy(s,e)),this.fastAesKey.expandKey().then(a=>s?(this.logOnce("WebCrypto AES decrypt"),new ry(s,new Uint8Array(i)).decrypt(t.buffer,a)):Promise.reject(new Error("web crypto not initialized"))).catch(a=>(L.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${a.name}: ${a.message}`),this.onWebCryptoError(t,e,i)))}onWebCryptoError(t,e,i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(t,e,i);const s=this.flush();if(s)return s.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(t){let e=t;const i=t.length-t.length%ny;return i!==t.length&&(e=Sr(t,0,i),this.remainderData=Sr(t,i)),e}logOnce(t){!this.logEnabled||(L.log(`[decrypter]: ${t}`),this.logEnabled=!1)}}const oy={toString:function(r){let t="";const e=r.length;for(let i=0;i<e;i++)t+=`[${r.start(i).toFixed(3)}-${r.end(i).toFixed(3)}]`;return t}},_={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Hl extends q0{constructor(t,e,i,s,a){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=_.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=a,this.logPrefix=s,this.log=L.log.bind(L,`${s}:`),this.warn=L.warn.bind(L,`${s}:`),this.hls=t,this.fragmentLoader=new Y0(t.config),this.keyLoader=i,this.fragmentTracker=e,this.config=t.config,this.decrypter=new Vl(t.config),t.on(m.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(t){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const t=this.fragCurrent;t!=null&&t.loader&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=_.STOPPED}_streamEnded(t,e){if(e.live||t.nextStart||!t.end||!this.media)return!1;const i=e.partList;if(i!=null&&i.length){const a=i[i.length-1];return rt.isBuffered(this.media,a.start+a.duration/2)}const s=e.fragments[e.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(s)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var t;return(t=this.levels[this.levelLastLoaded])==null?void 0:t.details}}onMediaAttached(t,e){const i=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),i.addEventListener("seeking",this.onvseeking),i.addEventListener("ended",this.onvended);const s=this.config;this.levels&&s.autoStartLoad&&this.state===_.STOPPED&&this.startLoad(s.startPosition)}onMediaDetaching(){const t=this.media;t!=null&&t.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),t&&this.onvseeking&&this.onvended&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:t,fragCurrent:e,media:i,mediaBuffer:s,state:a}=this,n=i?i.currentTime:0,o=rt.bufferInfo(s||i,n,t.maxBufferHole);if(this.log(`media seeking to ${B(n)?n.toFixed(3):n}, state: ${a}`),this.state===_.ENDED)this.resetLoadingState();else if(e){const l=t.maxFragLookUpTolerance,u=e.start-l,c=e.start+e.duration+l;if(!o.len||c<o.start||u>o.end){const d=n>c;(n<u||d)&&(d&&e.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),e.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}i&&(this.fragmentTracker.removeFragmentsInRange(n,1/0,this.playlistType,!0),this.lastCurrentTime=n),!this.loadedmetadata&&!o.len&&(this.nextLoadPosition=this.startPosition=n),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(t,e){this.startTimeOffset=e.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.stopLoad(),super.onHandlerDestroying()}onHandlerDestroyed(){this.state=_.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(t,e,i){this._loadFragForPlayback(t,e,i)}_loadFragForPlayback(t,e,i){const s=a=>{if(this.fragContextChanged(t)){this.warn(`Fragment ${t.sn}${a.part?" p: "+a.part.index:""} of level ${t.level} was dropped during download.`),this.fragmentTracker.removeFragment(t);return}t.stats.chunkCount++,this._handleFragmentLoadProgress(a)};this._doFragLoad(t,e,i,s).then(a=>{if(!a)return;const n=this.state;if(this.fragContextChanged(t)){(n===_.FRAG_LOADING||!this.fragCurrent&&n===_.PARSING)&&(this.fragmentTracker.removeFragment(t),this.state=_.IDLE);return}"payload"in a&&(this.log(`Loaded fragment ${t.sn} of level ${t.level}`),this.hls.trigger(m.FRAG_LOADED,a)),this._handleFragmentLoadComplete(a)}).catch(a=>{this.state===_.STOPPED||this.state===_.ERROR||(this.warn(a),this.resetFragmentLoading(t))})}clearTrackerIfNeeded(t){var e;const{fragmentTracker:i}=this;if(i.getState(t)===kt.APPENDING){const s=t.type,a=this.getFwdBufferInfo(this.mediaBuffer,s),n=Math.max(t.duration,a?a.len:this.config.maxBufferLength);this.reduceMaxBufferLength(n)&&i.removeFragment(t)}else((e=this.mediaBuffer)==null?void 0:e.buffered.length)===0?i.removeAllFragments():i.hasParts(t.type)&&(i.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type}),i.getState(t)===kt.PARTIAL&&i.removeFragment(t))}flushMainBuffer(t,e,i=null){if(!(t-e))return;const s={startOffset:t,endOffset:e,type:i};this.hls.trigger(m.BUFFER_FLUSHING,s)}_loadInitSegment(t,e){this._doFragLoad(t,e).then(i=>{if(!i||this.fragContextChanged(t)||!this.levels)throw new Error("init load aborted");return i}).then(i=>{const{hls:s}=this,{payload:a}=i,n=t.decryptdata;if(a&&a.byteLength>0&&n&&n.key&&n.iv&&n.method==="AES-128"){const o=self.performance.now();return this.decrypter.decrypt(new Uint8Array(a),n.key.buffer,n.iv.buffer).catch(l=>{throw s.trigger(m.ERROR,{type:$.MEDIA_ERROR,details:I.FRAG_DECRYPT_ERROR,fatal:!1,error:l,reason:l.message,frag:t}),l}).then(l=>{const u=self.performance.now();return s.trigger(m.FRAG_DECRYPTED,{frag:t,payload:l,stats:{tstart:o,tdecrypt:u}}),i.payload=l,i})}return i}).then(i=>{const{fragCurrent:s,hls:a,levels:n}=this;if(!n)throw new Error("init load aborted, missing levels");const o=t.stats;this.state=_.IDLE,e.fragmentError=0,t.data=new Uint8Array(i.payload),o.parsing.start=o.buffering.start=self.performance.now(),o.parsing.end=o.buffering.end=self.performance.now(),i.frag===s&&a.trigger(m.FRAG_BUFFERED,{stats:o,frag:s,part:null,id:t.type}),this.tick()}).catch(i=>{this.state===_.STOPPED||this.state===_.ERROR||(this.warn(i),this.resetFragmentLoading(t))})}fragContextChanged(t){const{fragCurrent:e}=this;return!t||!e||t.level!==e.level||t.sn!==e.sn||t.urlId!==e.urlId}fragBufferedComplete(t,e){var i,s,a,n;const o=this.mediaBuffer?this.mediaBuffer:this.media;this.log(`Buffered ${t.type} sn: ${t.sn}${e?" part: "+e.index:""} of ${this.playlistType===G.MAIN?"level":"track"} ${t.level} (frag:[${((i=t.startPTS)!=null?i:NaN).toFixed(3)}-${((s=t.endPTS)!=null?s:NaN).toFixed(3)}] > buffer:${o?oy.toString(rt.getBuffered(o)):"(detached)"})`),this.state=_.IDLE,o&&(!this.loadedmetadata&&t.type==G.MAIN&&o.buffered.length&&((a=this.fragCurrent)==null?void 0:a.sn)===((n=this.fragPrevious)==null?void 0:n.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(t){const{transmuxer:e}=this;if(!e)return;const{frag:i,part:s,partsLoaded:a}=t,n=!a||a.length===0||a.some(l=>!l),o=new Gl(i.level,i.sn,i.stats.chunkCount+1,0,s?s.index:-1,!n);e.flush(o)}_handleFragmentLoadProgress(t){}_doFragLoad(t,e,i=null,s){var a;const n=e==null?void 0:e.details;if(!this.levels||!n)throw new Error(`frag load aborted, missing level${n?"":" detail"}s`);let o=null;if(t.encrypted&&!((a=t.decryptdata)!=null&&a.key)?(this.log(`Loading key for ${t.sn} of [${n.startSN}-${n.endSN}], ${this.logPrefix==="[stream-controller]"?"level":"track"} ${t.level}`),this.state=_.KEY_LOADING,this.fragCurrent=t,o=this.keyLoader.load(t).then(c=>{if(!this.fragContextChanged(c.frag))return this.hls.trigger(m.KEY_LOADED,c),this.state===_.KEY_LOADING&&(this.state=_.IDLE),c}),this.hls.trigger(m.KEY_LOADING,{frag:t}),this.fragCurrent===null&&(o=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!t.encrypted&&n.encryptedFragments.length&&this.keyLoader.loadClear(t,n.encryptedFragments),i=Math.max(t.start,i||0),this.config.lowLatencyMode&&t.sn!=="initSegment"){const c=n.partList;if(c&&s){i>t.end&&n.fragmentHint&&(t=n.fragmentHint);const d=this.getNextPart(c,t,i);if(d>-1){const h=c[d];this.log(`Loading part sn: ${t.sn} p: ${h.index} cc: ${t.cc} of playlist [${n.startSN}-${n.endSN}] parts [0-${d}-${c.length-1}] ${this.logPrefix==="[stream-controller]"?"level":"track"}: ${t.level}, target: ${parseFloat(i.toFixed(3))}`),this.nextLoadPosition=h.start+h.duration,this.state=_.FRAG_LOADING;let f;return o?f=o.then(g=>!g||this.fragContextChanged(g.frag)?null:this.doFragPartsLoad(t,h,e,s)).catch(g=>this.handleFragLoadError(g)):f=this.doFragPartsLoad(t,h,e,s).catch(g=>this.handleFragLoadError(g)),this.hls.trigger(m.FRAG_LOADING,{frag:t,part:h,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):f}else if(!t.url||this.loadedEndOfParts(c,i))return Promise.resolve(null)}}this.log(`Loading fragment ${t.sn} cc: ${t.cc} ${n?"of ["+n.startSN+"-"+n.endSN+"] ":""}${this.logPrefix==="[stream-controller]"?"level":"track"}: ${t.level}, target: ${parseFloat(i.toFixed(3))}`),B(t.sn)&&!this.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),this.state=_.FRAG_LOADING;const l=this.config.progressive;let u;return l&&o?u=o.then(c=>!c||this.fragContextChanged(c==null?void 0:c.frag)?null:this.fragmentLoader.load(t,s)).catch(c=>this.handleFragLoadError(c)):u=Promise.all([this.fragmentLoader.load(t,l?s:void 0),o]).then(([c])=>(!l&&c&&s&&s(c),c)).catch(c=>this.handleFragLoadError(c)),this.hls.trigger(m.FRAG_LOADING,{frag:t,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):u}doFragPartsLoad(t,e,i,s){return new Promise((a,n)=>{var o;const l=[],u=(o=i.details)==null?void 0:o.partList,c=d=>{this.fragmentLoader.loadPart(t,d,s).then(h=>{l[d.index]=h;const f=h.part;this.hls.trigger(m.FRAG_LOADED,h);const g=wc(i,t.sn,d.index+1)||xf(u,t.sn,d.index+1);if(g)c(g);else return a({frag:t,part:f,partsLoaded:l})}).catch(n)};c(e)})}handleFragLoadError(t){if("data"in t){const e=t.data;t.data&&e.details===I.INTERNAL_ABORTED?this.handleFragLoadAborted(e.frag,e.part):this.hls.trigger(m.ERROR,e)}else this.hls.trigger(m.ERROR,{type:$.OTHER_ERROR,details:I.INTERNAL_EXCEPTION,err:t,error:t,fatal:!0});return null}_handleTransmuxerFlush(t){const e=this.getCurrentContext(t);if(!e||this.state!==_.PARSING){!this.fragCurrent&&this.state!==_.STOPPED&&this.state!==_.ERROR&&(this.state=_.IDLE);return}const{frag:i,part:s,level:a}=e,n=self.performance.now();i.stats.parsing.end=n,s&&(s.stats.parsing.end=n),this.updateLevelTiming(i,s,a,t.partial)}getCurrentContext(t){const{levels:e,fragCurrent:i}=this,{level:s,sn:a,part:n}=t;if(!(e!=null&&e[s]))return this.warn(`Levels object was unset while buffering fragment ${a} of level ${s}. The current chunk will not be buffered.`),null;const o=e[s],l=n>-1?wc(o,a,n):null,u=l?l.fragment:N0(o,a,i);return u?(i&&i!==u&&(u.stats=i.stats),{frag:u,part:l,level:o}):null}bufferFragmentData(t,e,i,s){var a;if(!t||this.state!==_.PARSING)return;const{data1:n,data2:o}=t;let l=n;if(n&&o&&(l=Rr(n,o)),!((a=l)!=null&&a.length))return;const u={type:t.type,frag:e,part:i,chunkMeta:s,parent:e.type,data:l};this.hls.trigger(m.BUFFER_APPENDING,u),t.dropped&&t.independent&&!i&&this.flushBufferGap(e)}flushBufferGap(t){const e=this.media;if(!e)return;if(!rt.isBuffered(e,e.currentTime)){this.flushMainBuffer(0,t.start);return}const i=e.currentTime,s=rt.bufferInfo(e,i,0),a=t.duration,n=Math.min(this.config.maxFragLookUpTolerance*2,a*.25),o=Math.max(Math.min(t.start-n,s.end-n),i+n);t.start-o>n&&this.flushMainBuffer(o,t.start)}getFwdBufferInfo(t,e){const i=this.getLoadPosition();return B(i)?this.getFwdBufferInfoAtPos(t,i,e):null}getFwdBufferInfoAtPos(t,e,i){const{config:{maxBufferHole:s}}=this,a=rt.bufferInfo(t,e,s);if(a.len===0&&a.nextStart!==void 0){const n=this.fragmentTracker.getBufferedFrag(e,i);if(n&&a.nextStart<n.end)return rt.bufferInfo(t,e,Math.max(a.nextStart,s))}return a}getMaxBufferLength(t){const{config:e}=this;let i;return t?i=Math.max(8*e.maxBufferSize/t,e.maxBufferLength):i=e.maxBufferLength,Math.min(i,e.maxMaxBufferLength)}reduceMaxBufferLength(t){const e=this.config,i=t||e.maxBufferLength;return e.maxMaxBufferLength>=i?(e.maxMaxBufferLength/=2,this.warn(`Reduce max buffer length to ${e.maxMaxBufferLength}s`),!0):!1}getAppendedFrag(t,e=G.MAIN){const i=this.fragmentTracker.getAppendedFrag(t,G.MAIN);return i&&"fragment"in i?i.fragment:i}getNextFragment(t,e){const i=e.fragments,s=i.length;if(!s)return null;const{config:a}=this,n=i[0].start;let o;if(e.live){const l=a.initialLiveManifestSize;if(s<l)return this.warn(`Not enough fragments to start playback (have: ${s}, need: ${l})`),null;!e.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(o=this.getInitialLiveFragment(e,i),this.startPosition=o?this.hls.liveSyncPosition||o.start:t)}else t<=n&&(o=i[0]);if(!o){const l=a.lowLatencyMode?e.partEnd:e.fragmentEnd;o=this.getFragmentAtPosition(t,l,e)}return this.mapToInitFragWhenRequired(o)}isLoopLoading(t,e){const i=this.fragmentTracker.getState(t);return(i===kt.OK||i===kt.PARTIAL&&!!t.gap)&&this.nextLoadPosition>e}getNextFragmentLoopLoading(t,e,i,s,a){const n=t.gap,o=this.getNextFragment(this.nextLoadPosition,e);if(o===null)return o;if(t=o,n&&t&&!t.gap&&i.nextStart){const l=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,s);if(l!==null&&i.len+l.len>=a)return this.log(`buffer full after gaps in "${s}" playlist starting at sn: ${t.sn}`),null}return t}mapToInitFragWhenRequired(t){return t!=null&&t.initSegment&&!(t!=null&&t.initSegment.data)&&!this.bitrateTest?t.initSegment:t}getNextPart(t,e,i){let s=-1,a=!1,n=!0;for(let o=0,l=t.length;o<l;o++){const u=t[o];if(n=n&&!u.independent,s>-1&&i<u.start)break;const c=u.loaded;c?s=-1:(a||u.independent||n)&&u.fragment===e&&(s=o),a=c}return s}loadedEndOfParts(t,e){const i=t[t.length-1];return i&&e>i.start&&i.loaded}getInitialLiveFragment(t,e){const i=this.fragPrevious;let s=null;if(i){if(t.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${i.programDateTime}`),s=B0(e,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){const a=i.sn+1;if(a>=t.startSN&&a<=t.endSN){const n=e[a-t.startSN];i.cc===n.cc&&(s=n,this.log(`Live playlist, switching playlist, load frag with next SN: ${s.sn}`))}s||(s=G0(e,i.cc),s&&this.log(`Live playlist, switching playlist, load frag with same CC: ${s.sn}`))}}else{const a=this.hls.liveSyncPosition;a!==null&&(s=this.getFragmentAtPosition(a,this.bitrateTest?t.fragmentEnd:t.edge,t))}return s}getFragmentAtPosition(t,e,i){const{config:s}=this;let{fragPrevious:a}=this,{fragments:n,endSN:o}=i;const{fragmentHint:l}=i,u=s.maxFragLookUpTolerance,c=i.partList,d=!!(s.lowLatencyMode&&c!=null&&c.length&&l);d&&l&&!this.bitrateTest&&(n=n.concat(l),o=l.sn);let h;if(t<e){const f=t>e-u?0:u;h=ts(a,n,t,f)}else h=n[n.length-1];if(h){const f=h.sn-i.startSN,g=this.fragmentTracker.getState(h);if((g===kt.OK||g===kt.PARTIAL&&h.gap)&&(a=h),a&&h.sn===a.sn&&(!d||c[0].fragment.sn>h.sn)&&a&&h.level===a.level){const p=n[f+1];h.sn<o&&this.fragmentTracker.getState(p)!==kt.OK?h=p:h=null}}return h}synchronizeToLiveEdge(t){const{config:e,media:i}=this;if(!i)return;const s=this.hls.liveSyncPosition,a=i.currentTime,n=t.fragments[0].start,o=t.edge,l=a>=n-e.maxFragLookUpTolerance&&a<=o;if(s!==null&&i.duration>s&&(a<s||!l)){const u=e.liveMaxLatencyDuration!==void 0?e.liveMaxLatencyDuration:e.liveMaxLatencyDurationCount*t.targetduration;(!l&&i.readyState<4||a<o-u)&&(this.loadedmetadata||(this.nextLoadPosition=s),i.readyState&&(this.warn(`Playback: ${a.toFixed(3)} is located too far from the end of live sliding playlist: ${o}, reset currentTime to : ${s.toFixed(3)}`),i.currentTime=s))}}alignPlaylists(t,e){const{levels:i,levelLastLoaded:s,fragPrevious:a}=this,n=s!==null?i[s]:null,o=t.fragments.length;if(!o)return this.warn("No fragments in live playlist"),0;const l=t.fragments[0].start,u=!e,c=t.alignedSliding&&B(l);if(u||!c&&!l){Z0(a,n,t);const d=t.fragments[0].start;return this.log(`Live playlist sliding: ${d.toFixed(2)} start-sn: ${e?e.startSN:"na"}->${t.startSN} prev-sn: ${a?a.sn:"na"} fragments: ${o}`),d}return l}waitForCdnTuneIn(t){return t.live&&t.canBlockReload&&t.partTarget&&t.tuneInGoal>Math.max(t.partHoldBack,t.partTarget*3)}setStartPosition(t,e){let i=this.startPosition;if(i<e&&(i=-1),i===-1||this.lastCurrentTime===-1){const s=this.startTimeOffset!==null,a=s?this.startTimeOffset:t.startTimeOffset;a!==null&&B(a)?(i=e+a,a<0&&(i+=t.totalduration),i=Math.min(Math.max(e,i),e+t.totalduration),this.log(`Start time offset ${a} found in ${s?"multivariant":"media"} playlist, adjust startPosition to ${i}`),this.startPosition=i):t.live?i=this.hls.liveSyncPosition||e:this.startPosition=i=0,this.lastCurrentTime=i}this.nextLoadPosition=i}getLoadPosition(){const{media:t}=this;let e=0;return this.loadedmetadata&&t?e=t.currentTime:this.nextLoadPosition&&(e=this.nextLoadPosition),e}handleFragLoadAborted(t,e){this.transmuxer&&t.sn!=="initSegment"&&t.stats.aborted&&(this.warn(`Fragment ${t.sn}${e?" part "+e.index:""} of level ${t.level} was aborted`),this.resetFragmentLoading(t))}resetFragmentLoading(t){(!this.fragCurrent||!this.fragContextChanged(t)&&this.state!==_.FRAG_LOADING_WAITING_RETRY)&&(this.state=_.IDLE)}onFragmentOrKeyLoadError(t,e){if(e.chunkMeta&&!e.frag){const c=this.getCurrentContext(e.chunkMeta);c&&(e.frag=c.frag)}const i=e.frag;if(!i||i.type!==t||!this.levels)return;if(this.fragContextChanged(i)){var s;this.warn(`Frag load error must match current frag to retry ${i.url} > ${(s=this.fragCurrent)==null?void 0:s.url}`);return}const a=e.details===I.FRAG_GAP;a&&this.fragmentTracker.fragBuffered(i,!0);const n=e.errorAction,{action:o,retryCount:l=0,retryConfig:u}=n||{};if(n&&o===Bt.RetryRequest&&u){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);const c=Bl(u,l);this.warn(`Fragment ${i.sn} of ${t} ${i.level} errored with ${e.details}, retrying loading ${l+1}/${u.maxNumRetry} in ${c}ms`),n.resolved=!0,this.retryDate=self.performance.now()+c,this.state=_.FRAG_LOADING_WAITING_RETRY}else u&&n?(this.resetFragmentErrors(t),l<u.maxNumRetry?a||(n.resolved=!0):L.warn(`${e.details} reached or exceeded max retry (${l})`)):this.state=_.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(t){if(this.state===_.PARSING||this.state===_.PARSED){const e=t.parent,i=this.getFwdBufferInfo(this.mediaBuffer,e),s=i&&i.len>.5;s&&this.reduceMaxBufferLength(i.len);const a=!s;return a&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${e} buffer`),t.frag&&(this.fragmentTracker.removeFragment(t.frag),this.nextLoadPosition=t.frag.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(t){t===G.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==_.STOPPED&&(this.state=_.IDLE)}afterBufferFlushed(t,e,i){if(!t)return;const s=rt.getBuffered(t);this.fragmentTracker.detectEvictedFragments(e,s,i),this.state===_.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=_.IDLE}resetStartWhenNotLoaded(t){if(!this.loadedmetadata){this.startFragRequested=!1;const e=this.levels?this.levels[t].details:null;e!=null&&e.live?(this.startPosition=-1,this.setStartPosition(e,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(t){this.warn(`The loading context changed while buffering fragment ${t.sn} of level ${t.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(t.level),this.resetLoadingState()}removeUnbufferedFrags(t=0){this.fragmentTracker.removeFragmentsInRange(t,1/0,this.playlistType,!1,!0)}updateLevelTiming(t,e,i,s){var a;const n=i.details;if(!n){this.warn("level.details undefined");return}if(Object.keys(t.elementaryStreams).reduce((o,l)=>{const u=t.elementaryStreams[l];if(u){const c=u.endPTS-u.startPTS;if(c<=0)return this.warn(`Could not parse fragment ${t.sn} ${l} duration reliably (${c})`),o||!1;const d=s?0:_f(n,t,u.startPTS,u.endPTS,u.startDTS,u.endDTS);return this.hls.trigger(m.LEVEL_PTS_UPDATED,{details:n,level:i,drift:d,type:l,frag:t,start:u.startPTS,end:u.endPTS}),!0}return o},!1))i.fragmentError=0;else if(((a=this.transmuxer)==null?void 0:a.error)===null){const o=new Error(`Found no media in fragment ${t.sn} of level ${i.id} resetting transmuxer to fallback to playlist timing`);if(this.warn(o.message),this.hls.trigger(m.ERROR,{type:$.MEDIA_ERROR,details:I.FRAG_PARSING_ERROR,fatal:!1,error:o,frag:t,reason:`Found no media in msn ${t.sn} of level "${i.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=_.PARSED,this.hls.trigger(m.FRAG_PARSED,{frag:t,part:e})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(t){t.event==="demuxerWorker"&&(this.resetTransmuxer(),this.resetLoadingState())}set state(t){const e=this._state;e!==t&&(this._state=t,this.log(`${e}->${t}`))}get state(){return this._state}}function Nf(){return self.SourceBuffer||self.WebKitSourceBuffer}function ly(){const r=$a();if(!r)return!1;const t=Nf(),e=r&&typeof r.isTypeSupported=="function"&&r.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),i=!t||t.prototype&&typeof t.prototype.appendBuffer=="function"&&typeof t.prototype.remove=="function";return!!e&&!!i}function uy(){var r;const t=Nf();return typeof(t==null||(r=t.prototype)==null?void 0:r.changeType)=="function"}function cy(){return typeof __HLS_WORKER_BUNDLE__=="function"}function dy(){const r=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(r);return{worker:new self.Worker(t),objectURL:t}}function hy(r){const t=new self.URL(r,self.location.href).href;return{worker:new self.Worker(t),scriptURL:t}}function Le(r="",t=9e4){return{type:r,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}class Uf{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(t,e,i,s){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(t){this.initPTS=t,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(t,e){return!1}appendFrame(t,e,i){}demux(t,e){this.cachedData&&(t=Rr(this.cachedData,t),this.cachedData=null);let i=ma(t,0),s=i?i.length:0,a;const n=this._audioTrack,o=this._id3Track,l=i?jm(i):void 0,u=t.length;for((this.basePTS===null||this.frameIndex===0&&B(l))&&(this.basePTS=fy(l,e,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:ge.audioId3,duration:Number.POSITIVE_INFINITY});s<u;){if(this.canParse(t,s)){const c=this.appendFrame(n,t,s);c?(this.frameIndex++,this.lastPTS=c.sample.pts,s+=c.length,a=s):s=u}else Ym(t,s)?(i=ma(t,s),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:ge.audioId3,duration:Number.POSITIVE_INFINITY}),s+=i.length,a=s):s++;if(s===u&&a!==u){const c=Sr(t,a);this.cachedData?this.cachedData=Rr(this.cachedData,c):this.cachedData=c}}return{audioTrack:n,videoTrack:Le(),id3Track:o,textTrack:Le()}}demuxSampleAes(t,e,i){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(t){const e=this.cachedData;return e&&(this.cachedData=null,this.demux(e,0)),{audioTrack:this._audioTrack,videoTrack:Le(),id3Track:this._id3Track,textTrack:Le()}}destroy(){}}const fy=(r,t,e)=>{if(B(r))return r*90;const i=e?e.baseTime*9e4/e.timescale:0;return t*9e4+i};function gy(r,t,e,i){let s,a,n,o;const l=navigator.userAgent.toLowerCase(),u=i,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];s=((t[e+2]&192)>>>6)+1;const d=(t[e+2]&60)>>>2;if(d>c.length-1){r.trigger(m.ERROR,{type:$.MEDIA_ERROR,details:I.FRAG_PARSING_ERROR,fatal:!0,reason:`invalid ADTS sampling index:${d}`});return}return n=(t[e+2]&1)<<2,n|=(t[e+3]&192)>>>6,L.log(`manifest codec:${i}, ADTS type:${s}, samplingIndex:${d}`),/firefox/i.test(l)?d>=6?(s=5,o=new Array(4),a=d-3):(s=2,o=new Array(2),a=d):l.indexOf("android")!==-1?(s=2,o=new Array(2),a=d):(s=5,o=new Array(4),i&&(i.indexOf("mp4a.40.29")!==-1||i.indexOf("mp4a.40.5")!==-1)||!i&&d>=6?a=d-3:((i&&i.indexOf("mp4a.40.2")!==-1&&(d>=6&&n===1||/vivaldi/i.test(l))||!i&&n===1)&&(s=2,o=new Array(2)),a=d)),o[0]=s<<3,o[0]|=(d&14)>>1,o[1]|=(d&1)<<7,o[1]|=n<<3,s===5&&(o[1]|=(a&14)>>1,o[2]=(a&1)<<7,o[2]|=2<<2,o[3]=0),{config:o,samplerate:c[d],channelCount:n,codec:"mp4a.40."+s,manifestCodec:u}}function Bf(r,t){return r[t]===255&&(r[t+1]&246)===240}function $f(r,t){return r[t+1]&1?7:9}function zl(r,t){return(r[t+3]&3)<<11|r[t+4]<<3|(r[t+5]&224)>>>5}function py(r,t){return t+5<r.length}function Sa(r,t){return t+1<r.length&&Bf(r,t)}function my(r,t){return py(r,t)&&Bf(r,t)&&zl(r,t)<=r.length-t}function yy(r,t){if(Sa(r,t)){const e=$f(r,t);if(t+e>=r.length)return!1;const i=zl(r,t);if(i<=e)return!1;const s=t+i;return s===r.length||Sa(r,s)}return!1}function Gf(r,t,e,i,s){if(!r.samplerate){const a=gy(t,e,i,s);if(!a)return;r.config=a.config,r.samplerate=a.samplerate,r.channelCount=a.channelCount,r.codec=a.codec,r.manifestCodec=a.manifestCodec,L.log(`parsed codec:${r.codec}, rate:${a.samplerate}, channels:${a.channelCount}`)}}function Kf(r){return 1024*9e4/r}function vy(r,t){const e=$f(r,t);if(t+e<=r.length){const i=zl(r,t)-e;if(i>0)return{headerLength:e,frameLength:i}}}function Vf(r,t,e,i,s){const a=Kf(r.samplerate),n=i+s*a,o=vy(t,e);let l;if(o){const{frameLength:c,headerLength:d}=o,h=d+c,f=Math.max(0,e+h-t.length);f?(l=new Uint8Array(h-d),l.set(t.subarray(e+d,t.length),0)):l=t.subarray(e+d,e+h);const g={unit:l,pts:n};return f||r.samples.push(g),{sample:g,length:h,missing:f}}const u=t.length-e;return l=new Uint8Array(u),l.set(t.subarray(e,t.length),0),{sample:{unit:l,pts:n},length:u,missing:-1}}class Ey extends Uf{constructor(t,e){super(),this.observer=void 0,this.config=void 0,this.observer=t,this.config=e}resetInitSegment(t,e,i,s){super.resetInitSegment(t,e,i,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:e,duration:s,inputTimeScale:9e4,dropped:0}}static probe(t){if(!t)return!1;let e=(ma(t,0)||[]).length;for(let i=t.length;e<i;e++)if(yy(t,e))return L.log("ADTS sync word found !"),!0;return!1}canParse(t,e){return my(t,e)}appendFrame(t,e,i){Gf(t,this.observer,e,i,t.manifestCodec);const s=Vf(t,e,i,this.basePTS,this.frameIndex);if(s&&s.missing===0)return s}}const Ty=/\/emsg[-/]ID3/i;class Sy{constructor(t,e){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=e}resetTimeStamp(){}resetInitSegment(t,e,i,s){const a=this.videoTrack=Le("video",1),n=this.audioTrack=Le("audio",1),o=this.txtTrack=Le("text",1);if(this.id3Track=Le("id3",1),this.timeOffset=0,!(t!=null&&t.byteLength))return;const l=kf(t);if(l.video){const{id:u,timescale:c,codec:d}=l.video;a.id=u,a.timescale=o.timescale=c,a.codec=d}if(l.audio){const{id:u,timescale:c,codec:d}=l.audio;n.id=u,n.timescale=c,n.codec=d}o.id=Sf.text,a.sampleDuration=0,a.duration=n.duration=s}resetContiguity(){this.remainderData=null}static probe(t){return t=t.length>16384?t.subarray(0,16384):t,j(t,["moof"]).length>0}demux(t,e){this.timeOffset=e;let i=t;const s=this.videoTrack,a=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=Rr(this.remainderData,t));const o=u0(i);this.remainderData=o.remainder,s.samples=o.valid||new Uint8Array}else s.samples=i;const n=this.extractID3Track(s,e);return a.samples=dc(e,s),{videoTrack:s,audioTrack:this.audioTrack,id3Track:n,textTrack:this.txtTrack}}flush(){const t=this.timeOffset,e=this.videoTrack,i=this.txtTrack;e.samples=this.remainderData||new Uint8Array,this.remainderData=null;const s=this.extractID3Track(e,this.timeOffset);return i.samples=dc(t,e),{videoTrack:e,audioTrack:Le(),id3Track:s,textTrack:Le()}}extractID3Track(t,e){const i=this.id3Track;if(t.samples.length){const s=j(t.samples,["emsg"]);s&&s.forEach(a=>{const n=h0(a);if(Ty.test(n.schemeIdUri)){const o=B(n.presentationTime)?n.presentationTime/n.timeScale:e+n.presentationTimeDelta/n.timeScale;let l=n.eventDuration===4294967295?Number.POSITIVE_INFINITY:n.eventDuration/n.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const u=n.payload;i.samples.push({data:u,len:u.byteLength,dts:o,pts:o,type:ge.emsg,duration:l})}})}return i}demuxSampleAes(t,e,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}}let Rs=null;const by=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Ly=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],ky=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Ay=[0,1,1,4];function Hf(r,t,e,i,s){if(e+24>t.length)return;const a=zf(t,e);if(a&&e+a.frameLength<=t.length){const n=a.samplesPerFrame*9e4/a.sampleRate,o=i+s*n,l={unit:t.subarray(e,e+a.frameLength),pts:o,dts:o};return r.config=[],r.channelCount=a.channelCount,r.samplerate=a.sampleRate,r.samples.push(l),{sample:l,length:a.frameLength,missing:0}}}function zf(r,t){const e=r[t+1]>>3&3,i=r[t+1]>>1&3,s=r[t+2]>>4&15,a=r[t+2]>>2&3;if(e!==1&&s!==0&&s!==15&&a!==3){const n=r[t+2]>>1&1,o=r[t+3]>>6,l=e===3?3-i:i===3?3:4,u=by[l*14+s-1]*1e3,c=Ly[(e===3?0:e===2?1:2)*3+a],d=o===3?1:2,h=ky[e][i],f=Ay[i],g=h*8*f,p=Math.floor(h*u/c+n)*f;if(Rs===null){const T=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Rs=T?parseInt(T[1]):0}return!!Rs&&Rs<=87&&i===2&&u>=224e3&&o===0&&(r[t+3]=r[t+3]|128),{sampleRate:c,channelCount:d,frameLength:p,samplesPerFrame:g}}}function Wl(r,t){return r[t]===255&&(r[t+1]&224)===224&&(r[t+1]&6)!==0}function Wf(r,t){return t+1<r.length&&Wl(r,t)}function wy(r,t){return Wl(r,t)&&4<=r.length-t}function Ry(r,t){if(t+1<r.length&&Wl(r,t)){const e=zf(r,t);let i=4;e!=null&&e.frameLength&&(i=e.frameLength);const s=t+i;return s===r.length||Wf(r,s)}return!1}class Oc{constructor(t){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const t=this.data,e=this.bytesAvailable,i=t.byteLength-e,s=new Uint8Array(4),a=Math.min(4,e);if(a===0)throw new Error("no bytes available");s.set(t.subarray(i,i+a)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=a*8,this.bytesAvailable-=a}skipBits(t){let e;t=Math.min(t,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(t-=this.bitsAvailable,e=t>>3,t-=e<<3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)}readBits(t){let e=Math.min(this.bitsAvailable,t);const i=this.word>>>32-e;if(t>32&&L.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0)this.word<<=e;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return e=t-e,e>0&&this.bitsAvailable?i<<e|this.readBits(e):i}skipLZ(){let t;for(t=0;t<this.bitsAvailable;++t)if((this.word&2147483648>>>t)!==0)return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const t=this.skipLZ();return this.readBits(t+1)-1}readEG(){const t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(t){let e=8,i=8,s;for(let a=0;a<t;a++)i!==0&&(s=this.readEG(),i=(e+s+256)%256),e=i===0?e:i}readSPS(){let t=0,e=0,i=0,s=0,a,n,o;const l=this.readUByte.bind(this),u=this.readBits.bind(this),c=this.readUEG.bind(this),d=this.readBoolean.bind(this),h=this.skipBits.bind(this),f=this.skipEG.bind(this),g=this.skipUEG.bind(this),p=this.skipScalingList.bind(this);l();const T=l();if(u(5),h(3),l(),g(),T===100||T===110||T===122||T===244||T===44||T===83||T===86||T===118||T===128){const w=c();if(w===3&&h(1),g(),g(),h(1),d())for(n=w!==3?8:12,o=0;o<n;o++)d()&&(o<6?p(16):p(64))}g();const y=c();if(y===0)c();else if(y===1)for(h(1),f(),f(),a=c(),o=0;o<a;o++)f();g(),h(1);const v=c(),E=c(),S=u(1);S===0&&h(1),h(1),d()&&(t=c(),e=c(),i=c(),s=c());let b=[1,1];if(d()&&d())switch(l()){case 1:b=[1,1];break;case 2:b=[12,11];break;case 3:b=[10,11];break;case 4:b=[16,11];break;case 5:b=[40,33];break;case 6:b=[24,11];break;case 7:b=[20,11];break;case 8:b=[32,11];break;case 9:b=[80,33];break;case 10:b=[18,11];break;case 11:b=[15,11];break;case 12:b=[64,33];break;case 13:b=[160,99];break;case 14:b=[4,3];break;case 15:b=[3,2];break;case 16:b=[2,1];break;case 255:{b=[l()<<8|l(),l()<<8|l()];break}}return{width:Math.ceil((v+1)*16-t*2-e*2),height:(2-S)*(E+1)*16-(S?2:4)*(i+s),pixelRatio:b}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class Iy{constructor(t,e,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new Vl(e,{removePKCS7Padding:!1})}decryptBuffer(t){return this.decrypter.decrypt(t,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(t,e,i){const s=t[e].unit;if(s.length<=16)return;const a=s.subarray(16,s.length-s.length%16),n=a.buffer.slice(a.byteOffset,a.byteOffset+a.length);this.decryptBuffer(n).then(o=>{const l=new Uint8Array(o);s.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(t,e+1,i)})}decryptAacSamples(t,e,i){for(;;e++){if(e>=t.length){i();return}if(!(t[e].unit.length<32)&&(this.decryptAacSample(t,e,i),!this.decrypter.isSync()))return}}getAvcEncryptedData(t){const e=Math.floor((t.length-48)/160)*16+16,i=new Int8Array(e);let s=0;for(let a=32;a<t.length-16;a+=160,s+=16)i.set(t.subarray(a,a+16),s);return i}getAvcDecryptedUnit(t,e){const i=new Uint8Array(e);let s=0;for(let a=32;a<t.length-16;a+=160,s+=16)t.set(i.subarray(s,s+16),a);return t}decryptAvcSample(t,e,i,s,a){const n=Rf(a.data),o=this.getAvcEncryptedData(n);this.decryptBuffer(o.buffer).then(l=>{a.data=this.getAvcDecryptedUnit(n,l),this.decrypter.isSync()||this.decryptAvcSamples(t,e,i+1,s)})}decryptAvcSamples(t,e,i,s){if(t instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;e++,i=0){if(e>=t.length){s();return}const a=t[e].units;for(;!(i>=a.length);i++){const n=a[i];if(!(n.data.length<=48||n.type!==1&&n.type!==5)&&(this.decryptAvcSample(t,e,i,s,n),!this.decrypter.isSync()))return}}}}const Ct=188;class We{constructor(t,e,i){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=t,this.config=e,this.typeSupported=i}static probe(t){const e=We.syncOffset(t);return e>0&&L.warn(`MPEG2-TS detected but first sync word found @ offset ${e}`),e!==-1}static syncOffset(t){const e=t.length;let i=Math.min(Ct*5,t.length-Ct)+1,s=0;for(;s<i;){let a=!1,n=-1,o=0;for(let l=s;l<e;l+=Ct)if(t[l]===71){if(o++,n===-1&&(n=l,n!==0&&(i=Math.min(n+Ct*99,t.length-Ct)+1)),a||(a=Bo(t,l)===0),a&&o>1&&(n===0&&o>2||l+Ct>i))return n}else{if(o)return-1;break}s++}return-1}static createTrack(t,e){return{container:t==="video"||t==="audio"?"video/mp2t":void 0,type:t,id:Sf[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:t==="audio"?e:void 0}}resetInitSegment(t,e,i,s){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=We.createTrack("video"),this._audioTrack=We.createTrack("audio",s),this._id3Track=We.createTrack("id3"),this._txtTrack=We.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=e,this.videoCodec=i,this._duration=s}resetTimeStamp(){}resetContiguity(){const{_audioTrack:t,_avcTrack:e,_id3Track:i}=this;t&&(t.pesData=null),e&&(e.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null}demux(t,e,i=!1,s=!1){i||(this.sampleAes=null);let a;const n=this._avcTrack,o=this._audioTrack,l=this._id3Track,u=this._txtTrack;let c=n.pid,d=n.pesData,h=o.pid,f=l.pid,g=o.pesData,p=l.pesData,T=null,y=this.pmtParsed,v=this._pmtId,E=t.length;if(this.remainderData&&(t=Rr(this.remainderData,t),E=t.length,this.remainderData=null),E<Ct&&!s)return this.remainderData=t,{audioTrack:o,videoTrack:n,id3Track:l,textTrack:u};const S=Math.max(0,We.syncOffset(t));E-=(E-S)%Ct,E<t.byteLength&&!s&&(this.remainderData=new Uint8Array(t.buffer,E,t.buffer.byteLength-E));let b=0;for(let k=S;k<E;k+=Ct)if(t[k]===71){const D=!!(t[k+1]&64),P=Bo(t,k),R=(t[k+3]&48)>>4;let U;if(R>1){if(U=k+5+t[k+4],U===k+Ct)continue}else U=k+4;switch(P){case c:D&&(d&&(a=Pr(d))&&this.parseAVCPES(n,u,a,!1),d={data:[],size:0}),d&&(d.data.push(t.subarray(U,k+Ct)),d.size+=k+Ct-U);break;case h:if(D){if(g&&(a=Pr(g)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,a);break;case"mp3":this.parseMPEGPES(o,a);break}g={data:[],size:0}}g&&(g.data.push(t.subarray(U,k+Ct)),g.size+=k+Ct-U);break;case f:D&&(p&&(a=Pr(p))&&this.parseID3PES(l,a),p={data:[],size:0}),p&&(p.data.push(t.subarray(U,k+Ct)),p.size+=k+Ct-U);break;case 0:D&&(U+=t[U]+1),v=this._pmtId=Dy(t,U);break;case v:{D&&(U+=t[U]+1);const M=Cy(t,U,this.typeSupported,i);c=M.avc,c>0&&(n.pid=c),h=M.audio,h>0&&(o.pid=h,o.segmentCodec=M.segmentCodec),f=M.id3,f>0&&(l.pid=f),T!==null&&!y&&(L.warn(`MPEG-TS PMT found at ${k} after unknown PID '${T}'. Backtracking to sync byte @${S} to parse all TS packets.`),T=null,k=S-188),y=this.pmtParsed=!0;break}case 17:case 8191:break;default:T=P;break}}else b++;if(b>0){const k=new Error(`Found ${b} TS packet/s that do not start with 0x47`);this.observer.emit(m.ERROR,m.ERROR,{type:$.MEDIA_ERROR,details:I.FRAG_PARSING_ERROR,fatal:!1,error:k,reason:k.message})}n.pesData=d,o.pesData=g,l.pesData=p;const w={audioTrack:o,videoTrack:n,id3Track:l,textTrack:u};return s&&this.extractRemainingSamples(w),w}flush(){const{remainderData:t}=this;this.remainderData=null;let e;return t?e=this.demux(t,-1,!1,!0):e={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e}extractRemainingSamples(t){const{audioTrack:e,videoTrack:i,id3Track:s,textTrack:a}=t,n=i.pesData,o=e.pesData,l=s.pesData;let u;if(n&&(u=Pr(n))?(this.parseAVCPES(i,a,u,!0),i.pesData=null):i.pesData=n,o&&(u=Pr(o))){switch(e.segmentCodec){case"aac":this.parseAACPES(e,u);break;case"mp3":this.parseMPEGPES(e,u);break}e.pesData=null}else o!=null&&o.size&&L.log("last AAC PES packet truncated,might overlap between fragments"),e.pesData=o;l&&(u=Pr(l))?(this.parseID3PES(s,u),s.pesData=null):s.pesData=l}demuxSampleAes(t,e,i){const s=this.demux(t,i,!0,!this.config.progressive),a=this.sampleAes=new Iy(this.observer,this.config,e);return this.decrypt(s,a)}decrypt(t,e){return new Promise(i=>{const{audioTrack:s,videoTrack:a}=t;s.samples&&s.segmentCodec==="aac"?e.decryptAacSamples(s.samples,0,()=>{a.samples?e.decryptAvcSamples(a.samples,0,0,()=>{i(t)}):i(t)}):a.samples&&e.decryptAvcSamples(a.samples,0,0,()=>{i(t)})})}destroy(){this._duration=0}parseAVCPES(t,e,i,s){const a=this.parseAVCNALu(t,i.data);let n=this.avcSample,o,l=!1;i.data=null,n&&a.length&&!t.audFound&&(kn(n,t),n=this.avcSample=Is(!1,i.pts,i.dts,"")),a.forEach(u=>{switch(u.type){case 1:{o=!0,n||(n=this.avcSample=Is(!0,i.pts,i.dts,"")),n.frame=!0;const c=u.data;if(l&&c.length>4){const d=new Oc(c).readSliceType();(d===2||d===4||d===7||d===9)&&(n.key=!0)}break}case 5:o=!0,n||(n=this.avcSample=Is(!0,i.pts,i.dts,"")),n.key=!0,n.frame=!0;break;case 6:{o=!0,wf(u.data,1,i.pts,e.samples);break}case 7:if(o=!0,l=!0,!t.sps){const c=u.data,d=new Oc(c).readSPS();t.width=d.width,t.height=d.height,t.pixelRatio=d.pixelRatio,t.sps=[c],t.duration=this._duration;const h=c.subarray(1,4);let f="avc1.";for(let g=0;g<3;g++){let p=h[g].toString(16);p.length<2&&(p="0"+p),f+=p}t.codec=f}break;case 8:o=!0,t.pps||(t.pps=[u.data]);break;case 9:o=!1,t.audFound=!0,n&&kn(n,t),n=this.avcSample=Is(!1,i.pts,i.dts,"");break;case 12:o=!0;break;default:o=!1,n&&(n.debug+="unknown NAL "+u.type+" ");break}n&&o&&n.units.push(u)}),s&&n&&(kn(n,t),this.avcSample=null)}getLastNalUnit(t){var e;let i=this.avcSample,s;if((!i||i.units.length===0)&&(i=t[t.length-1]),(e=i)!=null&&e.units){const a=i.units;s=a[a.length-1]}return s}parseAVCNALu(t,e){const i=e.byteLength;let s=t.naluState||0;const a=s,n=[];let o=0,l,u,c,d=-1,h=0;for(s===-1&&(d=0,h=e[0]&31,s=0,o=1);o<i;){if(l=e[o++],!s){s=l?0:1;continue}if(s===1){s=l?0:2;continue}if(!l)s=3;else if(l===1){if(d>=0){const f={data:e.subarray(d,o-s-1),type:h};n.push(f)}else{const f=this.getLastNalUnit(t.samples);if(f&&(a&&o<=4-a&&f.state&&(f.data=f.data.subarray(0,f.data.byteLength-a)),u=o-s-1,u>0)){const g=new Uint8Array(f.data.byteLength+u);g.set(f.data,0),g.set(e.subarray(0,u),f.data.byteLength),f.data=g,f.state=0}}o<i?(c=e[o]&31,d=o,h=c,s=0):s=-1}else s=0}if(d>=0&&s>=0){const f={data:e.subarray(d,i),type:h,state:s};n.push(f)}if(n.length===0){const f=this.getLastNalUnit(t.samples);if(f){const g=new Uint8Array(f.data.byteLength+e.byteLength);g.set(f.data,0),g.set(e,f.data.byteLength),f.data=g}}return t.naluState=s,n}parseAACPES(t,e){let i=0;const s=this.aacOverFlow;let a=e.data;if(s){this.aacOverFlow=null;const d=s.missing,h=s.sample.unit.byteLength;if(d===-1){const f=new Uint8Array(h+a.byteLength);f.set(s.sample.unit,0),f.set(a,h),a=f}else{const f=h-d;s.sample.unit.set(a.subarray(0,d),f),t.samples.push(s.sample),i=s.missing}}let n,o;for(n=i,o=a.length;n<o-1&&!Sa(a,n);n++);if(n!==i){let d;const h=n<o-1;h?d=`AAC PES did not start with ADTS header,offset:${n}`:d="No ADTS header found in AAC PES";const f=new Error(d);if(L.warn(`parsing error: ${d}`),this.observer.emit(m.ERROR,m.ERROR,{type:$.MEDIA_ERROR,details:I.FRAG_PARSING_ERROR,fatal:!1,levelRetry:h,error:f,reason:d}),!h)return}Gf(t,this.observer,a,n,this.audioCodec);let l;if(e.pts!==void 0)l=e.pts;else if(s){const d=Kf(t.samplerate);l=s.sample.pts+d}else{L.warn("[tsdemuxer]: AAC PES unknown PTS");return}let u=0,c;for(;n<o;)if(c=Vf(t,a,n,l,u),n+=c.length,c.missing){this.aacOverFlow=c;break}else for(u++;n<o-1&&!Sa(a,n);n++);}parseMPEGPES(t,e){const i=e.data,s=i.length;let a=0,n=0;const o=e.pts;if(o===void 0){L.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;n<s;)if(Wf(i,n)){const l=Hf(t,i,n,o,a);if(l)n+=l.length,a++;else break}else n++}parseID3PES(t,e){if(e.pts===void 0){L.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const i=vt({},e,{type:this._avcTrack?ge.emsg:ge.audioId3,duration:Number.POSITIVE_INFINITY});t.samples.push(i)}}function Is(r,t,e,i){return{key:r,frame:!1,pts:t,dts:e,units:[],debug:i,length:0}}function Bo(r,t){return((r[t+1]&31)<<8)+r[t+2]}function Dy(r,t){return(r[t+10]&31)<<8|r[t+11]}function Cy(r,t,e,i){const s={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},a=(r[t+1]&15)<<8|r[t+2],n=t+3+a-4,o=(r[t+10]&15)<<8|r[t+11];for(t+=12+o;t<n;){const l=Bo(r,t);switch(r[t]){case 207:if(!i){L.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:s.audio===-1&&(s.audio=l);break;case 21:s.id3===-1&&(s.id3=l);break;case 219:if(!i){L.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:s.avc===-1&&(s.avc=l);break;case 3:case 4:e.mpeg!==!0&&e.mp3!==!0?L.log("MPEG audio found, not supported in this browser"):s.audio===-1&&(s.audio=l,s.segmentCodec="mp3");break;case 36:L.warn("Unsupported HEVC stream type found");break}t+=((r[t+3]&15)<<8|r[t+4])+5}return s}function Pr(r){let t=0,e,i,s,a,n;const o=r.data;if(!r||r.size===0)return null;for(;o[0].length<19&&o.length>1;){const l=new Uint8Array(o[0].length+o[1].length);l.set(o[0]),l.set(o[1],o[0].length),o[0]=l,o.splice(1,1)}if(e=o[0],(e[0]<<16)+(e[1]<<8)+e[2]===1){if(i=(e[4]<<8)+e[5],i&&i>r.size-6)return null;const l=e[7];l&192&&(a=(e[9]&14)*536870912+(e[10]&255)*4194304+(e[11]&254)*16384+(e[12]&255)*128+(e[13]&254)/2,l&64?(n=(e[14]&14)*536870912+(e[15]&255)*4194304+(e[16]&254)*16384+(e[17]&255)*128+(e[18]&254)/2,a-n>60*9e4&&(L.warn(`${Math.round((a-n)/9e4)}s delta between PTS and DTS, align them`),a=n)):n=a),s=e[8];let u=s+9;if(r.size<=u)return null;r.size-=u;const c=new Uint8Array(r.size);for(let d=0,h=o.length;d<h;d++){e=o[d];let f=e.byteLength;if(u)if(u>f){u-=f;continue}else e=e.subarray(u),f-=u,u=0;c.set(e,t),t+=f}return i&&(i-=s+3),{data:c,pts:a,dts:n,len:i}}return null}function kn(r,t){if(r.units.length&&r.frame){if(r.pts===void 0){const e=t.samples,i=e.length;if(i){const s=e[i-1];r.pts=s.pts,r.dts=s.dts}else{t.dropped++;return}}t.samples.push(r)}r.debug.length&&L.log(r.pts+"/"+r.dts+":"+r.debug)}class _y extends Uf{resetInitSegment(t,e,i,s){super.resetInitSegment(t,e,i,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:e,duration:s,inputTimeScale:9e4,dropped:0}}static probe(t){if(!t)return!1;let e=(ma(t,0)||[]).length;for(let i=t.length;e<i;e++)if(Ry(t,e))return L.log("MPEG Audio sync word found !"),!0;return!1}canParse(t,e){return wy(t,e)}appendFrame(t,e,i){if(this.basePTS!==null)return Hf(t,e,i,this.basePTS,this.frameIndex)}}class Fc{static getSilentFrame(t,e){switch(t){case"mp4a.40.2":if(e===1)return new Uint8Array([0,200,0,128,35,128]);if(e===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(e===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(e===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(e===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(e===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(e===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(e===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(e===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Ve=Math.pow(2,32)-1;class A{static init(){A.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let t;for(t in A.types)A.types.hasOwnProperty(t)&&(A.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);const e=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);A.HDLR_TYPES={video:e,audio:i};const s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);A.STTS=A.STSC=A.STCO=a,A.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),A.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),A.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),A.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const n=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);A.FTYP=A.box(A.types.ftyp,n,l,n,o),A.DINF=A.box(A.types.dinf,A.box(A.types.dref,s))}static box(t,...e){let i=8,s=e.length;const a=s;for(;s--;)i+=e[s].byteLength;const n=new Uint8Array(i);for(n[0]=i>>24&255,n[1]=i>>16&255,n[2]=i>>8&255,n[3]=i&255,n.set(t,4),s=0,i=8;s<a;s++)n.set(e[s],i),i+=e[s].byteLength;return n}static hdlr(t){return A.box(A.types.hdlr,A.HDLR_TYPES[t])}static mdat(t){return A.box(A.types.mdat,t)}static mdhd(t,e){e*=t;const i=Math.floor(e/(Ve+1)),s=Math.floor(e%(Ve+1));return A.box(A.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,i>>24,i>>16&255,i>>8&255,i&255,s>>24,s>>16&255,s>>8&255,s&255,85,196,0,0]))}static mdia(t){return A.box(A.types.mdia,A.mdhd(t.timescale,t.duration),A.hdlr(t.type),A.minf(t))}static mfhd(t){return A.box(A.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]))}static minf(t){return t.type==="audio"?A.box(A.types.minf,A.box(A.types.smhd,A.SMHD),A.DINF,A.stbl(t)):A.box(A.types.minf,A.box(A.types.vmhd,A.VMHD),A.DINF,A.stbl(t))}static moof(t,e,i){return A.box(A.types.moof,A.mfhd(t),A.traf(i,e))}static moov(t){let e=t.length;const i=[];for(;e--;)i[e]=A.trak(t[e]);return A.box.apply(null,[A.types.moov,A.mvhd(t[0].timescale,t[0].duration)].concat(i).concat(A.mvex(t)))}static mvex(t){let e=t.length;const i=[];for(;e--;)i[e]=A.trex(t[e]);return A.box.apply(null,[A.types.mvex,...i])}static mvhd(t,e){e*=t;const i=Math.floor(e/(Ve+1)),s=Math.floor(e%(Ve+1)),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,i>>24,i>>16&255,i>>8&255,i&255,s>>24,s>>16&255,s>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return A.box(A.types.mvhd,a)}static sdtp(t){const e=t.samples||[],i=new Uint8Array(4+e.length);let s,a;for(s=0;s<e.length;s++)a=e[s].flags,i[s+4]=a.dependsOn<<4|a.isDependedOn<<2|a.hasRedundancy;return A.box(A.types.sdtp,i)}static stbl(t){return A.box(A.types.stbl,A.stsd(t),A.box(A.types.stts,A.STTS),A.box(A.types.stsc,A.STSC),A.box(A.types.stsz,A.STSZ),A.box(A.types.stco,A.STCO))}static avc1(t){let e=[],i=[],s,a,n;for(s=0;s<t.sps.length;s++)a=t.sps[s],n=a.byteLength,e.push(n>>>8&255),e.push(n&255),e=e.concat(Array.prototype.slice.call(a));for(s=0;s<t.pps.length;s++)a=t.pps[s],n=a.byteLength,i.push(n>>>8&255),i.push(n&255),i=i.concat(Array.prototype.slice.call(a));const o=A.box(A.types.avcC,new Uint8Array([1,e[3],e[4],e[5],255,224|t.sps.length].concat(e).concat([t.pps.length]).concat(i))),l=t.width,u=t.height,c=t.pixelRatio[0],d=t.pixelRatio[1];return A.box(A.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,u>>8&255,u&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,A.box(A.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),A.box(A.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,c&255,d>>24,d>>16&255,d>>8&255,d&255])))}static esds(t){const e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))}static mp4a(t){const e=t.samplerate;return A.box(A.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,e>>8&255,e&255,0,0]),A.box(A.types.esds,A.esds(t)))}static mp3(t){const e=t.samplerate;return A.box(A.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,e>>8&255,e&255,0,0]))}static stsd(t){return t.type==="audio"?t.segmentCodec==="mp3"&&t.codec==="mp3"?A.box(A.types.stsd,A.STSD,A.mp3(t)):A.box(A.types.stsd,A.STSD,A.mp4a(t)):A.box(A.types.stsd,A.STSD,A.avc1(t))}static tkhd(t){const e=t.id,i=t.duration*t.timescale,s=t.width,a=t.height,n=Math.floor(i/(Ve+1)),o=Math.floor(i%(Ve+1));return A.box(A.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255,o>>24,o>>16&255,o>>8&255,o&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,s&255,0,0,a>>8&255,a&255,0,0]))}static traf(t,e){const i=A.sdtp(t),s=t.id,a=Math.floor(e/(Ve+1)),n=Math.floor(e%(Ve+1));return A.box(A.types.traf,A.box(A.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255])),A.box(A.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,n>>24,n>>16&255,n>>8&255,n&255])),A.trun(t,i.length+16+20+8+16+8+8),i)}static trak(t){return t.duration=t.duration||4294967295,A.box(A.types.trak,A.tkhd(t),A.mdia(t))}static trex(t){const e=t.id;return A.box(A.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(t,e){const i=t.samples||[],s=i.length,a=12+16*s,n=new Uint8Array(a);let o,l,u,c,d,h;for(e+=8+a,n.set([t.type==="video"?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,s&255,e>>>24&255,e>>>16&255,e>>>8&255,e&255],0),o=0;o<s;o++)l=i[o],u=l.duration,c=l.size,d=l.flags,h=l.cts,n.set([u>>>24&255,u>>>16&255,u>>>8&255,u&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,d.degradPrio&240<<8,d.degradPrio&15,h>>>24&255,h>>>16&255,h>>>8&255,h&255],12+16*o);return A.box(A.types.trun,n)}static initSegment(t){A.types||A.init();const e=A.moov(t),i=new Uint8Array(A.FTYP.byteLength+e.byteLength);return i.set(A.FTYP),i.set(e,A.FTYP.byteLength),i}}A.types=void 0;A.HDLR_TYPES=void 0;A.STTS=void 0;A.STSC=void 0;A.STCO=void 0;A.STSZ=void 0;A.VMHD=void 0;A.SMHD=void 0;A.STSD=void 0;A.FTYP=void 0;A.DINF=void 0;const Yf=9e4;function Yl(r,t,e=1,i=!1){const s=r*t*e;return i?Math.round(s):s}function Py(r,t,e=1,i=!1){return Yl(r,t,1/e,i)}function Ei(r,t=!1){return Yl(r,1e3,1/Yf,t)}function xy(r,t=1){return Yl(r,Yf,1/t)}const Oy=10*1e3,Mc=1024,Fy=1152;let Ds=null,An=null;class wn{constructor(t,e,i,s=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=t,this.config=e,this.typeSupported=i,this.ISGenerated=!1,Ds===null){const a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Ds=a?parseInt(a[1]):0}if(An===null){const a=navigator.userAgent.match(/Safari\/(\d+)/i);An=a?parseInt(a[1]):0}}destroy(){}resetTimeStamp(t){L.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=t}resetNextTimestamp(){L.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){L.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1}getVideoStartPts(t){let e=!1;const i=t.reduce((s,a)=>{const n=a.pts-s;return n<-4294967296?(e=!0,ee(s,a.pts)):n>0?s:a.pts},t[0].pts);return e&&L.debug("PTS rollover detected"),i}remux(t,e,i,s,a,n,o,l){let u,c,d,h,f,g,p=a,T=a;const y=t.pid>-1,v=e.pid>-1,E=e.samples.length,S=t.samples.length>0,b=o&&E>0||E>1;if((!y||S)&&(!v||b)||this.ISGenerated||o){this.ISGenerated||(d=this.generateIS(t,e,a,n));const w=this.isVideoContiguous;let k=-1,D;if(b&&(k=My(e.samples),!w&&this.config.forceKeyFrameOnDiscontinuity))if(g=!0,k>0){L.warn(`[mp4-remuxer]: Dropped ${k} out of ${E} video samples due to a missing keyframe`);const P=this.getVideoStartPts(e.samples);e.samples=e.samples.slice(k),e.dropped+=k,T+=(e.samples[0].pts-P)/e.inputTimeScale,D=T}else k===-1&&(L.warn(`[mp4-remuxer]: No keyframe found out of ${E} video samples`),g=!1);if(this.ISGenerated){if(S&&b){const P=this.getVideoStartPts(e.samples),R=(ee(t.samples[0].pts,P)-P)/e.inputTimeScale;p+=Math.max(0,R),T+=Math.max(0,-R)}if(S){if(t.samplerate||(L.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),d=this.generateIS(t,e,a,n)),c=this.remuxAudio(t,p,this.isAudioContiguous,n,v||b||l===G.AUDIO?T:void 0),b){const P=c?c.endPTS-c.startPTS:0;e.inputTimeScale||(L.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),d=this.generateIS(t,e,a,n)),u=this.remuxVideo(e,T,w,P)}}else b&&(u=this.remuxVideo(e,T,w,0));u&&(u.firstKeyFrame=k,u.independent=k!==-1,u.firstKeyFramePTS=D)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(f=jf(i,a,this._initPTS,this._initDTS)),s.samples.length&&(h=qf(s,a,this._initPTS))),{audio:c,video:u,initSegment:d,independent:g,text:h,id3:f}}generateIS(t,e,i,s){const a=t.samples,n=e.samples,o=this.typeSupported,l={},u=this._initPTS;let c=!u||s,d="audio/mp4",h,f,g;if(c&&(h=f=1/0),t.config&&a.length){switch(t.timescale=t.samplerate,t.segmentCodec){case"mp3":o.mpeg?(d="audio/mpeg",t.codec=""):o.mp3&&(t.codec="mp3");break}l.audio={id:"audio",container:d,codec:t.codec,initSegment:t.segmentCodec==="mp3"&&o.mpeg?new Uint8Array(0):A.initSegment([t]),metadata:{channelCount:t.channelCount}},c&&(g=t.inputTimeScale,!u||g!==u.timescale?h=f=a[0].pts-Math.round(g*i):c=!1)}if(e.sps&&e.pps&&n.length&&(e.timescale=e.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:e.codec,initSegment:A.initSegment([e]),metadata:{width:e.width,height:e.height}},c))if(g=e.inputTimeScale,!u||g!==u.timescale){const p=this.getVideoStartPts(n),T=Math.round(g*i);f=Math.min(f,ee(n[0].dts,p)-T),h=Math.min(h,p-T)}else c=!1;if(Object.keys(l).length)return this.ISGenerated=!0,c?(this._initPTS={baseTime:h,timescale:g},this._initDTS={baseTime:f,timescale:g}):h=g=void 0,{tracks:l,initPTS:h,timescale:g}}remuxVideo(t,e,i,s){const a=t.inputTimeScale,n=t.samples,o=[],l=n.length,u=this._initPTS;let c=this.nextAvcDts,d=8,h=this.videoSampleDuration,f,g,p=Number.POSITIVE_INFINITY,T=Number.NEGATIVE_INFINITY,y=!1;if(!i||c===null){const C=e*a,x=n[0].pts-ee(n[0].dts,n[0].pts);c=C-x}const v=u.baseTime*a/u.timescale;for(let C=0;C<l;C++){const x=n[C];x.pts=ee(x.pts-v,c),x.dts=ee(x.dts-v,c),x.dts<n[C>0?C-1:C].dts&&(y=!0)}y&&n.sort(function(C,x){const F=C.dts-x.dts,K=C.pts-x.pts;return F||K}),f=n[0].dts,g=n[n.length-1].dts;const E=g-f,S=E?Math.round(E/(l-1)):h||t.inputTimeScale/30;if(i){const C=f-c,x=C>S,F=C<-1;if((x||F)&&(x?L.warn(`AVC: ${Ei(C,!0)} ms (${C}dts) hole between fragments detected, filling it`):L.warn(`AVC: ${Ei(-C,!0)} ms (${C}dts) overlapping between fragments detected`),!F||c>=n[0].pts)){f=c;const K=n[0].pts-C;n[0].dts=f,n[0].pts=K,L.log(`Video: First PTS/DTS adjusted: ${Ei(K,!0)}/${Ei(f,!0)}, delta: ${Ei(C,!0)} ms`)}}f=Math.max(0,f);let b=0,w=0;for(let C=0;C<l;C++){const x=n[C],F=x.units,K=F.length;let z=0;for(let Et=0;Et<K;Et++)z+=F[Et].data.length;w+=z,b+=K,x.length=z,x.dts=Math.max(x.dts,f),p=Math.min(x.pts,p),T=Math.max(x.pts,T)}g=n[l-1].dts;const k=w+4*b+8;let D;try{D=new Uint8Array(k)}catch(C){this.observer.emit(m.ERROR,m.ERROR,{type:$.MUX_ERROR,details:I.REMUX_ALLOC_ERROR,fatal:!1,error:C,bytes:k,reason:`fail allocating video mdat ${k}`});return}const P=new DataView(D.buffer);P.setUint32(0,k),D.set(A.types.mdat,4);let R=!1,U=Number.POSITIVE_INFINITY,M=Number.POSITIVE_INFINITY,Y=Number.NEGATIVE_INFINITY,pt=Number.NEGATIVE_INFINITY;for(let C=0;C<l;C++){const x=n[C],F=x.units;let K=0;for(let ft=0,Rt=F.length;ft<Rt;ft++){const Zt=F[ft],Ee=Zt.data,Ga=Zt.data.byteLength;P.setUint32(d,Ga),d+=4,D.set(Ee,d),d+=Ga,K+=4+Ga}let z;if(C<l-1)h=n[C+1].dts-x.dts,z=n[C+1].pts-x.pts;else{const ft=this.config,Rt=C>0?x.dts-n[C-1].dts:S;if(z=C>0?x.pts-n[C-1].pts:S,ft.stretchShortVideoTrack&&this.nextAudioPts!==null){const Zt=Math.floor(ft.maxBufferHole*a),Ee=(s?p+s*a:this.nextAudioPts)-x.pts;Ee>Zt?(h=Ee-Rt,h<0?h=Rt:R=!0,L.log(`[mp4-remuxer]: It is approximately ${Ee/90} ms to the next segment; using duration ${h/90} ms for the last video frame.`)):h=Rt}else h=Rt}const Et=Math.round(x.pts-x.dts);U=Math.min(U,h),Y=Math.max(Y,h),M=Math.min(M,z),pt=Math.max(pt,z),o.push(new Nc(x.key,h,K,Et))}if(o.length){if(Ds){if(Ds<70){const C=o[0].flags;C.dependsOn=2,C.isNonSync=0}}else if(An&&pt-M<Y-U&&S/Y<.025&&o[0].cts===0){L.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let C=f;for(let x=0,F=o.length;x<F;x++){const K=C+o[x].duration,z=C+o[x].cts;if(x<F-1){const Et=K+o[x+1].cts;o[x].duration=Et-z}else o[x].duration=x?o[x-1].duration:S;o[x].cts=0,C=K}}}h=R||!h?S:h,this.nextAvcDts=c=g+h,this.videoSampleDuration=h,this.isVideoContiguous=!0;const H=A.moof(t.sequenceNumber++,f,vt({},t,{samples:o})),st="video",Q={data1:H,data2:D,startPTS:p/a,endPTS:(T+h)/a,startDTS:f/a,endDTS:c/a,type:st,hasAudio:!1,hasVideo:!0,nb:o.length,dropped:t.dropped};return t.samples=[],t.dropped=0,Q}remuxAudio(t,e,i,s,a){const n=t.inputTimeScale,o=t.samplerate?t.samplerate:n,l=n/o,u=t.segmentCodec==="aac"?Mc:Fy,c=u*l,d=this._initPTS,h=t.segmentCodec==="mp3"&&this.typeSupported.mpeg,f=[],g=a!==void 0;let p=t.samples,T=h?0:8,y=this.nextAudioPts||-1;const v=e*n,E=d.baseTime*n/d.timescale;if(this.isAudioContiguous=i=i||p.length&&y>0&&(s&&Math.abs(v-y)<9e3||Math.abs(ee(p[0].pts-E,v)-y)<20*c),p.forEach(function(H){H.pts=ee(H.pts-E,v)}),!i||y<0){if(p=p.filter(H=>H.pts>=0),!p.length)return;a===0?y=0:s&&!g?y=Math.max(0,v):y=p[0].pts}if(t.segmentCodec==="aac"){const H=this.config.maxAudioFramesDrift;for(let st=0,Q=y;st<p.length;st++){const C=p[st],x=C.pts,F=x-Q,K=Math.abs(1e3*F/n);if(F<=-H*c&&g)st===0&&(L.warn(`Audio frame @ ${(x/n).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*F/n)} ms.`),this.nextAudioPts=y=Q=x);else if(F>=H*c&&K<Oy&&g){let z=Math.round(F/c);Q=x-z*c,Q<0&&(z--,Q+=c),st===0&&(this.nextAudioPts=y=Q),L.warn(`[mp4-remuxer]: Injecting ${z} audio frame @ ${(Q/n).toFixed(3)}s due to ${Math.round(1e3*F/n)} ms gap.`);for(let Et=0;Et<z;Et++){const ft=Math.max(Q,0);let Rt=Fc.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);Rt||(L.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),Rt=C.unit.subarray()),p.splice(st,0,{unit:Rt,pts:ft}),Q+=c,st++}}C.pts=Q,Q+=c}}let S=null,b=null,w,k=0,D=p.length;for(;D--;)k+=p[D].unit.byteLength;for(let H=0,st=p.length;H<st;H++){const Q=p[H],C=Q.unit;let x=Q.pts;if(b!==null){const K=f[H-1];K.duration=Math.round((x-b)/l)}else if(i&&t.segmentCodec==="aac"&&(x=y),S=x,k>0){k+=T;try{w=new Uint8Array(k)}catch(K){this.observer.emit(m.ERROR,m.ERROR,{type:$.MUX_ERROR,details:I.REMUX_ALLOC_ERROR,fatal:!1,error:K,bytes:k,reason:`fail allocating audio mdat ${k}`});return}h||(new DataView(w.buffer).setUint32(0,k),w.set(A.types.mdat,4))}else return;w.set(C,T);const F=C.byteLength;T+=F,f.push(new Nc(!0,u,F,0)),b=x}const P=f.length;if(!P)return;const R=f[f.length-1];this.nextAudioPts=y=b+l*R.duration;const U=h?new Uint8Array(0):A.moof(t.sequenceNumber++,S/l,vt({},t,{samples:f}));t.samples=[];const M=S/n,Y=y/n,pt={data1:U,data2:w,startPTS:M,endPTS:Y,startDTS:M,endDTS:Y,type:"audio",hasAudio:!0,hasVideo:!1,nb:P};return this.isAudioContiguous=!0,pt}remuxEmptyAudio(t,e,i,s){const a=t.inputTimeScale,n=t.samplerate?t.samplerate:a,o=a/n,l=this.nextAudioPts,u=this._initDTS,c=u.baseTime*9e4/u.timescale,d=(l!==null?l:s.startDTS*a)+c,h=s.endDTS*a+c,f=o*Mc,g=Math.ceil((h-d)/f),p=Fc.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(L.warn("[mp4-remuxer]: remux empty Audio"),!p){L.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}const T=[];for(let y=0;y<g;y++){const v=d+y*f;T.push({unit:p,pts:v,dts:v})}return t.samples=T,this.remuxAudio(t,e,i,!1)}}function ee(r,t){let e;if(t===null)return r;for(t<r?e=-8589934592:e=8589934592;Math.abs(r-t)>4294967296;)r+=e;return r}function My(r){for(let t=0;t<r.length;t++)if(r[t].key)return t;return-1}function jf(r,t,e,i){const s=r.samples.length;if(!s)return;const a=r.inputTimeScale;for(let o=0;o<s;o++){const l=r.samples[o];l.pts=ee(l.pts-e.baseTime*a/e.timescale,t*a)/a,l.dts=ee(l.dts-i.baseTime*a/i.timescale,t*a)/a}const n=r.samples;return r.samples=[],{samples:n}}function qf(r,t,e){const i=r.samples.length;if(!i)return;const s=r.inputTimeScale;for(let n=0;n<i;n++){const o=r.samples[n];o.pts=ee(o.pts-e.baseTime*9e4/e.timescale,t*s)/s}r.samples.sort((n,o)=>n.pts-o.pts);const a=r.samples;return r.samples=[],{samples:a}}class Nc{constructor(t,e,i,s){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=e,this.size=i,this.cts=s,this.flags=new Ny(t)}}class Ny{constructor(t){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=t?2:1,this.isNonSync=t?0:1}}class Uy{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(t){this.initPTS=t,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(t,e,i,s){this.audioCodec=e,this.videoCodec=i,this.generateInitSegment(s0(t,s)),this.emitInitSegment=!0}generateInitSegment(t){let{audioCodec:e,videoCodec:i}=this;if(!(t!=null&&t.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const s=this.initData=kf(t);e||(e=Uc(s.audio,Z.AUDIO)),i||(i=Uc(s.video,Z.VIDEO));const a={};s.audio&&s.video?a.audiovideo={container:"video/mp4",codec:e+","+i,initSegment:t,id:"main"}:s.audio?a.audio={container:"audio/mp4",codec:e,initSegment:t,id:"audio"}:s.video?a.video={container:"video/mp4",codec:i,initSegment:t,id:"main"}:L.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=a}remux(t,e,i,s,a,n){var o,l;let{initPTS:u,lastEndTime:c}=this;const d={audio:void 0,video:void 0,text:s,id3:i,initSegment:void 0};B(c)||(c=this.lastEndTime=a||0);const h=e.samples;if(!(h!=null&&h.length))return d;const f={initPTS:void 0,timescale:1};let g=this.initData;if((o=g)!=null&&o.length||(this.generateInitSegment(h),g=this.initData),!((l=g)!=null&&l.length))return L.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),d;this.emitInitSegment&&(f.tracks=this.initTracks,this.emitInitSegment=!1);const p=n0(h,g),T=a0(g,h),y=T===null?a:T;(By(u,y,a,p)||f.timescale!==u.timescale&&n)&&(f.initPTS=y-a,u&&u.timescale===1&&L.warn(`Adjusting initPTS by ${f.initPTS-u.baseTime}`),this.initPTS=u={baseTime:f.initPTS,timescale:1});const v=t?y-u.baseTime/u.timescale:c,E=v+p;l0(g,h,u.baseTime/u.timescale),p>0?this.lastEndTime=E:(L.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const S=!!g.audio,b=!!g.video;let w="";S&&(w+="audio"),b&&(w+="video");const k={data1:h,startPTS:v,startDTS:v,endPTS:E,endDTS:E,type:w,hasAudio:S,hasVideo:b,nb:1,dropped:0};return d.audio=k.type==="audio"?k:void 0,d.video=k.type!=="audio"?k:void 0,d.initSegment=f,d.id3=jf(i,a,u,u),s.samples.length&&(d.text=qf(s,a,u)),d}}function By(r,t,e,i){if(r===null)return!0;const s=Math.max(i,1),a=t-r.baseTime/r.timescale;return Math.abs(a-e)>s}function Uc(r,t){const e=r==null?void 0:r.codec;return e&&e.length>4?e:e==="hvc1"||e==="hev1"?"hvc1.1.6.L120.90":e==="av01"?"av01.0.04M.08":e==="avc1"||t===Z.VIDEO?"avc1.42e01e":"mp4a.40.5"}let _e;try{_e=self.performance.now.bind(self.performance)}catch{L.debug("Unable to use Performance API on this environment"),_e=typeof self<"u"&&self.Date.now}const Rn=[{demux:Sy,remux:Uy},{demux:We,remux:wn},{demux:Ey,remux:wn},{demux:_y,remux:wn}];class Bc{constructor(t,e,i,s,a){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=t,this.typeSupported=e,this.config=i,this.vendor=s,this.id=a}configure(t){this.transmuxConfig=t,this.decrypter&&this.decrypter.reset()}push(t,e,i,s){const a=i.transmuxing;a.executeStart=_e();let n=new Uint8Array(t);const{currentTransmuxState:o,transmuxConfig:l}=this;s&&(this.currentTransmuxState=s);const{contiguous:u,discontinuity:c,trackSwitch:d,accurateTimeOffset:h,timeOffset:f,initSegmentChange:g}=s||o,{audioCodec:p,videoCodec:T,defaultInitPts:y,duration:v,initSegmentData:E}=l,S=$y(n,e);if(S&&S.method==="AES-128"){const D=this.getDecrypter();if(D.isSync()){let P=D.softwareDecrypt(n,S.key.buffer,S.iv.buffer);if(i.part>-1&&(P=D.flush()),!P)return a.executeEnd=_e(),In(i);n=new Uint8Array(P)}else return this.decryptionPromise=D.webCryptoDecrypt(n,S.key.buffer,S.iv.buffer).then(P=>{const R=this.push(P,null,i);return this.decryptionPromise=null,R}),this.decryptionPromise}const b=this.needsProbing(c,d);if(b){const D=this.configureTransmuxer(n);if(D)return L.warn(`[transmuxer] ${D.message}`),this.observer.emit(m.ERROR,m.ERROR,{type:$.MEDIA_ERROR,details:I.FRAG_PARSING_ERROR,fatal:!1,error:D,reason:D.message}),a.executeEnd=_e(),In(i)}(c||d||g||b)&&this.resetInitSegment(E,p,T,v,e),(c||g||b)&&this.resetInitialTimestamp(y),u||this.resetContiguity();const w=this.transmux(n,S,f,h,i),k=this.currentTransmuxState;return k.contiguous=!0,k.discontinuity=!1,k.trackSwitch=!1,a.executeEnd=_e(),w}flush(t){const e=t.transmuxing;e.executeStart=_e();const{decrypter:i,currentTransmuxState:s,decryptionPromise:a}=this;if(a)return a.then(()=>this.flush(t));const n=[],{timeOffset:o}=s;if(i){const d=i.flush();d&&n.push(this.push(d,null,t))}const{demuxer:l,remuxer:u}=this;if(!l||!u)return e.executeEnd=_e(),[In(t)];const c=l.flush(o);return zs(c)?c.then(d=>(this.flushRemux(n,d,t),n)):(this.flushRemux(n,c,t),n)}flushRemux(t,e,i){const{audioTrack:s,videoTrack:a,id3Track:n,textTrack:o}=e,{accurateTimeOffset:l,timeOffset:u}=this.currentTransmuxState;L.log(`[transmuxer.ts]: Flushed fragment ${i.sn}${i.part>-1?" p: "+i.part:""} of level ${i.level}`);const c=this.remuxer.remux(s,a,n,o,u,l,!0,this.id);t.push({remuxResult:c,chunkMeta:i}),i.transmuxing.executeEnd=_e()}resetInitialTimestamp(t){const{demuxer:e,remuxer:i}=this;!e||!i||(e.resetTimeStamp(t),i.resetTimeStamp(t))}resetContiguity(){const{demuxer:t,remuxer:e}=this;!t||!e||(t.resetContiguity(),e.resetNextTimestamp())}resetInitSegment(t,e,i,s,a){const{demuxer:n,remuxer:o}=this;!n||!o||(n.resetInitSegment(t,e,i,s),o.resetInitSegment(t,e,i,a))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(t,e,i,s,a){let n;return e&&e.method==="SAMPLE-AES"?n=this.transmuxSampleAes(t,e,i,s,a):n=this.transmuxUnencrypted(t,i,s,a),n}transmuxUnencrypted(t,e,i,s){const{audioTrack:a,videoTrack:n,id3Track:o,textTrack:l}=this.demuxer.demux(t,e,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(a,n,o,l,e,i,!1,this.id),chunkMeta:s}}transmuxSampleAes(t,e,i,s,a){return this.demuxer.demuxSampleAes(t,e,i).then(n=>({remuxResult:this.remuxer.remux(n.audioTrack,n.videoTrack,n.id3Track,n.textTrack,i,s,!1,this.id),chunkMeta:a}))}configureTransmuxer(t){const{config:e,observer:i,typeSupported:s,vendor:a}=this;let n;for(let d=0,h=Rn.length;d<h;d++)if(Rn[d].demux.probe(t)){n=Rn[d];break}if(!n)return new Error("Failed to find demuxer by probing fragment data");const o=this.demuxer,l=this.remuxer,u=n.remux,c=n.demux;(!l||!(l instanceof u))&&(this.remuxer=new u(i,e,s,a)),(!o||!(o instanceof c))&&(this.demuxer=new c(i,e,s),this.probe=c.probe)}needsProbing(t,e){return!this.demuxer||!this.remuxer||t||e}getDecrypter(){let t=this.decrypter;return t||(t=this.decrypter=new Vl(this.config)),t}}function $y(r,t){let e=null;return r.byteLength>0&&t!=null&&t.key!=null&&t.iv!==null&&t.method!=null&&(e=t),e}const In=r=>({remuxResult:{},chunkMeta:r});function zs(r){return"then"in r&&r.then instanceof Function}class Gy{constructor(t,e,i,s,a){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=t,this.videoCodec=e,this.initSegmentData=i,this.duration=s,this.defaultInitPts=a||null}}class Ky{constructor(t,e,i,s,a,n){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=t,this.contiguous=e,this.accurateTimeOffset=i,this.trackSwitch=s,this.timeOffset=a,this.initSegmentChange=n}}var Xf={exports:{}};(function(r){var t=Object.prototype.hasOwnProperty,e="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function s(l,u,c){this.fn=l,this.context=u,this.once=c||!1}function a(l,u,c,d,h){if(typeof c!="function")throw new TypeError("The listener must be a function");var f=new s(c,d||l,h),g=e?e+u:u;return l._events[g]?l._events[g].fn?l._events[g]=[l._events[g],f]:l._events[g].push(f):(l._events[g]=f,l._eventsCount++),l}function n(l,u){--l._eventsCount===0?l._events=new i:delete l._events[u]}function o(){this._events=new i,this._eventsCount=0}o.prototype.eventNames=function(){var l=[],u,c;if(this._eventsCount===0)return l;for(c in u=this._events)t.call(u,c)&&l.push(e?c.slice(1):c);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(u)):l},o.prototype.listeners=function(l){var u=e?e+l:l,c=this._events[u];if(!c)return[];if(c.fn)return[c.fn];for(var d=0,h=c.length,f=new Array(h);d<h;d++)f[d]=c[d].fn;return f},o.prototype.listenerCount=function(l){var u=e?e+l:l,c=this._events[u];return c?c.fn?1:c.length:0},o.prototype.emit=function(l,u,c,d,h,f){var g=e?e+l:l;if(!this._events[g])return!1;var p=this._events[g],T=arguments.length,y,v;if(p.fn){switch(p.once&&this.removeListener(l,p.fn,void 0,!0),T){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,u),!0;case 3:return p.fn.call(p.context,u,c),!0;case 4:return p.fn.call(p.context,u,c,d),!0;case 5:return p.fn.call(p.context,u,c,d,h),!0;case 6:return p.fn.call(p.context,u,c,d,h,f),!0}for(v=1,y=new Array(T-1);v<T;v++)y[v-1]=arguments[v];p.fn.apply(p.context,y)}else{var E=p.length,S;for(v=0;v<E;v++)switch(p[v].once&&this.removeListener(l,p[v].fn,void 0,!0),T){case 1:p[v].fn.call(p[v].context);break;case 2:p[v].fn.call(p[v].context,u);break;case 3:p[v].fn.call(p[v].context,u,c);break;case 4:p[v].fn.call(p[v].context,u,c,d);break;default:if(!y)for(S=1,y=new Array(T-1);S<T;S++)y[S-1]=arguments[S];p[v].fn.apply(p[v].context,y)}}return!0},o.prototype.on=function(l,u,c){return a(this,l,u,c,!1)},o.prototype.once=function(l,u,c){return a(this,l,u,c,!0)},o.prototype.removeListener=function(l,u,c,d){var h=e?e+l:l;if(!this._events[h])return this;if(!u)return n(this,h),this;var f=this._events[h];if(f.fn)f.fn===u&&(!d||f.once)&&(!c||f.context===c)&&n(this,h);else{for(var g=0,p=[],T=f.length;g<T;g++)(f[g].fn!==u||d&&!f[g].once||c&&f[g].context!==c)&&p.push(f[g]);p.length?this._events[h]=p.length===1?p[0]:p:n(this,h)}return this},o.prototype.removeAllListeners=function(l){var u;return l?(u=e?e+l:l,this._events[u]&&n(this,u)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=e,o.EventEmitter=o,r.exports=o})(Xf);var Vy=Xf.exports,jl=Im(Vy);const Dn=$a()||{isTypeSupported:()=>!1};class Qf{constructor(t,e,i,s){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const a=t.config;this.hls=t,this.id=e,this.useWorker=!!a.enableWorker,this.onTransmuxComplete=i,this.onFlush=s;const n=(u,c)=>{c=c||{},c.frag=this.frag,c.id=this.id,u===m.ERROR&&(this.error=c.error),this.hls.trigger(u,c)};this.observer=new jl,this.observer.on(m.FRAG_DECRYPTED,n),this.observer.on(m.ERROR,n);const o={mp4:Dn.isTypeSupported("video/mp4"),mpeg:Dn.isTypeSupported("audio/mpeg"),mp3:Dn.isTypeSupported('audio/mp4; codecs="mp3"')},l=navigator.vendor;if(this.useWorker&&typeof Worker<"u"&&(a.workerPath||cy())){try{a.workerPath?(L.log(`loading Web Worker ${a.workerPath} for "${e}"`),this.workerContext=hy(a.workerPath)):(L.log(`injecting Web Worker for "${e}"`),this.workerContext=dy()),this.onwmsg=c=>this.onWorkerMessage(c);const{worker:u}=this.workerContext;u.addEventListener("message",this.onwmsg),u.onerror=c=>{const d=new Error(`${c.message}  (${c.filename}:${c.lineno})`);a.enableWorker=!1,L.warn(`Error in "${e}" Web Worker, fallback to inline`),this.hls.trigger(m.ERROR,{type:$.OTHER_ERROR,details:I.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:d})},u.postMessage({cmd:"init",typeSupported:o,vendor:l,id:e,config:JSON.stringify(a)})}catch(u){L.warn(`Error setting up "${e}" Web Worker, fallback to inline`,u),this.resetWorker(),this.error=null,this.transmuxer=new Bc(this.observer,o,a,l,e)}return}this.transmuxer=new Bc(this.observer,o,a,l,e)}resetWorker(){if(this.workerContext){const{worker:t,objectURL:e}=this.workerContext;e&&self.URL.revokeObjectURL(e),t.removeEventListener("message",this.onwmsg),t.onerror=null,t.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}const t=this.observer;t&&t.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(t,e,i,s,a,n,o,l,u,c){var d,h;u.transmuxing.start=self.performance.now();const{transmuxer:f}=this,g=n?n.start:a.start,p=a.decryptdata,T=this.frag,y=!(T&&a.cc===T.cc),v=!(T&&u.level===T.level),E=T?u.sn-T.sn:-1,S=this.part?u.part-this.part.index:-1,b=E===0&&u.id>1&&u.id===(T==null?void 0:T.stats.chunkCount),w=!v&&(E===1||E===0&&(S===1||b&&S<=0)),k=self.performance.now();(v||E||a.stats.parsing.start===0)&&(a.stats.parsing.start=k),n&&(S||!w)&&(n.stats.parsing.start=k);const D=!(T&&((d=a.initSegment)==null?void 0:d.url)===((h=T.initSegment)==null?void 0:h.url)),P=new Ky(y,w,l,v,g,D);if(!w||y||D){L.log(`[transmuxer-interface, ${a.type}]: Starting new transmux session for sn: ${u.sn} p: ${u.part} level: ${u.level} id: ${u.id}
        discontinuity: ${y}
        trackSwitch: ${v}
        contiguous: ${w}
        accurateTimeOffset: ${l}
        timeOffset: ${g}
        initSegmentChange: ${D}`);const R=new Gy(i,s,e,o,c);this.configureTransmuxer(R)}if(this.frag=a,this.part=n,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:t,decryptdata:p,chunkMeta:u,state:P},t instanceof ArrayBuffer?[t]:[]);else if(f){const R=f.push(t,p,u,P);zs(R)?(f.async=!0,R.then(U=>{this.handleTransmuxComplete(U)}).catch(U=>{this.transmuxerError(U,u,"transmuxer-interface push error")})):(f.async=!1,this.handleTransmuxComplete(R))}}flush(t){t.transmuxing.start=self.performance.now();const{transmuxer:e}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:t});else if(e){let i=e.flush(t);zs(i)||e.async?(zs(i)||(i=Promise.resolve(i)),i.then(s=>{this.handleFlushResult(s,t)}).catch(s=>{this.transmuxerError(s,t,"transmuxer-interface flush error")})):this.handleFlushResult(i,t)}}transmuxerError(t,e,i){!this.hls||(this.error=t,this.hls.trigger(m.ERROR,{type:$.MEDIA_ERROR,details:I.FRAG_PARSING_ERROR,chunkMeta:e,fatal:!1,error:t,err:t,reason:i}))}handleFlushResult(t,e){t.forEach(i=>{this.handleTransmuxComplete(i)}),this.onFlush(e)}onWorkerMessage(t){const e=t.data,i=this.hls;switch(e.event){case"init":{var s;const a=(s=this.workerContext)==null?void 0:s.objectURL;a&&self.URL.revokeObjectURL(a);break}case"transmuxComplete":{this.handleTransmuxComplete(e.data);break}case"flush":{this.onFlush(e.data);break}case"workerLog":L[e.data.logType]&&L[e.data.logType](e.data.message);break;default:{e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,i.trigger(e.event,e.data);break}}}configureTransmuxer(t){const{transmuxer:e}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:t}):e&&e.configure(t)}handleTransmuxComplete(t){t.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(t)}}const Hy=250,Cn=2,zy=.1,Wy=.05;class Yy{constructor(t,e,i,s){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=t,this.media=e,this.fragmentTracker=i,this.hls=s}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(t,e){const{config:i,media:s,stalled:a}=this;if(s===null)return;const{currentTime:n,seeking:o}=s,l=this.seeking&&!o,u=!this.seeking&&o;if(this.seeking=o,n!==t){if(this.moved=!0,a!==null){if(this.stallReported){const y=self.performance.now()-a;L.warn(`playback not stuck anymore @${n}, after ${Math.round(y)}ms`),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if(u||l){this.stalled=null;return}if(s.paused&&!o||s.ended||s.playbackRate===0||!rt.getBuffered(s).length)return;const c=rt.bufferInfo(s,n,0),d=c.len>0,h=c.nextStart||0;if(!d&&!h)return;if(o){const y=c.len>Cn,v=!h||e&&e.start<=n||h-n>Cn&&!this.fragmentTracker.getPartialFragment(n);if(y||v)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var f;const y=Math.max(h,c.start||0)-n,v=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,E=!(v==null||(f=v.details)==null)&&f.live?v.details.targetduration*2:Cn,S=this.fragmentTracker.getPartialFragment(n);if(y>0&&(y<=E||S)){this._trySkipBufferHole(S);return}}const g=self.performance.now();if(a===null){this.stalled=g;return}const p=g-a;if(!o&&p>=Hy&&(this._reportStall(c),!this.media))return;const T=rt.bufferInfo(s,n,i.maxBufferHole);this._tryFixBufferStall(T,p)}_tryFixBufferStall(t,e){const{config:i,fragmentTracker:s,media:a}=this;if(a===null)return;const n=a.currentTime,o=s.getPartialFragment(n);o&&(this._trySkipBufferHole(o)||!this.media)||(t.len>i.maxBufferHole||t.nextStart&&t.nextStart-n<i.maxBufferHole)&&e>i.highBufferWatchdogPeriod*1e3&&(L.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(t){const{hls:e,media:i,stallReported:s}=this;if(!s&&i){this.stallReported=!0;const a=new Error(`Playback stalling at @${i.currentTime} due to low buffer (${JSON.stringify(t)})`);L.warn(a.message),e.trigger(m.ERROR,{type:$.MEDIA_ERROR,details:I.BUFFER_STALLED_ERROR,fatal:!1,error:a,buffer:t.len})}}_trySkipBufferHole(t){const{config:e,hls:i,media:s}=this;if(s===null)return 0;const a=s.currentTime,n=rt.bufferInfo(s,a,0),o=a<n.start?n.start:n.nextStart;if(o){const l=n.len<=e.maxBufferHole,u=n.len>0&&n.len<1&&s.readyState<3,c=o-a;if(c>0&&(l||u)){if(c>e.maxBufferHole){const{fragmentTracker:h}=this;let f=!1;if(a===0){const g=h.getAppendedFrag(0,G.MAIN);g&&o<g.end&&(f=!0)}if(!f){const g=t||h.getAppendedFrag(a,G.MAIN);if(g){let p=!1,T=g.end;for(;T<o;){const y=h.getPartialFragment(T);if(y)T+=y.duration;else{p=!0;break}}if(p)return 0}}}const d=Math.max(o+Wy,a+zy);if(L.warn(`skipping hole, adjusting currentTime from ${a} to ${d}`),this.moved=!0,this.stalled=null,s.currentTime=d,t&&!t.gap){const h=new Error(`fragment loaded with buffer holes, seeking from ${a} to ${d}`);i.trigger(m.ERROR,{type:$.MEDIA_ERROR,details:I.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:h,reason:h.message,frag:t})}return d}}return 0}_tryNudgeBuffer(){const{config:t,hls:e,media:i,nudgeRetry:s}=this;if(i===null)return;const a=i.currentTime;if(this.nudgeRetry++,s<t.nudgeMaxRetry){const n=a+(s+1)*t.nudgeOffset,o=new Error(`Nudging 'currentTime' from ${a} to ${n}`);L.warn(o.message),i.currentTime=n,e.trigger(m.ERROR,{type:$.MEDIA_ERROR,details:I.BUFFER_NUDGE_ON_STALL,error:o,fatal:!1})}else{const n=new Error(`Playhead still not moving while enough data buffered @${a} after ${t.nudgeMaxRetry} nudges`);L.error(n.message),e.trigger(m.ERROR,{type:$.MEDIA_ERROR,details:I.BUFFER_STALLED_ERROR,error:n,fatal:!0})}}}const jy=100;class qy extends Hl{constructor(t,e,i){super(t,e,i,"[stream-controller]",G.MAIN),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:t}=this;t.on(m.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(m.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(m.MANIFEST_LOADING,this.onManifestLoading,this),t.on(m.MANIFEST_PARSED,this.onManifestParsed,this),t.on(m.LEVEL_LOADING,this.onLevelLoading,this),t.on(m.LEVEL_LOADED,this.onLevelLoaded,this),t.on(m.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(m.ERROR,this.onError,this),t.on(m.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(m.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(m.BUFFER_CREATED,this.onBufferCreated,this),t.on(m.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(m.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(m.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:t}=this;t.off(m.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(m.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(m.MANIFEST_LOADING,this.onManifestLoading,this),t.off(m.MANIFEST_PARSED,this.onManifestParsed,this),t.off(m.LEVEL_LOADED,this.onLevelLoaded,this),t.off(m.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(m.ERROR,this.onError,this),t.off(m.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(m.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(m.BUFFER_CREATED,this.onBufferCreated,this),t.off(m.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(m.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(m.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),this.onMediaDetaching()}startLoad(t){if(this.levels){const{lastCurrentTime:e,hls:i}=this;if(this.stopLoad(),this.setInterval(jy),this.level=-1,!this.startFragRequested){let s=i.startLevel;s===-1&&(i.config.testBandwidth&&this.levels.length>1?(s=0,this.bitrateTest=!0):s=i.nextAutoLevel),this.level=i.nextLoadLevel=s,this.loadedmetadata=!1}e>0&&t===-1&&(this.log(`Override startPosition with lastCurrentTime @${e.toFixed(3)}`),t=e),this.state=_.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this._forceStartLoad=!0,this.state=_.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case _.WAITING_LEVEL:{var t;const{levels:i,level:s}=this,a=i==null||(t=i[s])==null?void 0:t.details;if(a&&(!a.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(a))break;this.state=_.IDLE;break}break}case _.FRAG_LOADING_WAITING_RETRY:{var e;const i=self.performance.now(),s=this.retryDate;(!s||i>=s||(e=this.media)!=null&&e.seeking)&&(this.resetStartWhenNotLoaded(this.level),this.state=_.IDLE)}break}this.state===_.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:t,levelLastLoaded:e,levels:i,media:s}=this,{config:a,nextLoadLevel:n}=t;if(e===null||!s&&(this.startFragRequested||!a.startFragPrefetch)||this.altAudio&&this.audioOnly||!(i!=null&&i[n]))return;const o=i[n],l=this.getMainFwdBufferInfo();if(l===null)return;const u=this.getLevelDetails();if(u&&this._streamEnded(l,u)){const T={};this.altAudio&&(T.type="video"),this.hls.trigger(m.BUFFER_EOS,T),this.state=_.ENDED;return}t.loadLevel!==n&&t.manualLevel===-1&&this.log(`Adapting to level ${n} from level ${this.level}`),this.level=t.nextLoadLevel=n;const c=o.details;if(!c||this.state===_.WAITING_LEVEL||c.live&&this.levelLastLoaded!==n){this.level=n,this.state=_.WAITING_LEVEL;return}const d=l.len,h=this.getMaxBufferLength(o.maxBitrate);if(d>=h)return;this.backtrackFragment&&this.backtrackFragment.start>l.end&&(this.backtrackFragment=null);const f=this.backtrackFragment?this.backtrackFragment.start:l.end;let g=this.getNextFragment(f,c);if(this.couldBacktrack&&!this.fragPrevious&&g&&g.sn!=="initSegment"&&this.fragmentTracker.getState(g)!==kt.OK){var p;const T=((p=this.backtrackFragment)!=null?p:g).sn-c.startSN,y=c.fragments[T-1];y&&g.cc===y.cc&&(g=y,this.fragmentTracker.removeFragment(y))}else this.backtrackFragment&&l.len&&(this.backtrackFragment=null);if(g&&this.isLoopLoading(g,f)){if(!g.gap){const T=this.audioOnly&&!this.altAudio?Z.AUDIO:Z.VIDEO,y=(T===Z.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;y&&this.afterBufferFlushed(y,T,G.MAIN)}g=this.getNextFragmentLoopLoading(g,c,l,G.MAIN,h)}!g||(g.initSegment&&!g.initSegment.data&&!this.bitrateTest&&(g=g.initSegment),this.loadFragment(g,o,f))}loadFragment(t,e,i){const s=this.fragmentTracker.getState(t);this.fragCurrent=t,s===kt.NOT_LOADED||s===kt.PARTIAL?t.sn==="initSegment"?this._loadInitSegment(t,e):this.bitrateTest?(this.log(`Fragment ${t.sn} of level ${t.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(t,e)):(this.startFragRequested=!0,super.loadFragment(t,e,i)):this.clearTrackerIfNeeded(t)}getBufferedFrag(t){return this.fragmentTracker.getBufferedFrag(t,G.MAIN)}followingBufferedFrag(t){return t?this.getBufferedFrag(t.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:t,media:e}=this;if(e!=null&&e.readyState){let i;const s=this.getAppendedFrag(e.currentTime);s&&s.start>1&&this.flushMainBuffer(0,s.start-1);const a=this.getLevelDetails();if(a!=null&&a.live){const o=this.getMainFwdBufferInfo();if(!o||o.len<a.targetduration*2)return}if(!e.paused&&t){const o=this.hls.nextLoadLevel,l=t[o],u=this.fragLastKbps;u&&this.fragCurrent?i=this.fragCurrent.duration*l.maxBitrate/(1e3*u)+1:i=0}else i=0;const n=this.getBufferedFrag(e.currentTime+i);if(n){const o=this.followingBufferedFrag(n);if(o){this.abortCurrentFrag();const l=o.maxStartPTS?o.maxStartPTS:o.start,u=o.duration,c=Math.max(n.end,l+Math.min(Math.max(u-this.config.maxFragLookUpTolerance,u*.5),u*.75));this.flushMainBuffer(c,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const t=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,t&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.state){case _.KEY_LOADING:case _.FRAG_LOADING:case _.FRAG_LOADING_WAITING_RETRY:case _.PARSING:case _.PARSED:this.state=_.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(t,e){super.flushMainBuffer(t,e,this.altAudio?"video":null)}onMediaAttached(t,e){super.onMediaAttached(t,e);const i=e.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),i.addEventListener("playing",this.onvplaying),i.addEventListener("seeked",this.onvseeked),this.gapController=new Yy(this.config,i,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:t}=this;t&&this.onvplaying&&this.onvseeked&&(t.removeEventListener("playing",this.onvplaying),t.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const t=this.media,e=t?t.currentTime:null;B(e)&&this.log(`Media seeked to ${e.toFixed(3)}`);const i=this.getMainFwdBufferInfo();if(i===null||i.len===0){this.warn(`Main forward buffer length on "seeked" event ${i?i.len:"empty"})`);return}this.tick()}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(m.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.levels=this.fragPlaying=this.backtrackFragment=null,this.altAudio=this.audioOnly=!1}onManifestParsed(t,e){let i=!1,s=!1,a;e.levels.forEach(n=>{a=n.audioCodec,a&&(a.indexOf("mp4a.40.2")!==-1&&(i=!0),a.indexOf("mp4a.40.5")!==-1&&(s=!0))}),this.audioCodecSwitch=i&&s&&!uy(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1}onLevelLoading(t,e){const{levels:i}=this;if(!i||this.state!==_.IDLE)return;const s=i[e.level];(!s.details||s.details.live&&this.levelLastLoaded!==e.level||this.waitForCdnTuneIn(s.details))&&(this.state=_.WAITING_LEVEL)}onLevelLoaded(t,e){var i;const{levels:s}=this,a=e.level,n=e.details,o=n.totalduration;if(!s){this.warn(`Levels were reset while loading level ${a}`);return}this.log(`Level ${a} loaded [${n.startSN},${n.endSN}]${n.lastPartSn?`[part-${n.lastPartSn}-${n.lastPartIndex}]`:""}, cc [${n.startCC}, ${n.endCC}] duration:${o}`);const l=s[a],u=this.fragCurrent;u&&(this.state===_.FRAG_LOADING||this.state===_.FRAG_LOADING_WAITING_RETRY)&&(u.level!==e.level||u.urlId!==l.urlId)&&u.loader&&this.abortCurrentFrag();let c=0;if(n.live||(i=l.details)!=null&&i.live){if(n.fragments[0]||(n.deltaUpdateFailed=!0),n.deltaUpdateFailed)return;c=this.alignPlaylists(n,l.details)}if(l.details=n,this.levelLastLoaded=a,this.hls.trigger(m.LEVEL_UPDATED,{details:n,level:a}),this.state===_.WAITING_LEVEL){if(this.waitForCdnTuneIn(n))return;this.state=_.IDLE}this.startFragRequested?n.live&&this.synchronizeToLiveEdge(n):this.setStartPosition(n,c),this.tick()}_handleFragmentLoadProgress(t){var e;const{frag:i,part:s,payload:a}=t,{levels:n}=this;if(!n){this.warn(`Levels were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const o=n[i.level],l=o.details;if(!l){this.warn(`Dropping fragment ${i.sn} of level ${i.level} after level details were reset`),this.fragmentTracker.removeFragment(i);return}const u=o.videoCodec,c=l.PTSKnown||!l.live,d=(e=i.initSegment)==null?void 0:e.data,h=this._getAudioCodec(o),f=this.transmuxer=this.transmuxer||new Qf(this.hls,G.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),g=s?s.index:-1,p=g!==-1,T=new Gl(i.level,i.sn,i.stats.chunkCount,a.byteLength,g,p),y=this.initPTS[i.cc];f.push(a,d,h,u,i,s,l.totalduration,c,T,y)}onAudioTrackSwitching(t,e){const i=this.altAudio;if(!e.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const s=this.hls;i&&(s.trigger(m.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),s.trigger(m.AUDIO_TRACK_SWITCHED,e)}}onAudioTrackSwitched(t,e){const i=e.id,s=!!this.hls.audioTracks[i].url;if(s){const a=this.videoBuffer;a&&this.mediaBuffer!==a&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=a)}this.altAudio=s,this.tick()}onBufferCreated(t,e){const i=e.tracks;let s,a,n=!1;for(const o in i){const l=i[o];if(l.id==="main"){if(a=o,s=l,o==="video"){const u=i[o];u&&(this.videoBuffer=u.buffer)}}else n=!0}n&&s?(this.log(`Alternate track found, use ${a}.buffered to schedule main fragment loading`),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media}onFragBuffered(t,e){const{frag:i,part:s}=e;if(i&&i.type!==G.MAIN)return;if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${s?" p: "+s.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}`),this.state===_.PARSED&&(this.state=_.IDLE);return}const a=s?s.stats:i.stats;this.fragLastKbps=Math.round(8*a.total/(a.buffering.end-a.loading.first)),i.sn!=="initSegment"&&(this.fragPrevious=i),this.fragBufferedComplete(i,s)}onError(t,e){var i;if(e.fatal){this.state=_.ERROR;return}switch(e.details){case I.FRAG_GAP:case I.FRAG_PARSING_ERROR:case I.FRAG_DECRYPT_ERROR:case I.FRAG_LOAD_ERROR:case I.FRAG_LOAD_TIMEOUT:case I.KEY_LOAD_ERROR:case I.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(G.MAIN,e);break;case I.LEVEL_LOAD_ERROR:case I.LEVEL_LOAD_TIMEOUT:case I.LEVEL_PARSING_ERROR:!e.levelRetry&&this.state===_.WAITING_LEVEL&&((i=e.context)==null?void 0:i.type)===X.LEVEL&&(this.state=_.IDLE);break;case I.BUFFER_FULL_ERROR:if(!e.parent||e.parent!=="main")return;this.reduceLengthAndFlushBuffer(e)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case I.INTERNAL_EXCEPTION:this.recoverWorkerError(e);break}}checkBuffer(){const{media:t,gapController:e}=this;if(!(!t||!e||!t.readyState)){if(this.loadedmetadata||!rt.getBuffered(t).length){const i=this.state!==_.IDLE?this.fragCurrent:null;e.poll(this.lastCurrentTime,i)}this.lastCurrentTime=t.currentTime}}onFragLoadEmergencyAborted(){this.state=_.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(t,{type:e}){if(e!==Z.AUDIO||this.audioOnly&&!this.altAudio){const i=(e===Z.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(i,e,G.MAIN)}}onLevelsUpdated(t,e){this.levels=e.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:t}=this;if(!t)return;const e=t.currentTime;let i=this.startPosition;if(i>=0&&e<i){if(t.seeking){this.log(`could not seek to ${i}, already seeking at ${e}`);return}const s=rt.getBuffered(t),a=(s.length?s.start(0):0)-i;a>0&&(a<this.config.maxBufferHole||a<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${a} to match buffer start`),i+=a,this.startPosition=i),this.log(`seek to target start position ${i} from current time ${e}`),t.currentTime=i}}_getAudioCodec(t){let e=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&e&&(this.log("Swapping audio codec"),e.indexOf("mp4a.40.5")!==-1?e="mp4a.40.2":e="mp4a.40.5"),e}_loadBitrateTestFrag(t,e){t.bitrateTest=!0,this._doFragLoad(t,e).then(i=>{const{hls:s}=this;if(!i||this.fragContextChanged(t))return;e.fragmentError=0,this.state=_.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const a=t.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),s.trigger(m.FRAG_LOADED,i),t.bitrateTest=!1})}_handleTransmuxComplete(t){var e;const i="main",{hls:s}=this,{remuxResult:a,chunkMeta:n}=t,o=this.getCurrentContext(n);if(!o){this.resetWhenMissingContext(n);return}const{frag:l,part:u,level:c}=o,{video:d,text:h,id3:f,initSegment:g}=a,{details:p}=c,T=this.altAudio?void 0:a.audio;if(this.fragContextChanged(l)){this.fragmentTracker.removeFragment(l);return}if(this.state=_.PARSING,g){if(g!=null&&g.tracks){const E=l.initSegment||l;this._bufferInitSegment(c,g.tracks,E,n),s.trigger(m.FRAG_PARSING_INIT_SEGMENT,{frag:E,id:i,tracks:g.tracks})}const y=g.initPTS,v=g.timescale;B(y)&&(this.initPTS[l.cc]={baseTime:y,timescale:v},s.trigger(m.INIT_PTS_FOUND,{frag:l,id:i,initPTS:y,timescale:v}))}if(d&&a.independent!==!1){if(p){const{startPTS:y,endPTS:v,startDTS:E,endDTS:S}=d;if(u)u.elementaryStreams[d.type]={startPTS:y,endPTS:v,startDTS:E,endDTS:S};else if(d.firstKeyFrame&&d.independent&&n.id===1&&(this.couldBacktrack=!0),d.dropped&&d.independent){const b=this.getMainFwdBufferInfo(),w=(b?b.end:this.getLoadPosition())+this.config.maxBufferHole,k=d.firstKeyFramePTS?d.firstKeyFramePTS:y;if(w<k-this.config.maxBufferHole){this.backtrack(l);return}l.setElementaryStreamInfo(d.type,l.start,v,l.start,S,!0)}l.setElementaryStreamInfo(d.type,y,v,E,S),this.backtrackFragment&&(this.backtrackFragment=l),this.bufferFragmentData(d,l,u,n)}}else if(a.independent===!1){this.backtrack(l);return}if(T){const{startPTS:y,endPTS:v,startDTS:E,endDTS:S}=T;u&&(u.elementaryStreams[Z.AUDIO]={startPTS:y,endPTS:v,startDTS:E,endDTS:S}),l.setElementaryStreamInfo(Z.AUDIO,y,v,E,S),this.bufferFragmentData(T,l,u,n)}if(p&&f!=null&&(e=f.samples)!=null&&e.length){const y={id:i,frag:l,details:p,samples:f.samples};s.trigger(m.FRAG_PARSING_METADATA,y)}if(p&&h){const y={id:i,frag:l,details:p,samples:h.samples};s.trigger(m.FRAG_PARSING_USERDATA,y)}}_bufferInitSegment(t,e,i,s){if(this.state!==_.PARSING)return;this.audioOnly=!!e.audio&&!e.video,this.altAudio&&!this.audioOnly&&delete e.audio;const{audio:a,video:n,audiovideo:o}=e;if(a){let l=t.audioCodec;const u=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(l&&(l.indexOf("mp4a.40.5")!==-1?l="mp4a.40.2":l="mp4a.40.5"),a.metadata.channelCount!==1&&u.indexOf("firefox")===-1&&(l="mp4a.40.5")),u.indexOf("android")!==-1&&a.container!=="audio/mpeg"&&(l="mp4a.40.2",this.log(`Android: force audio codec to ${l}`)),t.audioCodec&&t.audioCodec!==l&&this.log(`Swapping manifest audio codec "${t.audioCodec}" for "${l}"`),a.levelCodec=l,a.id="main",this.log(`Init audio buffer, container:${a.container}, codecs[selected/level/parsed]=[${l||""}/${t.audioCodec||""}/${a.codec}]`)}n&&(n.levelCodec=t.videoCodec,n.id="main",this.log(`Init video buffer, container:${n.container}, codecs[level/parsed]=[${t.videoCodec||""}/${n.codec}]`)),o&&this.log(`Init audiovideo buffer, container:${o.container}, codecs[level/parsed]=[${t.attrs.CODECS||""}/${o.codec}]`),this.hls.trigger(m.BUFFER_CODECS,e),Object.keys(e).forEach(l=>{const u=e[l].initSegment;u!=null&&u.byteLength&&this.hls.trigger(m.BUFFER_APPENDING,{type:l,data:u,frag:i,part:null,chunkMeta:s,parent:i.type})}),this.tick()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,G.MAIN)}backtrack(t){this.couldBacktrack=!0,this.backtrackFragment=t,this.resetTransmuxer(),this.flushBufferGap(t),this.fragmentTracker.removeFragment(t),this.fragPrevious=null,this.nextLoadPosition=t.start,this.state=_.IDLE}checkFragmentChanged(){const t=this.media;let e=null;if(t&&t.readyState>1&&t.seeking===!1){const i=t.currentTime;if(rt.isBuffered(t,i)?e=this.getAppendedFrag(i):rt.isBuffered(t,i+.1)&&(e=this.getAppendedFrag(i+.1)),e){this.backtrackFragment=null;const s=this.fragPlaying,a=e.level;(!s||e.sn!==s.sn||s.level!==a||e.urlId!==s.urlId)&&(this.fragPlaying=e,this.hls.trigger(m.FRAG_CHANGED,{frag:e}),(!s||s.level!==a)&&this.hls.trigger(m.LEVEL_SWITCHED,{level:a}))}}}get nextLevel(){const t=this.nextBufferedFrag;return t?t.level:-1}get currentFrag(){const t=this.media;return t?this.fragPlaying||this.getAppendedFrag(t.currentTime):null}get currentProgramDateTime(){const t=this.media;if(t){const e=t.currentTime,i=this.currentFrag;if(i&&B(e)&&B(i.programDateTime)){const s=i.programDateTime+(e-i.start)*1e3;return new Date(s)}}return null}get currentLevel(){const t=this.currentFrag;return t?t.level:-1}get nextBufferedFrag(){const t=this.currentFrag;return t?this.followingBufferedFrag(t):null}get forceStartLoad(){return this._forceStartLoad}}class xr{constructor(t,e=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=t,this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=e,this.totalWeight_=i}sample(t,e){const i=Math.pow(this.alpha_,t);this.estimate_=e*(1-i)+i*this.estimate_,this.totalWeight_+=t}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const t=1-Math.pow(this.alpha_,this.totalWeight_);if(t)return this.estimate_/t}return this.estimate_}}class Xy{constructor(t,e,i,s=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new xr(t),this.fast_=new xr(e),this.defaultTTFB_=s,this.ttfb_=new xr(t)}update(t,e){const{slow_:i,fast_:s,ttfb_:a}=this;i.halfLife!==t&&(this.slow_=new xr(t,i.getEstimate(),i.getTotalWeight())),s.halfLife!==e&&(this.fast_=new xr(e,s.getEstimate(),s.getTotalWeight())),a.halfLife!==t&&(this.ttfb_=new xr(t,a.getEstimate(),a.getTotalWeight()))}sample(t,e){t=Math.max(t,this.minDelayMs_);const i=8*e,s=t/1e3,a=i/s;this.fast_.sample(s,a),this.slow_.sample(s,a)}sampleTTFB(t){const e=t/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(e,2)/2);this.ttfb_.sample(i,Math.max(t,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}class Qy{constructor(t){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=-1,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=t;const e=t.config;this.bwEstimator=new Xy(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate),this.registerListeners()}registerListeners(){const{hls:t}=this;t.on(m.FRAG_LOADING,this.onFragLoading,this),t.on(m.FRAG_LOADED,this.onFragLoaded,this),t.on(m.FRAG_BUFFERED,this.onFragBuffered,this),t.on(m.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(m.LEVEL_LOADED,this.onLevelLoaded,this)}unregisterListeners(){const{hls:t}=this;t.off(m.FRAG_LOADING,this.onFragLoading,this),t.off(m.FRAG_LOADED,this.onFragLoaded,this),t.off(m.FRAG_BUFFERED,this.onFragBuffered,this),t.off(m.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(m.LEVEL_LOADED,this.onLevelLoaded,this)}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null}onFragLoading(t,e){var i;const s=e.frag;this.ignoreFragment(s)||(this.fragCurrent=s,this.partCurrent=(i=e.part)!=null?i:null,this.clearTimer(),this.timer=self.setInterval(this.onCheck,100))}onLevelSwitching(t,e){this.clearTimer()}getTimeToLoadFrag(t,e,i,s){const a=t+i/e,n=s?this.lastLevelLoadSec:0;return a+n}onLevelLoaded(t,e){const i=this.hls.config,{total:s,bwEstimate:a}=e.stats;B(s)&&B(a)&&(this.lastLevelLoadSec=8*s/a),e.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD)}_abandonRulesCheck(){const{fragCurrent:t,partCurrent:e,hls:i}=this,{autoLevelEnabled:s,media:a}=i;if(!t||!a)return;const n=performance.now(),o=e?e.stats:t.stats,l=e?e.duration:t.duration,u=n-o.loading.start;if(o.aborted||o.loaded&&o.loaded===o.total||t.level===0){this.clearTimer(),this._nextAutoLevel=-1;return}if(!s||a.paused||!a.playbackRate||!a.readyState)return;const c=i.mainForwardBufferInfo;if(c===null)return;const d=this.bwEstimator.getEstimateTTFB(),h=Math.abs(a.playbackRate);if(u<=Math.max(d,1e3*(l/(h*2))))return;const f=c.len/h;if(f>=2*l/h)return;const g=o.loading.first?o.loading.first-o.loading.start:-1,p=o.loaded&&g>-1,T=this.bwEstimator.getEstimate(),{levels:y,minAutoLevel:v}=i,E=y[t.level],S=o.total||Math.max(o.loaded,Math.round(l*E.maxBitrate/8));let b=u-g;b<1&&p&&(b=Math.min(u,o.loaded*8/T));const w=p?o.loaded*1e3/b:0,k=w?(S-o.loaded)/w:S*8/T+d/1e3;if(k<=f)return;const D=w?w*8:T;let P=Number.POSITIVE_INFINITY,R;for(R=t.level-1;R>v;R--){const U=y[R].maxBitrate;if(P=this.getTimeToLoadFrag(d/1e3,D,l*U,!y[R].details),P<f)break}P>=k||P>l*10||(i.nextLoadLevel=R,p?this.bwEstimator.sample(u-Math.min(d,g),o.loaded):this.bwEstimator.sampleTTFB(u),this.clearTimer(),L.warn(`[abr] Fragment ${t.sn}${e?" part "+e.index:""} of level ${t.level} is loading too slowly;
      Time to underbuffer: ${f.toFixed(3)} s
      Estimated load time for current fragment: ${k.toFixed(3)} s
      Estimated load time for down switch fragment: ${P.toFixed(3)} s
      TTFB estimate: ${g}
      Current BW estimate: ${B(T)?(T/1024).toFixed(3):"Unknown"} Kb/s
      New BW estimate: ${(this.bwEstimator.getEstimate()/1024).toFixed(3)} Kb/s
      Aborting and switching to level ${R}`),t.loader&&(this.fragCurrent=this.partCurrent=null,t.abortRequests()),i.trigger(m.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:e,stats:o}))}onFragLoaded(t,{frag:e,part:i}){const s=i?i.stats:e.stats;if(e.type===G.MAIN&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(e)){if(this.clearTimer(),this.lastLoadedFragLevel=e.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){const a=i?i.duration:e.duration,n=this.hls.levels[e.level],o=(n.loaded?n.loaded.bytes:0)+s.loaded,l=(n.loaded?n.loaded.duration:0)+a;n.loaded={bytes:o,duration:l},n.realBitrate=Math.round(8*o/l)}if(e.bitrateTest){const a={stats:s,frag:e,part:i,id:e.type};this.onFragBuffered(m.FRAG_BUFFERED,a),e.bitrateTest=!1}}}onFragBuffered(t,e){const{frag:i,part:s}=e,a=s!=null&&s.stats.loaded?s.stats:i.stats;if(a.aborted||this.ignoreFragment(i))return;const n=a.parsing.end-a.loading.start-Math.min(a.loading.first-a.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(n,a.loaded),a.bwEstimate=this.bwEstimator.getEstimate(),i.bitrateTest?this.bitrateTestDelay=n/1e3:this.bitrateTestDelay=0}ignoreFragment(t){return t.type!==G.MAIN||t.sn==="initSegment"}clearTimer(){self.clearInterval(this.timer)}get nextAutoLevel(){const t=this._nextAutoLevel,e=this.bwEstimator;if(t!==-1&&!e.canEstimate())return t;let i=this.getNextABRAutoLevel();if(t!==-1){const s=this.hls.levels;if(s.length>Math.max(t,i)&&s[t].loadError<=s[i].loadError)return t}return t!==-1&&(i=Math.min(t,i)),i}getNextABRAutoLevel(){const{fragCurrent:t,partCurrent:e,hls:i}=this,{maxAutoLevel:s,config:a,minAutoLevel:n,media:o}=i,l=e?e.duration:t?t.duration:0,u=o&&o.playbackRate!==0?Math.abs(o.playbackRate):1,c=this.bwEstimator?this.bwEstimator.getEstimate():a.abrEwmaDefaultEstimate,d=i.mainForwardBufferInfo,h=(d?d.len:0)/u;let f=this.findBestLevel(c,n,s,h,a.abrBandWidthFactor,a.abrBandWidthUpFactor);if(f>=0)return f;L.trace(`[abr] ${h?"rebuffering expected":"buffer is empty"}, finding optimal quality level`);let g=l?Math.min(l,a.maxStarvationDelay):a.maxStarvationDelay,p=a.abrBandWidthFactor,T=a.abrBandWidthUpFactor;if(!h){const y=this.bitrateTestDelay;y&&(g=(l?Math.min(l,a.maxLoadingDelay):a.maxLoadingDelay)-y,L.trace(`[abr] bitrate test took ${Math.round(1e3*y)}ms, set first fragment max fetchDuration to ${Math.round(1e3*g)} ms`),p=T=1)}return f=this.findBestLevel(c,n,s,h+g,p,T),Math.max(f,0)}findBestLevel(t,e,i,s,a,n){var o;const{fragCurrent:l,partCurrent:u,lastLoadedFragLevel:c}=this,{levels:d}=this.hls,h=d[c],f=!!(h!=null&&(o=h.details)!=null&&o.live),g=h==null?void 0:h.codecSet,p=u?u.duration:l?l.duration:0,T=this.bwEstimator.getEstimateTTFB()/1e3;let y=e,v=-1;for(let E=i;E>=e;E--){const S=d[E];if(!S||g&&S.codecSet!==g){S&&(y=Math.min(E,y),v=Math.max(E,v));continue}v!==-1&&L.trace(`[abr] Skipped level(s) ${y}-${v} with CODECS:"${d[v].attrs.CODECS}"; not compatible with "${h.attrs.CODECS}"`);const b=S.details,w=(u?b==null?void 0:b.partTarget:b==null?void 0:b.averagetargetduration)||p;let k;E<=c?k=a*t:k=n*t;const D=d[E].maxBitrate,P=this.getTimeToLoadFrag(T,k,D*w,b===void 0);if(L.trace(`[abr] level:${E} adjustedbw-bitrate:${Math.round(k-D)} avgDuration:${w.toFixed(1)} maxFetchDuration:${s.toFixed(1)} fetchDuration:${P.toFixed(1)}`),k>D&&(P===0||!B(P)||f&&!this.bitrateTestDelay||P<s))return E}return-1}set nextAutoLevel(t){this._nextAutoLevel=t}}class Jf{constructor(){this.chunks=[],this.dataLength=0}push(t){this.chunks.push(t),this.dataLength+=t.length}flush(){const{chunks:t,dataLength:e}=this;let i;if(t.length)t.length===1?i=t[0]:i=Jy(t,e);else return new Uint8Array(0);return this.reset(),i}reset(){this.chunks.length=0,this.dataLength=0}}function Jy(r,t){const e=new Uint8Array(t);let i=0;for(let s=0;s<r.length;s++){const a=r[s];e.set(a,i),i+=a.length}return e}const $c=100;class Zy extends Hl{constructor(t,e,i){super(t,e,i,"[audio-stream-controller]",G.AUDIO),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:t}=this;t.on(m.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(m.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(m.MANIFEST_LOADING,this.onManifestLoading,this),t.on(m.LEVEL_LOADED,this.onLevelLoaded,this),t.on(m.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(m.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(m.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(m.ERROR,this.onError,this),t.on(m.BUFFER_RESET,this.onBufferReset,this),t.on(m.BUFFER_CREATED,this.onBufferCreated,this),t.on(m.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(m.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(m.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:t}=this;t.off(m.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(m.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(m.MANIFEST_LOADING,this.onManifestLoading,this),t.off(m.LEVEL_LOADED,this.onLevelLoaded,this),t.off(m.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(m.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(m.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(m.ERROR,this.onError,this),t.off(m.BUFFER_RESET,this.onBufferReset,this),t.off(m.BUFFER_CREATED,this.onBufferCreated,this),t.off(m.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(m.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(m.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(t,{frag:e,id:i,initPTS:s,timescale:a}){if(i==="main"){const n=e.cc;this.initPTS[e.cc]={baseTime:s,timescale:a},this.log(`InitPTS for cc: ${n} found from main: ${s}`),this.videoTrackCC=n,this.state===_.WAITING_INIT_PTS&&this.tick()}}startLoad(t){if(!this.levels){this.startPosition=t,this.state=_.STOPPED;return}const e=this.lastCurrentTime;this.stopLoad(),this.setInterval($c),e>0&&t===-1?(this.log(`Override startPosition with lastCurrentTime @${e.toFixed(3)}`),t=e,this.state=_.IDLE):(this.loadedmetadata=!1,this.state=_.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}doTick(){switch(this.state){case _.IDLE:this.doTickIdle();break;case _.WAITING_TRACK:{var t;const{levels:i,trackId:s}=this,a=i==null||(t=i[s])==null?void 0:t.details;if(a){if(this.waitForCdnTuneIn(a))break;this.state=_.WAITING_INIT_PTS}break}case _.FRAG_LOADING_WAITING_RETRY:{var e;const i=performance.now(),s=this.retryDate;(!s||i>=s||(e=this.media)!=null&&e.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=_.IDLE);break}case _.WAITING_INIT_PTS:{const i=this.waitingData;if(i){const{frag:s,part:a,cache:n,complete:o}=i;if(this.initPTS[s.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=_.FRAG_LOADING;const l=n.flush(),u={frag:s,part:a,payload:l,networkDetails:null};this._handleFragmentLoadProgress(u),o&&super._handleFragmentLoadComplete(u)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${s.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const l=this.getLoadPosition(),u=rt.bufferInfo(this.mediaBuffer,l,this.config.maxBufferHole);Uo(u.end,this.config.maxFragLookUpTolerance,s)<0&&(this.log(`Waiting fragment cc (${s.cc}) @ ${s.start} cancelled because another fragment at ${u.end} is needed`),this.clearWaitingFragment())}}else this.state=_.IDLE}}this.onTickEnd()}clearWaitingFragment(){const t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=_.IDLE)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:t}=this;!(t!=null&&t.readyState)||(this.lastCurrentTime=t.currentTime)}doTickIdle(){const{hls:t,levels:e,media:i,trackId:s}=this,a=t.config;if(!(e!=null&&e[s])||!i&&(this.startFragRequested||!a.startFragPrefetch))return;const n=e[s],o=n.details;if(!o||o.live&&this.levelLastLoaded!==s||this.waitForCdnTuneIn(o)){this.state=_.WAITING_TRACK;return}const l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,Z.AUDIO,G.AUDIO));const u=this.getFwdBufferInfo(l,G.AUDIO);if(u===null)return;const{bufferedTrack:c,switchingTrack:d}=this;if(!d&&this._streamEnded(u,o)){t.trigger(m.BUFFER_EOS,{type:"audio"}),this.state=_.ENDED;return}const h=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,G.MAIN),f=u.len,g=this.getMaxBufferLength(h==null?void 0:h.len);if(f>=g&&!d)return;const p=o.fragments[0].start;let T=u.end;if(d&&i){const S=this.getLoadPosition();c&&d.attrs!==c.attrs&&(T=S),o.PTSKnown&&S<p&&(u.end>p||u.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=p+.05)}let y=this.getNextFragment(T,o),v=!1;if(y&&this.isLoopLoading(y,T)&&(v=!!y.gap,y=this.getNextFragmentLoopLoading(y,o,u,G.MAIN,g)),!y){this.bufferFlushed=!0;return}const E=h&&y.start>h.end+o.targetduration;if(E||!(h!=null&&h.len)&&u.len){const S=this.getAppendedFrag(y.start,G.MAIN);if(S===null||(v||(v=!!S.gap||!!E&&h.len===0),E&&!v||v&&u.nextStart&&u.nextStart<S.end))return}this.loadFragment(y,n,T)}getMaxBufferLength(t){const e=super.getMaxBufferLength();return t?Math.min(Math.max(e,t),this.config.maxMaxBufferLength):e}onMediaDetaching(){this.videoBuffer=null,super.onMediaDetaching()}onAudioTracksUpdated(t,{audioTracks:e}){this.resetTransmuxer(),this.levels=e.map(i=>new Zi(i))}onAudioTrackSwitching(t,e){const i=!!e.url;this.trackId=e.id;const{fragCurrent:s}=this;s&&(s.abortRequests(),this.removeUnbufferedFrags(s.start)),this.resetLoadingState(),i?this.setInterval($c):this.resetTransmuxer(),i?(this.switchingTrack=e,this.state=_.IDLE):(this.switchingTrack=null,this.bufferedTrack=e,this.state=_.STOPPED),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(t,e){this.mainDetails=e.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(m.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(t,e){var i;if(this.mainDetails==null){this.cachedTrackLoadedData=e;return}const{levels:s}=this,{details:a,id:n}=e;if(!s){this.warn(`Audio tracks were reset while loading level ${n}`);return}this.log(`Track ${n} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`);const o=s[n];let l=0;if(a.live||(i=o.details)!=null&&i.live){const u=this.mainDetails;if(a.fragments[0]||(a.deltaUpdateFailed=!0),a.deltaUpdateFailed||!u)return;!o.details&&a.hasProgramDateTime&&u.hasProgramDateTime?(Mf(a,u),l=a.fragments[0].start):l=this.alignPlaylists(a,o.details)}o.details=a,this.levelLastLoaded=n,!this.startFragRequested&&(this.mainDetails||!a.live)&&this.setStartPosition(o.details,l),this.state===_.WAITING_TRACK&&!this.waitForCdnTuneIn(a)&&(this.state=_.IDLE),this.tick()}_handleFragmentLoadProgress(t){var e;const{frag:i,part:s,payload:a}=t,{config:n,trackId:o,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const u=l[o];if(!u){this.warn("Audio track is undefined on fragment load progress");return}const c=u.details;if(!c){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(i.start);return}const d=n.defaultAudioCodec||u.audioCodec||"mp4a.40.2";let h=this.transmuxer;h||(h=this.transmuxer=new Qf(this.hls,G.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const f=this.initPTS[i.cc],g=(e=i.initSegment)==null?void 0:e.data;if(f!==void 0){const p=s?s.index:-1,T=p!==-1,y=new Gl(i.level,i.sn,i.stats.chunkCount,a.byteLength,p,T);h.push(a,g,d,"",i,s,c.totalduration,!1,y,f)}else{this.log(`Unknown video PTS for cc ${i.cc}, waiting for video PTS before demuxing audio frag ${i.sn} of [${c.startSN} ,${c.endSN}],track ${o}`);const{cache:p}=this.waitingData=this.waitingData||{frag:i,part:s,cache:new Jf,complete:!1};p.push(new Uint8Array(a)),this.waitingVideoCC=this.videoTrackCC,this.state=_.WAITING_INIT_PTS}}_handleFragmentLoadComplete(t){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(t)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(t,e){const i=e.tracks.audio;i&&(this.mediaBuffer=i.buffer||null),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer||null)}onFragBuffered(t,e){const{frag:i,part:s}=e;if(i.type!==G.AUDIO){if(!this.loadedmetadata&&i.type===G.MAIN){const a=this.videoBuffer||this.media;a&&rt.getBuffered(a).length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${s?" p: "+s.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(i.sn!=="initSegment"){this.fragPrevious=i;const a=this.switchingTrack;a&&(this.bufferedTrack=a,this.switchingTrack=null,this.hls.trigger(m.AUDIO_TRACK_SWITCHED,Wt({},a)))}this.fragBufferedComplete(i,s)}onError(t,e){var i;if(e.fatal){this.state=_.ERROR;return}switch(e.details){case I.FRAG_GAP:case I.FRAG_PARSING_ERROR:case I.FRAG_DECRYPT_ERROR:case I.FRAG_LOAD_ERROR:case I.FRAG_LOAD_TIMEOUT:case I.KEY_LOAD_ERROR:case I.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(G.AUDIO,e);break;case I.AUDIO_TRACK_LOAD_ERROR:case I.AUDIO_TRACK_LOAD_TIMEOUT:case I.LEVEL_PARSING_ERROR:!e.levelRetry&&this.state===_.WAITING_TRACK&&((i=e.context)==null?void 0:i.type)===X.AUDIO_TRACK&&(this.state=_.IDLE);break;case I.BUFFER_FULL_ERROR:if(!e.parent||e.parent!=="audio")return;this.reduceLengthAndFlushBuffer(e)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case I.INTERNAL_EXCEPTION:this.recoverWorkerError(e);break}}onBufferFlushed(t,{type:e}){e===Z.AUDIO&&(this.bufferFlushed=!0,this.state===_.ENDED&&(this.state=_.IDLE))}_handleTransmuxComplete(t){var e;const i="audio",{hls:s}=this,{remuxResult:a,chunkMeta:n}=t,o=this.getCurrentContext(n);if(!o){this.resetWhenMissingContext(n);return}const{frag:l,part:u,level:c}=o,{details:d}=c,{audio:h,text:f,id3:g,initSegment:p}=a;if(this.fragContextChanged(l)||!d){this.fragmentTracker.removeFragment(l);return}if(this.state=_.PARSING,this.switchingTrack&&h&&this.completeAudioSwitch(this.switchingTrack),p!=null&&p.tracks){const T=l.initSegment||l;this._bufferInitSegment(p.tracks,T,n),s.trigger(m.FRAG_PARSING_INIT_SEGMENT,{frag:T,id:i,tracks:p.tracks})}if(h){const{startPTS:T,endPTS:y,startDTS:v,endDTS:E}=h;u&&(u.elementaryStreams[Z.AUDIO]={startPTS:T,endPTS:y,startDTS:v,endDTS:E}),l.setElementaryStreamInfo(Z.AUDIO,T,y,v,E),this.bufferFragmentData(h,l,u,n)}if(g!=null&&(e=g.samples)!=null&&e.length){const T=vt({id:i,frag:l,details:d},g);s.trigger(m.FRAG_PARSING_METADATA,T)}if(f){const T=vt({id:i,frag:l,details:d},f);s.trigger(m.FRAG_PARSING_USERDATA,T)}}_bufferInitSegment(t,e,i){if(this.state!==_.PARSING)return;t.video&&delete t.video;const s=t.audio;if(!s)return;s.levelCodec=s.codec,s.id="audio",this.log(`Init audio buffer, container:${s.container}, codecs[parsed]=[${s.codec}]`),this.hls.trigger(m.BUFFER_CODECS,t);const a=s.initSegment;if(a!=null&&a.byteLength){const n={type:"audio",frag:e,part:null,chunkMeta:i,parent:e.type,data:a};this.hls.trigger(m.BUFFER_APPENDING,n)}this.tick()}loadFragment(t,e,i){const s=this.fragmentTracker.getState(t);if(this.fragCurrent=t,this.switchingTrack||s===kt.NOT_LOADED||s===kt.PARTIAL){var a;t.sn==="initSegment"?this._loadInitSegment(t,e):(a=e.details)!=null&&a.live&&!this.initPTS[t.cc]?(this.log(`Waiting for video PTS in continuity counter ${t.cc} of live stream before loading audio fragment ${t.sn} of level ${this.trackId}`),this.state=_.WAITING_INIT_PTS):(this.startFragRequested=!0,super.loadFragment(t,e,i))}else this.clearTrackerIfNeeded(t)}completeAudioSwitch(t){const{hls:e,media:i,bufferedTrack:s}=this,a=s==null?void 0:s.attrs,n=t.attrs;i&&a&&(a.CHANNELS!==n.CHANNELS||a.NAME!==n.NAME||a.LANGUAGE!==n.LANGUAGE)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio")),this.bufferedTrack=t,this.switchingTrack=null,e.trigger(m.AUDIO_TRACK_SWITCHED,Wt({},t))}}class tv extends $l{constructor(t){super(t,"[audio-track-controller]"),this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:t}=this;t.on(m.MANIFEST_LOADING,this.onManifestLoading,this),t.on(m.MANIFEST_PARSED,this.onManifestParsed,this),t.on(m.LEVEL_LOADING,this.onLevelLoading,this),t.on(m.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(m.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(m.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(m.MANIFEST_LOADING,this.onManifestLoading,this),t.off(m.MANIFEST_PARSED,this.onManifestParsed,this),t.off(m.LEVEL_LOADING,this.onLevelLoading,this),t.off(m.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(m.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(m.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(t,e){this.tracks=e.audioTracks||[]}onAudioTrackLoaded(t,e){const{id:i,groupId:s,details:a}=e,n=this.tracksInGroup[i];if(!n||n.groupId!==s){this.warn(`Track with id:${i} and group:${s} not found in active group ${n.groupId}`);return}const o=n.details;n.details=e.details,this.log(`audio-track ${i} "${n.name}" lang:${n.lang} group:${s} loaded [${a.startSN}-${a.endSN}]`),i===this.trackId&&this.playlistLoaded(i,e,o)}onLevelLoading(t,e){this.switchLevel(e.level)}onLevelSwitching(t,e){this.switchLevel(e.level)}switchLevel(t){const e=this.hls.levels[t];if(!(e!=null&&e.audioGroupIds))return;const i=e.audioGroupIds[e.urlId];if(this.groupId!==i){this.groupId=i||null;const s=this.tracks.filter(n=>!i||n.groupId===i);this.selectDefaultTrack&&!s.some(n=>n.default)&&(this.selectDefaultTrack=!1),this.tracksInGroup=s;const a={audioTracks:s};this.log(`Updating audio tracks, ${s.length} track(s) found in group:${i}`),this.hls.trigger(m.AUDIO_TRACKS_UPDATED,a),this.selectInitialTrack()}else this.shouldReloadPlaylist(this.currentTrack)&&this.setAudioTrack(this.trackId)}onError(t,e){e.fatal||!e.context||e.context.type===X.AUDIO_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&(this.requestScheduled=-1,this.checkRetry(e))}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(t){this.selectDefaultTrack=!1,this.setAudioTrack(t)}setAudioTrack(t){const e=this.tracksInGroup;if(t<0||t>=e.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();const i=this.currentTrack;e[this.trackId];const s=e[t],{groupId:a,name:n}=s;if(this.log(`Switching to audio-track ${t} "${n}" lang:${s.lang} group:${a}`),this.trackId=t,this.currentTrack=s,this.selectDefaultTrack=!1,this.hls.trigger(m.AUDIO_TRACK_SWITCHING,Wt({},s)),s.details&&!s.details.live)return;const o=this.switchParams(s.url,i==null?void 0:i.details);this.loadPlaylist(o)}selectInitialTrack(){const t=this.tracksInGroup,e=this.findTrackId(this.currentTrack)|this.findTrackId(null);if(e!==-1)this.setAudioTrack(e);else{const i=new Error(`No track found for running audio group-ID: ${this.groupId} track count: ${t.length}`);this.warn(i.message),this.hls.trigger(m.ERROR,{type:$.MEDIA_ERROR,details:I.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:i})}}findTrackId(t){const e=this.tracksInGroup;for(let i=0;i<e.length;i++){const s=e[i];if((!this.selectDefaultTrack||s.default)&&(!t||t.attrs["STABLE-RENDITION-ID"]!==void 0&&t.attrs["STABLE-RENDITION-ID"]===s.attrs["STABLE-RENDITION-ID"]||t.name===s.name&&t.lang===s.lang))return s.id}return-1}loadPlaylist(t){super.loadPlaylist();const e=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(e)){const i=e.id,s=e.groupId;let a=e.url;if(t)try{a=t.addDirectives(a)}catch(n){this.warn(`Could not construct new URL with HLS Delivery Directives: ${n}`)}this.log(`loading audio-track playlist ${i} "${e.name}" lang:${e.lang} group:${s}`),this.clearTimer(),this.hls.trigger(m.AUDIO_TRACK_LOADING,{url:a,id:i,groupId:s,deliveryDirectives:t||null})}}}function Zf(r,t){if(r.length!==t.length)return!1;for(let e=0;e<r.length;e++)if(!ev(r[e].attrs,t[e].attrs))return!1;return!0}function ev(r,t){const e=r["STABLE-RENDITION-ID"];return e?e===t["STABLE-RENDITION-ID"]:!["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED"].some(i=>r[i]!==t[i])}const Gc=500;class rv extends Hl{constructor(t,e,i){super(t,e,i,"[subtitle-stream-controller]",G.SUBTITLE),this.levels=[],this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null}_registerListeners(){const{hls:t}=this;t.on(m.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(m.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(m.MANIFEST_LOADING,this.onManifestLoading,this),t.on(m.LEVEL_LOADED,this.onLevelLoaded,this),t.on(m.ERROR,this.onError,this),t.on(m.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(m.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(m.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(m.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.on(m.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(m.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:t}=this;t.off(m.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(m.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(m.MANIFEST_LOADING,this.onManifestLoading,this),t.off(m.LEVEL_LOADED,this.onLevelLoaded,this),t.off(m.ERROR,this.onError,this),t.off(m.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(m.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(m.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(m.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.off(m.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(m.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(t){this.stopLoad(),this.state=_.IDLE,this.setInterval(Gc),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(t,e){this.mainDetails=e.details}onSubtitleFragProcessed(t,e){const{frag:i,success:s}=e;if(this.fragPrevious=i,this.state=_.IDLE,!s)return;const a=this.tracksBuffered[this.currentTrackId];if(!a)return;let n;const o=i.start;for(let u=0;u<a.length;u++)if(o>=a[u].start&&o<=a[u].end){n=a[u];break}const l=i.start+i.duration;n?n.end=l:(n={start:o,end:l},a.push(n)),this.fragmentTracker.fragBuffered(i)}onBufferFlushing(t,e){const{startOffset:i,endOffset:s}=e;if(i===0&&s!==Number.POSITIVE_INFINITY){const{currentTrackId:a,levels:n}=this;if(!n.length||!n[a]||!n[a].details)return;const o=n[a].details.targetduration,l=s-o;if(l<=0)return;e.endOffsetSubtitles=Math.max(0,l),this.tracksBuffered.forEach(u=>{for(let c=0;c<u.length;){if(u[c].end<=l){u.shift();continue}else if(u[c].start<l)u[c].start=l;else break;c++}}),this.fragmentTracker.removeFragmentsInRange(i,l,G.SUBTITLE)}}onFragBuffered(t,e){if(!this.loadedmetadata&&e.frag.type===G.MAIN){var i;(i=this.media)!=null&&i.buffered.length&&(this.loadedmetadata=!0)}}onError(t,e){const i=e.frag;(i==null?void 0:i.type)===G.SUBTITLE&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==_.STOPPED&&(this.state=_.IDLE))}onSubtitleTracksUpdated(t,{subtitleTracks:e}){if(Zf(this.levels,e)){this.levels=e.map(i=>new Zi(i));return}this.tracksBuffered=[],this.levels=e.map(i=>{const s=new Zi(i);return this.tracksBuffered[s.id]=[],s}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,G.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(t,e){if(this.currentTrackId=e.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}const i=this.levels[this.currentTrackId];i!=null&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.setInterval(Gc)}onSubtitleTrackLoaded(t,e){var i;const{details:s,id:a}=e,{currentTrackId:n,levels:o}=this;if(!o.length)return;const l=o[n];if(a>=o.length||a!==n||!l)return;this.mediaBuffer=this.mediaBufferTimeRanges;let u=0;if(s.live||(i=l.details)!=null&&i.live){const c=this.mainDetails;if(s.deltaUpdateFailed||!c)return;const d=c.fragments[0];l.details?(u=this.alignPlaylists(s,l.details),u===0&&d&&(u=d.start,No(s,u))):s.hasProgramDateTime&&c.hasProgramDateTime?(Mf(s,c),u=s.fragments[0].start):d&&(u=d.start,No(s,u))}l.details=s,this.levelLastLoaded=a,!this.startFragRequested&&(this.mainDetails||!s.live)&&this.setStartPosition(l.details,u),this.tick(),s.live&&!this.fragCurrent&&this.media&&this.state===_.IDLE&&(ts(null,s.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0))}_handleFragmentLoadComplete(t){const{frag:e,payload:i}=t,s=e.decryptdata,a=this.hls;if(!this.fragContextChanged(e)&&i&&i.byteLength>0&&s&&s.key&&s.iv&&s.method==="AES-128"){const n=performance.now();this.decrypter.decrypt(new Uint8Array(i),s.key.buffer,s.iv.buffer).catch(o=>{throw a.trigger(m.ERROR,{type:$.MEDIA_ERROR,details:I.FRAG_DECRYPT_ERROR,fatal:!1,error:o,reason:o.message,frag:e}),o}).then(o=>{const l=performance.now();a.trigger(m.FRAG_DECRYPTED,{frag:e,payload:o,stats:{tstart:n,tdecrypt:l}})}).catch(o=>{this.warn(`${o.name}: ${o.message}`),this.state=_.IDLE})}}doTick(){if(!this.media){this.state=_.IDLE;return}if(this.state===_.IDLE){const{currentTrackId:t,levels:e}=this,i=e[t];if(!e.length||!i||!i.details)return;const s=i.details,a=s.targetduration,{config:n}=this,o=this.getLoadPosition(),l=rt.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],o-a,n.maxBufferHole),{end:u,len:c}=l,d=this.getFwdBufferInfo(this.media,G.MAIN),h=this.getMaxBufferLength(d==null?void 0:d.len)+a;if(c>h)return;const f=s.fragments,g=f.length,p=s.edge;let T=null;const y=this.fragPrevious;if(u<p){const{maxFragLookUpTolerance:v}=n;T=ts(y,f,Math.max(f[0].start,u),v),!T&&y&&y.start<f[0].start&&(T=f[0])}else T=f[g-1];if(!T)return;T=this.mapToInitFragWhenRequired(T),this.fragmentTracker.getState(T)===kt.NOT_LOADED&&this.loadFragment(T,i,u)}}getMaxBufferLength(t){const e=super.getMaxBufferLength();return t?Math.max(e,t):e}loadFragment(t,e,i){this.fragCurrent=t,t.sn==="initSegment"?this._loadInitSegment(t,e):(this.startFragRequested=!0,super.loadFragment(t,e,i))}get mediaBufferTimeRanges(){return new iv(this.tracksBuffered[this.currentTrackId]||[])}}class iv{constructor(t){this.buffered=void 0;const e=(i,s,a)=>{if(s=s>>>0,s>a-1)throw new DOMException(`Failed to execute '${i}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${a})`);return t[s][i]};this.buffered={get length(){return t.length},end(i){return e("end",i,t.length)},start(i){return e("start",i,t.length)}}}}class sv extends $l{constructor(t){super(t,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.trackChangeListener=()=>this.onTextTracksChanged(),this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(t){this._subtitleDisplay=t,this.trackId>-1&&this.toggleTrackModes(this.trackId)}registerListeners(){const{hls:t}=this;t.on(m.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(m.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(m.MANIFEST_LOADING,this.onManifestLoading,this),t.on(m.MANIFEST_PARSED,this.onManifestParsed,this),t.on(m.LEVEL_LOADING,this.onLevelLoading,this),t.on(m.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(m.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(m.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(m.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(m.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(m.MANIFEST_LOADING,this.onManifestLoading,this),t.off(m.MANIFEST_PARSED,this.onManifestParsed,this),t.off(m.LEVEL_LOADING,this.onLevelLoading,this),t.off(m.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(m.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(m.ERROR,this.onError,this)}onMediaAttached(t,e){this.media=e.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,t)}onMediaDetaching(){!this.media||(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),_n(this.media.textTracks).forEach(t=>{Yr(t)}),this.subtitleTrack=-1,this.media=null)}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(t,e){this.tracks=e.subtitleTracks}onSubtitleTrackLoaded(t,e){const{id:i,details:s}=e,{trackId:a}=this,n=this.tracksInGroup[a];if(!n){this.warn(`Invalid subtitle track id ${i}`);return}const o=n.details;n.details=e.details,this.log(`subtitle track ${i} loaded [${s.startSN}-${s.endSN}]`),i===this.trackId&&this.playlistLoaded(i,e,o)}onLevelLoading(t,e){this.switchLevel(e.level)}onLevelSwitching(t,e){this.switchLevel(e.level)}switchLevel(t){const e=this.hls.levels[t];if(!(e!=null&&e.textGroupIds))return;const i=e.textGroupIds[e.urlId],s=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;if(this.groupId!==i){const a=this.tracks.filter(l=>!i||l.groupId===i);this.tracksInGroup=a;const n=this.findTrackId(s==null?void 0:s.name)||this.findTrackId();this.groupId=i||null;const o={subtitleTracks:a};this.log(`Updating subtitle tracks, ${a.length} track(s) found in "${i}" group-id`),this.hls.trigger(m.SUBTITLE_TRACKS_UPDATED,o),n!==-1&&this.setSubtitleTrack(n,s)}else this.shouldReloadPlaylist(s)&&this.setSubtitleTrack(this.trackId,s)}findTrackId(t){const e=this.tracksInGroup;for(let i=0;i<e.length;i++){const s=e[i];if((!this.selectDefaultTrack||s.default)&&(!t||t===s.name))return s.id}return-1}onError(t,e){e.fatal||!e.context||e.context.type===X.SUBTITLE_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&this.checkRetry(e)}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(t){this.selectDefaultTrack=!1;const e=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(t,e)}loadPlaylist(t){super.loadPlaylist();const e=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(e)){const i=e.id,s=e.groupId;let a=e.url;if(t)try{a=t.addDirectives(a)}catch(n){this.warn(`Could not construct new URL with HLS Delivery Directives: ${n}`)}this.log(`Loading subtitle playlist for id ${i}`),this.hls.trigger(m.SUBTITLE_TRACK_LOADING,{url:a,id:i,groupId:s,deliveryDirectives:t||null})}}toggleTrackModes(t){const{media:e,trackId:i}=this;if(!e)return;const s=_n(e.textTracks),a=s.filter(o=>o.groupId===this.groupId);if(t===-1)[].slice.call(s).forEach(o=>{o.mode="disabled"});else{const o=a[i];o&&(o.mode="disabled")}const n=a[t];n&&(n.mode=this.subtitleDisplay?"showing":"hidden")}setSubtitleTrack(t,e){var i;const s=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=t;return}if(this.trackId!==t&&this.toggleTrackModes(t),this.trackId===t&&(t===-1||(i=s[t])!=null&&i.details)||t<-1||t>=s.length)return;this.clearTimer();const a=s[t];if(this.log(`Switching to subtitle-track ${t}`+(a?` "${a.name}" lang:${a.lang} group:${a.groupId}`:"")),this.trackId=t,a){const{id:n,groupId:o="",name:l,type:u,url:c}=a;this.hls.trigger(m.SUBTITLE_TRACK_SWITCH,{id:n,groupId:o,name:l,type:u,url:c});const d=this.switchParams(a.url,e==null?void 0:e.details);this.loadPlaylist(d)}else this.hls.trigger(m.SUBTITLE_TRACK_SWITCH,{id:t})}onTextTracksChanged(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=-1;const e=_n(this.media.textTracks);for(let i=0;i<e.length;i++)if(e[i].mode==="hidden")t=i;else if(e[i].mode==="showing"){t=i;break}this.subtitleTrack!==t&&(this.subtitleTrack=t)}}function _n(r){const t=[];for(let e=0;e<r.length;e++){const i=r[e];(i.kind==="subtitles"||i.kind==="captions")&&i.label&&t.push(r[e])}return t}class av{constructor(t){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=t}append(t,e){const i=this.queues[e];i.push(t),i.length===1&&this.buffers[e]&&this.executeNext(e)}insertAbort(t,e){this.queues[e].unshift(t),this.executeNext(e)}appendBlocker(t){let e;const i=new Promise(a=>{e=a}),s={execute:e,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(s,t),i}executeNext(t){const{buffers:e,queues:i}=this,s=e[t],a=i[t];if(a.length){const n=a[0];try{n.execute()}catch(o){L.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),n.onError(o),s!=null&&s.updating||(a.shift(),this.executeNext(t))}}}shiftAndExecuteNext(t){this.queues[t].shift(),this.executeNext(t)}current(t){return this.queues[t][0]}}const Kc=$a(),Vc=/([ha]vc.)(?:\.[^.,]+)+/;class nv{constructor(t){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=()=>{const{media:e,mediaSource:i}=this;L.log("[buffer-controller]: Media source opened"),e&&(e.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(m.MEDIA_ATTACHED,{media:e})),i&&i.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{L.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=()=>{L.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=()=>{const{media:e,_objectUrl:i}=this;e&&e.src!==i&&L.error(`Media element src was set while attaching MediaSource (${i} > ${e.src})`)},this.hls=t,this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null}registerListeners(){const{hls:t}=this;t.on(m.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(m.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(m.MANIFEST_LOADING,this.onManifestLoading,this),t.on(m.MANIFEST_PARSED,this.onManifestParsed,this),t.on(m.BUFFER_RESET,this.onBufferReset,this),t.on(m.BUFFER_APPENDING,this.onBufferAppending,this),t.on(m.BUFFER_CODECS,this.onBufferCodecs,this),t.on(m.BUFFER_EOS,this.onBufferEos,this),t.on(m.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(m.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(m.FRAG_PARSED,this.onFragParsed,this),t.on(m.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:t}=this;t.off(m.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(m.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(m.MANIFEST_LOADING,this.onManifestLoading,this),t.off(m.MANIFEST_PARSED,this.onManifestParsed,this),t.off(m.BUFFER_RESET,this.onBufferReset,this),t.off(m.BUFFER_APPENDING,this.onBufferAppending,this),t.off(m.BUFFER_CODECS,this.onBufferCodecs,this),t.off(m.BUFFER_EOS,this.onBufferEos,this),t.off(m.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(m.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(m.FRAG_PARSED,this.onFragParsed,this),t.off(m.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new av(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(t,e){let i=2;(e.audio&&!e.video||!e.altAudio)&&(i=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=i,L.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(t,e){const i=this.media=e.media;if(i&&Kc){const s=this.mediaSource=new Kc;s.addEventListener("sourceopen",this._onMediaSourceOpen),s.addEventListener("sourceended",this._onMediaSourceEnded),s.addEventListener("sourceclose",this._onMediaSourceClose),i.src=self.URL.createObjectURL(s),this._objectUrl=i.src,i.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:t,mediaSource:e,_objectUrl:i}=this;if(e){if(L.log("[buffer-controller]: media source detaching"),e.readyState==="open")try{e.endOfStream()}catch(s){L.warn(`[buffer-controller]: onMediaDetaching: ${s.message} while calling endOfStream`)}this.onBufferReset(),e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),t&&(t.removeEventListener("emptied",this._onMediaEmptied),i&&self.URL.revokeObjectURL(i),t.src===i?(t.removeAttribute("src"),t.load()):L.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(m.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(t=>{const e=this.sourceBuffer[t];try{e&&(this.removeBufferListeners(t),this.mediaSource&&this.mediaSource.removeSourceBuffer(e),this.sourceBuffer[t]=void 0)}catch(i){L.warn(`[buffer-controller]: Failed to reset the ${t} buffer`,i)}}),this._initSourceBuffer()}onBufferCodecs(t,e){const i=this.getSourceBufferTypes().length;Object.keys(e).forEach(s=>{if(i){const a=this.tracks[s];if(a&&typeof a.buffer.changeType=="function"){const{id:n,codec:o,levelCodec:l,container:u,metadata:c}=e[s],d=(a.levelCodec||a.codec).replace(Vc,"$1"),h=(l||o).replace(Vc,"$1");if(d!==h){const f=`${u};codecs=${l||o}`;this.appendChangeType(s,f),L.log(`[buffer-controller]: switching codec ${d} to ${h}`),this.tracks[s]={buffer:a.buffer,codec:o,container:u,levelCodec:l,metadata:c,id:n}}}}else this.pendingTracks[s]=e[s]}),!i&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())}appendChangeType(t,e){const{operationQueue:i}=this,s={execute:()=>{const a=this.sourceBuffer[t];a&&(L.log(`[buffer-controller]: changing ${t} sourceBuffer type to ${e}`),a.changeType(e)),i.shiftAndExecuteNext(t)},onStart:()=>{},onComplete:()=>{},onError:a=>{L.warn(`[buffer-controller]: Failed to change ${t} SourceBuffer type`,a)}};i.append(s,t)}onBufferAppending(t,e){const{hls:i,operationQueue:s,tracks:a}=this,{data:n,type:o,frag:l,part:u,chunkMeta:c}=e,d=c.buffering[o],h=self.performance.now();d.start=h;const f=l.stats.buffering,g=u?u.stats.buffering:null;f.start===0&&(f.start=h),g&&g.start===0&&(g.start=h);const p=a.audio;let T=!1;o==="audio"&&(p==null?void 0:p.container)==="audio/mpeg"&&(T=!this.lastMpegAudioChunk||c.id===1||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);const y=l.start,v={execute:()=>{if(d.executeStart=self.performance.now(),T){const E=this.sourceBuffer[o];if(E){const S=y-E.timestampOffset;Math.abs(S)>=.1&&(L.log(`[buffer-controller]: Updating audio SourceBuffer timestampOffset to ${y} (delta: ${S}) sn: ${l.sn})`),E.timestampOffset=y)}}this.appendExecutor(n,o)},onStart:()=>{},onComplete:()=>{const E=self.performance.now();d.executeEnd=d.end=E,f.first===0&&(f.first=E),g&&g.first===0&&(g.first=E);const{sourceBuffer:S}=this,b={};for(const w in S)b[w]=rt.getBuffered(S[w]);this.appendError=0,this.hls.trigger(m.BUFFER_APPENDED,{type:o,frag:l,part:u,chunkMeta:c,parent:l.type,timeRanges:b})},onError:E=>{L.error(`[buffer-controller]: Error encountered while trying to append to the ${o} SourceBuffer`,E);const S={type:$.MEDIA_ERROR,parent:l.type,details:I.BUFFER_APPEND_ERROR,frag:l,part:u,chunkMeta:c,error:E,err:E,fatal:!1};E.code===DOMException.QUOTA_EXCEEDED_ERR?S.details=I.BUFFER_FULL_ERROR:(this.appendError++,S.details=I.BUFFER_APPEND_ERROR,this.appendError>i.config.appendErrorMaxRetry&&(L.error(`[buffer-controller]: Failed ${i.config.appendErrorMaxRetry} times to append segment in sourceBuffer`),S.fatal=!0)),i.trigger(m.ERROR,S)}};s.append(v,o)}onBufferFlushing(t,e){const{operationQueue:i}=this,s=a=>({execute:this.removeExecutor.bind(this,a,e.startOffset,e.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(m.BUFFER_FLUSHED,{type:a})},onError:n=>{L.warn(`[buffer-controller]: Failed to remove from ${a} SourceBuffer`,n)}});e.type?i.append(s(e.type),e.type):this.getSourceBufferTypes().forEach(a=>{i.append(s(a),a)})}onFragParsed(t,e){const{frag:i,part:s}=e,a=[],n=s?s.elementaryStreams:i.elementaryStreams;n[Z.AUDIOVIDEO]?a.push("audiovideo"):(n[Z.AUDIO]&&a.push("audio"),n[Z.VIDEO]&&a.push("video"));const o=()=>{const l=self.performance.now();i.stats.buffering.end=l,s&&(s.stats.buffering.end=l);const u=s?s.stats:i.stats;this.hls.trigger(m.FRAG_BUFFERED,{frag:i,part:s,stats:u,id:i.type})};a.length===0&&L.warn(`Fragments must have at least one ElementaryStreamType set. type: ${i.type} level: ${i.level} sn: ${i.sn}`),this.blockBuffers(o,a)}onFragChanged(t,e){this.flushBackBuffer()}onBufferEos(t,e){this.getSourceBufferTypes().reduce((i,s)=>{const a=this.sourceBuffer[s];return a&&(!e.type||e.type===s)&&(a.ending=!0,a.ended||(a.ended=!0,L.log(`[buffer-controller]: ${s} sourceBuffer now EOS`))),i&&!!(!a||a.ended)},!0)&&(L.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(s=>{const a=this.sourceBuffer[s];a&&(a.ending=!1)});const{mediaSource:i}=this;if(!i||i.readyState!=="open"){i&&L.info(`[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: ${i.readyState}`);return}L.log("[buffer-controller]: Calling mediaSource.endOfStream()"),i.endOfStream()}))}onLevelUpdated(t,{details:e}){!e.fragments.length||(this.details=e,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}flushBackBuffer(){const{hls:t,details:e,media:i,sourceBuffer:s}=this;if(!i||e===null)return;const a=this.getSourceBufferTypes();if(!a.length)return;const n=e.live&&t.config.liveBackBufferLength!==null?t.config.liveBackBufferLength:t.config.backBufferLength;if(!B(n)||n<0)return;const o=i.currentTime,l=e.levelTargetDuration,u=Math.max(n,l),c=Math.floor(o/l)*l-u;a.forEach(d=>{const h=s[d];if(h){const f=rt.getBuffered(h);if(f.length>0&&c>f.start(0)){if(t.trigger(m.BACK_BUFFER_REACHED,{bufferEnd:c}),e.live)t.trigger(m.LIVE_BACK_BUFFER_REACHED,{bufferEnd:c});else if(h.ended&&f.end(f.length-1)-o<l*2){L.info(`[buffer-controller]: Cannot flush ${d} back buffer while SourceBuffer is in ended state`);return}t.trigger(m.BUFFER_FLUSHING,{startOffset:0,endOffset:c,type:d})}}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")return;const{details:t,hls:e,media:i,mediaSource:s}=this,a=t.fragments[0].start+t.totalduration,n=i.duration,o=B(s.duration)?s.duration:0;t.live&&e.config.liveDurationInfinity?(L.log("[buffer-controller]: Media Source duration is set to Infinity"),s.duration=1/0,this.updateSeekableRange(t)):(a>o&&a>n||!B(n))&&(L.log(`[buffer-controller]: Updating Media Source duration to ${a.toFixed(3)}`),s.duration=a)}updateSeekableRange(t){const e=this.mediaSource,i=t.fragments;if(i.length&&t.live&&e!=null&&e.setLiveSeekableRange){const s=Math.max(0,i[0].start),a=Math.max(s,s+t.totalduration);e.setLiveSeekableRange(s,a)}}checkPendingTracks(){const{bufferCodecEventsExpected:t,operationQueue:e,pendingTracks:i}=this,s=Object.keys(i).length;if(s&&!t||s===2){this.createSourceBuffers(i),this.pendingTracks={};const a=this.getSourceBufferTypes();if(a.length)this.hls.trigger(m.BUFFER_CREATED,{tracks:this.tracks}),a.forEach(n=>{e.executeNext(n)});else{const n=new Error("could not create source buffer for media codec(s)");this.hls.trigger(m.ERROR,{type:$.MEDIA_ERROR,details:I.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:n,reason:n.message})}}}createSourceBuffers(t){const{sourceBuffer:e,mediaSource:i}=this;if(!i)throw Error("createSourceBuffers called when mediaSource was null");for(const s in t)if(!e[s]){const a=t[s];if(!a)throw Error(`source buffer exists for track ${s}, however track does not`);const n=a.levelCodec||a.codec,o=`${a.container};codecs=${n}`;L.log(`[buffer-controller]: creating sourceBuffer(${o})`);try{const l=e[s]=i.addSourceBuffer(o),u=s;this.addBufferListener(u,"updatestart",this._onSBUpdateStart),this.addBufferListener(u,"updateend",this._onSBUpdateEnd),this.addBufferListener(u,"error",this._onSBUpdateError),this.tracks[s]={buffer:l,codec:n,container:a.container,levelCodec:a.levelCodec,metadata:a.metadata,id:a.id}}catch(l){L.error(`[buffer-controller]: error while trying to add sourceBuffer: ${l.message}`),this.hls.trigger(m.ERROR,{type:$.MEDIA_ERROR,details:I.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:l,mimeType:o})}}}_onSBUpdateStart(t){const{operationQueue:e}=this;e.current(t).onStart()}_onSBUpdateEnd(t){const{operationQueue:e}=this;e.current(t).onComplete(),e.shiftAndExecuteNext(t)}_onSBUpdateError(t,e){const i=new Error(`${t} SourceBuffer error`);L.error(`[buffer-controller]: ${i}`,e),this.hls.trigger(m.ERROR,{type:$.MEDIA_ERROR,details:I.BUFFER_APPENDING_ERROR,error:i,fatal:!1});const s=this.operationQueue.current(t);s&&s.onError(e)}removeExecutor(t,e,i){const{media:s,mediaSource:a,operationQueue:n,sourceBuffer:o}=this,l=o[t];if(!s||!a||!l){L.warn(`[buffer-controller]: Attempting to remove from the ${t} SourceBuffer, but it does not exist`),n.shiftAndExecuteNext(t);return}const u=B(s.duration)?s.duration:1/0,c=B(a.duration)?a.duration:1/0,d=Math.max(0,e),h=Math.min(i,u,c);h>d&&!l.ending?(l.ended=!1,L.log(`[buffer-controller]: Removing [${d},${h}] from the ${t} SourceBuffer`),l.remove(d,h)):n.shiftAndExecuteNext(t)}appendExecutor(t,e){const{operationQueue:i,sourceBuffer:s}=this,a=s[e];if(!a){L.warn(`[buffer-controller]: Attempting to append to the ${e} SourceBuffer, but it does not exist`),i.shiftAndExecuteNext(e);return}a.ended=!1,a.appendBuffer(t)}blockBuffers(t,e=this.getSourceBufferTypes()){if(!e.length){L.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(t);return}const{operationQueue:i}=this,s=e.map(a=>i.appendBlocker(a));Promise.all(s).then(()=>{t(),e.forEach(a=>{const n=this.sourceBuffer[a];n!=null&&n.updating||i.shiftAndExecuteNext(a)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(t,e,i){const s=this.sourceBuffer[t];if(!s)return;const a=i.bind(this,t);this.listeners[t].push({event:e,listener:a}),s.addEventListener(e,a)}removeBufferListeners(t){const e=this.sourceBuffer[t];!e||this.listeners[t].forEach(i=>{e.removeEventListener(i.event,i.listener)})}}const Hc={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},tg=function(r){let t=r;return Hc.hasOwnProperty(r)&&(t=Hc[r]),String.fromCharCode(t)},ce=15,Ie=100,ov={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},lv={17:2,18:4,21:6,22:8,23:10,19:13,20:15},uv={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},cv={25:2,26:4,29:6,30:8,31:10,27:13,28:15},dv=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class hv{constructor(){this.time=null,this.verboseLevel=0}log(t,e){if(this.verboseLevel>=t){const i=typeof e=="function"?e():e;L.log(`${this.time} [${t}] ${i}`)}}}const dr=function(r){const t=[];for(let e=0;e<r.length;e++)t.push(r[e].toString(16));return t};class eg{constructor(t,e,i,s,a){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=t||"white",this.underline=e||!1,this.italics=i||!1,this.background=s||"black",this.flash=a||!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(t){const e=["foreground","underline","italics","background","flash"];for(let i=0;i<e.length;i++){const s=e[i];t.hasOwnProperty(s)&&(this[s]=t[s])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash}copy(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class fv{constructor(t,e,i,s,a,n){this.uchar=void 0,this.penState=void 0,this.uchar=t||" ",this.penState=new eg(e,i,s,a,n)}reset(){this.uchar=" ",this.penState.reset()}setChar(t,e){this.uchar=t,this.penState.copy(e)}setPenState(t){this.penState.copy(t)}equals(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)}copy(t){this.uchar=t.uchar,this.penState.copy(t.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class gv{constructor(t){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(let e=0;e<Ie;e++)this.chars.push(new fv);this.logger=t,this.pos=0,this.currPenState=new eg}equals(t){let e=!0;for(let i=0;i<Ie;i++)if(!this.chars[i].equals(t.chars[i])){e=!1;break}return e}copy(t){for(let e=0;e<Ie;e++)this.chars[e].copy(t.chars[e])}isEmpty(){let t=!0;for(let e=0;e<Ie;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t}setCursor(t){this.pos!==t&&(this.pos=t),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Ie&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Ie)}moveCursor(t){const e=this.pos+t;if(t>1)for(let i=this.pos+1;i<e+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(e)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(t){t>=144&&this.backSpace();const e=tg(t);if(this.pos>=Ie){this.logger.log(0,()=>"Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1)}clearFromPos(t){let e;for(e=t;e<Ie;e++)this.chars[e].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const t=[];let e=!0;for(let i=0;i<Ie;i++){const s=this.chars[i].uchar;s!==" "&&(e=!1),t.push(s)}return e?"":t.join("")}setPenStyles(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)}}class Pn{constructor(t){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(let e=0;e<ce;e++)this.rows.push(new gv(t));this.logger=t,this.currRow=ce-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}reset(){for(let t=0;t<ce;t++)this.rows[t].clear();this.currRow=ce-1}equals(t){let e=!0;for(let i=0;i<ce;i++)if(!this.rows[i].equals(t.rows[i])){e=!1;break}return e}copy(t){for(let e=0;e<ce;e++)this.rows[e].copy(t.rows[e])}isEmpty(){let t=!0;for(let e=0;e<ce;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(t){this.rows[this.currRow].insertChar(t)}setPen(t){this.rows[this.currRow].setPenStyles(t)}moveCursor(t){this.rows[this.currRow].moveCursor(t)}setCursor(t){this.logger.log(2,"setCursor: "+t),this.rows[this.currRow].setCursor(t)}setPAC(t){this.logger.log(2,()=>"pacData = "+JSON.stringify(t));let e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(let o=0;o<ce;o++)this.rows[o].clear();const a=this.currRow+1-this.nrRollUpRows,n=this.lastOutputScreen;if(n){const o=n.rows[a].cueStartTime,l=this.logger.time;if(o&&l!==null&&o<l)for(let u=0;u<this.nrRollUpRows;u++)this.rows[e-this.nrRollUpRows+u+1].copy(n.rows[a+u])}}this.currRow=e;const i=this.rows[this.currRow];if(t.indent!==null){const a=t.indent,n=Math.max(a-1,0);i.setCursor(t.indent),t.color=i.chars[n].penState.foreground}const s={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(s)}setBkgData(t){this.logger.log(2,()=>"bkgData = "+JSON.stringify(t)),this.backSpace(),this.setPen(t),this.insertChar(32)}setRollUpRows(t){this.nrRollUpRows=t}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const t=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(t,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),this.logger.log(2,"Rolling up")}getDisplayText(t){t=t||!1;const e=[];let i="",s=-1;for(let a=0;a<ce;a++){const n=this.rows[a].getTextString();n&&(s=a+1,t?e.push("Row "+s+": '"+n+"'"):e.push(n.trim()))}return e.length>0&&(t?i="["+e.join(" | ")+"]":i=e.join(`
`)),i}getTextAndFormat(){return this.rows}}class zc{constructor(t,e,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new Pn(i),this.nonDisplayedMemory=new Pn(i),this.lastOutputScreen=new Pn(i),this.currRollUpRow=this.displayedMemory.rows[ce-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[ce-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(t){this.outputFilter=t}setPAC(t){this.writeScreen.setPAC(t)}setBkgData(t){this.writeScreen.setBkgData(t)}setMode(t){t!==this.mode&&(this.mode=t,this.logger.log(2,()=>"MODE="+t),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)}insertChars(t){for(let i=0;i<t.length;i++)this.writeScreen.insertChar(t[i]);const e=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>e+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(t){this.logger.log(2,"RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(t){this.logger.log(2,"TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)}ccMIDROW(t){const e={flash:!1};if(e.underline=t%2===1,e.italics=t>=46,e.italics)e.foreground="white";else{const i=Math.floor(t/2)-16,s=["white","green","blue","cyan","red","yellow","magenta"];e.foreground=s[i]}this.logger.log(2,"MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)}outputDataUpdate(t=!1){const e=this.logger.time;e!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=e:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:e),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))}}class Wc{constructor(t,e,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;const s=new hv;this.channels=[null,new zc(t,e,s),new zc(t+1,i,s)],this.cmdHistory=jc(),this.logger=s}getHandler(t){return this.channels[t].getHandler()}setHandler(t,e){this.channels[t].setHandler(e)}addData(t,e){let i,s,a,n=!1;this.logger.time=t;for(let o=0;o<e.length;o+=2)if(s=e[o]&127,a=e[o+1]&127,!(s===0&&a===0)){if(this.logger.log(3,"["+dr([e[o],e[o+1]])+"] -> ("+dr([s,a])+")"),i=this.parseCmd(s,a),i||(i=this.parseMidrow(s,a)),i||(i=this.parsePAC(s,a)),i||(i=this.parseBackgroundAttributes(s,a)),!i&&(n=this.parseChars(s,a),n)){const l=this.currentChannel;l&&l>0?this.channels[l].insertChars(n):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!i&&!n&&this.logger.log(2,"Couldn't parse cleaned data "+dr([s,a])+" orig: "+dr([e[o],e[o+1]]))}}parseCmd(t,e){const{cmdHistory:i}=this,s=(t===20||t===28||t===21||t===29)&&e>=32&&e<=47,a=(t===23||t===31)&&e>=33&&e<=35;if(!(s||a))return!1;if(Yc(t,e,i))return Or(null,null,i),this.logger.log(3,"Repeated command ("+dr([t,e])+") is dropped"),!0;const n=t===20||t===21||t===23?1:2,o=this.channels[n];return t===20||t===21||t===28||t===29?e===32?o.ccRCL():e===33?o.ccBS():e===34?o.ccAOF():e===35?o.ccAON():e===36?o.ccDER():e===37?o.ccRU(2):e===38?o.ccRU(3):e===39?o.ccRU(4):e===40?o.ccFON():e===41?o.ccRDC():e===42?o.ccTR():e===43?o.ccRTD():e===44?o.ccEDM():e===45?o.ccCR():e===46?o.ccENM():e===47&&o.ccEOC():o.ccTO(e-32),Or(t,e,i),this.currentChannel=n,!0}parseMidrow(t,e){let i=0;if((t===17||t===25)&&e>=32&&e<=47){if(t===17?i=1:i=2,i!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const s=this.channels[i];return s?(s.ccMIDROW(e),this.logger.log(3,"MIDROW ("+dr([t,e])+")"),!0):!1}return!1}parsePAC(t,e){let i;const s=this.cmdHistory,a=(t>=17&&t<=23||t>=25&&t<=31)&&e>=64&&e<=127,n=(t===16||t===24)&&e>=64&&e<=95;if(!(a||n))return!1;if(Yc(t,e,s))return Or(null,null,s),!0;const o=t<=23?1:2;e>=64&&e<=95?i=o===1?ov[t]:uv[t]:i=o===1?lv[t]:cv[t];const l=this.channels[o];return l?(l.setPAC(this.interpretPAC(i,e)),Or(t,e,s),this.currentChannel=o,!0):!1}interpretPAC(t,e){let i;const s={color:null,italics:!1,indent:null,underline:!1,row:t};return e>95?i=e-96:i=e-64,s.underline=(i&1)===1,i<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(s.italics=!0,s.color="white"):s.indent=Math.floor((i-16)/2)*4,s}parseChars(t,e){let i,s=null,a=null;if(t>=25?(i=2,a=t-8):(i=1,a=t),a>=17&&a<=19){let n;a===17?n=e+80:a===18?n=e+112:n=e+144,this.logger.log(2,"Special char '"+tg(n)+"' in channel "+i),s=[n]}else t>=32&&t<=127&&(s=e===0?[t]:[t,e]);if(s){const n=dr(s);this.logger.log(3,"Char codes =  "+n.join(",")),Or(t,e,this.cmdHistory)}return s}parseBackgroundAttributes(t,e){const i=(t===16||t===24)&&e>=32&&e<=47,s=(t===23||t===31)&&e>=45&&e<=47;if(!(i||s))return!1;let a;const n={};t===16||t===24?(a=Math.floor((e-32)/2),n.background=dv[a],e%2===1&&(n.background=n.background+"_semi")):e===45?n.background="transparent":(n.foreground="black",e===47&&(n.underline=!0));const o=t<=23?1:2;return this.channels[o].setBkgData(n),Or(t,e,this.cmdHistory),!0}reset(){for(let t=0;t<Object.keys(this.channels).length;t++){const e=this.channels[t];e&&e.reset()}this.cmdHistory=jc()}cueSplitAtTime(t){for(let e=0;e<this.channels.length;e++){const i=this.channels[e];i&&i.cueSplitAtTime(t)}}}function Or(r,t,e){e.a=r,e.b=t}function Yc(r,t,e){return e.a===r&&e.b===t}function jc(){return{a:null,b:null}}class Cs{constructor(t,e){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=t,this.trackName=e}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(t,e,i){(this.startTime===null||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var ql=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;const r=["","lr","rl"],t=["start","middle","end","left","right"];function e(o,l){if(typeof l!="string"||!Array.isArray(o))return!1;const u=l.toLowerCase();return~o.indexOf(u)?u:!1}function i(o){return e(r,o)}function s(o){return e(t,o)}function a(o,...l){let u=1;for(;u<arguments.length;u++){const c=arguments[u];for(const d in c)o[d]=c[d]}return o}function n(o,l,u){const c=this,d={enumerable:!0};c.hasBeenReset=!1;let h="",f=!1,g=o,p=l,T=u,y=null,v="",E=!0,S="auto",b="start",w=50,k="middle",D=50,P="middle";Object.defineProperty(c,"id",a({},d,{get:function(){return h},set:function(R){h=""+R}})),Object.defineProperty(c,"pauseOnExit",a({},d,{get:function(){return f},set:function(R){f=!!R}})),Object.defineProperty(c,"startTime",a({},d,{get:function(){return g},set:function(R){if(typeof R!="number")throw new TypeError("Start time must be set to a number.");g=R,this.hasBeenReset=!0}})),Object.defineProperty(c,"endTime",a({},d,{get:function(){return p},set:function(R){if(typeof R!="number")throw new TypeError("End time must be set to a number.");p=R,this.hasBeenReset=!0}})),Object.defineProperty(c,"text",a({},d,{get:function(){return T},set:function(R){T=""+R,this.hasBeenReset=!0}})),Object.defineProperty(c,"region",a({},d,{get:function(){return y},set:function(R){y=R,this.hasBeenReset=!0}})),Object.defineProperty(c,"vertical",a({},d,{get:function(){return v},set:function(R){const U=i(R);if(U===!1)throw new SyntaxError("An invalid or illegal string was specified.");v=U,this.hasBeenReset=!0}})),Object.defineProperty(c,"snapToLines",a({},d,{get:function(){return E},set:function(R){E=!!R,this.hasBeenReset=!0}})),Object.defineProperty(c,"line",a({},d,{get:function(){return S},set:function(R){if(typeof R!="number"&&R!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");S=R,this.hasBeenReset=!0}})),Object.defineProperty(c,"lineAlign",a({},d,{get:function(){return b},set:function(R){const U=s(R);if(!U)throw new SyntaxError("An invalid or illegal string was specified.");b=U,this.hasBeenReset=!0}})),Object.defineProperty(c,"position",a({},d,{get:function(){return w},set:function(R){if(R<0||R>100)throw new Error("Position must be between 0 and 100.");w=R,this.hasBeenReset=!0}})),Object.defineProperty(c,"positionAlign",a({},d,{get:function(){return k},set:function(R){const U=s(R);if(!U)throw new SyntaxError("An invalid or illegal string was specified.");k=U,this.hasBeenReset=!0}})),Object.defineProperty(c,"size",a({},d,{get:function(){return D},set:function(R){if(R<0||R>100)throw new Error("Size must be between 0 and 100.");D=R,this.hasBeenReset=!0}})),Object.defineProperty(c,"align",a({},d,{get:function(){return P},set:function(R){const U=s(R);if(!U)throw new SyntaxError("An invalid or illegal string was specified.");P=U,this.hasBeenReset=!0}})),c.displayState=void 0}return n.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},n}();class pv{decode(t,e){if(!t)return"";if(typeof t!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))}}function rg(r){function t(i,s,a,n){return(i|0)*3600+(s|0)*60+(a|0)+parseFloat(n||0)}const e=r.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return e?parseFloat(e[2])>59?t(e[2],e[3],0,e[4]):t(e[1],e[2],e[3],e[4]):null}class mv{constructor(){this.values=Object.create(null)}set(t,e){!this.get(t)&&e!==""&&(this.values[t]=e)}get(t,e,i){return i?this.has(t)?this.values[t]:e[i]:this.has(t)?this.values[t]:e}has(t){return t in this.values}alt(t,e,i){for(let s=0;s<i.length;++s)if(e===i[s]){this.set(t,e);break}}integer(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))}percent(t,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){const i=parseFloat(e);if(i>=0&&i<=100)return this.set(t,i),!0}return!1}}function ig(r,t,e,i){const s=i?r.split(i):[r];for(const a in s){if(typeof s[a]!="string")continue;const n=s[a].split(e);if(n.length!==2)continue;const o=n[0],l=n[1];t(o,l)}}const $o=new ql(0,0,""),_s=$o.align==="middle"?"middle":"center";function yv(r,t,e){const i=r;function s(){const o=rg(r);if(o===null)throw new Error("Malformed timestamp: "+i);return r=r.replace(/^[^\sa-zA-Z-]+/,""),o}function a(o,l){const u=new mv;ig(o,function(h,f){let g;switch(h){case"region":for(let p=e.length-1;p>=0;p--)if(e[p].id===f){u.set(h,e[p].region);break}break;case"vertical":u.alt(h,f,["rl","lr"]);break;case"line":g=f.split(","),u.integer(h,g[0]),u.percent(h,g[0])&&u.set("snapToLines",!1),u.alt(h,g[0],["auto"]),g.length===2&&u.alt("lineAlign",g[1],["start",_s,"end"]);break;case"position":g=f.split(","),u.percent(h,g[0]),g.length===2&&u.alt("positionAlign",g[1],["start",_s,"end","line-left","line-right","auto"]);break;case"size":u.percent(h,f);break;case"align":u.alt(h,f,["start",_s,"end","left","right"]);break}},/:/,/\s/),l.region=u.get("region",null),l.vertical=u.get("vertical","");let c=u.get("line","auto");c==="auto"&&$o.line===-1&&(c=-1),l.line=c,l.lineAlign=u.get("lineAlign","start"),l.snapToLines=u.get("snapToLines",!0),l.size=u.get("size",100),l.align=u.get("align",_s);let d=u.get("position","auto");d==="auto"&&$o.position===50&&(d=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=d}function n(){r=r.replace(/^\s+/,"")}if(n(),t.startTime=s(),n(),r.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+i);r=r.slice(3),n(),t.endTime=s(),n(),a(r,t)}function sg(r){return r.replace(/<br(?: \/)?>/gi,`
`)}class vv{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new pv,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(t){const e=this;t&&(e.buffer+=e.decoder.decode(t,{stream:!0}));function i(){let a=e.buffer,n=0;for(a=sg(a);n<a.length&&a[n]!=="\r"&&a[n]!==`
`;)++n;const o=a.slice(0,n);return a[n]==="\r"&&++n,a[n]===`
`&&++n,e.buffer=a.slice(n),o}function s(a){ig(a,function(n,o){},/:/)}try{let a="";if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;a=i();const o=a.match(/^()?WEBVTT([ \t].*)?$/);if(!(o!=null&&o[0]))throw new Error("Malformed WebVTT signature.");e.state="HEADER"}let n=!1;for(;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(n?n=!1:a=i(),e.state){case"HEADER":/:/.test(a)?s(a):a||(e.state="ID");continue;case"NOTE":a||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(a)){e.state="NOTE";break}if(!a)continue;if(e.cue=new ql(0,0,""),e.state="CUE",a.indexOf("-->")===-1){e.cue.id=a;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{yv(a,e.cue,e.regionList)}catch{e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":{const o=a.indexOf("-->")!==-1;if(!a||o&&(n=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(e.cue===null)continue;e.cue.text&&(e.cue.text+=`
`),e.cue.text+=a}continue;case"BADCUE":a||(e.state="ID")}}}catch{e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const t=this;try{if((t.cue||t.state==="HEADER")&&(t.buffer+=`

`,t.parse()),t.state==="INITIAL"||t.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(e){t.onparsingerror&&t.onparsingerror(e)}return t.onflush&&t.onflush(),this}}const Ev=/\r\n|\n\r|\n|\r/g,xn=function(r,t,e=0){return r.slice(e,e+t.length)===t},Tv=function(r){let t=parseInt(r.slice(-3));const e=parseInt(r.slice(-6,-4)),i=parseInt(r.slice(-9,-7)),s=r.length>9?parseInt(r.substring(0,r.indexOf(":"))):0;if(!B(t)||!B(e)||!B(i)||!B(s))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${r}`);return t+=1e3*e,t+=60*1e3*i,t+=60*60*1e3*s,t},On=function(r){let t=5381,e=r.length;for(;e;)t=t*33^r.charCodeAt(--e);return(t>>>0).toString()};function Xl(r,t,e){return On(r.toString())+On(t.toString())+On(e)}const Sv=function(r,t,e){let i=r[t],s=r[i.prevCC];if(!s||!s.new&&i.new){r.ccOffset=r.presentationOffset=i.start,i.new=!1;return}for(;(a=s)!=null&&a.new;){var a;r.ccOffset+=i.start-s.start,i.new=!1,i=s,s=r[i.prevCC]}r.presentationOffset=e};function bv(r,t,e,i,s,a,n){const o=new vv,l=Re(new Uint8Array(r)).trim().replace(Ev,`
`).split(`
`),u=[],c=xy(t.baseTime,t.timescale);let d="00:00.000",h=0,f=0,g,p=!0;o.oncue=function(T){const y=e[i];let v=e.ccOffset;const E=(h-c)/9e4;y!=null&&y.new&&(f!==void 0?v=e.ccOffset=y.start:Sv(e,i,E)),E&&(v=E-e.presentationOffset);const S=T.endTime-T.startTime,b=ee((T.startTime+v-f)*9e4,s*9e4)/9e4;T.startTime=Math.max(b,0),T.endTime=Math.max(b+S,0);const w=T.text.trim();T.text=decodeURIComponent(encodeURIComponent(w)),T.id||(T.id=Xl(T.startTime,T.endTime,w)),T.endTime>0&&u.push(T)},o.onparsingerror=function(T){g=T},o.onflush=function(){if(g){n(g);return}a(u)},l.forEach(T=>{if(p)if(xn(T,"X-TIMESTAMP-MAP=")){p=!1,T.slice(16).split(",").forEach(y=>{xn(y,"LOCAL:")?d=y.slice(6):xn(y,"MPEGTS:")&&(h=parseInt(y.slice(7)))});try{f=Tv(d)/1e3}catch(y){g=y}return}else T===""&&(p=!1);o.parse(T+`
`)}),o.flush()}const Fn="stpp.ttml.im1t",ag=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,ng=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,Lv={left:"start",center:"center",right:"end",start:"start",end:"end"};function qc(r,t,e,i){const s=j(new Uint8Array(r),["mdat"]);if(s.length===0){i(new Error("Could not parse IMSC1 mdat"));return}const a=s.map(o=>Re(o)),n=Py(t.baseTime,1,t.timescale);try{a.forEach(o=>e(kv(o,n)))}catch(o){i(o)}}function kv(r,t){const e=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("tt")[0];if(!e)throw new Error("Invalid ttml");const i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},s=Object.keys(i).reduce((u,c)=>(u[c]=e.getAttribute(`ttp:${c}`)||i[c],u),{}),a=e.getAttribute("xml:space")!=="preserve",n=Xc(Mn(e,"styling","style")),o=Xc(Mn(e,"layout","region")),l=Mn(e,"body","[begin]");return[].map.call(l,u=>{const c=og(u,a);if(!c||!u.hasAttribute("begin"))return null;const d=Un(u.getAttribute("begin"),s),h=Un(u.getAttribute("dur"),s);let f=Un(u.getAttribute("end"),s);if(d===null)throw Qc(u);if(f===null){if(h===null)throw Qc(u);f=d+h}const g=new ql(d-t,f-t,c);g.id=Xl(g.startTime,g.endTime,g.text);const p=o[u.getAttribute("region")],T=n[u.getAttribute("style")],y=Av(p,T,n),{textAlign:v}=y;if(v){const E=Lv[v];E&&(g.lineAlign=E),g.align=v}return vt(g,y),g}).filter(u=>u!==null)}function Mn(r,t,e){const i=r.getElementsByTagName(t)[0];return i?[].slice.call(i.querySelectorAll(e)):[]}function Xc(r){return r.reduce((t,e)=>{const i=e.getAttribute("xml:id");return i&&(t[i]=e),t},{})}function og(r,t){return[].slice.call(r.childNodes).reduce((e,i,s)=>{var a;return i.nodeName==="br"&&s?e+`
`:(a=i.childNodes)!=null&&a.length?og(i,t):t?e+i.textContent.trim().replace(/\s+/g," "):e+i.textContent},"")}function Av(r,t,e){const i="http://www.w3.org/ns/ttml#styling";let s=null;const a=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],n=r!=null&&r.hasAttribute("style")?r.getAttribute("style"):null;return n&&e.hasOwnProperty(n)&&(s=e[n]),a.reduce((o,l)=>{const u=Nn(t,i,l)||Nn(r,i,l)||Nn(s,i,l);return u&&(o[l]=u),o},{})}function Nn(r,t,e){return r&&r.hasAttributeNS(t,e)?r.getAttributeNS(t,e):null}function Qc(r){return new Error(`Could not parse ttml timestamp ${r}`)}function Un(r,t){if(!r)return null;let e=rg(r);return e===null&&(ag.test(r)?e=wv(r,t):ng.test(r)&&(e=Rv(r,t))),e}function wv(r,t){const e=ag.exec(r),i=(e[4]|0)+(e[5]|0)/t.subFrameRate;return(e[1]|0)*3600+(e[2]|0)*60+(e[3]|0)+i/t.frameRate}function Rv(r,t){const e=ng.exec(r),i=Number(e[1]);switch(e[2]){case"h":return i*3600;case"m":return i*60;case"ms":return i*1e3;case"f":return i/t.frameRate;case"t":return i/t.tickRate}return i}class Iv{constructor(t){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Jc(),this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){const e=new Cs(this,"textTrack1"),i=new Cs(this,"textTrack2"),s=new Cs(this,"textTrack3"),a=new Cs(this,"textTrack4");this.cea608Parser1=new Wc(1,e,i),this.cea608Parser2=new Wc(3,s,a)}t.on(m.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(m.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(m.MANIFEST_LOADING,this.onManifestLoading,this),t.on(m.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(m.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(m.FRAG_LOADING,this.onFragLoading,this),t.on(m.FRAG_LOADED,this.onFragLoaded,this),t.on(m.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(m.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(m.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(m.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(m.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:t}=this;t.off(m.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(m.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(m.MANIFEST_LOADING,this.onManifestLoading,this),t.off(m.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(m.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(m.FRAG_LOADING,this.onFragLoading,this),t.off(m.FRAG_LOADED,this.onFragLoaded,this),t.off(m.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.off(m.FRAG_DECRYPTED,this.onFragDecrypted,this),t.off(m.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(m.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.off(m.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null}addCues(t,e,i,s,a){let n=!1;for(let o=a.length;o--;){const l=a[o],u=Cv(l[0],l[1],e,i);if(u>=0&&(l[0]=Math.min(l[0],e),l[1]=Math.max(l[1],i),n=!0,u/(i-e)>.5))return}if(n||a.push([e,i]),this.config.renderTextTracksNatively){const o=this.captionsTracks[t];this.Cues.newCue(o,e,i,s)}else{const o=this.Cues.newCue(null,e,i,s);this.hls.trigger(m.CUES_PARSED,{type:"captions",cues:o,track:t})}}onInitPtsFound(t,{frag:e,id:i,initPTS:s,timescale:a}){const{unparsedVttFrags:n}=this;i==="main"&&(this.initPTS[e.cc]={baseTime:s,timescale:a}),n.length&&(this.unparsedVttFrags=[],n.forEach(o=>{this.onFragLoaded(m.FRAG_LOADED,o)}))}getExistingTrack(t){const{media:e}=this;if(e)for(let i=0;i<e.textTracks.length;i++){const s=e.textTracks[i];if(s[t])return s}return null}createCaptionsTrack(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)}createNativeTrack(t){if(this.captionsTracks[t])return;const{captionsProperties:e,captionsTracks:i,media:s}=this,{label:a,languageCode:n}=e[t],o=this.getExistingTrack(t);if(o)i[t]=o,Yr(i[t]),Df(i[t],s);else{const l=this.createTextTrack("captions",a,n);l&&(l[t]=!0,i[t]=l)}}createNonNativeTrack(t){if(this.nonNativeCaptionsTracks[t])return;const e=this.captionsProperties[t];if(!e)return;const i=e.label,s={_id:t,label:i,kind:"captions",default:e.media?!!e.media.default:!1,closedCaptions:e.media};this.nonNativeCaptionsTracks[t]=s,this.hls.trigger(m.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(t,e,i){const s=this.media;if(s)return s.addTextTrack(t,e,i)}onMediaAttaching(t,e){this.media=e.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:t}=this;Object.keys(t).forEach(e=>{Yr(t[e]),delete t[e]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Jc(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:t}=this;if(!t)return;const e=t.textTracks;if(e)for(let i=0;i<e.length;i++)Yr(e[i])}onSubtitleTracksUpdated(t,e){const i=e.subtitleTracks||[],s=i.some(a=>a.textCodec===Fn);if(this.config.enableWebVTT||s&&this.config.enableIMSC1){if(Zf(this.tracks,i)){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){const a=this.media?this.media.textTracks:null;this.tracks.forEach((n,o)=>{let l;if(a&&o<a.length){let u=null;for(let c=0;c<a.length;c++)if(Dv(a[c],n)){u=a[c];break}u&&(l=u)}if(l)Yr(l);else{const u=this._captionsOrSubtitlesFromCharacteristics(n);l=this.createTextTrack(u,n.name,n.lang),l&&(l.mode="disabled")}l&&(l.groupId=n.groupId,this.textTracks.push(l))})}else if(this.tracks.length){const a=this.tracks.map(n=>({label:n.name,kind:n.type.toLowerCase(),default:n.default,subtitleTrack:n}));this.hls.trigger(m.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}}_captionsOrSubtitlesFromCharacteristics(t){if(t.attrs.CHARACTERISTICS){const e=/transcribes-spoken-dialog/gi.test(t.attrs.CHARACTERISTICS),i=/describes-music-and-sound/gi.test(t.attrs.CHARACTERISTICS);if(e&&i)return"captions"}return"subtitles"}onManifestLoaded(t,e){this.config.enableCEA708Captions&&e.captions&&e.captions.forEach(i=>{const s=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!s)return;const a=`textTrack${s[1]}`,n=this.captionsProperties[a];!n||(n.label=i.name,i.lang&&(n.languageCode=i.lang),n.media=i)})}closedCaptionsForLevel(t){const e=this.hls.levels[t.level];return e==null?void 0:e.attrs["CLOSED-CAPTIONS"]}onFragLoading(t,e){const{cea608Parser1:i,cea608Parser2:s,lastSn:a,lastPartIndex:n}=this;if(!(!this.enabled||!(i&&s))&&e.frag.type===G.MAIN){var o,l;const u=e.frag.sn,c=(o=e==null||(l=e.part)==null?void 0:l.index)!=null?o:-1;u===a+1||u===a&&c===n+1||(i.reset(),s.reset()),this.lastSn=u,this.lastPartIndex=c}}onFragLoaded(t,e){const{frag:i,payload:s}=e,{initPTS:a,unparsedVttFrags:n}=this;if(i.type===G.SUBTITLE)if(s.byteLength){if(!a[i.cc]){n.push(e),a.length&&this.hls.trigger(m.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Missing initial subtitle PTS")});return}const o=i.decryptdata,l="stats"in e;if(o==null||!o.encrypted||l){const u=this.tracks[i.level],c=this.vttCCs;c[i.cc]||(c[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),u&&u.textCodec===Fn?this._parseIMSC1(i,s):this._parseVTTs(i,s,c)}}else this.hls.trigger(m.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})}_parseIMSC1(t,e){const i=this.hls;qc(e,this.initPTS[t.cc],s=>{this._appendCues(s,t.level),i.trigger(m.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},s=>{L.log(`Failed to parse IMSC1: ${s}`),i.trigger(m.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:s})})}_parseVTTs(t,e,i){var s;const a=this.hls,n=(s=t.initSegment)!=null&&s.data?Rr(t.initSegment.data,new Uint8Array(e)):e;bv(n,this.initPTS[t.cc],i,t.cc,t.start,o=>{this._appendCues(o,t.level),a.trigger(m.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},o=>{this._fallbackToIMSC1(t,e),L.log(`Failed to parse VTT cue: ${o}`),a.trigger(m.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:o})})}_fallbackToIMSC1(t,e){const i=this.tracks[t.level];i.textCodec||qc(e,this.initPTS[t.cc],()=>{i.textCodec=Fn,this._parseIMSC1(t,e)},()=>{i.textCodec="wvtt"})}_appendCues(t,e){const i=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[e];if(!s||s.mode==="disabled")return;t.forEach(a=>Cf(s,a))}else{const s=this.tracks[e];if(!s)return;const a=s.default?"default":"subtitles"+e;i.trigger(m.CUES_PARSED,{type:"subtitles",cues:t,track:a})}}onFragDecrypted(t,e){const{frag:i}=e;if(i.type===G.SUBTITLE){if(!this.initPTS[i.cc]){this.unparsedVttFrags.push(e);return}this.onFragLoaded(m.FRAG_LOADED,e)}}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(t,e){const{cea608Parser1:i,cea608Parser2:s}=this;if(!this.enabled||!(i&&s))return;const{frag:a,samples:n}=e;if(!(a.type===G.MAIN&&this.closedCaptionsForLevel(a)==="NONE"))for(let o=0;o<n.length;o++){const l=n[o].bytes;if(l){const u=this.extractCea608Data(l);i.addData(n[o].pts,u[0]),s.addData(n[o].pts,u[1])}}}onBufferFlushing(t,{startOffset:e,endOffset:i,endOffsetSubtitles:s,type:a}){const{media:n}=this;if(!(!n||n.currentTime<i)){if(!a||a==="video"){const{captionsTracks:o}=this;Object.keys(o).forEach(l=>Oo(o[l],e,i))}if(this.config.renderTextTracksNatively&&e===0&&s!==void 0){const{textTracks:o}=this;Object.keys(o).forEach(l=>Oo(o[l],e,s))}}}extractCea608Data(t){const e=[[],[]],i=t[0]&31;let s=2;for(let a=0;a<i;a++){const n=t[s++],o=127&t[s++],l=127&t[s++];if(!(o===0&&l===0)&&(4&n)!==0){const u=3&n;(u===0||u===1)&&(e[u].push(o),e[u].push(l))}}return e}}function Dv(r,t){return!!r&&r.label===t.name&&!(r.textTrack1||r.textTrack2)}function Cv(r,t,e,i){return Math.min(t,i)-Math.max(r,e)}function Jc(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}class Ql{constructor(t){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=t,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(t){this.streamController=t}destroy(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:t}=this;t.on(m.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.on(m.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(m.MANIFEST_PARSED,this.onManifestParsed,this),t.on(m.BUFFER_CODECS,this.onBufferCodecs,this),t.on(m.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:t}=this;t.off(m.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.off(m.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(m.MANIFEST_PARSED,this.onManifestParsed,this),t.off(m.BUFFER_CODECS,this.onBufferCodecs,this),t.off(m.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(t,e){const i=this.hls.levels[e.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(t,e){this.media=e.media instanceof HTMLVideoElement?e.media:null,this.clientRect=null}onManifestParsed(t,e){const i=this.hls;this.restrictedLevels=[],this.firstLevel=e.firstLevel,i.config.capLevelToPlayerSize&&e.video&&this.startCapping()}onBufferCodecs(t,e){this.hls.config.capLevelToPlayerSize&&e.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){const t=this.hls.levels;if(t.length){const e=this.hls;e.autoLevelCapping=this.getMaxLevel(t.length-1),e.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}}getMaxLevel(t){const e=this.hls.levels;if(!e.length)return-1;const i=e.filter((s,a)=>this.isLevelAllowed(s)&&a<=t);return this.clientRect=null,Ql.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const t=this.media,e={width:0,height:0};if(t){const i=t.getBoundingClientRect();e.width=i.width,e.height=i.height,!e.width&&!e.height&&(e.width=i.right-i.left||t.width||0,e.height=i.bottom-i.top||t.height||0)}return this.clientRect=e,e}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let t=1;if(!this.hls.config.ignoreDevicePixelRatio)try{t=self.devicePixelRatio}catch{}return t}isLevelAllowed(t){return!this.restrictedLevels.some(e=>t.bitrate===e.bitrate&&t.width===e.width&&t.height===e.height)}static getMaxLevelByMediaSize(t,e,i){if(!(t!=null&&t.length))return-1;const s=(n,o)=>o?n.width!==o.width||n.height!==o.height:!0;let a=t.length-1;for(let n=0;n<t.length;n+=1){const o=t[n];if((o.width>=e||o.height>=i)&&s(o,t[n+1])){a=n;break}}return a}}class _v{constructor(t){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=t,this.registerListeners()}setStreamController(t){this.streamController=t}registerListeners(){this.hls.on(m.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(m.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(t,e){const i=this.hls.config;if(i.capLevelOnFPSDrop){const s=e.media instanceof self.HTMLVideoElement?e.media:null;this.media=s,s&&typeof s.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}checkFPS(t,e,i){const s=performance.now();if(e){if(this.lastTime){const a=s-this.lastTime,n=i-this.lastDroppedFrames,o=e-this.lastDecodedFrames,l=1e3*n/a,u=this.hls;if(u.trigger(m.FPS_DROP,{currentDropped:n,currentDecoded:o,totalDroppedFrames:i}),l>0&&n>u.config.fpsDroppedMonitoringThreshold*o){let c=u.currentLevel;L.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=c)&&(c=c-1,u.trigger(m.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:u.currentLevel}),u.autoLevelCapping=c,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=i,this.lastDecodedFrames=e}}checkFPSInterval(){const t=this.media;if(t)if(this.isVideoPlaybackQualityAvailable){const e=t.getVideoPlaybackQuality();this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)}}const Ps="[eme]";class ti{constructor(t){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=ti.CDMCleanupPromise?[ti.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=L.debug.bind(L,Ps),this.log=L.log.bind(L,Ps),this.warn=L.warn.bind(L,Ps),this.error=L.error.bind(L,Ps),this.hls=t,this.config=t.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const t=this.config;t.requestMediaKeySystemAccessFunc=null,t.licenseXhrSetup=t.licenseResponseCallback=void 0,t.drmSystems=t.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(m.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(m.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(m.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(m.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(m.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(m.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(m.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(m.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(t){const{drmSystems:e,widevineLicenseUrl:i}=this.config,s=e[t];if(s)return s.licenseUrl;if(t===lt.WIDEVINE&&i)return i;throw new Error(`no license server URL configured for key-system "${t}"`)}getServerCertificateUrl(t){const{drmSystems:e}=this.config,i=e[t];if(i)return i.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${t}"]`)}attemptKeySystemAccess(t){const e=this.hls.levels,i=(n,o,l)=>!!n&&l.indexOf(n)===o,s=e.map(n=>n.audioCodec).filter(i),a=e.map(n=>n.videoCodec).filter(i);return s.length+a.length===0&&a.push("avc1.42e01e"),new Promise((n,o)=>{const l=u=>{const c=u.shift();this.getMediaKeysPromise(c,s,a).then(d=>n({keySystem:c,mediaKeys:d})).catch(d=>{u.length?l(u):d instanceof te?o(d):o(new te({type:$.KEY_SYSTEM_ERROR,details:I.KEY_SYSTEM_NO_ACCESS,error:d,fatal:!0},d.message))})};l(t)})}requestMediaKeySystemAccess(t,e){const{requestMediaKeySystemAccessFunc:i}=this.config;if(typeof i!="function"){let s=`Configured requestMediaKeySystemAccess is not a function ${i}`;return yf===null&&self.location.protocol==="http:"&&(s=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(s))}return i(t,e)}getMediaKeysPromise(t,e,i){const s=zm(t,e,i,this.config.drmSystemOptions),a=this.keySystemAccessPromises[t];let n=a==null?void 0:a.keySystemAccess;if(!n){this.log(`Requesting encrypted media "${t}" key-system access with config: ${JSON.stringify(s)}`),n=this.requestMediaKeySystemAccess(t,s);const o=this.keySystemAccessPromises[t]={keySystemAccess:n};return n.catch(l=>{this.log(`Failed to obtain access to key-system "${t}": ${l}`)}),n.then(l=>{this.log(`Access for key-system "${l.keySystem}" obtained`);const u=this.fetchServerCertificate(t);return this.log(`Create media-keys for "${t}"`),o.mediaKeys=l.createMediaKeys().then(c=>(this.log(`Media-keys created for "${t}"`),u.then(d=>d?this.setMediaKeysServerCertificate(c,t,d):c))),o.mediaKeys.catch(c=>{this.error(`Failed to create media-keys for "${t}"}: ${c}`)}),o.mediaKeys})}return n.then(()=>a.mediaKeys)}createMediaKeySessionContext({decryptdata:t,keySystem:e,mediaKeys:i}){this.log(`Creating key-system session "${e}" keyId: ${be.hexDump(t.keyId||[])}`);const s=i.createSession(),a={decryptdata:t,keySystem:e,mediaKeys:i,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(a),a}renewKeySession(t){const e=t.decryptdata;if(e.pssh){const i=this.createMediaKeySessionContext(t),s=this.getKeyIdString(e),a="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(i,a,e.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(t)}getKeyIdString(t){if(!t)throw new Error("Could not read keyId of undefined decryptdata");if(t.keyId===null)throw new Error("keyId is null");return be.hexDump(t.keyId)}updateKeySession(t,e){var i;const s=t.mediaKeysSession;return this.log(`Updating key-session "${s.sessionId}" for keyID ${be.hexDump(((i=t.decryptdata)==null?void 0:i.keyId)||[])}
      } (data length: ${e&&e.byteLength})`),s.update(e)}selectKeySystemFormat(t){const e=Object.keys(t.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${t.sn} ${t.type}: ${t.level}) key formats ${e.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(e)),this.keyFormatPromise}getKeyFormatPromise(t){return new Promise((e,i)=>{const s=mn(this.config),a=t.map(uc).filter(n=>!!n&&s.indexOf(n)!==-1);return this.getKeySystemSelectionPromise(a).then(({keySystem:n})=>{const o=cc(n);o?e(o):i(new Error(`Unable to find format for key-system "${n}"`))}).catch(i)})}loadKey(t){const e=t.keyInfo.decryptdata,i=this.getKeyIdString(e),s=`(keyId: ${i} format: "${e.keyFormat}" method: ${e.method} uri: ${e.uri})`;this.log(`Starting session for key ${s}`);let a=this.keyIdToKeySessionPromise[i];return a||(a=this.keyIdToKeySessionPromise[i]=this.getKeySystemForKeyPromise(e).then(({keySystem:n,mediaKeys:o})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${t.frag.sn} ${t.frag.type}: ${t.frag.level} using key ${s}`),this.attemptSetMediaKeys(n,o).then(()=>{this.throwIfDestroyed();const l=this.createMediaKeySessionContext({keySystem:n,mediaKeys:o,decryptdata:e}),u="cenc";return this.generateRequestWithPreferredKeySession(l,u,e.pssh,"playlist-key")}))),a.catch(n=>this.handleError(n))),a}throwIfDestroyed(t="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(t){!this.hls||(this.error(t.message),t instanceof te?this.hls.trigger(m.ERROR,t.data):this.hls.trigger(m.ERROR,{type:$.KEY_SYSTEM_ERROR,details:I.KEY_SYSTEM_NO_KEYS,error:t,fatal:!0}))}getKeySystemForKeyPromise(t){const e=this.getKeyIdString(t),i=this.keyIdToKeySessionPromise[e];if(!i){const s=uc(t.keyFormat),a=s?[s]:mn(this.config);return this.attemptKeySystemAccess(a)}return i}getKeySystemSelectionPromise(t){if(t.length||(t=mn(this.config)),t.length===0)throw new te({type:$.KEY_SYSTEM_ERROR,details:I.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(t)}_onMediaEncrypted(t){const{initDataType:e,initData:i}=t;if(this.debug(`"${t.type}" event: init data type: "${e}"`),i===null)return;let s,a;if(e==="sinf"&&this.config.drmSystems[lt.FAIRPLAY]){const c=Lt(new Uint8Array(i));try{const d=Nl(JSON.parse(c).sinf),h=Af(new Uint8Array(d));if(!h)return;s=h.subarray(8,24),a=lt.FAIRPLAY}catch{this.warn('Failed to parse sinf "encrypted" event message initData');return}}else{const c=p0(i);if(c===null)return;c.version===0&&c.systemId===mf.WIDEVINE&&c.data&&(s=c.data.subarray(8,24)),a=Hm(c.systemId)}if(!a||!s)return;const n=be.hexDump(s),{keyIdToKeySessionPromise:o,mediaKeySessions:l}=this;let u=o[n];for(let c=0;c<l.length;c++){const d=l[c],h=d.decryptdata;if(h.pssh||!h.keyId)continue;const f=be.hexDump(h.keyId);if(n===f||h.uri.replace(/-/g,"").indexOf(n)!==-1){u=o[f],delete o[f],h.pssh=new Uint8Array(i),h.keyId=s,u=o[n]=u.then(()=>this.generateRequestWithPreferredKeySession(d,e,i,"encrypted-event-key-match"));break}}u||(u=o[n]=this.getKeySystemSelectionPromise([a]).then(({keySystem:c,mediaKeys:d})=>{var h;this.throwIfDestroyed();const f=new Ji("ISO-23001-7",n,(h=cc(c))!=null?h:"");return f.pssh=new Uint8Array(i),f.keyId=s,this.attemptSetMediaKeys(c,d).then(()=>{this.throwIfDestroyed();const g=this.createMediaKeySessionContext({decryptdata:f,keySystem:c,mediaKeys:d});return this.generateRequestWithPreferredKeySession(g,e,i,"encrypted-event-no-match")})})),u.catch(c=>this.handleError(c))}_onWaitingForKey(t){this.log(`"${t.type}" event`)}attemptSetMediaKeys(t,e){const i=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${t}"`);const s=Promise.all(i).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(e)});return this.setMediaKeysQueue.push(s),s.then(()=>{this.log(`Media-keys set for "${t}"`),i.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(a=>i.indexOf(a)===-1)})}generateRequestWithPreferredKeySession(t,e,i,s){var a,n;const o=(a=this.config.drmSystems)==null||(n=a[t.keySystem])==null?void 0:n.generateRequest;if(o)try{const h=o.call(this.hls,e,i,t);if(!h)throw new Error("Invalid response from configured generateRequest filter");e=h.initDataType,i=t.decryptdata.pssh=h.initData?new Uint8Array(h.initData):null}catch(h){var l;if(this.warn(h.message),(l=this.hls)!=null&&l.config.debug)throw h}if(i===null)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(t);const u=this.getKeyIdString(t.decryptdata);this.log(`Generating key-session request for "${s}": ${u} (init data type: ${e} length: ${i?i.byteLength:null})`);const c=new jl;t.mediaKeysSession.onmessage=h=>{const f=t.mediaKeysSession;if(!f){c.emit("error",new Error("invalid state"));return}const{messageType:g,message:p}=h;this.log(`"${g}" message event for session "${f.sessionId}" message size: ${p.byteLength}`),g==="license-request"||g==="license-renewal"?this.renewLicense(t,p).catch(T=>{this.handleError(T),c.emit("error",T)}):g==="license-release"?t.keySystem===lt.FAIRPLAY&&(this.updateKeySession(t,pf("acknowledged")),this.removeSession(t)):this.warn(`unhandled media key message type "${g}"`)},t.mediaKeysSession.onkeystatuseschange=h=>{if(!t.mediaKeysSession){c.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(t);const f=t.keyStatus;c.emit("keyStatus",f),f==="expired"&&(this.warn(`${t.keySystem} expired for key ${u}`),this.renewKeySession(t))};const d=new Promise((h,f)=>{c.on("error",f),c.on("keyStatus",g=>{g.startsWith("usable")?h():g==="output-restricted"?f(new te({type:$.KEY_SYSTEM_ERROR,details:I.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):g==="internal-error"?f(new te({type:$.KEY_SYSTEM_ERROR,details:I.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${g}"`)):g==="expired"?f(new Error("key expired while generating request")):this.warn(`unhandled key status change "${g}"`)})});return t.mediaKeysSession.generateRequest(e,i).then(()=>{var h;this.log(`Request generated for key-session "${(h=t.mediaKeysSession)==null?void 0:h.sessionId}" keyId: ${u}`)}).catch(h=>{throw new te({type:$.KEY_SYSTEM_ERROR,details:I.KEY_SYSTEM_NO_SESSION,error:h,fatal:!1},`Error generating key-session request: ${h}`)}).then(()=>d).catch(h=>{throw c.removeAllListeners(),this.removeSession(t),h}).then(()=>(c.removeAllListeners(),t))}onKeyStatusChange(t){t.mediaKeysSession.keyStatuses.forEach((e,i)=>{this.log(`key status change "${e}" for keyStatuses keyId: ${be.hexDump("buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i))} session keyId: ${be.hexDump(new Uint8Array(t.decryptdata.keyId||[]))} uri: ${t.decryptdata.uri}`),t.keyStatus=e})}fetchServerCertificate(t){const e=this.config,i=e.loader,s=new i(e),a=this.getServerCertificateUrl(t);return a?(this.log(`Fetching serverCertificate for "${t}"`),new Promise((n,o)=>{const l={responseType:"arraybuffer",url:a},u=e.certLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(h,f,g,p)=>{n(h.data)},onError:(h,f,g,p)=>{o(new te({type:$.KEY_SYSTEM_ERROR,details:I.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:g,response:Wt({url:l.url,data:void 0},h)},`"${t}" certificate request failed (${a}). Status: ${h.code} (${h.text})`))},onTimeout:(h,f,g)=>{o(new te({type:$.KEY_SYSTEM_ERROR,details:I.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:g,response:{url:l.url,data:void 0}},`"${t}" certificate request timed out (${a})`))},onAbort:(h,f,g)=>{o(new Error("aborted"))}};s.load(l,c,d)})):Promise.resolve()}setMediaKeysServerCertificate(t,e,i){return new Promise((s,a)=>{t.setServerCertificate(i).then(n=>{this.log(`setServerCertificate ${n?"success":"not supported by CDM"} (${i==null?void 0:i.byteLength}) on "${e}"`),s(t)}).catch(n=>{a(new te({type:$.KEY_SYSTEM_ERROR,details:I.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:n,fatal:!0},n.message))})})}renewLicense(t,e){return this.requestLicense(t,new Uint8Array(e)).then(i=>this.updateKeySession(t,new Uint8Array(i)).catch(s=>{throw new te({type:$.KEY_SYSTEM_ERROR,details:I.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:s,fatal:!0},s.message)}))}setupLicenseXHR(t,e,i,s){const a=this.config.licenseXhrSetup;return a?Promise.resolve().then(()=>{if(!i.decryptdata)throw new Error("Key removed");return a.call(this.hls,t,e,i,s)}).catch(n=>{if(!i.decryptdata)throw n;return t.open("POST",e,!0),a.call(this.hls,t,e,i,s)}).then(n=>(t.readyState||t.open("POST",e,!0),{xhr:t,licenseChallenge:n||s})):(t.open("POST",e,!0),Promise.resolve({xhr:t,licenseChallenge:s}))}requestLicense(t,e){const i=this.config.keyLoadPolicy.default;return new Promise((s,a)=>{const n=this.getLicenseServerUrl(t.keySystem);this.log(`Sending license request to URL: ${n}`);const o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=()=>{if(!this.hls||!t.mediaKeysSession)return a(new Error("invalid state"));if(o.readyState===4)if(o.status===200){this._requestLicenseFailureCount=0;let l=o.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const u=this.config.licenseResponseCallback;if(u)try{l=u.call(this.hls,o,n,t)}catch(c){this.error(c)}s(l)}else{const l=i.errorRetry,u=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>u||o.status>=400&&o.status<500)a(new te({type:$.KEY_SYSTEM_ERROR,details:I.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:o,response:{url:n,data:void 0,code:o.status,text:o.statusText}},`License Request XHR failed (${n}). Status: ${o.status} (${o.statusText})`));else{const c=u-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${c} attempts left`),this.requestLicense(t,e).then(s,a)}}},t.licenseXhr&&t.licenseXhr.readyState!==XMLHttpRequest.DONE&&t.licenseXhr.abort(),t.licenseXhr=o,this.setupLicenseXHR(o,n,t,e).then(({xhr:l,licenseChallenge:u})=>{l.send(u)})})}onMediaAttached(t,e){if(!this.config.emeEnabled)return;const i=e.media;this.media=i,i.addEventListener("encrypted",this.onMediaEncrypted),i.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const t=this.media,e=this.mediaKeySessions;t&&(t.removeEventListener("encrypted",this.onMediaEncrypted),t.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},Ji.clearKeyUriToKeyIdMap();const i=e.length;ti.CDMCleanupPromise=Promise.all(e.map(s=>this.removeSession(s)).concat(t==null?void 0:t.setMediaKeys(null).catch(s=>{this.log(`Could not clear media keys: ${s}. media.src: ${t==null?void 0:t.src}`)}))).then(()=>{i&&(this.log("finished closing key sessions and clearing media keys"),e.length=0)}).catch(s=>{this.log(`Could not close sessions and clear media keys: ${s}. media.src: ${t==null?void 0:t.src}`)})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(t,{sessionKeys:e}){if(!(!e||!this.config.emeEnabled)&&!this.keyFormatPromise){const i=e.reduce((s,a)=>(s.indexOf(a.keyFormat)===-1&&s.push(a.keyFormat),s),[]);this.log(`Selecting key-system from session-keys ${i.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(i)}}removeSession(t){const{mediaKeysSession:e,licenseXhr:i}=t;if(e){this.log(`Remove licenses and keys and close session ${e.sessionId}`),e.onmessage=null,e.onkeystatuseschange=null,i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),t.mediaKeysSession=t.decryptdata=t.licenseXhr=void 0;const s=this.mediaKeySessions.indexOf(t);return s>-1&&this.mediaKeySessions.splice(s,1),e.remove().catch(a=>{this.log(`Could not remove session: ${a}`)}).then(()=>e.close()).catch(a=>{this.log(`Could not close session: ${a}`)})}}}ti.CDMCleanupPromise=void 0;class te extends Error{constructor(t,e){super(e),this.data=void 0,t.error||(t.error=new Error(e)),this.data=t,t.err=t.error}}const Pv=1;var Nt={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"};const xv="h";class Ye{constructor(t){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=s=>{try{this.apply(s,{ot:Nt.MANIFEST,su:!this.initialized})}catch(a){L.warn("Could not generate manifest CMCD data.",a)}},this.applyFragmentData=s=>{try{const a=s.frag,n=this.hls.levels[a.level],o=this.getObjectType(a),l={d:a.duration*1e3,ot:o};(o===Nt.VIDEO||o===Nt.AUDIO||o==Nt.MUXED)&&(l.br=n.bitrate/1e3,l.tb=this.getTopBandwidth(o)/1e3,l.bl=this.getBufferLength(o)),this.apply(s,l)}catch(a){L.warn("Could not generate segment CMCD data.",a)}},this.hls=t;const e=this.config=t.config,{cmcd:i}=e;i!=null&&(e.pLoader=this.createPlaylistLoader(),e.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||Ye.uuid(),this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.registerListeners())}registerListeners(){const t=this.hls;t.on(m.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(m.MEDIA_DETACHED,this.onMediaDetached,this),t.on(m.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const t=this.hls;t.off(m.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(m.MEDIA_DETACHED,this.onMediaDetached,this),t.off(m.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null}onMediaAttached(t,e){this.media=e.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(t,e){var i,s;this.audioBuffer=(i=e.tracks.audio)==null?void 0:i.buffer,this.videoBuffer=(s=e.tracks.video)==null?void 0:s.buffer}createData(){var t;return{v:Pv,sf:xv,sid:this.sid,cid:this.cid,pr:(t=this.media)==null?void 0:t.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(t,e={}){vt(e,this.createData());const i=e.ot===Nt.INIT||e.ot===Nt.VIDEO||e.ot===Nt.MUXED;if(this.starved&&i&&(e.bs=!0,e.su=!0,this.starved=!1),e.su==null&&(e.su=this.buffering),this.useHeaders){const s=Ye.toHeaders(e);if(!Object.keys(s).length)return;t.headers||(t.headers={}),vt(t.headers,s)}else{const s=Ye.toQuery(e);if(!s)return;t.url=Ye.appendQueryToUri(t.url,s)}}getObjectType(t){const{type:e}=t;if(e==="subtitle")return Nt.TIMED_TEXT;if(t.sn==="initSegment")return Nt.INIT;if(e==="audio")return Nt.AUDIO;if(e==="main")return this.hls.audioTracks.length?Nt.VIDEO:Nt.MUXED}getTopBandwidth(t){let e=0,i;const s=this.hls;if(t===Nt.AUDIO)i=s.audioTracks;else{const a=s.maxAutoLevel,n=a>-1?a+1:s.levels.length;i=s.levels.slice(0,n)}for(const a of i)a.bitrate>e&&(e=a.bitrate);return e>0?e:NaN}getBufferLength(t){const e=this.hls.media,i=t===Nt.AUDIO?this.audioBuffer:this.videoBuffer;return!i||!e?NaN:rt.bufferInfo(i,e.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:t}=this.config,e=this.applyPlaylistData,i=t||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new i(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,a,n){e(s),this.loader.load(s,a,n)}}}createFragmentLoader(){const{fLoader:t}=this.config,e=this.applyFragmentData,i=t||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new i(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,a,n){e(s),this.loader.load(s,a,n)}}}static uuid(){const t=URL.createObjectURL(new Blob),e=t.toString();return URL.revokeObjectURL(t),e.slice(e.lastIndexOf("/")+1)}static serialize(t){const e=[],i=l=>!Number.isNaN(l)&&l!=null&&l!==""&&l!==!1,s=l=>Math.round(l),a=l=>s(l/100)*100,n={br:s,d:s,bl:a,dl:a,mtp:a,nor:l=>encodeURIComponent(l),rtp:a,tb:s},o=Object.keys(t||{}).sort();for(const l of o){let u=t[l];if(!i(u)||l==="v"&&u===1||l=="pr"&&u===1)continue;const c=n[l];c&&(u=c(u));const d=typeof u;let h;l==="ot"||l==="sf"||l==="st"?h=`${l}=${u}`:d==="boolean"?h=l:d==="number"?h=`${l}=${u}`:h=`${l}=${JSON.stringify(u)}`,e.push(h)}return e.join(",")}static toHeaders(t){const e=Object.keys(t),i={},s=["Object","Request","Session","Status"],a=[{},{},{},{}],n={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3};for(const o of e){const l=n[o]!=null?n[o]:1;a[l][o]=t[o]}for(let o=0;o<a.length;o++){const l=Ye.serialize(a[o]);l&&(i[`CMCD-${s[o]}`]=l)}return i}static toQuery(t){return`CMCD=${encodeURIComponent(Ye.serialize(t))}`}static appendQueryToUri(t,e){if(!e)return t;const i=t.includes("?")?"&":"?";return`${t}${i}${e}`}}const Ov=3e5;class Fv{constructor(t){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=t,this.log=L.log.bind(L,"[content-steering]:"),this.registerListeners()}registerListeners(){const t=this.hls;t.on(m.MANIFEST_LOADING,this.onManifestLoading,this),t.on(m.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(m.MANIFEST_PARSED,this.onManifestParsed,this),t.on(m.ERROR,this.onError,this)}unregisterListeners(){const t=this.hls;!t||(t.off(m.MANIFEST_LOADING,this.onManifestLoading,this),t.off(m.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(m.MANIFEST_PARSED,this.onManifestParsed,this),t.off(m.ERROR,this.onError,this))}startLoad(){if(this.started=!0,self.clearTimeout(this.reloadTimer),this.enabled&&this.uri)if(this.updated){const t=Math.max(this.timeToLoad*1e3-(performance.now()-this.updated),0);this.scheduleRefresh(this.uri,t)}else this.loadSteeringManifest(this.uri)}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),self.clearTimeout(this.reloadTimer)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(t){const e=this.levels;e&&(this.levels=e.filter(i=>i!==t))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(t,e){const{contentSteering:i}=e;i!==null&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(t,e){this.audioTracks=e.audioTracks,this.subtitleTracks=e.subtitleTracks}onError(t,e){const{errorAction:i}=e;if((i==null?void 0:i.action)===Bt.SendAlternateToPenaltyBox&&i.flags===ue.MoveAllAlternatesMatchingHost){let s=this.pathwayPriority;const a=this.pathwayId;this.penalizedPathways[a]||(this.penalizedPathways[a]=performance.now()),!s&&this.levels&&(s=this.levels.reduce((n,o)=>(n.indexOf(o.pathwayId)===-1&&n.push(o.pathwayId),n),[])),s&&s.length>1&&(this.updatePathwayPriority(s),i.resolved=this.pathwayId!==a)}}filterParsedLevels(t){this.levels=t;let e=this.getLevelsForPathway(this.pathwayId);if(e.length===0){const i=t[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${i}"`),e=this.getLevelsForPathway(i),this.pathwayId=i}return e.length!==t.length?(this.log(`Found ${e.length}/${t.length} levels in Pathway "${this.pathwayId}"`),e):t}getLevelsForPathway(t){return this.levels===null?[]:this.levels.filter(e=>t===e.pathwayId)}updatePathwayPriority(t){this.pathwayPriority=t;let e;const i=this.penalizedPathways,s=performance.now();Object.keys(i).forEach(a=>{s-i[a]>Ov&&delete i[a]});for(let a=0;a<t.length;a++){const n=t[a];if(i[n])continue;if(n===this.pathwayId)return;const o=this.hls.nextLoadLevel,l=this.hls.levels[o];if(e=this.getLevelsForPathway(n),e.length>0){this.log(`Setting Pathway to "${n}"`),this.pathwayId=n,this.hls.trigger(m.LEVELS_UPDATED,{levels:e});const u=this.hls.levels[o];l&&u&&this.levels&&(u.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&u.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${u.bitrate}`),this.hls.nextLoadLevel=o);break}}}clonePathways(t){const e=this.levels;if(!e)return;const i={},s={};t.forEach(a=>{const{ID:n,"BASE-ID":o,"URI-REPLACEMENT":l}=a;if(e.some(c=>c.pathwayId===n))return;const u=this.getLevelsForPathway(o).map(c=>{const d=vt({},c);d.details=void 0,d.url=lg(c.uri,c.attrs["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l);const h=new nt(c.attrs);h["PATHWAY-ID"]=n;const f=h.AUDIO&&`${h.AUDIO}_clone_${n}`,g=h.SUBTITLES&&`${h.SUBTITLES}_clone_${n}`;f&&(i[h.AUDIO]=f,h.AUDIO=f),g&&(s[h.SUBTITLES]=g,h.SUBTITLES=g),d.attrs=h;const p=new Zi(d);return Ta(p,"audio",f),Ta(p,"text",g),p});e.push(...u),Zc(this.audioTracks,i,l,n),Zc(this.subtitleTracks,s,l,n)})}loadSteeringManifest(t){const e=this.hls.config,i=e.loader;this.loader&&this.loader.destroy(),this.loader=new i(e);let s;try{s=new self.URL(t)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${t}`);return}if(s.protocol!=="data:"){const c=(this.hls.bandwidthEstimate||e.abrEwmaDefaultEstimate)|0;s.searchParams.set("_HLS_pathway",this.pathwayId),s.searchParams.set("_HLS_throughput",""+c)}const a={responseType:"json",url:s.href},n=e.steeringManifestLoadPolicy.default,o=n.errorRetry||n.timeoutRetry||{},l={loadPolicy:n,timeout:n.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},u={onSuccess:(c,d,h,f)=>{this.log(`Loaded steering manifest: "${s}"`);const g=c.data;if(g.VERSION!==1){this.log(`Steering VERSION ${g.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=g.TTL;const{"RELOAD-URI":p,"PATHWAY-CLONES":T,"PATHWAY-PRIORITY":y}=g;if(p)try{this.uri=new self.URL(p,s).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${p}`);return}this.scheduleRefresh(this.uri||h.url),T&&this.clonePathways(T),y&&this.updatePathwayPriority(y)},onError:(c,d,h,f)=>{if(this.log(`Error loading steering manifest: ${c.code} ${c.text} (${d.url})`),this.stopLoad(),c.code===410){this.enabled=!1,this.log(`Steering manifest ${d.url} no longer available`);return}let g=this.timeToLoad*1e3;if(c.code===429){const p=this.loader;if(typeof(p==null?void 0:p.getResponseHeader)=="function"){const T=p.getResponseHeader("Retry-After");T&&(g=parseFloat(T)*1e3)}this.log(`Steering manifest ${d.url} rate limited`);return}this.scheduleRefresh(this.uri||d.url,g)},onTimeout:(c,d,h)=>{this.log(`Timeout loading steering manifest (${d.url})`),this.scheduleRefresh(this.uri||d.url)}};this.log(`Requesting steering manifest: ${s}`),this.loader.load(a,l,u)}scheduleRefresh(t,e=this.timeToLoad*1e3){self.clearTimeout(this.reloadTimer),this.reloadTimer=self.setTimeout(()=>{this.loadSteeringManifest(t)},e)}}function Zc(r,t,e,i){!r||Object.keys(t).forEach(s=>{const a=r.filter(n=>n.groupId===s).map(n=>{const o=vt({},n);return o.details=void 0,o.attrs=new nt(o.attrs),o.url=o.attrs.URI=lg(n.url,n.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",e),o.groupId=o.attrs["GROUP-ID"]=t[s],o.attrs["PATHWAY-ID"]=i,o});r.push(...a)})}function lg(r,t,e,i){const{HOST:s,PARAMS:a,[e]:n}=i;let o;t&&(o=n==null?void 0:n[t],o&&(r=o));const l=new self.URL(r);return s&&!o&&(l.host=s),a&&Object.keys(a).sort().forEach(u=>{u&&l.searchParams.set(u,a[u])}),l.href}const Mv=/^age:\s*[\d.]+\s*$/im;class ug{constructor(t){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=t&&t.xhrSetup||null,this.stats=new Ua,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null}abortInternal(){const t=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),t&&(t.onreadystatechange=null,t.onprogress=null,t.readyState!==4&&(this.stats.aborted=!0,t.abort()))}abort(){var t;this.abortInternal(),(t=this.callbacks)!=null&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(t,e,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=t,this.config=e,this.callbacks=i,this.loadInternal()}loadInternal(){const{config:t,context:e}=this;if(!t)return;const i=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0;const a=this.xhrSetup;a?Promise.resolve().then(()=>{if(!this.stats.aborted)return a(i,e.url)}).catch(n=>(i.open("GET",e.url,!0),a(i,e.url))).then(()=>{this.stats.aborted||this.openAndSendXhr(i,e,t)}).catch(n=>{this.callbacks.onError({code:i.status,text:n.message},e,i,s)}):this.openAndSendXhr(i,e,t)}openAndSendXhr(t,e,i){t.readyState||t.open("GET",e.url,!0);const s=this.context.headers,{maxTimeToFirstByteMs:a,maxLoadTimeMs:n}=i.loadPolicy;if(s)for(const o in s)t.setRequestHeader(o,s[o]);e.rangeEnd&&t.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=e.responseType,self.clearTimeout(this.requestTimeout),i.timeout=a&&B(a)?a:n,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),t.send()}readystatechange(){const{context:t,loader:e,stats:i}=this;if(!t||!e)return;const s=e.readyState,a=this.config;if(!i.aborted&&s>=2&&(i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),a.timeout!==a.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),a.timeout=a.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),a.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),s===4)){self.clearTimeout(this.requestTimeout),e.onreadystatechange=null,e.onprogress=null;const n=e.status,o=e.responseType!=="text";if(n>=200&&n<300&&(o&&e.response||e.responseText!==null)){i.loading.end=Math.max(self.performance.now(),i.loading.first);const l=o?e.response:e.responseText,u=e.responseType==="arraybuffer"?l.byteLength:l.length;if(i.loaded=i.total=u,i.bwEstimate=i.total*8e3/(i.loading.end-i.loading.first),!this.callbacks)return;const c=this.callbacks.onProgress;if(c&&c(i,t,l,e),!this.callbacks)return;const d={url:e.responseURL,data:l,code:n};this.callbacks.onSuccess(d,i,t,e)}else{const l=a.loadPolicy.errorRetry,u=i.retry;Ea(l,u,!1,n)?this.retry(l):(L.error(`${n} while loading ${t.url}`),this.callbacks.onError({code:n,text:e.statusText},t,e,i))}}}loadtimeout(){var t;const e=(t=this.config)==null?void 0:t.loadPolicy.timeoutRetry,i=this.stats.retry;if(Ea(e,i,!0))this.retry(e);else{L.warn(`timeout while loading ${this.context.url}`);const s=this.callbacks;s&&(this.abortInternal(),s.onTimeout(this.stats,this.context,this.loader))}}retry(t){const{context:e,stats:i}=this;this.retryDelay=Bl(t,i.retry),i.retry++,L.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${e.url}, retrying ${i.retry}/${t.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(t){const e=this.stats;e.loaded=t.loaded,t.lengthComputable&&(e.total=t.total)}getCacheAge(){let t=null;if(this.loader&&Mv.test(this.loader.getAllResponseHeaders())){const e=this.loader.getResponseHeader("age");t=e?parseFloat(e):null}return t}getResponseHeader(t){return this.loader&&new RegExp(`^${t}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(t):null}}function Nv(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const Uv=/(\d+)-(\d+)\/(\d+)/;class td{constructor(t){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=t.fetchSetup||Kv,this.controller=new self.AbortController,this.stats=new Ua}destroy(){this.loader=this.callbacks=null,this.abortInternal()}abortInternal(){const t=this.response;t!=null&&t.ok||(this.stats.aborted=!0,this.controller.abort())}abort(){var t;this.abortInternal(),(t=this.callbacks)!=null&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(t,e,i){const s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();const a=Bv(t,this.controller.signal),n=i.onProgress,o=t.responseType==="arraybuffer",l=o?"byteLength":"length",{maxTimeToFirstByteMs:u,maxLoadTimeMs:c}=e.loadPolicy;this.context=t,this.config=e,this.callbacks=i,this.request=this.fetchSetup(t,a),self.clearTimeout(this.requestTimeout),e.timeout=u&&B(u)?u:c,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),i.onTimeout(s,t,this.response)},e.timeout),self.fetch(this.request).then(d=>{this.response=this.loader=d;const h=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(this.requestTimeout),e.timeout=c,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),i.onTimeout(s,t,this.response)},c-(h-s.loading.start)),!d.ok){const{status:f,statusText:g}=d;throw new Vv(g||"fetch, bad network response",f,d)}return s.loading.first=h,s.total=Gv(d.headers)||s.total,n&&B(e.highWaterMark)?this.loadProgressively(d,s,t,e.highWaterMark,n):o?d.arrayBuffer():t.responseType==="json"?d.json():d.text()}).then(d=>{const{response:h}=this;self.clearTimeout(this.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);const f=d[l];f&&(s.loaded=s.total=f);const g={url:h.url,data:d,code:h.status};n&&!B(e.highWaterMark)&&n(s,t,d,h),i.onSuccess(g,s,t,h)}).catch(d=>{if(self.clearTimeout(this.requestTimeout),s.aborted)return;const h=d&&d.code||0,f=d?d.message:null;i.onError({code:h,text:f},t,d?d.details:null,s)})}getCacheAge(){let t=null;if(this.response){const e=this.response.headers.get("age");t=e?parseFloat(e):null}return t}getResponseHeader(t){return this.response?this.response.headers.get(t):null}loadProgressively(t,e,i,s=0,a){const n=new Jf,o=t.body.getReader(),l=()=>o.read().then(u=>{if(u.done)return n.dataLength&&a(e,i,n.flush(),t),Promise.resolve(new ArrayBuffer(0));const c=u.value,d=c.length;return e.loaded+=d,d<s||n.dataLength?(n.push(c),n.dataLength>=s&&a(e,i,n.flush(),t)):a(e,i,c,t),l()}).catch(()=>Promise.reject());return l()}}function Bv(r,t){const e={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(vt({},r.headers))};return r.rangeEnd&&e.headers.set("Range","bytes="+r.rangeStart+"-"+String(r.rangeEnd-1)),e}function $v(r){const t=Uv.exec(r);if(t)return parseInt(t[2])-parseInt(t[1])+1}function Gv(r){const t=r.get("Content-Range");if(t){const i=$v(t);if(B(i))return i}const e=r.get("Content-Length");if(e)return parseInt(e)}function Kv(r,t){return new self.Request(r.url,t)}class Vv extends Error{constructor(t,e,i){super(t),this.code=void 0,this.details=void 0,this.code=e,this.details=i}}const Hv=/\s/,zv={newCue(r,t,e,i){const s=[];let a,n,o,l,u;const c=self.VTTCue||self.TextTrackCue;for(let h=0;h<i.rows.length;h++)if(a=i.rows[h],o=!0,l=0,u="",!a.isEmpty()){var d;for(let p=0;p<a.chars.length;p++)Hv.test(a.chars[p].uchar)&&o?l++:(u+=a.chars[p].uchar,o=!1);a.cueStartTime=t,t===e&&(e+=1e-4),l>=16?l--:l++;const f=sg(u.trim()),g=Xl(t,e,f);r!=null&&(d=r.cues)!=null&&d.getCueById(g)||(n=new c(t,e,f),n.id=g,n.line=h+1,n.align="left",n.position=10+Math.min(80,Math.floor(l*8/32)*10),s.push(n))}return r&&s.length&&(s.sort((h,f)=>h.line==="auto"||f.line==="auto"?0:h.line>8&&f.line>8?f.line-h.line:h.line-f.line),s.forEach(h=>Cf(r,h))),s}},Wv={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},Yv=Wt(Wt({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:ug,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:Qy,bufferController:nv,capLevelController:Ql,errorController:V0,fpsController:_v,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:yf,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,certLoadPolicy:{default:Wv},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},jv()),{},{subtitleStreamController:rv,subtitleTrackController:sv,timelineController:Iv,audioStreamController:Zy,audioTrackController:tv,emeController:ti,cmcdController:Ye,contentSteeringController:Fv});function jv(){return{cueHandler:zv,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function qv(r,t){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(t.liveMaxLatencyDurationCount!==void 0&&(t.liveSyncDurationCount===void 0||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(t.liveMaxLatencyDuration!==void 0&&(t.liveSyncDuration===void 0||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const e=Go(r),i=["manifest","level","frag"],s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return i.forEach(a=>{const n=`${a==="level"?"playlist":a}LoadPolicy`,o=t[n]===void 0,l=[];s.forEach(u=>{const c=`${a}Loading${u}`,d=t[c];if(d!==void 0&&o){l.push(c);const h=e[n].default;switch(t[n]={default:h},u){case"TimeOut":h.maxLoadTimeMs=d,h.maxTimeToFirstByteMs=d;break;case"MaxRetry":h.errorRetry.maxNumRetry=d,h.timeoutRetry.maxNumRetry=d;break;case"RetryDelay":h.errorRetry.retryDelayMs=d,h.timeoutRetry.retryDelayMs=d;break;case"MaxRetryTimeout":h.errorRetry.maxRetryDelayMs=d,h.timeoutRetry.maxRetryDelayMs=d;break}}}),l.length&&L.warn(`hls.js config: "${l.join('", "')}" setting(s) are deprecated, use "${n}": ${JSON.stringify(t[n])}`)}),Wt(Wt({},e),t)}function Go(r){return r&&typeof r=="object"?Array.isArray(r)?r.map(Go):Object.keys(r).reduce((t,e)=>(t[e]=Go(r[e]),t),{}):r}function Xv(r){const t=r.loader;t!==td&&t!==ug?(L.log("[config]: Custom loader detected, cannot enable progressive streaming"),r.progressive=!1):Nv()&&(r.loader=td,r.progressive=!0,r.enableSoftwareAES=!0,L.log("[config]: Progressive streaming enabled, using FetchLoader"))}class Fe{static get version(){return"1.4.4"}static isSupported(){return ly()}static get Events(){return m}static get ErrorTypes(){return $}static get ErrorDetails(){return I}static get DefaultConfig(){return Fe.defaultConfig?Fe.defaultConfig:Yv}static set DefaultConfig(t){Fe.defaultConfig=t}constructor(t={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new jl,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,Om(t.debug||!1,"Hls instance");const e=this.config=qv(Fe.DefaultConfig,t);this.userConfig=t,this._autoLevelCapping=-1,e.progressive&&Xv(e);const{abrController:i,bufferController:s,capLevelController:a,errorController:n,fpsController:o}=e,l=new n(this),u=this.abrController=new i(this),c=this.bufferController=new s(this),d=this.capLevelController=new a(this),h=new o(this),f=new k0(this),g=new D0(this),p=e.contentSteeringController,T=p?new p(this):null,y=this.levelController=new z0(this,T),v=new W0(this),E=new j0(this.config),S=this.streamController=new qy(this,v,E);d.setStreamController(S),h.setStreamController(S);const b=[f,y,S];T&&b.splice(1,0,T),this.networkControllers=b;const w=[u,c,d,h,g,v];this.audioTrackController=this.createController(e.audioTrackController,b);const k=e.audioStreamController;k&&b.push(new k(this,v,E)),this.subtitleTrackController=this.createController(e.subtitleTrackController,b);const D=e.subtitleStreamController;D&&b.push(new D(this,v,E)),this.createController(e.timelineController,w),E.emeController=this.emeController=this.createController(e.emeController,w),this.cmcdController=this.createController(e.cmcdController,w),this.latencyController=this.createController(C0,w),this.coreComponents=w,b.push(l);const P=l.onErrorOut;typeof P=="function"&&this.on(m.ERROR,P,l)}createController(t,e){if(t){const i=new t(this);return e&&e.push(i),i}return null}on(t,e,i=this){this._emitter.on(t,e,i)}once(t,e,i=this){this._emitter.once(t,e,i)}removeAllListeners(t){this._emitter.removeAllListeners(t)}off(t,e,i=this,s){this._emitter.off(t,e,i,s)}listeners(t){return this._emitter.listeners(t)}emit(t,e,i){return this._emitter.emit(t,e,i)}trigger(t,e){if(this.config.debug)return this.emit(t,t,e);try{return this.emit(t,t,e)}catch(i){L.error("An internal error happened while handling event "+t+'. Error message: "'+i.message+'". Here is a stacktrace:',i),this.trigger(m.ERROR,{type:$.OTHER_ERROR,details:I.INTERNAL_EXCEPTION,fatal:!1,event:t,error:i})}return!1}listenerCount(t){return this._emitter.listenerCount(t)}destroy(){L.log("destroy"),this.trigger(m.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(e=>e.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(e=>e.destroy()),this.coreComponents.length=0;const t=this.config;t.xhrSetup=t.fetchSetup=void 0,this.userConfig=null}attachMedia(t){L.log("attachMedia"),this._media=t,this.trigger(m.MEDIA_ATTACHING,{media:t})}detachMedia(){L.log("detachMedia"),this.trigger(m.MEDIA_DETACHING,void 0),this._media=null}loadSource(t){this.stopLoad();const e=this.media,i=this.url,s=this.url=Ml.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});L.log(`loadSource:${s}`),e&&i&&(i!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(e)),this.trigger(m.MANIFEST_LOADING,{url:t})}startLoad(t=-1){L.log(`startLoad(${t})`),this.networkControllers.forEach(e=>{e.startLoad(t)})}stopLoad(){L.log("stopLoad"),this.networkControllers.forEach(t=>{t.stopLoad()})}swapAudioCodec(){L.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){L.log("recoverMediaError");const t=this._media;this.detachMedia(),t&&this.attachMedia(t)}removeLevel(t,e=0){this.levelController.removeLevel(t,e)}get levels(){return this.levelController.levels||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(t){L.log(`set currentLevel:${t}`),this.loadLevel=t,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(t){L.log(`set nextLevel:${t}`),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(t){L.log(`set loadLevel:${t}`),this.levelController.manualLevel=t}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(t){this.levelController.nextLoadLevel=t}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(t){L.log(`set firstLevel:${t}`),this.levelController.firstLevel=t}get startLevel(){return this.levelController.startLevel}set startLevel(t){L.log(`set startLevel:${t}`),t!==-1&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(t){const e=!!t;e!==this.config.capLevelToPlayerSize&&(e?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=e)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:t}=this.abrController;return t?t.getEstimate():NaN}get ttfbEstimate(){const{bwEstimator:t}=this.abrController;return t?t.getEstimateTTFB():NaN}set autoLevelCapping(t){this._autoLevelCapping!==t&&(L.log(`set autoLevelCapping:${t}`),this._autoLevelCapping=t)}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(t){Mo.indexOf(t)>-1&&(this._maxHdcpLevel=t)}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:t,config:{minAutoBitrate:e}}=this;if(!t)return 0;const i=t.length;for(let s=0;s<i;s++)if(t[s].maxBitrate>=e)return s;return 0}get maxAutoLevel(){const{levels:t,autoLevelCapping:e,maxHdcpLevel:i}=this;let s;if(e===-1&&t&&t.length?s=t.length-1:s=e,i)for(let a=s;a--;){const n=t[a].attrs["HDCP-LEVEL"];if(n&&n<=i)return a}return s}get nextAutoLevel(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)}set nextAutoLevel(t){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,t)}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get audioTracks(){const t=this.audioTrackController;return t?t.audioTracks:[]}get audioTrack(){const t=this.audioTrackController;return t?t.audioTrack:-1}set audioTrack(t){const e=this.audioTrackController;e&&(e.audioTrack=t)}get subtitleTracks(){const t=this.subtitleTrackController;return t?t.subtitleTracks:[]}get subtitleTrack(){const t=this.subtitleTrackController;return t?t.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(t){const e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}get subtitleDisplay(){const t=this.subtitleTrackController;return t?t.subtitleDisplay:!1}set subtitleDisplay(t){const e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(t){this.config.lowLatencyMode=t}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}Fe.defaultConfig=void 0;function Qv(r){let t=["line","\u7EBF\u8DEF"],e={};for(let[i,s]of Object.entries(r))(i.startsWith(t[0])||i.startsWith(t[1]))&&(e[i]=Array.isArray(s)?s[0]:s);return e}function Jv(){let r=Qv(window.__meta||{line1:"https://vip.lzcdn2.com/20220318/37_8786d09c/1200k/hls/mixed.m3u8",line2:"xx"}),t=Object.keys(r);ba.exports.useEffect(()=>{e(r[t[0]])});function e(i){const s=document.getElementById("video");if(Fe.isSupported()){const a=new Fe;a.loadSource(i),a.attachMedia(s),a.on(Fe.Events.MANIFEST_PARSED,function(){})}else s.canPlayType("application/vnd.apple.mpegurl")&&(s.src=i,s.addEventListener("loadedmetadata",function(){}))}return pr.createElement(pr.Fragment,null,pr.createElement("video",{controls:!0,autoPlay:!1,style:{width:"100%"},id:"video"}),t.map(i=>pr.createElement("button",{key:i,onClick:e.bind(null,r[i])},i)))}Bn.createRoot(document.getElementById("root-video")).render(pr.createElement(pr.StrictMode,null,pr.createElement(Jv,null)));
